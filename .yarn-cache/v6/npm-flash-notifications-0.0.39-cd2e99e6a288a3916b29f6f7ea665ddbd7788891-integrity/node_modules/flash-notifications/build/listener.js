import events from "./events.js";
export default class FlashNotificationsListener {
    notifications = [];
    static current() {
        if (!globalThis.flashNotificationsListener) {
            globalThis.flashNotificationsListener = new FlashNotificationsListener();
            globalThis.flashNotificationsListener.connect(events);
        }
        return globalThis.flashNotificationsListener;
    }
    connect(events) {
        events.addListener("pushNotification", this.onPushNotification);
    }
    findAndPop(argument) {
        for (const notificationIndex in this.notifications) {
            const notification = this.notifications[notificationIndex];
            let result;
            if (typeof argument == "function") {
                result = argument(notification);
            }
            else if (typeof argument == "object") {
                let allEqual = true;
                for (const key in argument) {
                    const value = argument[key];
                    if (value !== notification[key]) {
                        allEqual = false;
                    }
                }
                result = allEqual;
            }
            else {
                throw new Error(`Unknown type of argument: ${typeof argument}`);
            }
            if (result) {
                delete this.notifications[notificationIndex];
                return notification;
            }
        }
        throw new Error(`Couldn't find the expected notification in: ${JSON.stringify(this.notifications)}`);
    }
    onPushNotification = (notification) => {
        this.notifications.push(notification);
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdGVuZXIuanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbImxpc3RlbmVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sTUFBTSxNQUFNLGFBQWEsQ0FBQTtBQUVoQyxNQUFNLENBQUMsT0FBTyxPQUFPLDBCQUEwQjtJQUM3QyxhQUFhLEdBQUcsRUFBRSxDQUFBO0lBRWxCLE1BQU0sQ0FBQyxPQUFPO1FBQ1osSUFBSSxDQUFDLFVBQVUsQ0FBQywwQkFBMEIsRUFBRSxDQUFDO1lBQzNDLFVBQVUsQ0FBQywwQkFBMEIsR0FBRyxJQUFJLDBCQUEwQixFQUFFLENBQUE7WUFFeEUsVUFBVSxDQUFDLDBCQUEwQixDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUN2RCxDQUFDO1FBRUQsT0FBTyxVQUFVLENBQUMsMEJBQTBCLENBQUE7SUFDOUMsQ0FBQztJQUVELE9BQU8sQ0FBQyxNQUFNO1FBQ1osTUFBTSxDQUFDLFdBQVcsQ0FBQyxrQkFBa0IsRUFBRSxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQTtJQUNqRSxDQUFDO0lBRUQsVUFBVSxDQUFDLFFBQVE7UUFDakIsS0FBSyxNQUFNLGlCQUFpQixJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUNuRCxNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLGlCQUFpQixDQUFDLENBQUE7WUFDMUQsSUFBSSxNQUFNLENBQUE7WUFFVixJQUFJLE9BQU8sUUFBUSxJQUFJLFVBQVUsRUFBRSxDQUFDO2dCQUNsQyxNQUFNLEdBQUcsUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFBO1lBQ2pDLENBQUM7aUJBQU0sSUFBSSxPQUFPLFFBQVEsSUFBSSxRQUFRLEVBQUUsQ0FBQztnQkFDdkMsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFBO2dCQUVuQixLQUFLLE1BQU0sR0FBRyxJQUFJLFFBQVEsRUFBRSxDQUFDO29CQUMzQixNQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUE7b0JBRTNCLElBQUksS0FBSyxLQUFLLFlBQVksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO3dCQUNoQyxRQUFRLEdBQUcsS0FBSyxDQUFBO29CQUNsQixDQUFDO2dCQUNILENBQUM7Z0JBRUQsTUFBTSxHQUFHLFFBQVEsQ0FBQTtZQUNuQixDQUFDO2lCQUFNLENBQUM7Z0JBQ04sTUFBTSxJQUFJLEtBQUssQ0FBQyw2QkFBNkIsT0FBTyxRQUFRLEVBQUUsQ0FBQyxDQUFBO1lBQ2pFLENBQUM7WUFFRCxJQUFJLE1BQU0sRUFBRSxDQUFDO2dCQUNYLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFBO2dCQUU1QyxPQUFPLFlBQVksQ0FBQTtZQUNyQixDQUFDO1FBQ0gsQ0FBQztRQUVELE1BQU0sSUFBSSxLQUFLLENBQUMsK0NBQStDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQTtJQUN0RyxDQUFDO0lBRUQsa0JBQWtCLEdBQUcsQ0FBQyxZQUFZLEVBQUUsRUFBRTtRQUNwQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQTtJQUN2QyxDQUFDLENBQUE7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBldmVudHMgZnJvbSBcIi4vZXZlbnRzLmpzXCJcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRmxhc2hOb3RpZmljYXRpb25zTGlzdGVuZXIge1xuICBub3RpZmljYXRpb25zID0gW11cblxuICBzdGF0aWMgY3VycmVudCgpIHtcbiAgICBpZiAoIWdsb2JhbFRoaXMuZmxhc2hOb3RpZmljYXRpb25zTGlzdGVuZXIpIHtcbiAgICAgIGdsb2JhbFRoaXMuZmxhc2hOb3RpZmljYXRpb25zTGlzdGVuZXIgPSBuZXcgRmxhc2hOb3RpZmljYXRpb25zTGlzdGVuZXIoKVxuXG4gICAgICBnbG9iYWxUaGlzLmZsYXNoTm90aWZpY2F0aW9uc0xpc3RlbmVyLmNvbm5lY3QoZXZlbnRzKVxuICAgIH1cblxuICAgIHJldHVybiBnbG9iYWxUaGlzLmZsYXNoTm90aWZpY2F0aW9uc0xpc3RlbmVyXG4gIH1cblxuICBjb25uZWN0KGV2ZW50cykge1xuICAgIGV2ZW50cy5hZGRMaXN0ZW5lcihcInB1c2hOb3RpZmljYXRpb25cIiwgdGhpcy5vblB1c2hOb3RpZmljYXRpb24pXG4gIH1cblxuICBmaW5kQW5kUG9wKGFyZ3VtZW50KSB7XG4gICAgZm9yIChjb25zdCBub3RpZmljYXRpb25JbmRleCBpbiB0aGlzLm5vdGlmaWNhdGlvbnMpIHtcbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IHRoaXMubm90aWZpY2F0aW9uc1tub3RpZmljYXRpb25JbmRleF1cbiAgICAgIGxldCByZXN1bHRcblxuICAgICAgaWYgKHR5cGVvZiBhcmd1bWVudCA9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgcmVzdWx0ID0gYXJndW1lbnQobm90aWZpY2F0aW9uKVxuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYXJndW1lbnQgPT0gXCJvYmplY3RcIikge1xuICAgICAgICBsZXQgYWxsRXF1YWwgPSB0cnVlXG5cbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gYXJndW1lbnQpIHtcbiAgICAgICAgICBjb25zdCB2YWx1ZSA9IGFyZ3VtZW50W2tleV1cblxuICAgICAgICAgIGlmICh2YWx1ZSAhPT0gbm90aWZpY2F0aW9uW2tleV0pIHtcbiAgICAgICAgICAgIGFsbEVxdWFsID0gZmFsc2VcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXN1bHQgPSBhbGxFcXVhbFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIHR5cGUgb2YgYXJndW1lbnQ6ICR7dHlwZW9mIGFyZ3VtZW50fWApXG4gICAgICB9XG5cbiAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgZGVsZXRlIHRoaXMubm90aWZpY2F0aW9uc1tub3RpZmljYXRpb25JbmRleF1cblxuICAgICAgICByZXR1cm4gbm90aWZpY2F0aW9uXG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZG4ndCBmaW5kIHRoZSBleHBlY3RlZCBub3RpZmljYXRpb24gaW46ICR7SlNPTi5zdHJpbmdpZnkodGhpcy5ub3RpZmljYXRpb25zKX1gKVxuICB9XG5cbiAgb25QdXNoTm90aWZpY2F0aW9uID0gKG5vdGlmaWNhdGlvbikgPT4ge1xuICAgIHRoaXMubm90aWZpY2F0aW9ucy5wdXNoKG5vdGlmaWNhdGlvbilcbiAgfVxufVxuIl19