// @ts-check
class TimeoutError extends Error {
}
/**
 * Runs a callback with a timeout.
 * @template T
 * @overload
 * @param {() => (T | Promise<T>)} callback - The callback to run.
 * @returns {Promise<T>} Resolves with the callback result.
 */
/**
 * Runs a callback with a timeout.
 * @template T
 * @overload
 * @param {object} args - The arguments.
 * @param {number} args.timeout - The timeout in milliseconds (default: 5000).
 * @param {string} [args.errorMessage] - The error message when timing out.
 * @param {() => (T | Promise<T>)} callback - The callback to run.
 * @returns {Promise<T>} Resolves with the callback result.
 */
/**
 * Runs a callback with a timeout.
 * @template T
 * @param {object | (() => (T | Promise<T>))} arg1 - The arguments or the callback.
 * @param {() => (T | Promise<T>)} [arg2] - The callback when arguments are provided.
 * @returns {Promise<T>} Resolves with the callback result.
 */
export default async function timeout(arg1, arg2) {
    /** @type {object | undefined} */
    let args;
    /** @type {(() => (T | Promise<T>)) | undefined} */
    let callback;
    if (typeof arg1 == "function" && arg2 === undefined) {
        args = { timeout: 5000 };
        callback = arg1;
    }
    else if (typeof arg1 == "object" && typeof arg2 == "function") {
        args = arg1;
        callback = arg2;
    }
    if (callback == undefined)
        throw new Error("Somehow callback is undefined");
    if (args == null || typeof args !== "object")
        throw new Error("Somehow args isn't an object");
    const { timeout: timeoutNumber, errorMessage = "Timeout while trying", ...restArgs } = args;
    const restArgsKeys = Object.keys(restArgs);
    if (restArgsKeys.length > 0)
        throw new Error(`Unknown arguments given to timeout: ${restArgsKeys.join(", ")}`);
    let timeoutId;
    const timeoutPromise = new Promise((_, reject) => {
        timeoutId = setTimeout(() => {
            reject(new TimeoutError(errorMessage));
        }, timeoutNumber);
    });
    try {
        return await Promise.race([Promise.resolve().then(callback), timeoutPromise]);
    }
    finally {
        clearTimeout(timeoutId);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZW91dC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy90aW1lb3V0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7QUFFWixNQUFNLFlBQWEsU0FBUSxLQUFLO0NBQUc7QUFFbkM7Ozs7OztHQU1HO0FBQ0g7Ozs7Ozs7OztHQVNHO0FBQ0g7Ozs7OztHQU1HO0FBQ0gsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLFVBQVUsT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJO0lBQzlDLGlDQUFpQztJQUNqQyxJQUFJLElBQUksQ0FBQTtJQUVSLG1EQUFtRDtJQUNuRCxJQUFJLFFBQVEsQ0FBQTtJQUVaLElBQUksT0FBTyxJQUFJLElBQUksVUFBVSxJQUFJLElBQUksS0FBSyxTQUFTLEVBQUUsQ0FBQztRQUNwRCxJQUFJLEdBQUcsRUFBQyxPQUFPLEVBQUUsSUFBSSxFQUFDLENBQUE7UUFDdEIsUUFBUSxHQUFHLElBQUksQ0FBQTtJQUNqQixDQUFDO1NBQU0sSUFBSSxPQUFPLElBQUksSUFBSSxRQUFRLElBQUksT0FBTyxJQUFJLElBQUksVUFBVSxFQUFFLENBQUM7UUFDaEUsSUFBSSxHQUFHLElBQUksQ0FBQTtRQUNYLFFBQVEsR0FBRyxJQUFJLENBQUE7SUFDakIsQ0FBQztJQUVELElBQUksUUFBUSxJQUFJLFNBQVM7UUFBRSxNQUFNLElBQUksS0FBSyxDQUFDLCtCQUErQixDQUFDLENBQUE7SUFDM0UsSUFBSSxJQUFJLElBQUksSUFBSSxJQUFJLE9BQU8sSUFBSSxLQUFLLFFBQVE7UUFBRSxNQUFNLElBQUksS0FBSyxDQUFDLDhCQUE4QixDQUFDLENBQUE7SUFFN0YsTUFBTSxFQUFDLE9BQU8sRUFBRSxhQUFhLEVBQUUsWUFBWSxHQUFHLHNCQUFzQixFQUFFLEdBQUcsUUFBUSxFQUFDLEdBQUcsSUFBSSxDQUFBO0lBQ3pGLE1BQU0sWUFBWSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUE7SUFFMUMsSUFBSSxZQUFZLENBQUMsTUFBTSxHQUFHLENBQUM7UUFBRSxNQUFNLElBQUksS0FBSyxDQUFDLHVDQUF1QyxZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQTtJQUU5RyxJQUFJLFNBQVMsQ0FBQTtJQUNiLE1BQU0sY0FBYyxHQUFHLElBQUksT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxFQUFFO1FBQy9DLFNBQVMsR0FBRyxVQUFVLENBQUMsR0FBRyxFQUFFO1lBQzFCLE1BQU0sQ0FBQyxJQUFJLFlBQVksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFBO1FBQ3hDLENBQUMsRUFBRSxhQUFhLENBQUMsQ0FBQTtJQUNuQixDQUFDLENBQUMsQ0FBQTtJQUVGLElBQUksQ0FBQztRQUNILE9BQU8sTUFBTSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFBO0lBQy9FLENBQUM7WUFBUyxDQUFDO1FBQ1QsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFBO0lBQ3pCLENBQUM7QUFDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQHRzLWNoZWNrXG5cbmNsYXNzIFRpbWVvdXRFcnJvciBleHRlbmRzIEVycm9yIHt9XG5cbi8qKlxuICogUnVucyBhIGNhbGxiYWNrIHdpdGggYSB0aW1lb3V0LlxuICogQHRlbXBsYXRlIFRcbiAqIEBvdmVybG9hZFxuICogQHBhcmFtIHsoKSA9PiAoVCB8IFByb21pc2U8VD4pfSBjYWxsYmFjayAtIFRoZSBjYWxsYmFjayB0byBydW4uXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxUPn0gUmVzb2x2ZXMgd2l0aCB0aGUgY2FsbGJhY2sgcmVzdWx0LlxuICovXG4vKipcbiAqIFJ1bnMgYSBjYWxsYmFjayB3aXRoIGEgdGltZW91dC5cbiAqIEB0ZW1wbGF0ZSBUXG4gKiBAb3ZlcmxvYWRcbiAqIEBwYXJhbSB7b2JqZWN0fSBhcmdzIC0gVGhlIGFyZ3VtZW50cy5cbiAqIEBwYXJhbSB7bnVtYmVyfSBhcmdzLnRpbWVvdXQgLSBUaGUgdGltZW91dCBpbiBtaWxsaXNlY29uZHMgKGRlZmF1bHQ6IDUwMDApLlxuICogQHBhcmFtIHtzdHJpbmd9IFthcmdzLmVycm9yTWVzc2FnZV0gLSBUaGUgZXJyb3IgbWVzc2FnZSB3aGVuIHRpbWluZyBvdXQuXG4gKiBAcGFyYW0geygpID0+IChUIHwgUHJvbWlzZTxUPil9IGNhbGxiYWNrIC0gVGhlIGNhbGxiYWNrIHRvIHJ1bi5cbiAqIEByZXR1cm5zIHtQcm9taXNlPFQ+fSBSZXNvbHZlcyB3aXRoIHRoZSBjYWxsYmFjayByZXN1bHQuXG4gKi9cbi8qKlxuICogUnVucyBhIGNhbGxiYWNrIHdpdGggYSB0aW1lb3V0LlxuICogQHRlbXBsYXRlIFRcbiAqIEBwYXJhbSB7b2JqZWN0IHwgKCgpID0+IChUIHwgUHJvbWlzZTxUPikpfSBhcmcxIC0gVGhlIGFyZ3VtZW50cyBvciB0aGUgY2FsbGJhY2suXG4gKiBAcGFyYW0geygpID0+IChUIHwgUHJvbWlzZTxUPil9IFthcmcyXSAtIFRoZSBjYWxsYmFjayB3aGVuIGFyZ3VtZW50cyBhcmUgcHJvdmlkZWQuXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxUPn0gUmVzb2x2ZXMgd2l0aCB0aGUgY2FsbGJhY2sgcmVzdWx0LlxuICovXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiB0aW1lb3V0KGFyZzEsIGFyZzIpIHtcbiAgLyoqIEB0eXBlIHtvYmplY3QgfCB1bmRlZmluZWR9ICovXG4gIGxldCBhcmdzXG5cbiAgLyoqIEB0eXBlIHsoKCkgPT4gKFQgfCBQcm9taXNlPFQ+KSkgfCB1bmRlZmluZWR9ICovXG4gIGxldCBjYWxsYmFja1xuXG4gIGlmICh0eXBlb2YgYXJnMSA9PSBcImZ1bmN0aW9uXCIgJiYgYXJnMiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgYXJncyA9IHt0aW1lb3V0OiA1MDAwfVxuICAgIGNhbGxiYWNrID0gYXJnMVxuICB9IGVsc2UgaWYgKHR5cGVvZiBhcmcxID09IFwib2JqZWN0XCIgJiYgdHlwZW9mIGFyZzIgPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgYXJncyA9IGFyZzFcbiAgICBjYWxsYmFjayA9IGFyZzJcbiAgfVxuXG4gIGlmIChjYWxsYmFjayA9PSB1bmRlZmluZWQpIHRocm93IG5ldyBFcnJvcihcIlNvbWVob3cgY2FsbGJhY2sgaXMgdW5kZWZpbmVkXCIpXG4gIGlmIChhcmdzID09IG51bGwgfHwgdHlwZW9mIGFyZ3MgIT09IFwib2JqZWN0XCIpIHRocm93IG5ldyBFcnJvcihcIlNvbWVob3cgYXJncyBpc24ndCBhbiBvYmplY3RcIilcblxuICBjb25zdCB7dGltZW91dDogdGltZW91dE51bWJlciwgZXJyb3JNZXNzYWdlID0gXCJUaW1lb3V0IHdoaWxlIHRyeWluZ1wiLCAuLi5yZXN0QXJnc30gPSBhcmdzXG4gIGNvbnN0IHJlc3RBcmdzS2V5cyA9IE9iamVjdC5rZXlzKHJlc3RBcmdzKVxuXG4gIGlmIChyZXN0QXJnc0tleXMubGVuZ3RoID4gMCkgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIGFyZ3VtZW50cyBnaXZlbiB0byB0aW1lb3V0OiAke3Jlc3RBcmdzS2V5cy5qb2luKFwiLCBcIil9YClcblxuICBsZXQgdGltZW91dElkXG4gIGNvbnN0IHRpbWVvdXRQcm9taXNlID0gbmV3IFByb21pc2UoKF8sIHJlamVjdCkgPT4ge1xuICAgIHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgcmVqZWN0KG5ldyBUaW1lb3V0RXJyb3IoZXJyb3JNZXNzYWdlKSlcbiAgICB9LCB0aW1lb3V0TnVtYmVyKVxuICB9KVxuXG4gIHRyeSB7XG4gICAgcmV0dXJuIGF3YWl0IFByb21pc2UucmFjZShbUHJvbWlzZS5yZXNvbHZlKCkudGhlbihjYWxsYmFjayksIHRpbWVvdXRQcm9taXNlXSlcbiAgfSBmaW5hbGx5IHtcbiAgICBjbGVhclRpbWVvdXQodGltZW91dElkKVxuICB9XG59XG4iXX0=