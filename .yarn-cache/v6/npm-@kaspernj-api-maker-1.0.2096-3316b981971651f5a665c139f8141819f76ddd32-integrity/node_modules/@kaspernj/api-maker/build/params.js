import Incorporator from "incorporator";
import config from "./config.js";
import formSerialize from "form-serialize";
import qs from "qs";
import urlEncode from "./url-encode.js";
export default class Params {
    /** @returns {Record<string, any>} */
    static parse() {
        return qs.parse(globalThis.location.search.substr(1));
    }
    /**
     * @param {object} given
     * @returns {object}
     */
    static change(given) {
        const incorporator = new Incorporator({ objects: [Params.parse(), given] });
        incorporator.replaceArrayIfExists(true);
        return incorporator.merge();
    }
    /**
     * @param {Record<string, any>} params
     * @returns {string}
     */
    static withParams(params) {
        const newParams = qs.stringify(params, { encoder: urlEncode });
        const newPath = `${location.pathname}?${newParams}`;
        return newPath;
    }
    /**
     * @param {Record<string, any>} given
     * @param {{appHistory?: any}} opts
     */
    static changeParams(given, opts = {}) {
        const params = Params.change(given);
        const newParams = qs.stringify(params, { encoder: urlEncode });
        const newPath = `${location.pathname}?${newParams}`;
        const appHistory = opts.appHistory || config.getHistory();
        if (!appHistory)
            throw new Error("AppHistory hasn't been set in the ApiMaker configuration");
        appHistory.push(newPath);
    }
    /**
     * @param {HTMLFormElement} form
     * @returns {Record<string, any>}
     */
    static serializeForm(form) {
        const hash = formSerialize(form, { empty: true, hash: true });
        return Params.setUndefined(hash);
    }
    /**
     * This is used to set all empty values to 'undefined' which makes qs removed those elements from the query string
     * @param {Record<string, any>} given
     * @returns {Record<string, any>}
     */
    static setUndefined(given) {
        if (Array.isArray(given)) {
            if (given.length == 0)
                return undefined;
            return given.map((givenI) => Params.setUndefined(givenI));
        }
        else if (typeof given === "object") {
            if (Object.keys(given).length == 0)
                return undefined;
            const newGiven = {};
            for (const key in given) {
                newGiven[key] = Params.setUndefined(given[key]);
            }
            return newGiven;
        }
        else if (given === "") {
            return undefined;
        }
        else {
            return given;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyYW1zLmpzIiwic291cmNlUm9vdCI6Ii9zcmMvIiwic291cmNlcyI6WyJwYXJhbXMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxZQUFZLE1BQU0sY0FBYyxDQUFBO0FBQ3ZDLE9BQU8sTUFBTSxNQUFNLGFBQWEsQ0FBQTtBQUNoQyxPQUFPLGFBQWEsTUFBTSxnQkFBZ0IsQ0FBQTtBQUMxQyxPQUFPLEVBQUUsTUFBTSxJQUFJLENBQUE7QUFDbkIsT0FBTyxTQUFTLE1BQU0saUJBQWlCLENBQUE7QUFFdkMsTUFBTSxDQUFDLE9BQU8sT0FBTyxNQUFNO0lBQ3pCLHFDQUFxQztJQUNyQyxNQUFNLENBQUMsS0FBSztRQUNWLE9BQU8sRUFBRSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUN2RCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLO1FBQ2pCLE1BQU0sWUFBWSxHQUFHLElBQUksWUFBWSxDQUFDLEVBQUMsT0FBTyxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxFQUFFLEtBQUssQ0FBQyxFQUFDLENBQUMsQ0FBQTtRQUV6RSxZQUFZLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLENBQUE7UUFFdkMsT0FBTyxZQUFZLENBQUMsS0FBSyxFQUFFLENBQUE7SUFDN0IsQ0FBQztJQUVEOzs7T0FHRztJQUNILE1BQU0sQ0FBQyxVQUFVLENBQUMsTUFBTTtRQUN0QixNQUFNLFNBQVMsR0FBRyxFQUFFLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxFQUFDLE9BQU8sRUFBRSxTQUFTLEVBQUMsQ0FBQyxDQUFBO1FBQzVELE1BQU0sT0FBTyxHQUFHLEdBQUcsUUFBUSxDQUFDLFFBQVEsSUFBSSxTQUFTLEVBQUUsQ0FBQTtRQUVuRCxPQUFPLE9BQU8sQ0FBQTtJQUNoQixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsTUFBTSxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsSUFBSSxHQUFHLEVBQUU7UUFDbEMsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUNuQyxNQUFNLFNBQVMsR0FBRyxFQUFFLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxFQUFDLE9BQU8sRUFBRSxTQUFTLEVBQUMsQ0FBQyxDQUFBO1FBQzVELE1BQU0sT0FBTyxHQUFHLEdBQUcsUUFBUSxDQUFDLFFBQVEsSUFBSSxTQUFTLEVBQUUsQ0FBQTtRQUNuRCxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsVUFBVSxJQUFJLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQTtRQUV6RCxJQUFJLENBQUMsVUFBVTtZQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsMERBQTBELENBQUMsQ0FBQTtRQUU1RixVQUFVLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQzFCLENBQUM7SUFFRDs7O09BR0c7SUFDSCxNQUFNLENBQUMsYUFBYSxDQUFDLElBQUk7UUFDdkIsTUFBTSxJQUFJLEdBQUcsYUFBYSxDQUFDLElBQUksRUFBRSxFQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUE7UUFDM0QsT0FBTyxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQ2xDLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsTUFBTSxDQUFDLFlBQVksQ0FBQyxLQUFLO1FBQ3ZCLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ3pCLElBQUksS0FBSyxDQUFDLE1BQU0sSUFBSSxDQUFDO2dCQUNuQixPQUFPLFNBQVMsQ0FBQTtZQUVsQixPQUFPLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQTtRQUMzRCxDQUFDO2FBQU0sSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLEVBQUUsQ0FBQztZQUNyQyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxJQUFJLENBQUM7Z0JBQ2hDLE9BQU8sU0FBUyxDQUFBO1lBRWxCLE1BQU0sUUFBUSxHQUFHLEVBQUUsQ0FBQTtZQUNuQixLQUFLLE1BQU0sR0FBRyxJQUFJLEtBQUssRUFBRSxDQUFDO2dCQUN4QixRQUFRLENBQUMsR0FBRyxDQUFDLEdBQUcsTUFBTSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtZQUNqRCxDQUFDO1lBRUQsT0FBTyxRQUFRLENBQUE7UUFDakIsQ0FBQzthQUFNLElBQUksS0FBSyxLQUFLLEVBQUUsRUFBRSxDQUFDO1lBQ3hCLE9BQU8sU0FBUyxDQUFBO1FBQ2xCLENBQUM7YUFBTSxDQUFDO1lBQ04sT0FBTyxLQUFLLENBQUE7UUFDZCxDQUFDO0lBQ0gsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEluY29ycG9yYXRvciBmcm9tIFwiaW5jb3Jwb3JhdG9yXCJcbmltcG9ydCBjb25maWcgZnJvbSBcIi4vY29uZmlnLmpzXCJcbmltcG9ydCBmb3JtU2VyaWFsaXplIGZyb20gXCJmb3JtLXNlcmlhbGl6ZVwiXG5pbXBvcnQgcXMgZnJvbSBcInFzXCJcbmltcG9ydCB1cmxFbmNvZGUgZnJvbSBcIi4vdXJsLWVuY29kZS5qc1wiXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBhcmFtcyB7XG4gIC8qKiBAcmV0dXJucyB7UmVjb3JkPHN0cmluZywgYW55Pn0gKi9cbiAgc3RhdGljIHBhcnNlKCkge1xuICAgIHJldHVybiBxcy5wYXJzZShnbG9iYWxUaGlzLmxvY2F0aW9uLnNlYXJjaC5zdWJzdHIoMSkpXG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtvYmplY3R9IGdpdmVuXG4gICAqIEByZXR1cm5zIHtvYmplY3R9XG4gICAqL1xuICBzdGF0aWMgY2hhbmdlKGdpdmVuKSB7XG4gICAgY29uc3QgaW5jb3Jwb3JhdG9yID0gbmV3IEluY29ycG9yYXRvcih7b2JqZWN0czogW1BhcmFtcy5wYXJzZSgpLCBnaXZlbl19KVxuXG4gICAgaW5jb3Jwb3JhdG9yLnJlcGxhY2VBcnJheUlmRXhpc3RzKHRydWUpXG5cbiAgICByZXR1cm4gaW5jb3Jwb3JhdG9yLm1lcmdlKClcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge1JlY29yZDxzdHJpbmcsIGFueT59IHBhcmFtc1xuICAgKiBAcmV0dXJucyB7c3RyaW5nfVxuICAgKi9cbiAgc3RhdGljIHdpdGhQYXJhbXMocGFyYW1zKSB7XG4gICAgY29uc3QgbmV3UGFyYW1zID0gcXMuc3RyaW5naWZ5KHBhcmFtcywge2VuY29kZXI6IHVybEVuY29kZX0pXG4gICAgY29uc3QgbmV3UGF0aCA9IGAke2xvY2F0aW9uLnBhdGhuYW1lfT8ke25ld1BhcmFtc31gXG5cbiAgICByZXR1cm4gbmV3UGF0aFxuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7UmVjb3JkPHN0cmluZywgYW55Pn0gZ2l2ZW5cbiAgICogQHBhcmFtIHt7YXBwSGlzdG9yeT86IGFueX19IG9wdHNcbiAgICovXG4gIHN0YXRpYyBjaGFuZ2VQYXJhbXMoZ2l2ZW4sIG9wdHMgPSB7fSkge1xuICAgIGNvbnN0IHBhcmFtcyA9IFBhcmFtcy5jaGFuZ2UoZ2l2ZW4pXG4gICAgY29uc3QgbmV3UGFyYW1zID0gcXMuc3RyaW5naWZ5KHBhcmFtcywge2VuY29kZXI6IHVybEVuY29kZX0pXG4gICAgY29uc3QgbmV3UGF0aCA9IGAke2xvY2F0aW9uLnBhdGhuYW1lfT8ke25ld1BhcmFtc31gXG4gICAgY29uc3QgYXBwSGlzdG9yeSA9IG9wdHMuYXBwSGlzdG9yeSB8fCBjb25maWcuZ2V0SGlzdG9yeSgpXG5cbiAgICBpZiAoIWFwcEhpc3RvcnkpIHRocm93IG5ldyBFcnJvcihcIkFwcEhpc3RvcnkgaGFzbid0IGJlZW4gc2V0IGluIHRoZSBBcGlNYWtlciBjb25maWd1cmF0aW9uXCIpXG5cbiAgICBhcHBIaXN0b3J5LnB1c2gobmV3UGF0aClcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge0hUTUxGb3JtRWxlbWVudH0gZm9ybVxuICAgKiBAcmV0dXJucyB7UmVjb3JkPHN0cmluZywgYW55Pn1cbiAgICovXG4gIHN0YXRpYyBzZXJpYWxpemVGb3JtKGZvcm0pIHtcbiAgICBjb25zdCBoYXNoID0gZm9ybVNlcmlhbGl6ZShmb3JtLCB7ZW1wdHk6IHRydWUsIGhhc2g6IHRydWV9KVxuICAgIHJldHVybiBQYXJhbXMuc2V0VW5kZWZpbmVkKGhhc2gpXG4gIH1cblxuICAvKipcbiAgICogVGhpcyBpcyB1c2VkIHRvIHNldCBhbGwgZW1wdHkgdmFsdWVzIHRvICd1bmRlZmluZWQnIHdoaWNoIG1ha2VzIHFzIHJlbW92ZWQgdGhvc2UgZWxlbWVudHMgZnJvbSB0aGUgcXVlcnkgc3RyaW5nXG4gICAqIEBwYXJhbSB7UmVjb3JkPHN0cmluZywgYW55Pn0gZ2l2ZW5cbiAgICogQHJldHVybnMge1JlY29yZDxzdHJpbmcsIGFueT59XG4gICAqL1xuICBzdGF0aWMgc2V0VW5kZWZpbmVkKGdpdmVuKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZ2l2ZW4pKSB7XG4gICAgICBpZiAoZ2l2ZW4ubGVuZ3RoID09IDApXG4gICAgICAgIHJldHVybiB1bmRlZmluZWRcblxuICAgICAgcmV0dXJuIGdpdmVuLm1hcCgoZ2l2ZW5JKSA9PiBQYXJhbXMuc2V0VW5kZWZpbmVkKGdpdmVuSSkpXG4gICAgfSBlbHNlIGlmICh0eXBlb2YgZ2l2ZW4gPT09IFwib2JqZWN0XCIpIHtcbiAgICAgIGlmIChPYmplY3Qua2V5cyhnaXZlbikubGVuZ3RoID09IDApXG4gICAgICAgIHJldHVybiB1bmRlZmluZWRcblxuICAgICAgY29uc3QgbmV3R2l2ZW4gPSB7fVxuICAgICAgZm9yIChjb25zdCBrZXkgaW4gZ2l2ZW4pIHtcbiAgICAgICAgbmV3R2l2ZW5ba2V5XSA9IFBhcmFtcy5zZXRVbmRlZmluZWQoZ2l2ZW5ba2V5XSlcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG5ld0dpdmVuXG4gICAgfSBlbHNlIGlmIChnaXZlbiA9PT0gXCJcIikge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZ2l2ZW5cbiAgICB9XG4gIH1cbn1cbiJdfQ==