/* eslint-disable sort-imports */
import debounceFunction from "debounce";
import ModelEvents from "./model-events.js";
import PropTypes from "prop-types";
import propTypesExact from "prop-types-exact";
import { useCallback, useLayoutEffect } from "react";
import useShape from "set-state-compare/build/use-shape.js";
/**
 * @param {Function} modelClass
 * @param {Function} onCreated
 * @param {object} [args]
 * @param {boolean} [args.active]
 * @param {number} [args.debounce]
 * @param {Function} [args.onConnected]
 * @returns {void}
 */
// eslint-disable-next-line max-len
const ApiMakerUseCreatedEvent = (modelClass, onCreated, args = { active: true, debounce: 0, onConnected: undefined }) => {
    const { active = true, debounce } = args;
    const s = useShape({ active, debounce, modelClass, onCreated });
    const eventDebounce = useCallback(() => {
        if (!s.meta.debounceInstance) {
            if (typeof s.props.debounce == "number") {
                s.meta.debounceInstance = debounceFunction(s.p.onCreated, s.p.debounce);
            }
            else {
                s.meta.debounceInstance = debounceFunction(s.p.onCreated);
            }
        }
        return s.meta.debounceInstance;
    }, []);
    const onCreatedCallback = useCallback((...args) => {
        if (!s.p.active) {
            return;
        }
        if (s.p.debounce) {
            eventDebounce()(...args);
        }
        else {
            s.p.onCreated(...args);
        }
    }, []);
    useLayoutEffect(() => {
        const connectCreated = ModelEvents.connectCreated(s.p.modelClass, (...args) => onCreatedCallback(...args));
        return () => {
            connectCreated.unsubscribe();
        };
    }, []);
};
ApiMakerUseCreatedEvent.propTypes = propTypesExact({
    active: PropTypes.bool.isRequired,
    debounce: PropTypes.oneOfType([
        PropTypes.bool,
        PropTypes.number
    ]),
    modelClass: PropTypes.func.isRequired,
    onCreated: PropTypes.func.isRequired
});
export default ApiMakerUseCreatedEvent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlLWNyZWF0ZWQtZXZlbnQuanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbInVzZS1jcmVhdGVkLWV2ZW50LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLGlDQUFpQztBQUNqQyxPQUFPLGdCQUFnQixNQUFNLFVBQVUsQ0FBQTtBQUN2QyxPQUFPLFdBQVcsTUFBTSxtQkFBbUIsQ0FBQTtBQUMzQyxPQUFPLFNBQVMsTUFBTSxZQUFZLENBQUE7QUFDbEMsT0FBTyxjQUFjLE1BQU0sa0JBQWtCLENBQUE7QUFDN0MsT0FBTyxFQUFDLFdBQVcsRUFBRSxlQUFlLEVBQUMsTUFBTSxPQUFPLENBQUE7QUFDbEQsT0FBTyxRQUFRLE1BQU0sc0NBQXNDLENBQUE7QUFFM0Q7Ozs7Ozs7O0dBUUc7QUFDSCxtQ0FBbUM7QUFDbkMsTUFBTSx1QkFBdUIsR0FBRyxDQUFDLFVBQVUsRUFBRSxTQUFTLEVBQUUsSUFBSSxHQUFHLEVBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUMsRUFBRSxFQUFFO0lBQ3BILE1BQU0sRUFBQyxNQUFNLEdBQUcsSUFBSSxFQUFFLFFBQVEsRUFBQyxHQUFHLElBQUksQ0FBQTtJQUN0QyxNQUFNLENBQUMsR0FBRyxRQUFRLENBQUMsRUFBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUMsQ0FBQyxDQUFBO0lBRTdELE1BQU0sYUFBYSxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUU7UUFDckMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztZQUM3QixJQUFJLE9BQU8sQ0FBQyxDQUFDLEtBQUssQ0FBQyxRQUFRLElBQUksUUFBUSxFQUFFLENBQUM7Z0JBQ3hDLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQTtZQUN6RSxDQUFDO2lCQUFNLENBQUM7Z0JBQ04sQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFBO1lBQzNELENBQUM7UUFDSCxDQUFDO1FBRUQsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFBO0lBQ2hDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQTtJQUVOLE1BQU0saUJBQWlCLEdBQUcsV0FBVyxDQUFDLENBQUMsR0FBRyxJQUFJLEVBQUUsRUFBRTtRQUNoRCxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNoQixPQUFNO1FBQ1IsQ0FBQztRQUVELElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNqQixhQUFhLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFBO1FBQzFCLENBQUM7YUFBTSxDQUFDO1lBQ04sQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQTtRQUN4QixDQUFDO0lBQ0gsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFBO0lBRU4sZUFBZSxDQUFDLEdBQUcsRUFBRTtRQUNuQixNQUFNLGNBQWMsR0FBRyxXQUFXLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUMsR0FBRyxJQUFJLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQTtRQUUxRyxPQUFPLEdBQUcsRUFBRTtZQUNWLGNBQWMsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtRQUM5QixDQUFDLENBQUE7SUFDSCxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUE7QUFDUixDQUFDLENBQUE7QUFFRCx1QkFBdUIsQ0FBQyxTQUFTLEdBQUcsY0FBYyxDQUFDO0lBQ2pELE1BQU0sRUFBRSxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVU7SUFDakMsUUFBUSxFQUFFLFNBQVMsQ0FBQyxTQUFTLENBQUM7UUFDNUIsU0FBUyxDQUFDLElBQUk7UUFDZCxTQUFTLENBQUMsTUFBTTtLQUNqQixDQUFDO0lBQ0YsVUFBVSxFQUFFLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVTtJQUNyQyxTQUFTLEVBQUUsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVO0NBQ3JDLENBQUMsQ0FBQTtBQUVGLGVBQWUsdUJBQXVCLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBzb3J0LWltcG9ydHMgKi9cbmltcG9ydCBkZWJvdW5jZUZ1bmN0aW9uIGZyb20gXCJkZWJvdW5jZVwiXG5pbXBvcnQgTW9kZWxFdmVudHMgZnJvbSBcIi4vbW9kZWwtZXZlbnRzLmpzXCJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIlxuaW1wb3J0IHByb3BUeXBlc0V4YWN0IGZyb20gXCJwcm9wLXR5cGVzLWV4YWN0XCJcbmltcG9ydCB7dXNlQ2FsbGJhY2ssIHVzZUxheW91dEVmZmVjdH0gZnJvbSBcInJlYWN0XCJcbmltcG9ydCB1c2VTaGFwZSBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvdXNlLXNoYXBlLmpzXCJcblxuLyoqXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBtb2RlbENsYXNzXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBvbkNyZWF0ZWRcbiAqIEBwYXJhbSB7b2JqZWN0fSBbYXJnc11cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gW2FyZ3MuYWN0aXZlXVxuICogQHBhcmFtIHtudW1iZXJ9IFthcmdzLmRlYm91bmNlXVxuICogQHBhcmFtIHtGdW5jdGlvbn0gW2FyZ3Mub25Db25uZWN0ZWRdXG4gKiBAcmV0dXJucyB7dm9pZH1cbiAqL1xuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1sZW5cbmNvbnN0IEFwaU1ha2VyVXNlQ3JlYXRlZEV2ZW50ID0gKG1vZGVsQ2xhc3MsIG9uQ3JlYXRlZCwgYXJncyA9IHthY3RpdmU6IHRydWUsIGRlYm91bmNlOiAwLCBvbkNvbm5lY3RlZDogdW5kZWZpbmVkfSkgPT4geyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlYWN0L2Z1bmN0aW9uLWNvbXBvbmVudC1kZWZpbml0aW9uXG4gIGNvbnN0IHthY3RpdmUgPSB0cnVlLCBkZWJvdW5jZX0gPSBhcmdzXG4gIGNvbnN0IHMgPSB1c2VTaGFwZSh7YWN0aXZlLCBkZWJvdW5jZSwgbW9kZWxDbGFzcywgb25DcmVhdGVkfSlcblxuICBjb25zdCBldmVudERlYm91bmNlID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGlmICghcy5tZXRhLmRlYm91bmNlSW5zdGFuY2UpIHtcbiAgICAgIGlmICh0eXBlb2Ygcy5wcm9wcy5kZWJvdW5jZSA9PSBcIm51bWJlclwiKSB7XG4gICAgICAgIHMubWV0YS5kZWJvdW5jZUluc3RhbmNlID0gZGVib3VuY2VGdW5jdGlvbihzLnAub25DcmVhdGVkLCBzLnAuZGVib3VuY2UpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzLm1ldGEuZGVib3VuY2VJbnN0YW5jZSA9IGRlYm91bmNlRnVuY3Rpb24ocy5wLm9uQ3JlYXRlZClcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcy5tZXRhLmRlYm91bmNlSW5zdGFuY2VcbiAgfSwgW10pXG5cbiAgY29uc3Qgb25DcmVhdGVkQ2FsbGJhY2sgPSB1c2VDYWxsYmFjaygoLi4uYXJncykgPT4ge1xuICAgIGlmICghcy5wLmFjdGl2ZSkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgaWYgKHMucC5kZWJvdW5jZSkge1xuICAgICAgZXZlbnREZWJvdW5jZSgpKC4uLmFyZ3MpXG4gICAgfSBlbHNlIHtcbiAgICAgIHMucC5vbkNyZWF0ZWQoLi4uYXJncylcbiAgICB9XG4gIH0sIFtdKVxuXG4gIHVzZUxheW91dEVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgY29ubmVjdENyZWF0ZWQgPSBNb2RlbEV2ZW50cy5jb25uZWN0Q3JlYXRlZChzLnAubW9kZWxDbGFzcywgKC4uLmFyZ3MpID0+IG9uQ3JlYXRlZENhbGxiYWNrKC4uLmFyZ3MpKVxuXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGNvbm5lY3RDcmVhdGVkLnVuc3Vic2NyaWJlKClcbiAgICB9XG4gIH0sIFtdKVxufVxuXG5BcGlNYWtlclVzZUNyZWF0ZWRFdmVudC5wcm9wVHlwZXMgPSBwcm9wVHlwZXNFeGFjdCh7XG4gIGFjdGl2ZTogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCxcbiAgZGVib3VuY2U6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgIFByb3BUeXBlcy5ib29sLFxuICAgIFByb3BUeXBlcy5udW1iZXJcbiAgXSksXG4gIG1vZGVsQ2xhc3M6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gIG9uQ3JlYXRlZDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZFxufSlcblxuZXhwb3J0IGRlZmF1bHQgQXBpTWFrZXJVc2VDcmVhdGVkRXZlbnRcbiJdfQ==