import { digg } from "diggerize";
export default class Serializer {
    static serialize(arg) {
        const serialize = new Serializer(arg);
        return serialize.serialize();
    }
    constructor(arg) {
        this.arg = arg;
    }
    serialize() {
        return this.serializeArgument(this.arg);
    }
    serializeArgument(arg) {
        if (typeof arg == "object" && arg && arg.constructor.apiMakerType == "BaseModel") {
            return {
                api_maker_type: "model",
                model_class_name: digg(arg.modelClassData(), "name"),
                model_id: arg.id()
            };
        }
        else if (typeof arg == "function" && arg.apiMakerType == "BaseModel") {
            return {
                api_maker_type: "resource",
                name: digg(arg.modelClassData(), "name")
            };
        }
        else if (arg instanceof Date) {
            let offsetNumber = parseInt(arg.getTimezoneOffset() / 60 * 100, 10);
            offsetNumber = -offsetNumber;
            let offset = `${offsetNumber}`;
            while (offset.length < 4) {
                offset = `0${offset}`;
            }
            return {
                api_maker_type: "datetime",
                value: `${arg.getFullYear()}-${arg.getMonth() + 1}-${arg.getDate()} ${arg.getHours()}:${arg.getMinutes()}:${arg.getSeconds()}+${offset}`
            };
        }
        else if (Array.isArray(arg)) {
            return this.serializeArray(arg);
        }
        else if (typeof arg == "object" && arg && arg.constructor && arg.constructor.apiMakerType == "Collection") {
            return {
                api_maker_type: "collection",
                value: this.serializeObject(arg)
            };
        }
        else if (typeof arg == "object" && arg !== null && arg.constructor.name == "Object") {
            return this.serializeObject(arg);
        }
        else {
            return arg;
        }
    }
    serializeArray(arg) {
        return arg.map((value) => this.serializeArgument(value));
    }
    serializeObject(arg) {
        const newObject = {};
        for (const key in arg) {
            const value = arg[key];
            const newValue = this.serializeArgument(value);
            const newKey = this.serializeArgument(key);
            newObject[newKey] = newValue;
        }
        return newObject;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VyaWFsaXplci5qcyIsInNvdXJjZVJvb3QiOiIvc3JjLyIsInNvdXJjZXMiOlsic2VyaWFsaXplci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsSUFBSSxFQUFDLE1BQU0sV0FBVyxDQUFBO0FBRTlCLE1BQU0sQ0FBQyxPQUFPLE9BQU8sVUFBVTtJQUM3QixNQUFNLENBQUMsU0FBUyxDQUFFLEdBQUc7UUFDbkIsTUFBTSxTQUFTLEdBQUcsSUFBSSxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUE7UUFFckMsT0FBTyxTQUFTLENBQUMsU0FBUyxFQUFFLENBQUE7SUFDOUIsQ0FBQztJQUVELFlBQWEsR0FBRztRQUNkLElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFBO0lBQ2hCLENBQUM7SUFFRCxTQUFTO1FBQ1AsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQ3pDLENBQUM7SUFFRCxpQkFBaUIsQ0FBRSxHQUFHO1FBQ3BCLElBQUksT0FBTyxHQUFHLElBQUksUUFBUSxJQUFJLEdBQUcsSUFBSSxHQUFHLENBQUMsV0FBVyxDQUFDLFlBQVksSUFBSSxXQUFXLEVBQUUsQ0FBQztZQUNqRixPQUFPO2dCQUNMLGNBQWMsRUFBRSxPQUFPO2dCQUN2QixnQkFBZ0IsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxFQUFFLE1BQU0sQ0FBQztnQkFDcEQsUUFBUSxFQUFFLEdBQUcsQ0FBQyxFQUFFLEVBQUU7YUFDbkIsQ0FBQTtRQUNILENBQUM7YUFBTSxJQUFJLE9BQU8sR0FBRyxJQUFJLFVBQVUsSUFBSSxHQUFHLENBQUMsWUFBWSxJQUFJLFdBQVcsRUFBRSxDQUFDO1lBQ3ZFLE9BQU87Z0JBQ0wsY0FBYyxFQUFFLFVBQVU7Z0JBQzFCLElBQUksRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxFQUFFLE1BQU0sQ0FBQzthQUN6QyxDQUFBO1FBQ0gsQ0FBQzthQUFNLElBQUksR0FBRyxZQUFZLElBQUksRUFBRSxDQUFDO1lBQy9CLElBQUksWUFBWSxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxFQUFFLEdBQUcsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFBO1lBRW5FLFlBQVksR0FBRyxDQUFDLFlBQVksQ0FBQTtZQUU1QixJQUFJLE1BQU0sR0FBRyxHQUFHLFlBQVksRUFBRSxDQUFBO1lBRTlCLE9BQU8sTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztnQkFDekIsTUFBTSxHQUFHLElBQUksTUFBTSxFQUFFLENBQUE7WUFDdkIsQ0FBQztZQUVELE9BQU87Z0JBQ0wsY0FBYyxFQUFFLFVBQVU7Z0JBQzFCLEtBQUssRUFBRSxHQUFHLEdBQUcsQ0FBQyxXQUFXLEVBQUUsSUFBSSxHQUFHLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxPQUFPLEVBQUUsSUFBSSxHQUFHLENBQUMsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLFVBQVUsRUFBRSxJQUFJLEdBQUcsQ0FBQyxVQUFVLEVBQUUsSUFBSSxNQUFNLEVBQUU7YUFDekksQ0FBQTtRQUNILENBQUM7YUFBTSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUM5QixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDakMsQ0FBQzthQUFNLElBQUksT0FBTyxHQUFHLElBQUksUUFBUSxJQUFJLEdBQUcsSUFBSSxHQUFHLENBQUMsV0FBVyxJQUFJLEdBQUcsQ0FBQyxXQUFXLENBQUMsWUFBWSxJQUFJLFlBQVksRUFBRSxDQUFDO1lBQzVHLE9BQU87Z0JBQ0wsY0FBYyxFQUFFLFlBQVk7Z0JBQzVCLEtBQUssRUFBRSxJQUFJLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQzthQUNqQyxDQUFBO1FBQ0gsQ0FBQzthQUFNLElBQUksT0FBTyxHQUFHLElBQUksUUFBUSxJQUFJLEdBQUcsS0FBSyxJQUFJLElBQUksR0FBRyxDQUFDLFdBQVcsQ0FBQyxJQUFJLElBQUksUUFBUSxFQUFFLENBQUM7WUFDdEYsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQ2xDLENBQUM7YUFBTSxDQUFDO1lBQ04sT0FBTyxHQUFHLENBQUE7UUFDWixDQUFDO0lBQ0gsQ0FBQztJQUVELGNBQWMsQ0FBRSxHQUFHO1FBQ2pCLE9BQU8sR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUE7SUFDMUQsQ0FBQztJQUVELGVBQWUsQ0FBRSxHQUFHO1FBQ2xCLE1BQU0sU0FBUyxHQUFHLEVBQUUsQ0FBQTtRQUVwQixLQUFLLE1BQU0sR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO1lBQ3RCLE1BQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQTtZQUN0QixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUE7WUFDOUMsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxDQUFBO1lBRTFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsR0FBRyxRQUFRLENBQUE7UUFDOUIsQ0FBQztRQUVELE9BQU8sU0FBUyxDQUFBO0lBQ2xCLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7ZGlnZ30gZnJvbSBcImRpZ2dlcml6ZVwiXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlcmlhbGl6ZXIge1xuICBzdGF0aWMgc2VyaWFsaXplIChhcmcpIHtcbiAgICBjb25zdCBzZXJpYWxpemUgPSBuZXcgU2VyaWFsaXplcihhcmcpXG5cbiAgICByZXR1cm4gc2VyaWFsaXplLnNlcmlhbGl6ZSgpXG4gIH1cblxuICBjb25zdHJ1Y3RvciAoYXJnKSB7XG4gICAgdGhpcy5hcmcgPSBhcmdcbiAgfVxuXG4gIHNlcmlhbGl6ZSAoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2VyaWFsaXplQXJndW1lbnQodGhpcy5hcmcpXG4gIH1cblxuICBzZXJpYWxpemVBcmd1bWVudCAoYXJnKSB7XG4gICAgaWYgKHR5cGVvZiBhcmcgPT0gXCJvYmplY3RcIiAmJiBhcmcgJiYgYXJnLmNvbnN0cnVjdG9yLmFwaU1ha2VyVHlwZSA9PSBcIkJhc2VNb2RlbFwiKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhcGlfbWFrZXJfdHlwZTogXCJtb2RlbFwiLFxuICAgICAgICBtb2RlbF9jbGFzc19uYW1lOiBkaWdnKGFyZy5tb2RlbENsYXNzRGF0YSgpLCBcIm5hbWVcIiksXG4gICAgICAgIG1vZGVsX2lkOiBhcmcuaWQoKVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodHlwZW9mIGFyZyA9PSBcImZ1bmN0aW9uXCIgJiYgYXJnLmFwaU1ha2VyVHlwZSA9PSBcIkJhc2VNb2RlbFwiKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhcGlfbWFrZXJfdHlwZTogXCJyZXNvdXJjZVwiLFxuICAgICAgICBuYW1lOiBkaWdnKGFyZy5tb2RlbENsYXNzRGF0YSgpLCBcIm5hbWVcIilcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGFyZyBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgIGxldCBvZmZzZXROdW1iZXIgPSBwYXJzZUludChhcmcuZ2V0VGltZXpvbmVPZmZzZXQoKSAvIDYwICogMTAwLCAxMClcblxuICAgICAgb2Zmc2V0TnVtYmVyID0gLW9mZnNldE51bWJlclxuXG4gICAgICBsZXQgb2Zmc2V0ID0gYCR7b2Zmc2V0TnVtYmVyfWBcblxuICAgICAgd2hpbGUgKG9mZnNldC5sZW5ndGggPCA0KSB7XG4gICAgICAgIG9mZnNldCA9IGAwJHtvZmZzZXR9YFxuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBhcGlfbWFrZXJfdHlwZTogXCJkYXRldGltZVwiLFxuICAgICAgICB2YWx1ZTogYCR7YXJnLmdldEZ1bGxZZWFyKCl9LSR7YXJnLmdldE1vbnRoKCkgKyAxfS0ke2FyZy5nZXREYXRlKCl9ICR7YXJnLmdldEhvdXJzKCl9OiR7YXJnLmdldE1pbnV0ZXMoKX06JHthcmcuZ2V0U2Vjb25kcygpfSske29mZnNldH1gXG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGFyZykpIHtcbiAgICAgIHJldHVybiB0aGlzLnNlcmlhbGl6ZUFycmF5KGFyZylcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcmcgPT0gXCJvYmplY3RcIiAmJiBhcmcgJiYgYXJnLmNvbnN0cnVjdG9yICYmIGFyZy5jb25zdHJ1Y3Rvci5hcGlNYWtlclR5cGUgPT0gXCJDb2xsZWN0aW9uXCIpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFwaV9tYWtlcl90eXBlOiBcImNvbGxlY3Rpb25cIixcbiAgICAgICAgdmFsdWU6IHRoaXMuc2VyaWFsaXplT2JqZWN0KGFyZylcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcmcgPT0gXCJvYmplY3RcIiAmJiBhcmcgIT09IG51bGwgJiYgYXJnLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuICAgICAgcmV0dXJuIHRoaXMuc2VyaWFsaXplT2JqZWN0KGFyZylcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGFyZ1xuICAgIH1cbiAgfVxuXG4gIHNlcmlhbGl6ZUFycmF5IChhcmcpIHtcbiAgICByZXR1cm4gYXJnLm1hcCgodmFsdWUpID0+IHRoaXMuc2VyaWFsaXplQXJndW1lbnQodmFsdWUpKVxuICB9XG5cbiAgc2VyaWFsaXplT2JqZWN0IChhcmcpIHtcbiAgICBjb25zdCBuZXdPYmplY3QgPSB7fVxuXG4gICAgZm9yIChjb25zdCBrZXkgaW4gYXJnKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IGFyZ1trZXldXG4gICAgICBjb25zdCBuZXdWYWx1ZSA9IHRoaXMuc2VyaWFsaXplQXJndW1lbnQodmFsdWUpXG4gICAgICBjb25zdCBuZXdLZXkgPSB0aGlzLnNlcmlhbGl6ZUFyZ3VtZW50KGtleSlcblxuICAgICAgbmV3T2JqZWN0W25ld0tleV0gPSBuZXdWYWx1ZVxuICAgIH1cblxuICAgIHJldHVybiBuZXdPYmplY3RcbiAgfVxufVxuIl19