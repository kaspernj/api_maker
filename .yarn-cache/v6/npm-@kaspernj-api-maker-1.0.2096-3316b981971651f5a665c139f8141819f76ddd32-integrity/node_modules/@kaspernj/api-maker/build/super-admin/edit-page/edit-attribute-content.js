/* eslint-disable sort-imports */
import BaseComponent from "../../base-component";
import memo from "set-state-compare/build/memo.js";
import PropTypes from "prop-types";
import propTypesExact from "prop-types-exact";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import { useForm } from "../../form";
import { useMemo } from "react";
export default memo(shapeComponent(class EditAttributeContent extends BaseComponent {
    static propTypes = propTypesExact({
        attribute: PropTypes.object.isRequired,
        id: PropTypes.string.isRequired,
        model: PropTypes.object.isRequired,
        name: PropTypes.string.isRequired
    });
    setup() {
        this.form = useForm();
        const rawValue = this.rawValue();
        this.initialValue = rawValue === null || rawValue === undefined ? "" : rawValue;
        this.hasInitialValue = rawValue !== null && rawValue !== undefined;
        this.useStates({
            value: this.initialValue
        });
        useMemo(() => {
            if (this.form && this.hasInitialValue) {
                this.form.setValue(this.p.name, this.initialValue);
            }
        }, []);
    }
    render() {
        const { attribute, id, model } = this.props;
        if (!(attribute.attribute in model)) {
            throw new Error(`${attribute.attribute} isn't set on the resource ${model.modelClassData().name}`);
        }
        const contentArgs = useMemo(() => ({
            defaultValue: this.initialValue,
            inputProps: {
                attribute: attribute.attribute,
                defaultValue: this.initialValue,
                id,
                model,
                name: this.p.name
            },
            onChangeValue: this.tt.onChangeValue,
            value: this.s.value
        }), [attribute.attribute, id, model, this.p.name, this.s.value]);
        return attribute.content(contentArgs);
    }
    defaultValue = () => this.initialValue;
    rawValue = () => {
        if (!(this.p.attribute.attribute in this.p.model)) {
            throw new Error(`No attribute called ${this.p.attribute.attribute} in model ${this.p.model.modelClassData().name}`);
        }
        return this.p.model[this.p.attribute.attribute]();
    };
    onChangeValue = (newValue) => {
        this.setState({ value: newValue });
        this.tt.form.setValue(this.p.name, newValue);
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWRpdC1hdHRyaWJ1dGUtY29udGVudC5qcyIsInNvdXJjZVJvb3QiOiIvc3JjLyIsInNvdXJjZXMiOlsic3VwZXItYWRtaW4vZWRpdC1wYWdlL2VkaXQtYXR0cmlidXRlLWNvbnRlbnQuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLGlDQUFpQztBQUNqQyxPQUFPLGFBQWEsTUFBTSxzQkFBc0IsQ0FBQTtBQUNoRCxPQUFPLElBQUksTUFBTSxpQ0FBaUMsQ0FBQTtBQUNsRCxPQUFPLFNBQVMsTUFBTSxZQUFZLENBQUE7QUFDbEMsT0FBTyxjQUFjLE1BQU0sa0JBQWtCLENBQUE7QUFDN0MsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLDRDQUE0QyxDQUFBO0FBQ3pFLE9BQU8sRUFBQyxPQUFPLEVBQUMsTUFBTSxZQUFZLENBQUE7QUFDbEMsT0FBTyxFQUFDLE9BQU8sRUFBQyxNQUFNLE9BQU8sQ0FBQTtBQUU3QixlQUFlLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxvQkFBcUIsU0FBUSxhQUFhO0lBQ2pGLE1BQU0sQ0FBQyxTQUFTLEdBQUcsY0FBYyxDQUFDO1FBQ2hDLFNBQVMsRUFBRSxTQUFTLENBQUMsTUFBTSxDQUFDLFVBQVU7UUFDdEMsRUFBRSxFQUFFLFNBQVMsQ0FBQyxNQUFNLENBQUMsVUFBVTtRQUMvQixLQUFLLEVBQUUsU0FBUyxDQUFDLE1BQU0sQ0FBQyxVQUFVO1FBQ2xDLElBQUksRUFBRSxTQUFTLENBQUMsTUFBTSxDQUFDLFVBQVU7S0FDbEMsQ0FBQyxDQUFBO0lBRUYsS0FBSztRQUNILElBQUksQ0FBQyxJQUFJLEdBQUcsT0FBTyxFQUFFLENBQUE7UUFDckIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFBO1FBQ2hDLElBQUksQ0FBQyxZQUFZLEdBQUcsUUFBUSxLQUFLLElBQUksSUFBSSxRQUFRLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQTtRQUMvRSxJ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aW1wb3J0cyAqL1xuaW1wb3J0IEJhc2VDb21wb25lbnQgZnJvbSBcIi4uLy4uL2Jhc2UtY29tcG9uZW50XCJcbmltcG9ydCBtZW1vIGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9tZW1vLmpzXCJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIlxuaW1wb3J0IHByb3BUeXBlc0V4YWN0IGZyb20gXCJwcm9wLXR5cGVzLWV4YWN0XCJcbmltcG9ydCB7c2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IHt1c2VGb3JtfSBmcm9tIFwiLi4vLi4vZm9ybVwiXG5pbXBvcnQge3VzZU1lbW99IGZyb20gXCJyZWFjdFwiXG5cbmV4cG9ydCBkZWZhdWx0IG1lbW8oc2hhcGVDb21wb25lbnQoY2xhc3MgRWRpdEF0dHJpYnV0ZUNvbnRlbnQgZXh0ZW5kcyBCYXNlQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHByb3BUeXBlc0V4YWN0KHtcbiAgICBhdHRyaWJ1dGU6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICBpZDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIG1vZGVsOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgbmFtZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkXG4gIH0pXG5cbiAgc2V0dXAoKSB7XG4gICAgdGhpcy5mb3JtID0gdXNlRm9ybSgpXG4gICAgY29uc3QgcmF3VmFsdWUgPSB0aGlzLnJhd1ZhbHVlKClcbiAgICB0aGlzLmluaXRpYWxWYWx1ZSA9IHJhd1ZhbHVlID09PSBudWxsIHx8IHJhd1ZhbHVlID09PSB1bmRlZmluZWQgPyBcIlwiIDogcmF3VmFsdWVcbiAgICB0aGlzLmhhc0luaXRpYWxWYWx1ZSA9IHJhd1ZhbHVlICE9PSBudWxsICYmIHJhd1ZhbHVlICE9PSB1bmRlZmluZWRcbiAgICB0aGlzLnVzZVN0YXRlcyh7XG4gICAgICB2YWx1ZTogdGhpcy5pbml0aWFsVmFsdWVcbiAgICB9KVxuXG4gICAgdXNlTWVtbygoKSA9PiB7XG4gICAgICBpZiAodGhpcy5mb3JtICYmIHRoaXMuaGFzSW5pdGlhbFZhbHVlKSB7XG4gICAgICAgIHRoaXMuZm9ybS5zZXRWYWx1ZSh0aGlzLnAubmFtZSwgdGhpcy5pbml0aWFsVmFsdWUpXG4gICAgICB9XG4gICAgfSwgW10pXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge2F0dHJpYnV0ZSwgaWQsIG1vZGVsfSA9IHRoaXMucHJvcHNcblxuICAgIGlmICghKGF0dHJpYnV0ZS5hdHRyaWJ1dGUgaW4gbW9kZWwpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7YXR0cmlidXRlLmF0dHJpYnV0ZX0gaXNuJ3Qgc2V0IG9uIHRoZSByZXNvdXJjZSAke21vZGVsLm1vZGVsQ2xhc3NEYXRhKCkubmFtZX1gKVxuICAgIH1cblxuICAgIGNvbnN0IGNvbnRlbnRBcmdzID0gdXNlTWVtbygoKSA9PiAoe1xuICAgICAgZGVmYXVsdFZhbHVlOiB0aGlzLmluaXRpYWxWYWx1ZSxcbiAgICAgIGlucHV0UHJvcHM6IHtcbiAgICAgICAgYXR0cmlidXRlOiBhdHRyaWJ1dGUuYXR0cmlidXRlLFxuICAgICAgICBkZWZhdWx0VmFsdWU6IHRoaXMuaW5pdGlhbFZhbHVlLFxuICAgICAgICBpZCxcbiAgICAgICAgbW9kZWwsXG4gICAgICAgIG5hbWU6IHRoaXMucC5uYW1lXG4gICAgICB9LFxuICAgICAgb25DaGFuZ2VWYWx1ZTogdGhpcy50dC5vbkNoYW5nZVZhbHVlLFxuICAgICAgdmFsdWU6IHRoaXMucy52YWx1ZVxuICAgIH0pLCBbYXR0cmlidXRlLmF0dHJpYnV0ZSwgaWQsIG1vZGVsLCB0aGlzLnAubmFtZSwgdGhpcy5zLnZhbHVlXSlcblxuICAgIHJldHVybiBhdHRyaWJ1dGUuY29udGVudChjb250ZW50QXJncylcbiAgfVxuXG4gIGRlZmF1bHRWYWx1ZSA9ICgpID0+IHRoaXMuaW5pdGlhbFZhbHVlXG5cbiAgcmF3VmFsdWUgPSAoKSA9PiB7XG4gICAgaWYgKCEodGhpcy5wLmF0dHJpYnV0ZS5hdHRyaWJ1dGUgaW4gdGhpcy5wLm1vZGVsKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBhdHRyaWJ1dGUgY2FsbGVkICR7dGhpcy5wLmF0dHJpYnV0ZS5hdHRyaWJ1dGV9IGluIG1vZGVsICR7dGhpcy5wLm1vZGVsLm1vZGVsQ2xhc3NEYXRhKCkubmFtZX1gKVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnAubW9kZWxbdGhpcy5wLmF0dHJpYnV0ZS5hdHRyaWJ1dGVdKClcbiAgfVxuXG4gIG9uQ2hhbmdlVmFsdWUgPSAobmV3VmFsdWUpID0+IHtcbiAgICB0aGlzLnNldFN0YXRlKHt2YWx1ZTogbmV3VmFsdWV9KVxuICAgIHRoaXMudHQuZm9ybS5zZXRWYWx1ZSh0aGlzLnAubmFtZSwgbmV3VmFsdWUpXG4gIH1cbn0pKVxuIl19