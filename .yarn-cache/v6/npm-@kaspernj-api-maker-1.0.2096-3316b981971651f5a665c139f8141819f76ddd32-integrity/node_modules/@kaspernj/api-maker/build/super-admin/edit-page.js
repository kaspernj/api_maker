import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
/* eslint-disable react/jsx-max-depth, react/jsx-no-literals, react/jsx-one-expression-per-line, sort-imports */
import * as inflection from "inflection";
import { FlashNotifications } from "flash-notifications";
import { Form } from "../form";
import { Pressable, View } from "react-native";
import { digg } from "diggerize";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import BaseComponent from "../base-component";
import ConfigReader from "./config-reader";
import EditAttribute from "./edit-page/edit-attribute";
// @ts-expect-error
import Locales from "shared/locales.js"; // eslint-disable-line import/no-unresolved
import Params from "../params.js";
import PropTypes from "prop-types";
import React from "react";
import Text from "../utils/text";
import memo from "set-state-compare/build/memo.js";
import propTypesExact from "prop-types-exact";
import useCurrentUser from "../use-current-user.js";
import useModel from "../use-model.js";
import useQueryParams from "on-location-changed/build/use-query-params.js";
export default memo(shapeComponent(class ApiMakerSuperAdminEditPage extends BaseComponent {
    static propTypes = propTypesExact({
        modelClass: PropTypes.func.isRequired
    });
    setup() {
        const { modelClass } = this.p;
        const modelClassName = modelClass.modelClassData().name;
        const availableLocales = Locales.availableLocales();
        this.configReader = ConfigReader.forModel(modelClass);
        const currentUser = useCurrentUser();
        const queryParams = useQueryParams();
        const selectedModelAttributes = ["id"];
        const selectedAttributes = {};
        this.attributes = this.configReader.modelConfig?.edit?.attributes;
        if (!this.attributes) {
            throw new Error(`No 'attributes' given from edit config for ${modelClass.modelClassData().name}`);
        }
        for (const attribute of this.attributes) {
            if (attribute.translated) {
                for (const locale of availableLocales) {
                    selectedModelAttributes.push(`${attribute.attribute}${inflection.camelize(locale)}`);
                }
            }
            else {
                selectedModelAttributes.push(attribute.attribute);
            }
        }
        selectedAttributes[modelClassName] = selectedModelAttributes;
        const useModelResult = useModel(modelClass, {
            cacheArgs: [currentUser?.id()],
            loadByQueryParam: (props) => props.queryParams.model_id,
            newIfNoId: this.configReader.modelConfig?.edit?.newIfNoId || true,
            preload: this.configReader.modelConfig?.edit?.preload,
            select: selectedAttributes
        });
        const modelIdVarName = `${inflection.camelize(modelClass.modelClassData().name, true)}Id`;
        const modelVarName = inflection.camelize(modelClass.modelClassData().name, true);
        this.model = digg(useModelResult, modelVarName);
        this.modelId = queryParams.model_id;
        this.modelArgs = {};
        this.modelArgs[modelIdVarName] = this.modelId;
        this.useStates({ form: null });
    }
    render() {
        const { attributes, model } = this.tt;
        const { modelClass } = this.p;
        const extraContent = this.configReader.modelConfig?.edit?.extraContentconst;
        return (_jsx(View, { testID: "super-admin--edit-page", children: _jsxs(Form, { setForm: this.setStates.form, children: [model && attributes?.map((attribute) => ( // eslint-disable-line no-extra-parens
                    _jsx(EditAttribute, { attribute: attribute, model: model, modelClass: modelClass }, attribute.attribute))), extraContent && extraContent(modelArgs), _jsx(Pressable, { onPress: this.tt.onSubmit, style: this.cache("pressableStyle", {
                            paddingTop: 18,
                            paddingRight: 24,
                            paddingBottom: 18,
                            paddingLeft: 24,
                            borderRadius: 10,
                            backgroundColor: "#4c93ff",
                            marginTop: 10
                        }), testID: "submit-button", children: _jsx(Text, { style: this.cache("buttonTextStyle", { color: "#fff" }), children: "Submit" }) })] }) }));
    }
    onSubmit = async () => {
        try {
            const { model } = this.tt;
            const formObject = this.s.form.asObject();
            model.assignAttributes(formObject);
            await model.save();
            Params.changeParams({ mode: undefined, model_id: model.id() });
        }
        catch (error) {
            FlashNotifications.errorResponse(error);
        }
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWRpdC1wYWdlLmpzIiwic291cmNlUm9vdCI6Ii9zcmMvIiwic291cmNlcyI6WyJzdXBlci1hZG1pbi9lZGl0LXBhZ2UuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxnSEFBZ0g7QUFDaEgsT0FBTyxLQUFLLFVBQVUsTUFBTSxZQUFZLENBQUE7QUFDeEMsT0FBTyxFQUFDLGtCQUFrQixFQUFDLE1BQU0scUJBQXFCLENBQUE7QUFDdEQsT0FBTyxFQUFDLElBQUksRUFBQyxNQUFNLFNBQVMsQ0FBQTtBQUM1QixPQUFPLEVBQUMsU0FBUyxFQUFFLElBQUksRUFBQyxNQUFNLGNBQWMsQ0FBQTtBQUM1QyxPQUFPLEVBQUMsSUFBSSxFQUFDLE1BQU0sV0FBVyxDQUFBO0FBQzlCLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSw0Q0FBNEMsQ0FBQTtBQUN6RSxPQUFPLGFBQWEsTUFBTSxtQkFBbUIsQ0FBQTtBQUM3QyxPQUFPLFlBQVksTUFBTSxpQkFBaUIsQ0FBQTtBQUMxQyxPQUFPLGFBQWEsTUFBTSw0QkFBNEIsQ0FBQTtBQUN0RCxtQkFBbUI7QUFDbkIsT0FBTyxPQUFPLE1BQU0sbUJBQW1CLENBQUEsQ0FBQywyQ0FBMkM7QUFDbkYsT0FBTyxNQUFNLE1BQU0sY0FBYyxDQUFBO0FBQ2pDLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQTtBQUNsQyxPQUFPLEtBQUssTUFBTSxPQUFPLENBQUE7QUFDekIsT0FBTyxJQUFJLE1BQU0sZUFBZSxDQUFBO0FBQ2hDLE9BQU8sSUFBSSxNQUFNLGlDQUFpQyxDQUFBO0FBQ2xELE9BQU8sY0FBYyxNQUFNLGtCQUFrQixDQUFBO0FBQzdDLE9BQU8sY0FBYyxNQUFNLHdCQUF3QixDQUFBO0FBQ25ELE9BQU8sUUFBUSxNQUFNLGlCQUFpQixDQUFBO0FBQ3RDLE9BQU8sY0FBYyxNQUFNLCtDQUErQyxDQUFBO0FBRTFFLGVBQWUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLDBCQUEyQixTQUFRLGFBQWE7SUFDdkYsTUFBTSxD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QixFQUFFLEVBQUMsS0FBSyxFQUFFLE1BQU0sRUFBQyxDQUFDLHVCQUFlLEdBQ2hFLElBQ1AsR0FDRixDQUNSLENBQUE7SUFDSCxDQUFDO0lBRUQsUUFBUSxHQUFHLEtBQUssSUFBSSxFQUFFO1FBQ3BCLElBQUksQ0FBQztZQUNILE1BQU0sRUFBQyxLQUFLLEVBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFBO1lBQ3ZCLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFBO1lBRXpDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQTtZQUNsQyxNQUFNLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQTtZQUNsQixNQUFNLENBQUMsWUFBWSxDQUFDLEVBQUMsSUFBSSxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRSxFQUFDLENBQUMsQ0FBQTtRQUM5RCxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLGtCQUFrQixDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUN6QyxDQUFDO0lBQ0gsQ0FBQyxDQUFBO0NBQ0YsQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSByZWFjdC9qc3gtbWF4LWRlcHRoLCByZWFjdC9qc3gtbm8tbGl0ZXJhbHMsIHJlYWN0L2pzeC1vbmUtZXhwcmVzc2lvbi1wZXItbGluZSwgc29ydC1pbXBvcnRzICovXG5pbXBvcnQgKiBhcyBpbmZsZWN0aW9uIGZyb20gXCJpbmZsZWN0aW9uXCJcbmltcG9ydCB7Rmxhc2hOb3RpZmljYXRpb25zfSBmcm9tIFwiZmxhc2gtbm90aWZpY2F0aW9uc1wiXG5pbXBvcnQge0Zvcm19IGZyb20gXCIuLi9mb3JtXCJcbmltcG9ydCB7UHJlc3NhYmxlLCBWaWV3fSBmcm9tIFwicmVhY3QtbmF0aXZlXCJcbmltcG9ydCB7ZGlnZ30gZnJvbSBcImRpZ2dlcml6ZVwiXG5pbXBvcnQge3NoYXBlQ29tcG9uZW50fSBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvc2hhcGUtY29tcG9uZW50LmpzXCJcbmltcG9ydCBCYXNlQ29tcG9uZW50IGZyb20gXCIuLi9iYXNlLWNvbXBvbmVudFwiXG5pbXBvcnQgQ29uZmlnUmVhZGVyIGZyb20gXCIuL2NvbmZpZy1yZWFkZXJcIlxuaW1wb3J0IEVkaXRBdHRyaWJ1dGUgZnJvbSBcIi4vZWRpdC1wYWdlL2VkaXQtYXR0cmlidXRlXCJcbi8vIEB0cy1leHBlY3QtZXJyb3JcbmltcG9ydCBMb2NhbGVzIGZyb20gXCJzaGFyZWQvbG9jYWxlcy5qc1wiIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgaW1wb3J0L25vLXVucmVzb2x2ZWRcbmltcG9ydCBQYXJhbXMgZnJvbSBcIi4uL3BhcmFtcy5qc1wiXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gXCJwcm9wLXR5cGVzXCJcbmltcG9ydCBSZWFjdCBmcm9tIFwicmVhY3RcIlxuaW1wb3J0IFRleHQgZnJvbSBcIi4uL3V0aWxzL3RleHRcIlxuaW1wb3J0IG1lbW8gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL21lbW8uanNcIlxuaW1wb3J0IHByb3BUeXBlc0V4YWN0IGZyb20gXCJwcm9wLXR5cGVzLWV4YWN0XCJcbmltcG9ydCB1c2VDdXJyZW50VXNlciBmcm9tIFwiLi4vdXNlLWN1cnJlbnQtdXNlci5qc1wiXG5pbXBvcnQgdXNlTW9kZWwgZnJvbSBcIi4uL3VzZS1tb2RlbC5qc1wiXG5pbXBvcnQgdXNlUXVlcnlQYXJhbXMgZnJvbSBcIm9uLWxvY2F0aW9uLWNoYW5nZWQvYnVpbGQvdXNlLXF1ZXJ5LXBhcmFtcy5qc1wiXG5cbmV4cG9ydCBkZWZhdWx0IG1lbW8oc2hhcGVDb21wb25lbnQoY2xhc3MgQXBpTWFrZXJTdXBlckFkbWluRWRpdFBhZ2UgZXh0ZW5kcyBCYXNlQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHByb3BUeXBlc0V4YWN0KHtcbiAgICBtb2RlbENsYXNzOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkXG4gIH0pXG5cbiAgc2V0dXAoKSB7XG4gICAgY29uc3Qge21vZGVsQ2xhc3N9ID0gdGhpcy5wXG4gICAgY29uc3QgbW9kZWxDbGFzc05hbWUgPSBtb2RlbENsYXNzLm1vZGVsQ2xhc3NEYXRhKCkubmFtZVxuICAgIGNvbnN0IGF2YWlsYWJsZUxvY2FsZXMgPSBMb2NhbGVzLmF2YWlsYWJsZUxvY2FsZXMoKVxuICAgIHRoaXMuY29uZmlnUmVhZGVyID0gQ29uZmlnUmVhZGVyLmZvck1vZGVsKG1vZGVsQ2xhc3MpXG4gICAgY29uc3QgY3VycmVudFVzZXIgPSB1c2VDdXJyZW50VXNlcigpXG4gICAgY29uc3QgcXVlcnlQYXJhbXMgPSB1c2VRdWVyeVBhcmFtcygpXG4gICAgY29uc3Qgc2VsZWN0ZWRNb2RlbEF0dHJpYnV0ZXMgPSBbXCJpZFwiXVxuICAgIGNvbnN0IHNlbGVjdGVkQXR0cmlidXRlcyA9IHt9XG4gICAgdGhpcy5hdHRyaWJ1dGVzID0gdGhpcy5jb25maWdSZWFkZXIubW9kZWxDb25maWc/LmVkaXQ/LmF0dHJpYnV0ZXNcblxuICAgIGlmICghdGhpcy5hdHRyaWJ1dGVzKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vICdhdHRyaWJ1dGVzJyBnaXZlbiBmcm9tIGVkaXQgY29uZmlnIGZvciAke21vZGVsQ2xhc3MubW9kZWxDbGFzc0RhdGEoKS5uYW1lfWApXG4gICAgfVxuXG4gICAgZm9yIChjb25zdCBhdHRyaWJ1dGUgb2YgdGhpcy5hdHRyaWJ1dGVzKSB7XG4gICAgICBpZiAoYXR0cmlidXRlLnRyYW5zbGF0ZWQpIHtcbiAgICAgICAgZm9yIChjb25zdCBsb2NhbGUgb2YgYXZhaWxhYmxlTG9jYWxlcykge1xuICAgICAgICAgIHNlbGVjdGVkTW9kZWxBdHRyaWJ1dGVzLnB1c2goYCR7YXR0cmlidXRlLmF0dHJpYnV0ZX0ke2luZmxlY3Rpb24uY2FtZWxpemUobG9jYWxlKX1gKVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZWxlY3RlZE1vZGVsQXR0cmlidXRlcy5wdXNoKGF0dHJpYnV0ZS5hdHRyaWJ1dGUpXG4gICAgICB9XG4gICAgfVxuXG4gICAgc2VsZWN0ZWRBdHRyaWJ1dGVzW21vZGVsQ2xhc3NOYW1lXSA9IHNlbGVjdGVkTW9kZWxBdHRyaWJ1dGVzXG5cbiAgICBjb25zdCB1c2VNb2RlbFJlc3VsdCA9IHVzZU1vZGVsKG1vZGVsQ2xhc3MsIHtcbiAgICAgIGNhY2hlQXJnczogW2N1cnJlbnRVc2VyPy5pZCgpXSxcbiAgICAgIGxvYWRCeVF1ZXJ5UGFyYW06IChwcm9wcykgPT4gcHJvcHMucXVlcnlQYXJhbXMubW9kZWxfaWQsXG4gICAgICBuZXdJZk5vSWQ6IHRoaXMuY29uZmlnUmVhZGVyLm1vZGVsQ29uZmlnPy5lZGl0Py5uZXdJZk5vSWQgfHwgdHJ1ZSxcbiAgICAgIHByZWxvYWQ6IHRoaXMuY29uZmlnUmVhZGVyLm1vZGVsQ29uZmlnPy5lZGl0Py5wcmVsb2FkLFxuICAgICAgc2VsZWN0OiBzZWxlY3RlZEF0dHJpYnV0ZXNcbiAgICB9KVxuXG4gICAgY29uc3QgbW9kZWxJZFZhck5hbWUgPSBgJHtpbmZsZWN0aW9uLmNhbWVsaXplKG1vZGVsQ2xhc3MubW9kZWxDbGFzc0RhdGEoKS5uYW1lLCB0cnVlKX1JZGBcbiAgICBjb25zdCBtb2RlbFZhck5hbWUgPSBpbmZsZWN0aW9uLmNhbWVsaXplKG1vZGVsQ2xhc3MubW9kZWxDbGFzc0RhdGEoKS5uYW1lLCB0cnVlKVxuXG4gICAgdGhpcy5tb2RlbCA9IGRpZ2codXNlTW9kZWxSZXN1bHQsIG1vZGVsVmFyTmFtZSlcbiAgICB0aGlzLm1vZGVsSWQgPSBxdWVyeVBhcmFtcy5tb2RlbF9pZFxuICAgIHRoaXMubW9kZWxBcmdzID0ge31cbiAgICB0aGlzLm1vZGVsQXJnc1ttb2RlbElkVmFyTmFtZV0gPSB0aGlzLm1vZGVsSWRcbiAgICB0aGlzLnVzZVN0YXRlcyh7Zm9ybTogbnVsbH0pXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge2F0dHJpYnV0ZXMsIG1vZGVsfSA9IHRoaXMudHRcbiAgICBjb25zdCB7bW9kZWxDbGFzc30gPSB0aGlzLnBcbiAgICBjb25zdCBleHRyYUNvbnRlbnQgPSB0aGlzLmNvbmZpZ1JlYWRlci5tb2RlbENvbmZpZz8uZWRpdD8uZXh0cmFDb250ZW50Y29uc3RcblxuICAgIHJldHVybiAoXG4gICAgICA8VmlldyB0ZXN0SUQ9XCJzdXBlci1hZG1pbi0tZWRpdC1wYWdlXCI+XG4gICAgICAgIDxGb3JtIHNldEZvcm09e3RoaXMuc2V0U3RhdGVzLmZvcm19PlxuICAgICAgICAgIHttb2RlbCAmJiBhdHRyaWJ1dGVzPy5tYXAoKGF0dHJpYnV0ZSkgPT4gKCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWV4dHJhLXBhcmVuc1xuICAgICAgICAgICAgPEVkaXRBdHRyaWJ1dGUgYXR0cmlidXRlPXthdHRyaWJ1dGV9IGtleT17YXR0cmlidXRlLmF0dHJpYnV0ZX0gbW9kZWw9e21vZGVsfSBtb2RlbENsYXNzPXttb2RlbENsYXNzfSAvPlxuICAgICAgICAgICkpfVxuICAgICAgICAgIHsvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW5kZWYgKi99XG4gICAgICAgICAge2V4dHJhQ29udGVudCAmJiBleHRyYUNvbnRlbnQobW9kZWxBcmdzKX1cbiAgICAgICAgICA8UHJlc3NhYmxlXG4gICAgICAgICAgICBvblByZXNzPXt0aGlzLnR0Lm9uU3VibWl0fVxuICAgICAgICAgICAgc3R5bGU9e3RoaXMuY2FjaGUoXCJwcmVzc2FibGVTdHlsZVwiLCB7XG4gICAgICAgICAgICAgIHBhZGRpbmdUb3A6IDE4LFxuICAgICAgICAgICAgICBwYWRkaW5nUmlnaHQ6IDI0LFxuICAgICAgICAgICAgICBwYWRkaW5nQm90dG9tOiAxOCxcbiAgICAgICAgICAgICAgcGFkZGluZ0xlZnQ6IDI0LFxuICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6IDEwLFxuICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IFwiIzRjOTNmZlwiLFxuICAgICAgICAgICAgICBtYXJnaW5Ub3A6IDEwXG4gICAgICAgICAgICB9KX1cbiAgICAgICAgICAgIHRlc3RJRD1cInN1Ym1pdC1idXR0b25cIlxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxUZXh0IHN0eWxlPXt0aGlzLmNhY2hlKFwiYnV0dG9uVGV4dFN0eWxlXCIsIHtjb2xvcjogXCIjZmZmXCJ9KX0+U3VibWl0PC9UZXh0PlxuICAgICAgICAgIDwvUHJlc3NhYmxlPlxuICAgICAgICA8L0Zvcm0+XG4gICAgICA8L1ZpZXc+XG4gICAgKVxuICB9XG5cbiAgb25TdWJtaXQgPSBhc3luYyAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHttb2RlbH0gPSB0aGlzLnR0XG4gICAgICBjb25zdCBmb3JtT2JqZWN0ID0gdGhpcy5zLmZvcm0uYXNPYmplY3QoKVxuXG4gICAgICBtb2RlbC5hc3NpZ25BdHRyaWJ1dGVzKGZvcm1PYmplY3QpXG4gICAgICBhd2FpdCBtb2RlbC5zYXZlKClcbiAgICAgIFBhcmFtcy5jaGFuZ2VQYXJhbXMoe21vZGU6IHVuZGVmaW5lZCwgbW9kZWxfaWQ6IG1vZGVsLmlkKCl9KVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBGbGFzaE5vdGlmaWNhdGlvbnMuZXJyb3JSZXNwb25zZShlcnJvcilcbiAgICB9XG4gIH1cbn0pKVxuIl19