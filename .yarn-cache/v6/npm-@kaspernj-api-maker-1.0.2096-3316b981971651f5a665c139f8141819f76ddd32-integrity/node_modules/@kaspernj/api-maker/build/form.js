import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
/* eslint-disable sort-imports */
import React, { createContext, useContext, useEffect, useMemo } from "react";
import { Platform } from "react-native";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import BaseComponent from "./base-component";
import FormDataObjectizer from "form-data-objectizer";
import PropTypes from "prop-types";
import memo from "set-state-compare/build/memo.js";
const FormContext = createContext(null);
const useForm = () => useContext(FormContext);
class FormInputs {
    constructor(props) {
        this.inputs = {};
        this.onSubmit = props?.onSubmit;
    }
    asObject() {
        const result = {};
        const formDataObjectizer = new FormDataObjectizer();
        for (const key in this.inputs) {
            const value = this.inputs[key];
            formDataObjectizer.treatInitial(key, value, result);
        }
        return result;
    }
    getValue(name) {
        return this.inputs[name];
    }
    setValue(name, value) {
        if (!name)
            throw new Error("'name' is required");
        this.inputs[name] = value;
    }
    setValueWithHidden(name, value) {
        this.setValue(name, value);
        if (Platform.OS == "web") {
            return _jsx("input", { name: name, type: "hidden", value: value !== null && value !== undefined ? value : "" });
        }
    }
    submit() {
        if (this.onSubmit) {
            this.onSubmit();
        }
    }
}
const Form = memo(shapeComponent(class Form extends BaseComponent {
    static propTypes = {
        children: PropTypes.any,
        formObjectRef: PropTypes.object,
        formRef: PropTypes.object,
        onSubmit: PropTypes.func,
        setForm: PropTypes.func
    };
    render() {
        const { children, formObjectRef, formRef, onSubmit, setForm, ...restProps } = this.props;
        const form = useMemo(() => new FormInputs({ onSubmit }), []);
        useMemo(() => {
            if (formObjectRef) {
                formObjectRef.current = form;
            }
        }, [form, formObjectRef]);
        useEffect(() => () => {
            if (formObjectRef) {
                formObjectRef.current = null;
            }
        }, [form, formObjectRef]);
        useMemo(() => {
            if (setForm) {
                setForm(form);
            }
        }, [setForm]);
        return (_jsxs(FormContext.Provider, { value: form, children: [Platform.OS == "web" &&
                    _jsx("form", { onSubmit: this.tt.onFormSubmit, ref: formRef, ...restProps, children: children }), Platform.OS != "web" && this.props.children] }));
    }
    onFormSubmit = (e) => {
        e.preventDefault();
        if (this.props.onSubmit) {
            this.props.onSubmit();
        }
    };
}));
export { Form, FormContext, FormInputs, useForm };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS5qcyIsInNvdXJjZVJvb3QiOiIvc3JjLyIsInNvdXJjZXMiOlsiZm9ybS5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLGlDQUFpQztBQUNqQyxPQUFPLEtBQUssRUFBRSxFQUFDLGFBQWEsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBQyxNQUFNLE9BQU8sQ0FBQTtBQUMxRSxPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0sY0FBYyxDQUFBO0FBQ3JDLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSw0Q0FBNEMsQ0FBQTtBQUN6RSxPQUFPLGFBQWEsTUFBTSxrQkFBa0IsQ0FBQTtBQUM1QyxPQUFPLGtCQUFrQixNQUFNLHNCQUFzQixDQUFBO0FBQ3JELE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQTtBQUNsQyxPQUFPLElBQUksTUFBTSxpQ0FBaUMsQ0FBQTtBQUVsRCxNQUFNLFdBQVcsR0FBRyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUE7QUFDdkMsTUFBTSxPQUFPLEdBQUcsR0FBRyxFQUFFLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFBO0FBRTdDLE1BQU0sVUFBVTtJQUNkLFlBQVksS0FBSztRQUNmLElBQUksQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFBO1FBQ2hCLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxFQUFFLFFBQVEsQ0FBQTtJQUNqQyxDQUFDO0lBRUQsUUFBUTtRQUNOLE1BQU0sTUFBTSxHQUFHLEVBQUUsQ0FBQTtRQUNqQixNQUFNLGtCQUFrQixHQUFHLElBQUksa0JBQWtCLEVBQUUsQ0FBQTtRQUVuRCxLQUFJLE1BQU0sR0FBRyxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUM3QixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1lBRTlCLGtCQUFrQixDQUFDLFlBQVksQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFBO1FBQ3JELENB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LENBQUMsS0FBSyxDQUFDLFFBQVEsSUFDdkIsQ0FDeEIsQ0FBQTtJQUNILENBQUM7SUFFRCxZQUFZLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRTtRQUNuQixDQUFDLENBQUMsY0FBYyxFQUFFLENBQUE7UUFFbEIsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ3hCLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUE7UUFDdkIsQ0FBQztJQUNILENBQUMsQ0FBQTtDQUNGLENBQUMsQ0FBQyxDQUFBO0FBRUgsT0FBTyxFQUFDLElBQUksRUFBRSxXQUFXLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgc29ydC1pbXBvcnRzICovXG5pbXBvcnQgUmVhY3QsIHtjcmVhdGVDb250ZXh0LCB1c2VDb250ZXh0LCB1c2VFZmZlY3QsIHVzZU1lbW99IGZyb20gXCJyZWFjdFwiXG5pbXBvcnQge1BsYXRmb3JtfSBmcm9tIFwicmVhY3QtbmF0aXZlXCJcbmltcG9ydCB7c2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IEJhc2VDb21wb25lbnQgZnJvbSBcIi4vYmFzZS1jb21wb25lbnRcIlxuaW1wb3J0IEZvcm1EYXRhT2JqZWN0aXplciBmcm9tIFwiZm9ybS1kYXRhLW9iamVjdGl6ZXJcIlxuaW1wb3J0IFByb3BUeXBlcyBmcm9tIFwicHJvcC10eXBlc1wiXG5pbXBvcnQgbWVtbyBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvbWVtby5qc1wiXG5cbmNvbnN0IEZvcm1Db250ZXh0ID0gY3JlYXRlQ29udGV4dChudWxsKVxuY29uc3QgdXNlRm9ybSA9ICgpID0+IHVzZUNvbnRleHQoRm9ybUNvbnRleHQpXG5cbmNsYXNzIEZvcm1JbnB1dHMge1xuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHRoaXMuaW5wdXRzID0ge31cbiAgICB0aGlzLm9uU3VibWl0ID0gcHJvcHM/Lm9uU3VibWl0XG4gIH1cblxuICBhc09iamVjdCgpIHtcbiAgICBjb25zdCByZXN1bHQgPSB7fVxuICAgIGNvbnN0IGZvcm1EYXRhT2JqZWN0aXplciA9IG5ldyBGb3JtRGF0YU9iamVjdGl6ZXIoKVxuXG4gICAgZm9yKGNvbnN0IGtleSBpbiB0aGlzLmlucHV0cykge1xuICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmlucHV0c1trZXldXG5cbiAgICAgIGZvcm1EYXRhT2JqZWN0aXplci50cmVhdEluaXRpYWwoa2V5LCB2YWx1ZSwgcmVzdWx0KVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHRcbiAgfVxuXG4gIGdldFZhbHVlKG5hbWUpIHtcbiAgICByZXR1cm4gdGhpcy5pbnB1dHNbbmFtZV1cbiAgfVxuXG4gIHNldFZhbHVlKG5hbWUsIHZhbHVlKSB7XG4gICAgaWYgKCFuYW1lKSB0aHJvdyBuZXcgRXJyb3IoXCInbmFtZScgaXMgcmVxdWlyZWRcIilcblxuICAgIHRoaXMuaW5wdXRzW25hbWVdID0gdmFsdWVcbiAgfVxuXG4gIHNldFZhbHVlV2l0aEhpZGRlbihuYW1lLCB2YWx1ZSkge1xuICAgIHRoaXMuc2V0VmFsdWUobmFtZSwgdmFsdWUpXG5cbiAgICBpZiAoUGxhdGZvcm0uT1MgPT0gXCJ3ZWJcIikge1xuICAgICAgcmV0dXJuIDxpbnB1dCBuYW1lPXtuYW1lfSB0eXBlPVwiaGlkZGVuXCIgdmFsdWU9e3ZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWQgPyB2YWx1ZSA6IFwiXCJ9IC8+XG4gICAgfVxuICB9XG5cbiAgc3VibWl0KCkge1xuICAgIGlmICh0aGlzLm9uU3VibWl0KSB7XG4gICAgICB0aGlzLm9uU3VibWl0KClcbiAgICB9XG4gIH1cbn1cblxuY29uc3QgRm9ybSA9IG1lbW8oc2hhcGVDb21wb25lbnQoY2xhc3MgRm9ybSBleHRlbmRzIEJhc2VDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIGNoaWxkcmVuOiBQcm9wVHlwZXMuYW55LFxuICAgIGZvcm1PYmplY3RSZWY6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgZm9ybVJlZjogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBvblN1Ym1pdDogUHJvcFR5cGVzLmZ1bmMsXG4gICAgc2V0Rm9ybTogUHJvcFR5cGVzLmZ1bmNcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7Y2hpbGRyZW4sIGZvcm1PYmplY3RSZWYsIGZvcm1SZWYsIG9uU3VibWl0LCBzZXRGb3JtLCAuLi5yZXN0UHJvcHN9ID0gdGhpcy5wcm9wc1xuICAgIGNvbnN0IGZvcm0gPSB1c2VNZW1vKCgpID0+IG5ldyBGb3JtSW5wdXRzKHtvblN1Ym1pdH0pLCBbXSlcblxuICAgIHVzZU1lbW8oKCkgPT4ge1xuICAgICAgaWYgKGZvcm1PYmplY3RSZWYpIHtcbiAgICAgICAgZm9ybU9iamVjdFJlZi5jdXJyZW50ID0gZm9ybVxuICAgICAgfVxuICAgIH0sIFtmb3JtLCBmb3JtT2JqZWN0UmVmXSlcblxuICAgIHVzZUVmZmVjdCgoKSA9PiAoKSA9PiB7XG4gICAgICBpZiAoZm9ybU9iamVjdFJlZikge1xuICAgICAgICBmb3JtT2JqZWN0UmVmLmN1cnJlbnQgPSBudWxsXG4gICAgICB9XG4gICAgfSwgW2Zvcm0sIGZvcm1PYmplY3RSZWZdKVxuXG4gICAgdXNlTWVtbygoKSA9PiB7XG4gICAgICBpZiAoc2V0Rm9ybSkge1xuICAgICAgICBzZXRGb3JtKGZvcm0pXG4gICAgICB9XG4gICAgfSwgW3NldEZvcm1dKVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxGb3JtQ29udGV4dC5Qcm92aWRlciB2YWx1ZT17Zm9ybX0+XG4gICAgICAgIHtQbGF0Zm9ybS5PUyA9PSBcIndlYlwiICYmXG4gICAgICAgICAgPGZvcm0gb25TdWJtaXQ9e3RoaXMudHQub25Gb3JtU3VibWl0fSByZWY9e2Zvcm1SZWZ9IHsuLi5yZXN0UHJvcHN9PlxuICAgICAgICAgICAge2NoaWxkcmVufVxuICAgICAgICAgIDwvZm9ybT5cbiAgICAgICAgfVxuICAgICAgICB7UGxhdGZvcm0uT1MgIT0gXCJ3ZWJcIiAmJiB0aGlzLnByb3BzLmNoaWxkcmVufVxuICAgICAgPC9Gb3JtQ29udGV4dC5Qcm92aWRlcj5cbiAgICApXG4gIH1cblxuICBvbkZvcm1TdWJtaXQgPSAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKVxuXG4gICAgaWYgKHRoaXMucHJvcHMub25TdWJtaXQpIHtcbiAgICAgIHRoaXMucHJvcHMub25TdWJtaXQoKVxuICAgIH1cbiAgfVxufSkpXG5cbmV4cG9ydCB7Rm9ybSwgRm9ybUNvbnRleHQsIEZvcm1JbnB1dHMsIHVzZUZvcm19XG4iXX0=