import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from "react/jsx-runtime";
/* eslint-disable sort-imports */
import React, { useMemo } from "react";
import { digg } from "diggerize";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import { useForm } from "../form";
import AutoSubmit from "./auto-submit.js";
import BaseComponent from "../base-component";
import PropTypes from "prop-types";
import memo from "set-state-compare/build/memo.js";
import useInput from "../use-input.js";
import useUpdatedEvent from "../use-updated-event.js";
export default memo(shapeComponent(class ApiMakerInputsCheckbox extends BaseComponent {
    static defaultProps = {
        autoRefresh: false,
        autoSubmit: false,
        defaultValue: 1,
        model: null,
        zeroInput: true
    };
    static propTypes = {
        attribute: PropTypes.string,
        autoRefresh: PropTypes.bool.isRequired,
        autoSubmit: PropTypes.bool.isRequired,
        defaultChecked: PropTypes.bool,
        defaultValue: PropTypes.any,
        id: PropTypes.string,
        inputRef: PropTypes.object,
        model: PropTypes.object,
        name: PropTypes.string,
        onErrors: PropTypes.func,
        onMatchValidationError: PropTypes.func,
        zeroInput: PropTypes.bool
    };
    setup() {
        const { autoRefresh, model } = this.p;
        const { inputProps, restProps: useInputRestProps } = useInput({ props: this.props, wrapperOptions: { type: "checkbox" } });
        const { defaultValue, name } = inputProps;
        this.setInstance({
            form: useForm(),
            inputProps,
            useInputRestProps
        });
        useMemo(() => {
            if (name) {
                this.tt.form?.setValue(name, defaultValue);
            }
        }, []);
        useUpdatedEvent(model, this.tt.onModelUpdated, { active: Boolean(autoRefresh && model) });
    }
    render() {
        const { inputProps, useInputRestProps } = this.tt;
        const { attribute, autoRefresh, autoSubmit, checked, defaultChecked, defaultValue, id, inputRef, model, name, onChange, zeroInput, ...restProps } = useInputRestProps;
        return (_jsxs(_Fragment, { children: [zeroInput && inputProps.name &&
                    _jsx("input", { defaultValue: "0", name: inputProps.name, type: "hidden" }), _jsx("input", { ...inputProps, "data-auto-refresh": autoRefresh, "data-auto-submit": autoSubmit, defaultValue: defaultValue, onChange: this.tt.onChanged, type: "checkbox", ...restProps })] }));
    }
    onChanged = (...args) => {
        const { form, inputProps } = this.tt;
        const { attribute, autoSubmit, model, onChange } = this.props;
        const { name } = inputProps;
        if (attribute && autoSubmit && model)
            new AutoSubmit({ component: this }).autoSubmit();
        if (form && name) {
            const checked = args[0].target.checked;
            form.setValue(name, checked);
        }
        if (onChange)
            onChange(...args);
    };
    onModelUpdated = (args) => {
        const inputRef = digg(this.tt.inputProps, "ref");
        if (!inputRef.current) {
            // This can happen if the component is being unmounted
            return;
        }
        const { attribute } = this.p;
        const newModel = digg(args, "model");
        const currentChecked = digg(inputRef, "current", "checked");
        const newValue = newModel.readAttribute(attribute);
        if (currentChecked != newValue) {
            inputRef.current.checked = newValue;
        }
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hlY2tib3guanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbImlucHV0cy9jaGVja2JveC5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLGlDQUFpQztBQUNqQyxPQUFPLEtBQUssRUFBRSxFQUFDLE9BQU8sRUFBQyxNQUFNLE9BQU8sQ0FBQTtBQUNwQyxPQUFPLEVBQUMsSUFBSSxFQUFDLE1BQU0sV0FBVyxDQUFBO0FBQzlCLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSw0Q0FBNEMsQ0FBQTtBQUN6RSxPQUFPLEVBQUMsT0FBTyxFQUFDLE1BQU0sU0FBUyxDQUFBO0FBQy9CLE9BQU8sVUFBVSxNQUFNLGtCQUFrQixDQUFBO0FBQ3pDLE9BQU8sYUFBYSxNQUFNLG1CQUFtQixDQUFBO0FBQzdDLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQTtBQUNsQyxPQUFPLElBQUksTUFBTSxpQ0FBaUMsQ0FBQTtBQUNsRCxPQUFPLFFBQVEsTUFBTSxpQkFBaUIsQ0FBQTtBQUN0QyxPQUFPLGVBQWUsTUFBTSx5QkFBeUIsQ0FBQTtBQUVyRCxlQUFlLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxzQkFBdUIsU0FBUSxhQUFhO0lBQ25GLE1BQU0sQ0FBQyxZQUFZLEdBQUc7UUFDcEIsV0FBVyxFQUFFLEtBQUs7UUFDbEIsVUFBVSxFQUFFLEtBQUs7UUFDakIsWUFBWSxFQUFFLENBQUM7UUFDZixLQUFLLEVBQUUsSUFBSTtRQUNYLFNBQVMsRUFBRSxJQUFJO0tBQ2hCLENBQUE7SUFFRCxNQUFNLENBQUMsU0FBUyxHQUFHO1FBQ2pCLFNBQVMsRUFBRSxTQUFTLENBQUMsTUFBTTtRQUMzQixXQUFXLEVBQUUsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVO1FBQ3RDLFVBQVUsRUFBRSxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVU7UUFDckMsY0FBYyxFQUFFLFNBQVMsQ0FBQyxJQUFJO1FBQzlCLFlBQVksRUFBRSxTQUFTLENBQUMsR0FBRztRQUMzQixFQUFFLEVBQUUsU0FBUyxDQUFDLE1BQU07UUFDcEIsUUFBUSxFQUFFLFNBQVMsQ0FBQyxNQUFNO1FBQzFCLEtBQUssRUFBRSxTQUFTLENBQUMsTUFBTTtRQUN2QixJQUFJLEVBQUUsU0FBUyxDQUFDLE1BQU07UUFDdEIsUUFBUSxFQUFFLFNBQVMsQ0FBQyxJQUFJO1FBQ3hCLHNCQUFzQixFQUFFLFNBQVMsQ0FBQyxJQUFJO1FBQ3RDLFNBQVMsRUFBRSxTQUFTLENBQUMsSUFBSTtLQUMxQixDQUFBO0lBRUQsS0FBSztRQUNILE1BQU0sRUFBQyxXQUFXLEVBQUUsS0FBSyxFQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQTtRQUNuQyxNQUFNLEVBQUMsVUFBVSxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBQyxHQUFHLFFBQVEsQ0FBQyxFQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxFQUFFLGNBQWMsRUFBRSxFQUFDLElBQUksRUFBRSxVQUFVLEVBQUMsRUFBQyxDQUFDLENBQUE7UUFDcEgsTUFBTSxFQUFDLFlBQVksRUFBRSxJQUFJLEVBQUMsR0FBRyxVQUFVLENBQUE7UUFFdkMsSUFBSSxDQUFDLFdBQVcsQ0FBQztZQUNmLElBQUksRUFBRSxPQUFPLEVBQUU7WUFDZixVQUFVO1lBQ1YsaUJBQWlCO1NBQ2xCLENBQUMsQ0FBQTtRQUVGLE9BQU8sQ0FBQyxHQUFHLEVBQUU7WUFDWCxJQUFJLElBQUksRUFBRSxDQUFDO2dCQUNULElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxJQUFJLEVBQUUsWUFBWSxDQUFDLENBQUE7WUFDNUMsQ0FBQztRQUNILENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQTtRQUVOLGVBQWUsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxjQUFjLEVBQUUsRUFBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLFdBQVcsSUFBSSxLQUFLLENBQUMsRUFBQyxDQUFDLENBQUE7SUFDekYsQ0FBQztJQUVELE1BQU07UUFDSixNQUFNLEVBQUMsVUFBVSxFQUFFLGlCQUFpQixFQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQTtRQUMvQyxNQUFNLEVBQ0osU0FBUyxFQUNULFdBQVcsRUFDWCxVQUFVLEVBQ1YsT0FBTyxFQUNQLGNBQWMsRUFDZCxZQUFZLEVBQ1osRUFBRSxFQUNGLFFBQVEsRUFDUixLQUFLLEVBQ0wsSUFBSSxFQUNKLFFBQVEsRUFDUixTQUFTLEVBQ1QsR0FBRyxTQUFTLEVBQ2IsR0FBRyxpQkFBaUIsQ0FBQTtRQUVyQixPQUFPLENBQ0wsOEJBQ0csU0FBUyxJQUFJLFVBQVUsQ0FBQyxJQUFJO29CQUMzQixnQkFBTyxZQUFZLEVBQUMsR0FBRyxFQUFDLElBQUksRUFBRSxVQUFVLENBQUMsSUFBSSxFQUFFLElBQUksRUFBQyxRQUFRLEdBQUcsRUFFakUsbUJBQ00sVUFBVSx1QkFDSyxXQUFXLHNCQUNaLFVBQVUsRUFDNUIsWUFBWSxFQUFFLFlBQVksRUFDMUIsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxFQUMzQixJQUFJLEVBQUMsVUFBVSxLQUNYLFNBQVMsR0FDYixJQUNELENBQ0osQ0FBQTtJQUNILENBQUM7SUFFRCxTQUFTLEdBQUcsQ0FBQyxHQUFHLElBQUksRUFBRSxFQUFFO1FBQ3RCLE1BQU0sRUFBQyxJQUFJLEVBQUUsVUFBVSxFQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQTtRQUNsQyxNQUFNLEVBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQTtRQUMzRCxNQUFNLEVBQUMsSUFBSSxFQUFDLEdBQUcsVUFBVSxDQUFBO1FBRXpCLElBQUksU0FBUyxJQUFJLFVBQVUsSUFBSSxLQUFLO1lBQUUsSUFBSSxVQUFVLENBQUMsRUFBQyxTQUFTLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQyxVQUFVLEVBQUUsQ0FBQTtRQUVwRixJQUFJLElBQUksSUFBSSxJQUFJLEVBQUUsQ0FBQztZQUNqQixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQTtZQUV0QyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQTtRQUM5QixDQUFDO1FBRUQsSUFBSSxRQUFRO1lBQUUsUUFBUSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUE7SUFDakMsQ0FBQyxDQUFBO0lBRUQsY0FBYyxHQUFHLENBQUMsSUFBSSxFQUFFLEVBQUU7UUFDeEIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFBO1FBRWhELElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDdEIsc0RBQXNEO1lBQ3RELE9BQU07UUFDUixDQUFDO1FBRUQsTUFBTSxFQUFDLFNBQVMsRUFBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUE7UUFDMUIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQTtRQUNwQyxNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFFLFNBQVMsRUFBRSxTQUFTLENBQUMsQ0FBQTtRQUMzRCxNQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxDQUFBO1FBRWxELElBQUksY0FBYyxJQUFJLFFBQVEsRUFBRSxDQUFDO1lBQy9CLFFBQVEsQ0FBQyxPQUFPLENBQUMsT0FBTyxHQUFHLFFBQVEsQ0FBQTtRQUNyQyxDQUFDO0lBQ0gsQ0FBQyxDQUFBO0NBQ0YsQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBzb3J0LWltcG9ydHMgKi9cbmltcG9ydCBSZWFjdCwge3VzZU1lbW99IGZyb20gXCJyZWFjdFwiXG5pbXBvcnQge2RpZ2d9IGZyb20gXCJkaWdnZXJpemVcIlxuaW1wb3J0IHtzaGFwZUNvbXBvbmVudH0gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL3NoYXBlLWNvbXBvbmVudC5qc1wiXG5pbXBvcnQge3VzZUZvcm19IGZyb20gXCIuLi9mb3JtXCJcbmltcG9ydCBBdXRvU3VibWl0IGZyb20gXCIuL2F1dG8tc3VibWl0LmpzXCJcbmltcG9ydCBCYXNlQ29tcG9uZW50IGZyb20gXCIuLi9iYXNlLWNvbXBvbmVudFwiXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gXCJwcm9wLXR5cGVzXCJcbmltcG9ydCBtZW1vIGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9tZW1vLmpzXCJcbmltcG9ydCB1c2VJbnB1dCBmcm9tIFwiLi4vdXNlLWlucHV0LmpzXCJcbmltcG9ydCB1c2VVcGRhdGVkRXZlbnQgZnJvbSBcIi4uL3VzZS11cGRhdGVkLWV2ZW50LmpzXCJcblxuZXhwb3J0IGRlZmF1bHQgbWVtbyhzaGFwZUNvbXBvbmVudChjbGFzcyBBcGlNYWtlcklucHV0c0NoZWNrYm94IGV4dGVuZHMgQmFzZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgYXV0b1JlZnJlc2g6IGZhbHNlLFxuICAgIGF1dG9TdWJtaXQ6IGZhbHNlLFxuICAgIGRlZmF1bHRWYWx1ZTogMSxcbiAgICBtb2RlbDogbnVsbCxcbiAgICB6ZXJvSW5wdXQ6IHRydWVcbiAgfVxuXG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgYXR0cmlidXRlOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGF1dG9SZWZyZXNoOiBQcm9wVHlwZXMuYm9vbC5pc1JlcXVpcmVkLFxuICAgIGF1dG9TdWJtaXQ6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsXG4gICAgZGVmYXVsdENoZWNrZWQ6IFByb3BUeXBlcy5ib29sLFxuICAgIGRlZmF1bHRWYWx1ZTogUHJvcFR5cGVzLmFueSxcbiAgICBpZDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBpbnB1dFJlZjogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBtb2RlbDogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBuYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIG9uRXJyb3JzOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvbk1hdGNoVmFsaWRhdGlvbkVycm9yOiBQcm9wVHlwZXMuZnVuYyxcbiAgICB6ZXJvSW5wdXQ6IFByb3BUeXBlcy5ib29sXG4gIH1cblxuICBzZXR1cCgpIHtcbiAgICBjb25zdCB7YXV0b1JlZnJlc2gsIG1vZGVsfSA9IHRoaXMucFxuICAgIGNvbnN0IHtpbnB1dFByb3BzLCByZXN0UHJvcHM6IHVzZUlucHV0UmVzdFByb3BzfSA9IHVzZUlucHV0KHtwcm9wczogdGhpcy5wcm9wcywgd3JhcHBlck9wdGlvbnM6IHt0eXBlOiBcImNoZWNrYm94XCJ9fSlcbiAgICBjb25zdCB7ZGVmYXVsdFZhbHVlLCBuYW1lfSA9IGlucHV0UHJvcHNcblxuICAgIHRoaXMuc2V0SW5zdGFuY2Uoe1xuICAgICAgZm9ybTogdXNlRm9ybSgpLFxuICAgICAgaW5wdXRQcm9wcyxcbiAgICAgIHVzZUlucHV0UmVzdFByb3BzXG4gICAgfSlcblxuICAgIHVzZU1lbW8oKCkgPT4ge1xuICAgICAgaWYgKG5hbWUpIHtcbiAgICAgICAgdGhpcy50dC5mb3JtPy5zZXRWYWx1ZShuYW1lLCBkZWZhdWx0VmFsdWUpXG4gICAgICB9XG4gICAgfSwgW10pXG5cbiAgICB1c2VVcGRhdGVkRXZlbnQobW9kZWwsIHRoaXMudHQub25Nb2RlbFVwZGF0ZWQsIHthY3RpdmU6IEJvb2xlYW4oYXV0b1JlZnJlc2ggJiYgbW9kZWwpfSlcbiAgfVxuXG4gIHJlbmRlciAoKSB7XG4gICAgY29uc3Qge2lucHV0UHJvcHMsIHVzZUlucHV0UmVzdFByb3BzfSA9IHRoaXMudHRcbiAgICBjb25zdCB7XG4gICAgICBhdHRyaWJ1dGUsXG4gICAgICBhdXRvUmVmcmVzaCxcbiAgICAgIGF1dG9TdWJtaXQsXG4gICAgICBjaGVja2VkLFxuICAgICAgZGVmYXVsdENoZWNrZWQsXG4gICAgICBkZWZhdWx0VmFsdWUsXG4gICAgICBpZCxcbiAgICAgIGlucHV0UmVmLFxuICAgICAgbW9kZWwsXG4gICAgICBuYW1lLFxuICAgICAgb25DaGFuZ2UsXG4gICAgICB6ZXJvSW5wdXQsXG4gICAgICAuLi5yZXN0UHJvcHNcbiAgICB9ID0gdXNlSW5wdXRSZXN0UHJvcHNcblxuICAgIHJldHVybiAoXG4gICAgICA8PlxuICAgICAgICB7emVyb0lucHV0ICYmIGlucHV0UHJvcHMubmFtZSAmJlxuICAgICAgICAgIDxpbnB1dCBkZWZhdWx0VmFsdWU9XCIwXCIgbmFtZT17aW5wdXRQcm9wcy5uYW1lfSB0eXBlPVwiaGlkZGVuXCIgLz5cbiAgICAgICAgfVxuICAgICAgICA8aW5wdXRcbiAgICAgICAgICB7Li4uaW5wdXRQcm9wc31cbiAgICAgICAgICBkYXRhLWF1dG8tcmVmcmVzaD17YXV0b1JlZnJlc2h9XG4gICAgICAgICAgZGF0YS1hdXRvLXN1Ym1pdD17YXV0b1N1Ym1pdH1cbiAgICAgICAgICBkZWZhdWx0VmFsdWU9e2RlZmF1bHRWYWx1ZX1cbiAgICAgICAgICBvbkNoYW5nZT17dGhpcy50dC5vbkNoYW5nZWR9XG4gICAgICAgICAgdHlwZT1cImNoZWNrYm94XCJcbiAgICAgICAgICB7Li4ucmVzdFByb3BzfVxuICAgICAgICAvPlxuICAgICAgPC8+XG4gICAgKVxuICB9XG5cbiAgb25DaGFuZ2VkID0gKC4uLmFyZ3MpID0+IHtcbiAgICBjb25zdCB7Zm9ybSwgaW5wdXRQcm9wc30gPSB0aGlzLnR0XG4gICAgY29uc3Qge2F0dHJpYnV0ZSwgYXV0b1N1Ym1pdCwgbW9kZWwsIG9uQ2hhbmdlfSA9IHRoaXMucHJvcHNcbiAgICBjb25zdCB7bmFtZX0gPSBpbnB1dFByb3BzXG5cbiAgICBpZiAoYXR0cmlidXRlICYmIGF1dG9TdWJtaXQgJiYgbW9kZWwpIG5ldyBBdXRvU3VibWl0KHtjb21wb25lbnQ6IHRoaXN9KS5hdXRvU3VibWl0KClcblxuICAgIGlmIChmb3JtICYmIG5hbWUpIHtcbiAgICAgIGNvbnN0IGNoZWNrZWQgPSBhcmdzWzBdLnRhcmdldC5jaGVja2VkXG5cbiAgICAgIGZvcm0uc2V0VmFsdWUobmFtZSwgY2hlY2tlZClcbiAgICB9XG5cbiAgICBpZiAob25DaGFuZ2UpIG9uQ2hhbmdlKC4uLmFyZ3MpXG4gIH1cblxuICBvbk1vZGVsVXBkYXRlZCA9IChhcmdzKSA9PiB7XG4gICAgY29uc3QgaW5wdXRSZWYgPSBkaWdnKHRoaXMudHQuaW5wdXRQcm9wcywgXCJyZWZcIilcblxuICAgIGlmICghaW5wdXRSZWYuY3VycmVudCkge1xuICAgICAgLy8gVGhpcyBjYW4gaGFwcGVuIGlmIHRoZSBjb21wb25lbnQgaXMgYmVpbmcgdW5tb3VudGVkXG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBjb25zdCB7YXR0cmlidXRlfSA9IHRoaXMucFxuICAgIGNvbnN0IG5ld01vZGVsID0gZGlnZyhhcmdzLCBcIm1vZGVsXCIpXG4gICAgY29uc3QgY3VycmVudENoZWNrZWQgPSBkaWdnKGlucHV0UmVmLCBcImN1cnJlbnRcIiwgXCJjaGVja2VkXCIpXG4gICAgY29uc3QgbmV3VmFsdWUgPSBuZXdNb2RlbC5yZWFkQXR0cmlidXRlKGF0dHJpYnV0ZSlcblxuICAgIGlmIChjdXJyZW50Q2hlY2tlZCAhPSBuZXdWYWx1ZSkge1xuICAgICAgaW5wdXRSZWYuY3VycmVudC5jaGVja2VkID0gbmV3VmFsdWVcbiAgICB9XG4gIH1cbn0pKVxuIl19