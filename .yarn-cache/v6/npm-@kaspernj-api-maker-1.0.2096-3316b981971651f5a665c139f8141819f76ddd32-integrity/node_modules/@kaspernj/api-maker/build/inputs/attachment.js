import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
/* eslint-disable sort-imports */
import { Input as ApiMakerInput } from "@kaspernj/api-maker/build/inputs/input";
import { digg } from "diggerize";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import BaseComponent from "../base-component";
import Checkbox from "./checkbox";
import PropTypes from "prop-types";
import React from "react";
import classNames from "classnames"; // eslint-disable-line import/no-unresolved
import memo from "set-state-compare/build/memo.js";
import useI18n from "i18n-on-steroids/src/use-i18n.mjs";
import useInput from "../use-input.js";
export default memo(shapeComponent(class ApiMakerInputsAttachment extends BaseComponent {
    static propTypes = {
        className: PropTypes.string,
        model: PropTypes.object.isRequired,
        onPurgeChanged: PropTypes.func,
        purgeName: PropTypes.string
    };
    setup() {
        const { t } = useI18n({ namespace: "js.api_maker.inputs.attachment" });
        const { inputProps } = useInput({ props: this.props });
        this.setInstance({ inputProps, t });
        this.useStates({
            purgeChecked: false
        });
    }
    render() {
        const { inputProps, t } = this.tt;
        const { attribute, checkboxComponent, className, label, model, name, onPurgeChanged, purgeName, wrapperOpts, ...restProps } = this.props;
        const CheckboxComponent = checkboxComponent || Checkbox;
        const newInputProps = Object.assign({}, inputProps, { type: "file" }); // eslint-disable-line prefer-object-spread
        return (_jsxs("div", { className: classNames("api-maker--inputs--attachment", "components--inputs--input", className), ...restProps, children: [this.isImage() &&
                    _jsx("a", { href: this.getUrl(), target: "_blank", children: _jsx("img", { src: this.getUrl(), style: { maxWidth: "200px", maxHeight: "200px" } }) }), this.getUrl() &&
                    _jsxs("div", { className: "input-checkbox", style: { paddingTop: "15px", paddingBottom: "15px" }, children: [_jsx(CheckboxComponent, { id: this.getPurgeInputId(), name: this.getPurgeInputName(), onChange: this.props.onPurgeChanged }), _jsx("label", { className: "checkbox-label", htmlFor: this.getPurgeInputId(), children: t("js.shared.delete") })] }), !this.s.purgeChecked &&
                    _jsx(ApiMakerInput, { defaultValue: null, inputProps: newInputProps, model: model })] }));
    }
    getContentType() {
        const { attribute, model } = this.p;
        const attributeName = `${attribute}ContentType`;
        if (!(attributeName in model))
            throw new Error(`No such method on ${model.modelClassData().name}: ${attributeName}`);
        return model[attributeName]();
    }
    getPurgeInputId() {
        const { inputProps } = this.tt;
        return `${inputProps.id}_purge`;
    }
    getPurgeInputName() {
        if ("purgeName" in this.props)
            return this.props.purgeName;
        const { inputProps } = this.tt;
        if (!inputProps.name)
            return null;
        const match = inputProps.name.match(/^(.+)\[(.+?)\]$/);
        const purgeInputName = `${match[1]}[${match[2]}_purge]`;
        return purgeInputName;
    }
    getUrl() {
        const { attribute, model } = this.p;
        const attributeName = `${attribute}Url`;
        if (!(attributeName in model))
            throw new Error(`No such method on ${model.modelClassData().name}: ${attributeName}`);
        return model[attributeName]();
    }
    isImage() {
        return this.getContentType()?.startsWith("image/");
    }
    onPurgeChanged = (e) => {
        this.setState({ purgeChecked: digg(e, "target", "checked") });
        if (this.props.onPurgeChanged)
            this.props.onPurgeChanged(e);
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXR0YWNobWVudC5qcyIsInNvdXJjZVJvb3QiOiIvc3JjLyIsInNvdXJjZXMiOlsiaW5wdXRzL2F0dGFjaG1lbnQuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxpQ0FBaUM7QUFDakMsT0FBTyxFQUFDLEtBQUssSUFBSSxhQUFhLEVBQUMsTUFBTSx3Q0FBd0MsQ0FBQTtBQUM3RSxPQUFPLEVBQUMsSUFBSSxFQUFDLE1BQU0sV0FBVyxDQUFBO0FBQzlCLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSw0Q0FBNEMsQ0FBQTtBQUN6RSxPQUFPLGFBQWEsTUFBTSxtQkFBbUIsQ0FBQTtBQUM3QyxPQUFPLFFBQVEsTUFBTSxZQUFZLENBQUE7QUFDakMsT0FBTyxTQUFTLE1BQU0sWUFBWSxDQUFBO0FBQ2xDLE9BQU8sS0FBSyxNQUFNLE9BQU8sQ0FBQTtBQUN6QixPQUFPLFVBQVUsTUFBTSxZQUFZLENBQUEsQ0FBQywyQ0FBMkM7QUFDL0UsT0FBTyxJQUFJLE1BQU0saUNBQWlDLENBQUE7QUFDbEQsT0FBTyxPQUFPLE1BQU0sbUNBQW1DLENBQUE7QUFDdkQsT0FBTyxRQUFRLE1BQU0saUJBQWlCLENBQUE7QUFFdEMsZUFBZSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sd0JBQXlCLFNBQVEsYUFBYTtJQUNyRixNQUFNLENBQUMsU0FBUyxHQUFHO1FBQ2pCLFNBQVMsRUFBRSxTQUFTLENBQUMsTUFBTTtRQUMzQixLQUFLLEVBQUUsU0FBUyxDQUFDLE1BQU0sQ0FBQyxVQUFVO1FBQ2xDLGNBQWMsRUFBRSxTQUFTLENBQUMsSUFBSTtRQUM5QixTQUFTLEVBQUUsU0FBUyxDQUFDLE1BQU07S0FDNUIsQ0FBQTtJQUVELEtBQUs7UUFDSCxNQUFNLEVBQUMsQ0FBQyxFQUFDLEdBQUcsT0FBTyxDQUFDLEVBQUMsU0FBUyxFQUFFLGdDQUFnQyxFQUFDLENBQUMsQ0FBQTtRQUNsRSxNQUFNLEVBQUMsVUFBVSxFQUFDLEdBQUcsUUFBUSxDQUFDLEVBQUMsS0FBSyxFQUFF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QyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBzb3J0LWltcG9ydHMgKi9cbmltcG9ydCB7SW5wdXQgYXMgQXBpTWFrZXJJbnB1dH0gZnJvbSBcIkBrYXNwZXJuai9hcGktbWFrZXIvYnVpbGQvaW5wdXRzL2lucHV0XCJcbmltcG9ydCB7ZGlnZ30gZnJvbSBcImRpZ2dlcml6ZVwiXG5pbXBvcnQge3NoYXBlQ29tcG9uZW50fSBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvc2hhcGUtY29tcG9uZW50LmpzXCJcbmltcG9ydCBCYXNlQ29tcG9uZW50IGZyb20gXCIuLi9iYXNlLWNvbXBvbmVudFwiXG5pbXBvcnQgQ2hlY2tib3ggZnJvbSBcIi4vY2hlY2tib3hcIlxuaW1wb3J0IFByb3BUeXBlcyBmcm9tIFwicHJvcC10eXBlc1wiXG5pbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCJcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gXCJjbGFzc25hbWVzXCIgLy8gZXNsaW50LWRpc2FibGUtbGluZSBpbXBvcnQvbm8tdW5yZXNvbHZlZFxuaW1wb3J0IG1lbW8gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL21lbW8uanNcIlxuaW1wb3J0IHVzZUkxOG4gZnJvbSBcImkxOG4tb24tc3Rlcm9pZHMvc3JjL3VzZS1pMThuLm1qc1wiXG5pbXBvcnQgdXNlSW5wdXQgZnJvbSBcIi4uL3VzZS1pbnB1dC5qc1wiXG5cbmV4cG9ydCBkZWZhdWx0IG1lbW8oc2hhcGVDb21wb25lbnQoY2xhc3MgQXBpTWFrZXJJbnB1dHNBdHRhY2htZW50IGV4dGVuZHMgQmFzZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIG1vZGVsOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgb25QdXJnZUNoYW5nZWQ6IFByb3BUeXBlcy5mdW5jLFxuICAgIHB1cmdlTmFtZTogUHJvcFR5cGVzLnN0cmluZ1xuICB9XG5cbiAgc2V0dXAoKSB7XG4gICAgY29uc3Qge3R9ID0gdXNlSTE4bih7bmFtZXNwYWNlOiBcImpzLmFwaV9tYWtlci5pbnB1dHMuYXR0YWNobWVudFwifSlcbiAgICBjb25zdCB7aW5wdXRQcm9wc30gPSB1c2VJbnB1dCh7cHJvcHM6IHRoaXMucHJvcHN9KVxuXG4gICAgdGhpcy5zZXRJbnN0YW5jZSh7aW5wdXRQcm9wcywgdH0pXG4gICAgdGhpcy51c2VTdGF0ZXMoe1xuICAgICAgcHVyZ2VDaGVja2VkOiBmYWxzZVxuICAgIH0pXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge2lucHV0UHJvcHMsIHR9ID0gdGhpcy50dFxuICAgIGNvbnN0IHthdHRyaWJ1dGUsIGNoZWNrYm94Q29tcG9uZW50LCBjbGFzc05hbWUsIGxhYmVsLCBtb2RlbCwgbmFtZSwgb25QdXJnZUNoYW5nZWQsIHB1cmdlTmFtZSwgd3JhcHBlck9wdHMsIC4uLnJlc3RQcm9wc30gPSB0aGlzLnByb3BzXG4gICAgY29uc3QgQ2hlY2tib3hDb21wb25lbnQgPSBjaGVja2JveENvbXBvbmVudCB8fCBDaGVja2JveFxuICAgIGNvbnN0IG5ld0lucHV0UHJvcHMgPSBPYmplY3QuYXNzaWduKHt9LCBpbnB1dFByb3BzLCB7dHlwZTogXCJmaWxlXCJ9KSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHByZWZlci1vYmplY3Qtc3ByZWFkXG5cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9e2NsYXNzTmFtZXMoXCJhcGktbWFrZXItLWlucHV0cy0tYXR0YWNobWVudFwiLCBcImNvbXBvbmVudHMtLWlucHV0cy0taW5wdXRcIiwgY2xhc3NOYW1lKX0gey4uLnJlc3RQcm9wc30+XG4gICAgICAgIHt0aGlzLmlzSW1hZ2UoKSAmJlxuICAgICAgICAgIDxhIGhyZWY9e3RoaXMuZ2V0VXJsKCl9IHRhcmdldD1cIl9ibGFua1wiPlxuICAgICAgICAgICAgPGltZyBzcmM9e3RoaXMuZ2V0VXJsKCl9IHN0eWxlPXt7bWF4V2lkdGg6IFwiMjAwcHhcIiwgbWF4SGVpZ2h0OiBcIjIwMHB4XCJ9fSAvPlxuICAgICAgICAgIDwvYT5cbiAgICAgICAgfVxuICAgICAgICB7dGhpcy5nZXRVcmwoKSAmJlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiaW5wdXQtY2hlY2tib3hcIiBzdHlsZT17e3BhZGRpbmdUb3A6IFwiMTVweFwiLCBwYWRkaW5nQm90dG9tOiBcIjE1cHhcIn19PlxuICAgICAgICAgICAgPENoZWNrYm94Q29tcG9uZW50IGlkPXt0aGlzLmdldFB1cmdlSW5wdXRJZCgpfSBuYW1lPXt0aGlzLmdldFB1cmdlSW5wdXROYW1lKCl9IG9uQ2hhbmdlPXt0aGlzLnByb3BzLm9uUHVyZ2VDaGFuZ2VkfSAvPlxuICAgICAgICAgICAgPGxhYmVsIGNsYXNzTmFtZT1cImNoZWNrYm94LWxhYmVsXCIgaHRtbEZvcj17dGhpcy5nZXRQdXJnZUlucHV0SWQoKX0+XG4gICAgICAgICAgICAgIHt0KFwianMuc2hhcmVkLmRlbGV0ZVwiKX1cbiAgICAgICAgICAgIDwvbGFiZWw+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIH1cbiAgICAgICAgeyF0aGlzLnMucHVyZ2VDaGVja2VkICYmXG4gICAgICAgICAgPEFwaU1ha2VySW5wdXRcbiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZT17bnVsbH1cbiAgICAgICAgICAgIGlucHV0UHJvcHM9e25ld0lucHV0UHJvcHN9XG4gICAgICAgICAgICBtb2RlbD17bW9kZWx9XG4gICAgICAgICAgLz5cbiAgICAgICAgfVxuICAgICAgPC9kaXY+XG4gICAgKVxuICB9XG5cbiAgZ2V0Q29udGVudFR5cGUoKSB7XG4gICAgY29uc3Qge2F0dHJpYnV0ZSwgbW9kZWx9ID0gdGhpcy5wXG4gICAgY29uc3QgYXR0cmlidXRlTmFtZSA9IGAke2F0dHJpYnV0ZX1Db250ZW50VHlwZWBcblxuICAgIGlmICghKGF0dHJpYnV0ZU5hbWUgaW4gbW9kZWwpKSB0aHJvdyBuZXcgRXJyb3IoYE5vIHN1Y2ggbWV0aG9kIG9uICR7bW9kZWwubW9kZWxDbGFzc0RhdGEoKS5uYW1lfTogJHthdHRyaWJ1dGVOYW1lfWApXG5cbiAgICByZXR1cm4gbW9kZWxbYXR0cmlidXRlTmFtZV0oKVxuICB9XG5cbiAgZ2V0UHVyZ2VJbnB1dElkKCkge1xuICAgIGNvbnN0IHtpbnB1dFByb3BzfSA9IHRoaXMudHRcblxuICAgIHJldHVybiBgJHtpbnB1dFByb3BzLmlkfV9wdXJnZWBcbiAgfVxuXG4gIGdldFB1cmdlSW5wdXROYW1lKCkge1xuICAgIGlmIChcInB1cmdlTmFtZVwiIGluIHRoaXMucHJvcHMpIHJldHVybiB0aGlzLnByb3BzLnB1cmdlTmFtZVxuXG4gICAgY29uc3Qge2lucHV0UHJvcHN9ID0gdGhpcy50dFxuXG4gICAgaWYgKCFpbnB1dFByb3BzLm5hbWUpIHJldHVybiBudWxsXG5cbiAgICBjb25zdCBtYXRjaCA9IGlucHV0UHJvcHMubmFtZS5tYXRjaCgvXiguKylcXFsoLis/KVxcXSQvKVxuICAgIGNvbnN0IHB1cmdlSW5wdXROYW1lID0gYCR7bWF0Y2hbMV19WyR7bWF0Y2hbMl19X3B1cmdlXWBcblxuICAgIHJldHVybiBwdXJnZUlucHV0TmFtZVxuICB9XG5cbiAgZ2V0VXJsKCkge1xuICAgIGNvbnN0IHthdHRyaWJ1dGUsIG1vZGVsfSA9IHRoaXMucFxuICAgIGNvbnN0IGF0dHJpYnV0ZU5hbWUgPSBgJHthdHRyaWJ1dGV9VXJsYFxuXG4gICAgaWYgKCEoYXR0cmlidXRlTmFtZSBpbiBtb2RlbCkpIHRocm93IG5ldyBFcnJvcihgTm8gc3VjaCBtZXRob2Qgb24gJHttb2RlbC5tb2RlbENsYXNzRGF0YSgpLm5hbWV9OiAke2F0dHJpYnV0ZU5hbWV9YClcblxuICAgIHJldHVybiBtb2RlbFthdHRyaWJ1dGVOYW1lXSgpXG4gIH1cblxuICBpc0ltYWdlKCkge1xuICAgIHJldHVybiB0aGlzLmdldENvbnRlbnRUeXBlKCk/LnN0YXJ0c1dpdGgoXCJpbWFnZS9cIilcbiAgfVxuXG4gIG9uUHVyZ2VDaGFuZ2VkID0gKGUpID0+IHtcbiAgICB0aGlzLnNldFN0YXRlKHtwdXJnZUNoZWNrZWQ6IGRpZ2coZSwgXCJ0YXJnZXRcIiwgXCJjaGVja2VkXCIpfSlcblxuICAgIGlmICh0aGlzLnByb3BzLm9uUHVyZ2VDaGFuZ2VkKSB0aGlzLnByb3BzLm9uUHVyZ2VDaGFuZ2VkKGUpXG4gIH1cbn0pKVxuIl19