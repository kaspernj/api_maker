import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
/* eslint-disable react/button-has-type, sort-imports */
import apiMakerConfig from "@kaspernj/api-maker/build/config.js";
import BaseComponent from "../../base-component";
import Checkbox from "../../bootstrap/checkbox";
import { digg } from "diggerize";
import { FlashNotifications } from "flash-notifications";
import { Form } from "../../form";
import Input from "../../bootstrap/input";
import modelClassRequire from "../../model-class-require.js";
import React from "react";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import memo from "set-state-compare/build/memo.js";
import useI18n from "i18n-on-steroids/src/use-i18n.mjs";
const TableSearch = modelClassRequire("TableSearch");
export default memo(shapeComponent(class ApiMakerTableFiltersSaveSearchModal extends BaseComponent {
    setup() {
        const { t } = useI18n({ namespace: "js.api_maker.table.filters.save_search_modal" });
        this.t = t;
        this.useStates({ form: null });
    }
    render() {
        const { currentFilters, currentUser, onRequestClose, search, ...restProps } = this.props;
        const Modal = apiMakerConfig.getModal();
        return (_jsx(Modal, { onRequestClose: onRequestClose, ...restProps, children: _jsxs(Form, { onSubmit: this.tt.onSaveSearchSubmit, setForm: this.setStates.form, children: [_jsx(Input, { defaultValue: search.name(), id: "table_search_name", label: this.t(".search_name", { defaultValue: "Search name" }), name: "table_search[name]" }), _jsx(Checkbox, { defaultChecked: search.public(), id: "table_search_public", label: this.t(".public", { defaultValue: "Public" }), name: "table_search[public]" }), _jsx("button", { className: "save-search-submit-button", children: this.t(".save_search", { defaultValue: "Save search" }) })] }) }));
    }
    onSaveSearchSubmit = async () => {
        const formData = this.s.form.asObject();
        const { currentFilters, currentUser, onRequestClose, search } = this.p;
        const hasUserTypeColumn = Boolean(TableSearch.attributes().find((attribute) => attribute.name() == "user_type"));
        if (search.isNewRecord()) {
            formData.table_search.query_params = JSON.stringify(currentFilters());
        }
        if (hasUserTypeColumn) {
            formData.table_search.user_type = digg(currentUser.modelClassData(), "className");
        }
        formData.table_search.user_id = currentUser.id();
        try {
            await search.saveRaw(formData);
            FlashNotifications.success(this.t(".", { defaultValue: "The search was saved." }));
            onRequestClose();
        }
        catch (error) {
            FlashNotifications.errorResponse(error);
        }
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2F2ZS1zZWFyY2gtbW9kYWwuanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbInRhYmxlL2ZpbHRlcnMvc2F2ZS1zZWFyY2gtbW9kYWwuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSx3REFBd0Q7QUFDeEQsT0FBTyxjQUFjLE1BQU0scUNBQXFDLENBQUE7QUFDaEUsT0FBTyxhQUFhLE1BQU0sc0JBQXNCLENBQUE7QUFDaEQsT0FBTyxRQUFRLE1BQU0sMEJBQTBCLENBQUE7QUFDL0MsT0FBTyxFQUFDLElBQUksRUFBQyxNQUFNLFdBQVcsQ0FBQTtBQUM5QixPQUFPLEVBQUMsa0JBQWtCLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQTtBQUN0RCxPQUFPLEVBQUMsSUFBSSxFQUFDLE1BQU0sWUFBWSxDQUFBO0FBQy9CLE9BQU8sS0FBSyxNQUFNLHVCQUF1QixDQUFBO0FBQ3pDLE9BQU8saUJBQWlCLE1BQU0sOEJBQThCLENBQUE7QUFDNUQsT0FBTyxLQUFLLE1BQU0sT0FBTyxDQUFBO0FBQ3pCLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSw0Q0FBNEMsQ0FBQTtBQUN6RSxPQUFPLElBQUksTUFBTSxpQ0FBaUMsQ0FBQTtBQUNsRCxPQUFPLE9BQU8sTUFBTSxtQ0FBbUMsQ0FBQTtBQUV2RCxNQUFNLFdBQVcsR0FBRyxpQkFBaUIsQ0FBQyxhQUFhLENBQUMsQ0FBQTtBQUVwRCxlQUFlLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxtQ0FBb0MsU0FBUSxhQUFhO0lBQ2hHLEtBQUs7UUFDSCxNQUFNLEVBQUMsQ0FBQyxFQUFDLEdBQUcsT0FBTyxDQUFDLEVBQUMsU0FBUyxFQUFFLDhDQUE4QyxFQUFDLENBQUMsQ0FBQTtRQUVoRixJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUNWLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBQyxJQUFJLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQTtJQUM5QixDQUFDO0lBRUQsTUFBTTtRQUNKLE1BQU0sRUFBQyxjQUFjLEVBQUUsV0FBVyxFQUFFLGNBQWMsRUFBRSxNQUFNLEVBQUUsR0FBRyxTQUFTLEVBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFBO1FBQ3RGLE1BQU0sS0FBSyxHQUFHLGNBQWMsQ0FBQyxRQUFRLEVBQUUsQ0FBQTtRQUV2QyxPQUFPLENBQ0wsS0FBQyxLQUFLLElBQUMsY0FBYyxFQUFFLGNBQWMsS0FBTSxTQUFTLFlBQ2xELE1BQUMsSUFBSSxJQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLGtCQUFrQixFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksYUFDdEUsS0FBQyxLQUFLLElBQ0osWUFBWSxFQUFFLE1BQU0sQ0FBQyxJQUFJLEVBQUUsRUFDM0IsRUFBRSxFQUFDLG1CQUFtQixFQUN0QixLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxjQUFjLEVBQUUsRUFBQyxZQUFZLEVBQUUsYUFBYSxFQUFDLENBQUMsRUFDNUQsSUFBSSxFQUFDLG9CQUFvQixHQUN6QixFQUNGLEtBQUMsUUFBUSxJQUNQLGNBQWMsRUFBRSxNQUFNLENBQUMsTUFBTSxFQUFFLEVBQy9CLEVBQUUsRUFBQyxxQkFBcUIsRUFDeEIsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsU0FBUyxFQUFFLEVBQUMsWUFBWSxFQUFFLFFBQVEsRUFBQyxDQUFDLEVBQ2xELElBQUksRUFBQyxzQkFBc0IsR0FDM0IsRUFDRixpQkFBUSxTQUFTLEVBQUMsMkJBQTJCLFlBQzFDLElBQUksQ0FBQyxDQUFDLENBQUMsY0FBYyxFQUFFLEVBQUMsWUFBWSxFQUFFLGFBQWEsRUFBQyxDQUFDLEdBQy9DLElBQ0osR0FDRCxDQUNULENBQUE7SUFDSCxDQUFDO0lBRUQsa0JBQWtCLEdBQUcsS0FBSyxJQUFJLEVBQUU7UUFDOUIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUE7UUFDdkMsTUFBTSxFQUFDLGNBQWMsRUFBRSxXQUFXLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUE7UUFDcEUsTUFBTSxpQkFBaUIsR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLFVBQVUsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxJQUFJLFdBQVcsQ0FBQyxDQUFDLENBQUE7UUFFaEgsSUFBSSxNQUFNLENBQUMsV0FBVyxFQUFFLEVBQUUsQ0FBQztZQUN6QixRQUFRLENBQUMsWUFBWSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsRUFBRSxDQUFDLENBQUE7UUFDdkUsQ0FBQztRQUVELElBQUksaUJBQWlCLEVBQUUsQ0FBQztZQUN0QixRQUFRLENBQUMsWUFBWSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLGNBQWMsRUFBRSxFQUFFLFdBQVcsQ0FBQyxDQUFBO1FBQ25GLENBQUM7UUFFRCxRQUFRLENBQUMsWUFBWSxDQUFDLE9BQU8sR0FBRyxXQUFXLENBQUMsRUFBRSxFQUFFLENBQUE7UUFFaEQsSUFBSSxDQUFDO1lBQ0gsTUFBTSxNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFBO1lBQzlCLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFDLFlBQVksRUFBRSx1QkFBdUIsRUFBQyxDQUFDLENBQUMsQ0FBQTtZQUNoRixjQUFjLEVBQUUsQ0FBQTtRQUNsQixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLGtCQUFrQixDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUN6QyxDQUFDO0lBQ0gsQ0FBQyxDQUFBO0NBQ0YsQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSByZWFjdC9idXR0b24taGFzLXR5cGUsIHNvcnQtaW1wb3J0cyAqL1xuaW1wb3J0IGFwaU1ha2VyQ29uZmlnIGZyb20gXCJAa2FzcGVybmovYXBpLW1ha2VyL2J1aWxkL2NvbmZpZy5qc1wiXG5pbXBvcnQgQmFzZUNvbXBvbmVudCBmcm9tIFwiLi4vLi4vYmFzZS1jb21wb25lbnRcIlxuaW1wb3J0IENoZWNrYm94IGZyb20gXCIuLi8uLi9ib290c3RyYXAvY2hlY2tib3hcIlxuaW1wb3J0IHtkaWdnfSBmcm9tIFwiZGlnZ2VyaXplXCJcbmltcG9ydCB7Rmxhc2hOb3RpZmljYXRpb25zfSBmcm9tIFwiZmxhc2gtbm90aWZpY2F0aW9uc1wiXG5pbXBvcnQge0Zvcm19IGZyb20gXCIuLi8uLi9mb3JtXCJcbmltcG9ydCBJbnB1dCBmcm9tIFwiLi4vLi4vYm9vdHN0cmFwL2lucHV0XCJcbmltcG9ydCBtb2RlbENsYXNzUmVxdWlyZSBmcm9tIFwiLi4vLi4vbW9kZWwtY2xhc3MtcmVxdWlyZS5qc1wiXG5pbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCJcbmltcG9ydCB7c2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IG1lbW8gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL21lbW8uanNcIlxuaW1wb3J0IHVzZUkxOG4gZnJvbSBcImkxOG4tb24tc3Rlcm9pZHMvc3JjL3VzZS1pMThuLm1qc1wiXG5cbmNvbnN0IFRhYmxlU2VhcmNoID0gbW9kZWxDbGFzc1JlcXVpcmUoXCJUYWJsZVNlYXJjaFwiKVxuXG5leHBvcnQgZGVmYXVsdCBtZW1vKHNoYXBlQ29tcG9uZW50KGNsYXNzIEFwaU1ha2VyVGFibGVGaWx0ZXJzU2F2ZVNlYXJjaE1vZGFsIGV4dGVuZHMgQmFzZUNvbXBvbmVudCB7XG4gIHNldHVwKCkge1xuICAgIGNvbnN0IHt0fSA9IHVzZUkxOG4oe25hbWVzcGFjZTogXCJqcy5hcGlfbWFrZXIudGFibGUuZmlsdGVycy5zYXZlX3NlYXJjaF9tb2RhbFwifSlcblxuICAgIHRoaXMudCA9IHRcbiAgICB0aGlzLnVzZVN0YXRlcyh7Zm9ybTogbnVsbH0pXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge2N1cnJlbnRGaWx0ZXJzLCBjdXJyZW50VXNlciwgb25SZXF1ZXN0Q2xvc2UsIHNlYXJjaCwgLi4ucmVzdFByb3BzfSA9IHRoaXMucHJvcHNcbiAgICBjb25zdCBNb2RhbCA9IGFwaU1ha2VyQ29uZmlnLmdldE1vZGFsKClcblxuICAgIHJldHVybiAoXG4gICAgICA8TW9kYWwgb25SZXF1ZXN0Q2xvc2U9e29uUmVxdWVzdENsb3NlfSB7Li4ucmVzdFByb3BzfT5cbiAgICAgICAgPEZvcm0gb25TdWJtaXQ9e3RoaXMudHQub25TYXZlU2VhcmNoU3VibWl0fSBzZXRGb3JtPXt0aGlzLnNldFN0YXRlcy5mb3JtfT5cbiAgICAgICAgICA8SW5wdXRcbiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZT17c2VhcmNoLm5hbWUoKX1cbiAgICAgICAgICAgIGlkPVwidGFibGVfc2VhcmNoX25hbWVcIlxuICAgICAgICAgICAgbGFiZWw9e3RoaXMudChcIi5zZWFyY2hfbmFtZVwiLCB7ZGVmYXVsdFZhbHVlOiBcIlNlYXJjaCBuYW1lXCJ9KX1cbiAgICAgICAgICAgIG5hbWU9XCJ0YWJsZV9zZWFyY2hbbmFtZV1cIlxuICAgICAgICAgIC8+XG4gICAgICAgICAgPENoZWNrYm94XG4gICAgICAgICAgICBkZWZhdWx0Q2hlY2tlZD17c2VhcmNoLnB1YmxpYygpfVxuICAgICAgICAgICAgaWQ9XCJ0YWJsZV9zZWFyY2hfcHVibGljXCJcbiAgICAgICAgICAgIGxhYmVsPXt0aGlzLnQoXCIucHVibGljXCIsIHtkZWZhdWx0VmFsdWU6IFwiUHVibGljXCJ9KX1cbiAgICAgICAgICAgIG5hbWU9XCJ0YWJsZV9zZWFyY2hbcHVibGljXVwiXG4gICAgICAgICAgLz5cbiAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT1cInNhdmUtc2VhcmNoLXN1Ym1pdC1idXR0b25cIj5cbiAgICAgICAgICAgIHt0aGlzLnQoXCIuc2F2ZV9zZWFyY2hcIiwge2RlZmF1bHRWYWx1ZTogXCJTYXZlIHNlYXJjaFwifSl9XG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIDwvRm9ybT5cbiAgICAgIDwvTW9kYWw+XG4gICAgKVxuICB9XG5cbiAgb25TYXZlU2VhcmNoU3VibWl0ID0gYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGZvcm1EYXRhID0gdGhpcy5zLmZvcm0uYXNPYmplY3QoKVxuICAgIGNvbnN0IHtjdXJyZW50RmlsdGVycywgY3VycmVudFVzZXIsIG9uUmVxdWVzdENsb3NlLCBzZWFyY2h9ID0gdGhpcy5wXG4gICAgY29uc3QgaGFzVXNlclR5cGVDb2x1bW4gPSBCb29sZWFuKFRhYmxlU2VhcmNoLmF0dHJpYnV0ZXMoKS5maW5kKChhdHRyaWJ1dGUpID0+IGF0dHJpYnV0ZS5uYW1lKCkgPT0gXCJ1c2VyX3R5cGVcIikpXG5cbiAgICBpZiAoc2VhcmNoLmlzTmV3UmVjb3JkKCkpIHtcbiAgICAgIGZvcm1EYXRhLnRhYmxlX3NlYXJjaC5xdWVyeV9wYXJhbXMgPSBKU09OLnN0cmluZ2lmeShjdXJyZW50RmlsdGVycygpKVxuICAgIH1cblxuICAgIGlmIChoYXNVc2VyVHlwZUNvbHVtbikge1xuICAgICAgZm9ybURhdGEudGFibGVfc2VhcmNoLnVzZXJfdHlwZSA9IGRpZ2coY3VycmVudFVzZXIubW9kZWxDbGFzc0RhdGEoKSwgXCJjbGFzc05hbWVcIilcbiAgICB9XG5cbiAgICBmb3JtRGF0YS50YWJsZV9zZWFyY2gudXNlcl9pZCA9IGN1cnJlbnRVc2VyLmlkKClcblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCBzZWFyY2guc2F2ZVJhdyhmb3JtRGF0YSlcbiAgICAgIEZsYXNoTm90aWZpY2F0aW9ucy5zdWNjZXNzKHRoaXMudChcIi5cIiwge2RlZmF1bHRWYWx1ZTogXCJUaGUgc2VhcmNoIHdhcyBzYXZlZC5cIn0pKVxuICAgICAgb25SZXF1ZXN0Q2xvc2UoKVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBGbGFzaE5vdGlmaWNhdGlvbnMuZXJyb3JSZXNwb25zZShlcnJvcilcbiAgICB9XG4gIH1cbn0pKVxuIl19