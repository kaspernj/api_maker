import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
/* eslint-disable import/no-unresolved, no-return-assign, sort-imports */
import React, { useMemo } from "react";
import BaseComponent from "../base-component";
import classNames from "classnames";
import Header from "./components/header";
import HeaderColumnContent from "./header-column-content";
import Icon from "../utils/icon";
import memo from "set-state-compare/build/memo.js";
import { Animated, PanResponder } from "react-native";
import PropTypes from "prop-types";
import propTypesExact from "prop-types-exact";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import { useBreakpoint } from "responsive-breakpoints";
import Widths from "./widths";
const dataSets = {};
export default memo(shapeComponent(class ApiMakerTableHeaderColumn extends BaseComponent {
    static propTypes = propTypesExact({
        active: PropTypes.bool.isRequired,
        animatedWidth: PropTypes.instanceOf(Animated.Value).isRequired,
        animatedZIndex: PropTypes.instanceOf(Animated.Value).isRequired,
        column: PropTypes.object.isRequired,
        resizing: PropTypes.bool.isRequired,
        table: PropTypes.object.isRequired,
        tableSettingColumn: PropTypes.object.isRequired,
        touchProps: PropTypes.object.isRequired,
        widths: PropTypes.instanceOf(Widths).isRequired
    });
    setup() {
        const { name: breakpoint, mdUp, smDown } = useBreakpoint();
        this.setInstance({ breakpoint, mdUp, smDown });
        this.useStates({
            resizing: false
        });
        this.resizePanResponder = useMemo(() => PanResponder.create({
            onStartShouldSetPanResponder: (_e) => {
                this.originalWidth = this.currentWidth;
                this.setState({ resizing: true });
                this.p.table.setState({ resizing: true });
                return true;
            },
            onPanResponderMove: (_e, gestate) => {
                const newWidth = this.tt.originalWidth + gestate.dx;
                this.p.widths.setWidthOfColumn({
                    identifier: this.p.tableSettingColumn.identifier(),
                    width: newWidth
                });
            },
            onPanResponderRelease: this.tt.onResizeEnd,
            onPanResponderTerminate: this.tt.onResizeEnd,
            onPanResponderTerminationRequest: () => false // Don't let another PanResponder steal focus and stop resizing until release
        }), []);
    }
    onResizeEnd = async () => {
        this.p.table.setState({ lastUpdate: new Date(), resizing: false });
        this.setState({ resizing: false });
        const width = this.p.widths.getWidthOfColumn(this.p.tableSettingColumn.identifier());
        await this.p.tableSettingColumn.update({ width });
    };
    render() {
        const { mdUp } = this.tt;
        const { active, animatedWidth, column, resizing, table, tableSettingColumn, touchProps } = this.p;
        const { styleForHeader } = table.tt;
        const headerProps = table.headerProps(column);
        const { style, ...restColumnProps } = headerProps;
        const headerIdentifier = tableSettingColumn.identifier();
        const actualStyle = useMemo(() => {
            // eslint-disable-next-line prefer-object-spread
            const actualStyle = Object.assign({
                cursor: resizing ? "col-resize" : undefined,
                width: mdUp ? animatedWidth : "100%",
                height: mdUp ? "100%" : undefined
            }, style);
            return actualStyle;
        }, [active, animatedWidth, mdUp, resizing, style]);
        return (_jsxs(Header, { dataSet: dataSets[`header-${headerIdentifier}`] ||= {
                className: classNames(...table.headerClassNameForColumn(column)),
                identifier: headerIdentifier
            }, onLayout: this.tt.onLayout, style: styleForHeader({ style: actualStyle }), ...restColumnProps, children: [mdUp &&
                    _jsx(Icon, { name: "bars", style: this.cache("barsIconStyle", { marginRight: 3, fontSize: 12 }), ...touchProps }), _jsx(HeaderColumnContent, { column: column, table: table, tableSettingColumn: tableSettingColumn }), mdUp &&
                    _jsx(Animated.View, { style: this.cache("resizeColumnViewStyle", {
                            position: "absolute",
                            top: 0,
                            right: 0,
                            width: 10,
                            height: "100%",
                            cursor: "col-resize",
                            zIndex: 9999
                        }), ...this.tt.resizePanResponder.panHandlers })] }));
    }
    onLayout = (e) => {
        const { width } = e.nativeEvent.layout;
        this.currentWidth = width;
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVhZGVyLWNvbHVtbi5qcyIsInNvdXJjZVJvb3QiOiIvc3JjLyIsInNvdXJjZXMiOlsidGFibGUvaGVhZGVyLWNvbHVtbi5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLHlFQUF5RTtBQUN6RSxPQUFPLEtBQUssRUFBRSxFQUFDLE9BQU8sRUFBQyxNQUFNLE9BQU8sQ0FBQTtBQUNwQyxPQUFPLGFBQWEsTUFBTSxtQkFBbUIsQ0FBQTtBQUM3QyxPQUFPLFVBQVUsTUFBTSxZQUFZLENBQUE7QUFDbkMsT0FBTyxNQUFNLE1BQU0scUJBQXFCLENBQUE7QUFDeEMsT0FBTyxtQkFBbUIsTUFBTSx5QkFBeUIsQ0FBQTtBQUN6RCxPQUFPLElBQUksTUFBTSxlQUFlLENBQUE7QUFDaEMsT0FBTyxJQUFJLE1BQU0saUNBQWlDLENBQUE7QUFDbEQsT0FBTyxFQUFDLFFBQVEsRUFBRSxZQUFZLEVBQUMsTUFBTSxjQUFjLENBQUE7QUFDbkQsT0FBTyxTQUFTLE1BQU0sWUFBWSxDQUFBO0FBQ2xDLE9BQU8sY0FBYyxNQUFNLGtCQUFrQixDQUFBO0FBQzdDLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSw0Q0FBNEMsQ0FBQTtBQUN6RSxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sd0JBQXdCLENBQUE7QUFDcEQsT0FBTyxNQUFNLE1BQU0sVUFBVSxDQUFBO0FBRTdCLE1BQU0sUUFBUSxHQUFHLEVBQUUsQ0FBQTtBQUVuQixlQUFlLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSx5QkFBMEIsU0FBUSxhQUFhO0lBQ3RGLE1BQU0sQ0FBQyxTQUFTLEdBQUcsY0FBYyxDQUFDO1FBQ2hDLE1BQU0sRUFBRSxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVU7UUFDakMsYUFBYSxFQUFFLFNBQVMsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLFVBQVU7UUFDOUQsY0FBYyxFQUFFLFNBQVMsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFD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LENBQUMsUUFBUSxFQUMxQixLQUFLLEVBQUUsY0FBYyxDQUFDLEVBQUMsS0FBSyxFQUFFLFdBQVcsRUFBQyxDQUFDLEtBQ3ZDLGVBQWUsYUFFbEIsSUFBSTtvQkFDSCxLQUFDLElBQUksSUFBQyxJQUFJLEVBQUMsTUFBTSxFQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLGVBQWUsRUFBRSxFQUFDLFdBQVcsRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBQyxDQUFDLEtBQU0sVUFBVSxHQUFJLEVBRTFHLEtBQUMsbUJBQW1CLElBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLGtCQUFrQixFQUFFLGtCQUFrQixHQUFJLEVBQzVGLElBQUk7b0JBQ0gsS0FBQyxRQUFRLENBQUMsSUFBSSxJQUNaLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLHVCQUF1QixFQUFFOzRCQUN6QyxRQUFRLEVBQUUsVUFBVTs0QkFDcEIsR0FBRyxFQUFFLENBQUM7NEJBQ04sS0FBSyxFQUFFLENBQUM7NEJBQ1IsS0FBSyxFQUFFLEVBQUU7NEJBQ1QsTUFBTSxFQUFFLE1BQU07NEJBQ2QsTUFBTSxFQUFFLFlBQVk7NEJBQ3BCLE1BQU0sRUFBRSxJQUFJO3lCQUNiLENBQUMsS0FDRSxJQUFJLENBQUMsRUFBRSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsR0FDMUMsSUFFRyxDQUNWLENBQUE7SUFDSCxDQUFDO0lBRUQsUUFBUSxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUU7UUFDZixNQUFNLEVBQUMsS0FBSyxFQUFDLEdBQUcsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUE7UUFFcEMsSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUE7SUFDM0IsQ0FBQyxDQUFBO0NBQ0YsQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBpbXBvcnQvbm8tdW5yZXNvbHZlZCwgbm8tcmV0dXJuLWFzc2lnbiwgc29ydC1pbXBvcnRzICovXG5pbXBvcnQgUmVhY3QsIHt1c2VNZW1vfSBmcm9tIFwicmVhY3RcIlxuaW1wb3J0IEJhc2VDb21wb25lbnQgZnJvbSBcIi4uL2Jhc2UtY29tcG9uZW50XCJcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gXCJjbGFzc25hbWVzXCJcbmltcG9ydCBIZWFkZXIgZnJvbSBcIi4vY29tcG9uZW50cy9oZWFkZXJcIlxuaW1wb3J0IEhlYWRlckNvbHVtbkNvbnRlbnQgZnJvbSBcIi4vaGVhZGVyLWNvbHVtbi1jb250ZW50XCJcbmltcG9ydCBJY29uIGZyb20gXCIuLi91dGlscy9pY29uXCJcbmltcG9ydCBtZW1vIGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9tZW1vLmpzXCJcbmltcG9ydCB7QW5pbWF0ZWQsIFBhblJlc3BvbmRlcn0gZnJvbSBcInJlYWN0LW5hdGl2ZVwiXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gXCJwcm9wLXR5cGVzXCJcbmltcG9ydCBwcm9wVHlwZXNFeGFjdCBmcm9tIFwicHJvcC10eXBlcy1leGFjdFwiXG5pbXBvcnQge3NoYXBlQ29tcG9uZW50fSBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvc2hhcGUtY29tcG9uZW50LmpzXCJcbmltcG9ydCB7dXNlQnJlYWtwb2ludH0gZnJvbSBcInJlc3BvbnNpdmUtYnJlYWtwb2ludHNcIlxuaW1wb3J0IFdpZHRocyBmcm9tIFwiLi93aWR0aHNcIlxuXG5jb25zdCBkYXRhU2V0cyA9IHt9XG5cbmV4cG9ydCBkZWZhdWx0IG1lbW8oc2hhcGVDb21wb25lbnQoY2xhc3MgQXBpTWFrZXJUYWJsZUhlYWRlckNvbHVtbiBleHRlbmRzIEJhc2VDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0gcHJvcFR5cGVzRXhhY3Qoe1xuICAgIGFjdGl2ZTogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCxcbiAgICBhbmltYXRlZFdpZHRoOiBQcm9wVHlwZXMuaW5zdGFuY2VPZihBbmltYXRlZC5WYWx1ZSkuaXNSZXF1aXJlZCxcbiAgICBhbmltYXRlZFpJbmRleDogUHJvcFR5cGVzLmluc3RhbmNlT2YoQW5pbWF0ZWQuVmFsdWUpLmlzUmVxdWlyZWQsXG4gICAgY29sdW1uOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgcmVzaXppbmc6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsXG4gICAgdGFibGU6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICB0YWJsZVNldHRpbmdDb2x1bW46IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICB0b3VjaFByb3BzOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgd2lkdGhzOiBQcm9wVHlwZXMuaW5zdGFuY2VPZihXaWR0aHMpLmlzUmVxdWlyZWRcbiAgfSlcblxuICBzZXR1cCgpIHtcbiAgICBjb25zdCB7bmFtZTogYnJlYWtwb2ludCwgbWRVcCwgc21Eb3dufSA9IHVzZUJyZWFrcG9pbnQoKVxuXG4gICAgdGhpcy5zZXRJbnN0YW5jZSh7YnJlYWtwb2ludCwgbWRVcCwgc21Eb3dufSlcbiAgICB0aGlzLnVzZVN0YXRlcyh7XG4gICAgICByZXNpemluZzogZmFsc2VcbiAgICB9KVxuXG4gICAgdGhpcy5yZXNpemVQYW5SZXNwb25kZXIgPSB1c2VNZW1vKFxuICAgICAgKCkgPT4gUGFuUmVzcG9uZGVyLmNyZWF0ZSh7XG4gICAgICAgIG9uU3RhcnRTaG91bGRTZXRQYW5SZXNwb25kZXI6IChfZSkgPT4ge1xuICAgICAgICAgIHRoaXMub3JpZ2luYWxXaWR0aCA9IHRoaXMuY3VycmVudFdpZHRoXG4gICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7cmVzaXppbmc6IHRydWV9KVxuICAgICAgICAgIHRoaXMucC50YWJsZS5zZXRTdGF0ZSh7cmVzaXppbmc6IHRydWV9KVxuXG4gICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgb25QYW5SZXNwb25kZXJNb3ZlOiAoX2UsIGdlc3RhdGUpID0+IHtcbiAgICAgICAgICBjb25zdCBuZXdXaWR0aCA9IHRoaXMudHQub3JpZ2luYWxXaWR0aCArIGdlc3RhdGUuZHhcblxuICAgICAgICAgIHRoaXMucC53aWR0aHMuc2V0V2lkdGhPZkNvbHVtbih7XG4gICAgICAgICAgICBpZGVudGlmaWVyOiB0aGlzLnAudGFibGVTZXR0aW5nQ29sdW1uLmlkZW50aWZpZXIoKSxcbiAgICAgICAgICAgIHdpZHRoOiBuZXdXaWR0aFxuICAgICAgICAgIH0pXG4gICAgICAgIH0sXG4gICAgICAgIG9uUGFuUmVzcG9uZGVyUmVsZWFzZTogdGhpcy50dC5vblJlc2l6ZUVuZCxcbiAgICAgICAgb25QYW5SZXNwb25kZXJUZXJtaW5hdGU6IHRoaXMudHQub25SZXNpemVFbmQsXG4gICAgICAgIG9uUGFuUmVzcG9uZGVyVGVybWluYXRpb25SZXF1ZXN0OiAoKSA9PiBmYWxzZSAvLyBEb24ndCBsZXQgYW5vdGhlciBQYW5SZXNwb25kZXIgc3RlYWwgZm9jdXMgYW5kIHN0b3AgcmVzaXppbmcgdW50aWwgcmVsZWFzZVxuICAgICAgfSksXG4gICAgICBbXVxuICAgIClcbiAgfVxuXG4gIG9uUmVzaXplRW5kID0gYXN5bmMgKCkgPT4ge1xuICAgIHRoaXMucC50YWJsZS5zZXRTdGF0ZSh7bGFzdFVwZGF0ZTogbmV3IERhdGUoKSwgcmVzaXppbmc6IGZhbHNlfSlcbiAgICB0aGlzLnNldFN0YXRlKHtyZXNpemluZzogZmFsc2V9KVxuXG4gICAgY29uc3Qgd2lkdGggPSB0aGlzLnAud2lkdGhzLmdldFdpZHRoT2ZDb2x1bW4odGhpcy5wLnRhYmxlU2V0dGluZ0NvbHVtbi5pZGVudGlmaWVyKCkpXG5cbiAgICBhd2FpdCB0aGlzLnAudGFibGVTZXR0aW5nQ29sdW1uLnVwZGF0ZSh7d2lkdGh9KVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHttZFVwfSA9IHRoaXMudHRcbiAgICBjb25zdCB7YWN0aXZlLCBhbmltYXRlZFdpZHRoLCBjb2x1bW4sIHJlc2l6aW5nLCB0YWJsZSwgdGFibGVTZXR0aW5nQ29sdW1uLCB0b3VjaFByb3BzfSA9IHRoaXMucFxuICAgIGNvbnN0IHtzdHlsZUZvckhlYWRlcn0gPSB0YWJsZS50dFxuICAgIGNvbnN0IGhlYWRlclByb3BzID0gdGFibGUuaGVhZGVyUHJvcHMoY29sdW1uKVxuICAgIGNvbnN0IHtzdHlsZSwgLi4ucmVzdENvbHVtblByb3BzfSA9IGhlYWRlclByb3BzXG4gICAgY29uc3QgaGVhZGVySWRlbnRpZmllciA9IHRhYmxlU2V0dGluZ0NvbHVtbi5pZGVudGlmaWVyKClcbiAgICBjb25zdCBhY3R1YWxTdHlsZSA9IHVzZU1lbW8oXG4gICAgICAoKSA9PiB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmVmZXItb2JqZWN0LXNwcmVhZFxuICAgICAgICBjb25zdCBhY3R1YWxTdHlsZSA9IE9iamVjdC5hc3NpZ24oXG4gICAgICAgICAge1xuICAgICAgICAgICAgY3Vyc29yOiByZXNpemluZyA/IFwiY29sLXJlc2l6ZVwiIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgd2lkdGg6IG1kVXAgPyBhbmltYXRlZFdpZHRoIDogXCIxMDAlXCIsXG4gICAgICAgICAgICBoZWlnaHQ6IG1kVXAgPyBcIjEwMCVcIiA6IHVuZGVmaW5lZFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc3R5bGVcbiAgICAgICAgKVxuXG4gICAgICAgIHJldHVybiBhY3R1YWxTdHlsZVxuICAgICAgfSxcbiAgICAgIFthY3RpdmUsIGFuaW1hdGVkV2lkdGgsIG1kVXAsIHJlc2l6aW5nLCBzdHlsZV1cbiAgICApXG5cbiAgICByZXR1cm4gKFxuICAgICAgPEhlYWRlclxuICAgICAgICBkYXRhU2V0PXtkYXRhU2V0c1tgaGVhZGVyLSR7aGVhZGVySWRlbnRpZmllcn1gXSB8fD0ge1xuICAgICAgICAgIGNsYXNzTmFtZTogY2xhc3NOYW1lcyguLi50YWJsZS5oZWFkZXJDbGFzc05hbWVGb3JDb2x1bW4oY29sdW1uKSksXG4gICAgICAgICAgaWRlbnRpZmllcjogaGVhZGVySWRlbnRpZmllclxuICAgICAgICB9fVxuICAgICAgICBvbkxheW91dD17dGhpcy50dC5vbkxheW91dH1cbiAgICAgICAgc3R5bGU9e3N0eWxlRm9ySGVhZGVyKHtzdHlsZTogYWN0dWFsU3R5bGV9KX1cbiAgICAgICAgey4uLnJlc3RDb2x1bW5Qcm9wc31cbiAgICAgID5cbiAgICAgICAge21kVXAgJiZcbiAgICAgICAgICA8SWNvbiBuYW1lPVwiYmFyc1wiIHN0eWxlPXt0aGlzLmNhY2hlKFwiYmFyc0ljb25TdHlsZVwiLCB7bWFyZ2luUmlnaHQ6IDMsIGZvbnRTaXplOiAxMn0pfSB7Li4udG91Y2hQcm9wc30gLz5cbiAgICAgICAgfVxuICAgICAgICA8SGVhZGVyQ29sdW1uQ29udGVudCBjb2x1bW49e2NvbHVtbn0gdGFibGU9e3RhYmxlfSB0YWJsZVNldHRpbmdDb2x1bW49e3RhYmxlU2V0dGluZ0NvbHVtbn0gLz5cbiAgICAgICAge21kVXAgJiZcbiAgICAgICAgICA8QW5pbWF0ZWQuVmlld1xuICAgICAgICAgICAgc3R5bGU9e3RoaXMuY2FjaGUoXCJyZXNpemVDb2x1bW5WaWV3U3R5bGVcIiwge1xuICAgICAgICAgICAgICBwb3NpdGlvbjogXCJhYnNvbHV0ZVwiLFxuICAgICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICAgIHJpZ2h0OiAwLFxuICAgICAgICAgICAgICB3aWR0aDogMTAsXG4gICAgICAgICAgICAgIGhlaWdodDogXCIxMDAlXCIsXG4gICAgICAgICAgICAgIGN1cnNvcjogXCJjb2wtcmVzaXplXCIsXG4gICAgICAgICAgICAgIHpJbmRleDogOTk5OVxuICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICB7Li4udGhpcy50dC5yZXNpemVQYW5SZXNwb25kZXIucGFuSGFuZGxlcnN9XG4gICAgICAgICAgLz5cbiAgICAgICAgfVxuICAgICAgPC9IZWFkZXI+XG4gICAgKVxuICB9XG5cbiAgb25MYXlvdXQgPSAoZSkgPT4ge1xuICAgIGNvbnN0IHt3aWR0aH0gPSBlLm5hdGl2ZUV2ZW50LmxheW91dFxuXG4gICAgdGhpcy5jdXJyZW50V2lkdGggPSB3aWR0aFxuICB9XG59KSlcbiJdfQ==