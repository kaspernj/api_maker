import { jsx as _jsx } from "react/jsx-runtime";
/* eslint-disable import/no-unresolved, new-cap, sort-imports */
import React, { useMemo } from "react";
import BaseComponent from "../base-component";
import classNames from "classnames";
import { digg } from "diggerize";
import memo from "set-state-compare/build/memo.js";
import modelClassRequire from "../model-class-require.js";
import PropTypes from "prop-types";
import PropTypesExact from "prop-types-exact";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import useModelEvent from "../use-model-event.js";
const Workplace = modelClassRequire("Workplace");
export default memo(shapeComponent(class ApiMakerTableWorkerPluginsCheckbox extends BaseComponent {
    static propTypes = PropTypesExact({
        currentWorkplace: PropTypes.object,
        model: PropTypes.object.isRequired,
        style: PropTypes.object
    });
    setup() {
        this.useStates({
            checked: false,
            linkLoaded: false
        });
        useMemo(() => {
            this.loadCurrentLink();
        }, []);
        useModelEvent(this.p.currentWorkplace, "workplace_links_created", this.tt.onLinksCreated);
        useModelEvent(this.p.currentWorkplace, "workplace_links_destroyed", this.tt.onLinksDestroyed);
    }
    async loadCurrentLink() {
        const { model } = this.props;
        const response = await Workplace.linkFor({ model_class: model.modelClassData().name, model_id: model.id() });
        const link = digg(response, "link");
        this.setState({
            checked: Boolean(link),
            linkLoaded: true
        });
    }
    render() {
        const { className, model, style } = this.props;
        const { checked, linkLoaded } = this.state;
        if (!linkLoaded) {
            return null;
        }
        return (_jsx("input", { checked: checked, className: classNames("api-maker--table--worker-plugins-checkbox", className), "data-checked": checked, "data-model-id": model.id(), onChange: this.tt.onCheckedChanged, style: style, type: "checkbox" }));
    }
    onCheckedChanged = (e) => {
        e.preventDefault();
        const { model } = this.props;
        const checked = e.target.checked;
        if (checked) {
            Workplace.createLink({ model_class: model.modelClassData().name, model_id: model.id() });
        }
        else {
            const modelClassName = model.modelClassData().name;
            const params = { models: {} };
            params.models[modelClassName] = [model.id()];
            Workplace.destroyLinks(params);
        }
    };
    onLinksCreated = ({ args }) => {
        const { model } = this.p;
        const id = model.id();
        const modelClassName = model.modelClassData().name;
        if (args.created[modelClassName] && args.created[modelClassName].includes(id)) {
            this.setState({ checked: true });
        }
    };
    onLinksDestroyed = ({ args }) => {
        const { model } = this.p;
        const id = model.id();
        const modelClassName = model.modelClassData().name;
        if (args.destroyed[modelClassName] && args.destroyed[modelClassName].includes(id)) {
            this.setState({ checked: false });
        }
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29ya2VyLXBsdWdpbnMtY2hlY2tib3guanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbInRhYmxlL3dvcmtlci1wbHVnaW5zLWNoZWNrYm94LmpzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsZ0VBQWdFO0FBQ2hFLE9BQU8sS0FBSyxFQUFFLEVBQUMsT0FBTyxFQUFDLE1BQU0sT0FBTyxDQUFBO0FBQ3BDLE9BQU8sYUFBYSxNQUFNLG1CQUFtQixDQUFBO0FBQzdDLE9BQU8sVUFBVSxNQUFNLFlBQVksQ0FBQTtBQUNuQyxPQUFPLEVBQUMsSUFBSSxFQUFDLE1BQU0sV0FBVyxDQUFBO0FBQzlCLE9BQU8sSUFBSSxNQUFNLGlDQUFpQyxDQUFBO0FBQ2xELE9BQU8saUJBQWlCLE1BQU0sMkJBQTJCLENBQUE7QUFDekQsT0FBTyxTQUFTLE1BQU0sWUFBWSxDQUFBO0FBQ2xDLE9BQU8sY0FBYyxNQUFNLGtCQUFrQixDQUFBO0FBQzdDLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSw0Q0FBNEMsQ0FBQTtBQUN6RSxPQUFPLGFBQWEsTUFBTSx1QkFBdUIsQ0FBQTtBQUVqRCxNQUFNLFNBQVMsR0FBRyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsQ0FBQTtBQUVoRCxlQUFlLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxrQ0FBbUMsU0FBUSxhQUFhO0lBQy9GLE1BQU0sQ0FBQyxTQUFTLEdBQUcsY0FBYyxDQUFDO1FBQ2hDLGdCQUFnQixFQUFFLFNBQVMsQ0FBQyxNQUFNO1FBQ2xDLEtBQUssRUFBRSxTQUFTLENBQUMsTUFBTSxDQUFDLFVBQVU7UUFDbEMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxNQUFNO0tBQ3hCLENBQUMsQ0FBQTtJQUVGLEtBQUs7UUFDSCxJQUFJLENBQUMsU0FBUyxDQUFDO1lBQ2IsT0FBTyxFQUFFLEtBQUs7WUFDZCxVQUFVLEVBQUUsS0FBSztTQUNsQixDQUFDLENBQUE7UUFFRixPQUFPLENBQUMsR0FBRyxFQUFFO1lBQ1gsSUFB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QUFNLGNBQWMsR0FBRyxLQUFLLENBQUMsY0FBYyxFQUFFLENBQUMsSUFBSSxDQUFBO1FBRWxELElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDO1lBQzlFLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBQyxPQUFPLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQTtRQUNoQyxDQUFDO0lBQ0gsQ0FBQyxDQUFBO0lBRUQsZ0JBQWdCLEdBQUcsQ0FBQyxFQUFDLElBQUksRUFBQyxFQUFFLEVBQUU7UUFDNUIsTUFBTSxFQUFDLEtBQUssRUFBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUE7UUFDdEIsTUFBTSxFQUFFLEdBQUcsS0FBSyxDQUFDLEVBQUUsRUFBRSxDQUFBO1FBQ3JCLE1BQU0sY0FBYyxHQUFHLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQyxJQUFJLENBQUE7UUFFbEQsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUM7WUFDbEYsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUMsQ0FBQyxDQUFBO1FBQ2pDLENBQUM7SUFDSCxDQUFDLENBQUE7Q0FDRixDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIGltcG9ydC9uby11bnJlc29sdmVkLCBuZXctY2FwLCBzb3J0LWltcG9ydHMgKi9cbmltcG9ydCBSZWFjdCwge3VzZU1lbW99IGZyb20gXCJyZWFjdFwiXG5pbXBvcnQgQmFzZUNvbXBvbmVudCBmcm9tIFwiLi4vYmFzZS1jb21wb25lbnRcIlxuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSBcImNsYXNzbmFtZXNcIlxuaW1wb3J0IHtkaWdnfSBmcm9tIFwiZGlnZ2VyaXplXCJcbmltcG9ydCBtZW1vIGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9tZW1vLmpzXCJcbmltcG9ydCBtb2RlbENsYXNzUmVxdWlyZSBmcm9tIFwiLi4vbW9kZWwtY2xhc3MtcmVxdWlyZS5qc1wiXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gXCJwcm9wLXR5cGVzXCJcbmltcG9ydCBQcm9wVHlwZXNFeGFjdCBmcm9tIFwicHJvcC10eXBlcy1leGFjdFwiXG5pbXBvcnQge3NoYXBlQ29tcG9uZW50fSBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvc2hhcGUtY29tcG9uZW50LmpzXCJcbmltcG9ydCB1c2VNb2RlbEV2ZW50IGZyb20gXCIuLi91c2UtbW9kZWwtZXZlbnQuanNcIlxuXG5jb25zdCBXb3JrcGxhY2UgPSBtb2RlbENsYXNzUmVxdWlyZShcIldvcmtwbGFjZVwiKVxuXG5leHBvcnQgZGVmYXVsdCBtZW1vKHNoYXBlQ29tcG9uZW50KGNsYXNzIEFwaU1ha2VyVGFibGVXb3JrZXJQbHVnaW5zQ2hlY2tib3ggZXh0ZW5kcyBCYXNlQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IFByb3BUeXBlc0V4YWN0KHtcbiAgICBjdXJyZW50V29ya3BsYWNlOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIG1vZGVsOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgc3R5bGU6IFByb3BUeXBlcy5vYmplY3RcbiAgfSlcblxuICBzZXR1cCgpIHtcbiAgICB0aGlzLnVzZVN0YXRlcyh7XG4gICAgICBjaGVja2VkOiBmYWxzZSxcbiAgICAgIGxpbmtMb2FkZWQ6IGZhbHNlXG4gICAgfSlcblxuICAgIHVzZU1lbW8oKCkgPT4ge1xuICAgICAgdGhpcy5sb2FkQ3VycmVudExpbmsoKVxuICAgIH0sIFtdKVxuXG4gICAgdXNlTW9kZWxFdmVudCh0aGlzLnAuY3VycmVudFdvcmtwbGFjZSwgXCJ3b3JrcGxhY2VfbGlua3NfY3JlYXRlZFwiLCB0aGlzLnR0Lm9uTGlua3NDcmVhdGVkKVxuICAgIHVzZU1vZGVsRXZlbnQodGhpcy5wLmN1cnJlbnRXb3JrcGxhY2UsIFwid29ya3BsYWNlX2xpbmtzX2Rlc3Ryb3llZFwiLCB0aGlzLnR0Lm9uTGlua3NEZXN0cm95ZWQpXG4gIH1cblxuICBhc3luYyBsb2FkQ3VycmVudExpbmsoKSB7XG4gICAgY29uc3Qge21vZGVsfSA9IHRoaXMucHJvcHNcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IFdvcmtwbGFjZS5saW5rRm9yKHttb2RlbF9jbGFzczogbW9kZWwubW9kZWxDbGFzc0RhdGEoKS5uYW1lLCBtb2RlbF9pZDogbW9kZWwuaWQoKX0pXG4gICAgY29uc3QgbGluayA9IGRpZ2cocmVzcG9uc2UsIFwibGlua1wiKVxuXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBjaGVja2VkOiBCb29sZWFuKGxpbmspLFxuICAgICAgbGlua0xvYWRlZDogdHJ1ZVxuICAgIH0pXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge2NsYXNzTmFtZSwgbW9kZWwsIHN0eWxlfSA9IHRoaXMucHJvcHNcbiAgICBjb25zdCB7Y2hlY2tlZCwgbGlua0xvYWRlZH0gPSB0aGlzLnN0YXRlXG5cbiAgICBpZiAoIWxpbmtMb2FkZWQpIHtcbiAgICAgIHJldHVybiBudWxsXG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxpbnB1dFxuICAgICAgICBjaGVja2VkPXtjaGVja2VkfVxuICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoXCJhcGktbWFrZXItLXRhYmxlLS13b3JrZXItcGx1Z2lucy1jaGVja2JveFwiLCBjbGFzc05hbWUpfVxuICAgICAgICBkYXRhLWNoZWNrZWQ9e2NoZWNrZWR9XG4gICAgICAgIGRhdGEtbW9kZWwtaWQ9e21vZGVsLmlkKCl9XG4gICAgICAgIG9uQ2hhbmdlPXt0aGlzLnR0Lm9uQ2hlY2tlZENoYW5nZWR9XG4gICAgICAgIHN0eWxlPXtzdHlsZX1cbiAgICAgICAgdHlwZT1cImNoZWNrYm94XCJcbiAgICAgIC8+XG4gICAgKVxuICB9XG5cbiAgb25DaGVja2VkQ2hhbmdlZCA9IChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpXG5cbiAgICBjb25zdCB7bW9kZWx9ID0gdGhpcy5wcm9wc1xuICAgIGNvbnN0IGNoZWNrZWQgPSBlLnRhcmdldC5jaGVja2VkXG5cbiAgICBpZiAoY2hlY2tlZCkge1xuICAgICAgV29ya3BsYWNlLmNyZWF0ZUxpbmsoe21vZGVsX2NsYXNzOiBtb2RlbC5tb2RlbENsYXNzRGF0YSgpLm5hbWUsIG1vZGVsX2lkOiBtb2RlbC5pZCgpfSlcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgbW9kZWxDbGFzc05hbWUgPSBtb2RlbC5tb2RlbENsYXNzRGF0YSgpLm5hbWVcbiAgICAgIGNvbnN0IHBhcmFtcyA9IHttb2RlbHM6IHt9fVxuXG4gICAgICBwYXJhbXMubW9kZWxzW21vZGVsQ2xhc3NOYW1lXSA9IFttb2RlbC5pZCgpXVxuXG4gICAgICBXb3JrcGxhY2UuZGVzdHJveUxpbmtzKHBhcmFtcylcbiAgICB9XG4gIH1cblxuICBvbkxpbmtzQ3JlYXRlZCA9ICh7YXJnc30pID0+IHtcbiAgICBjb25zdCB7bW9kZWx9ID0gdGhpcy5wXG4gICAgY29uc3QgaWQgPSBtb2RlbC5pZCgpXG4gICAgY29uc3QgbW9kZWxDbGFzc05hbWUgPSBtb2RlbC5tb2RlbENsYXNzRGF0YSgpLm5hbWVcblxuICAgIGlmIChhcmdzLmNyZWF0ZWRbbW9kZWxDbGFzc05hbWVdICYmIGFyZ3MuY3JlYXRlZFttb2RlbENsYXNzTmFtZV0uaW5jbHVkZXMoaWQpKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtjaGVja2VkOiB0cnVlfSlcbiAgICB9XG4gIH1cblxuICBvbkxpbmtzRGVzdHJveWVkID0gKHthcmdzfSkgPT4ge1xuICAgIGNvbnN0IHttb2RlbH0gPSB0aGlzLnBcbiAgICBjb25zdCBpZCA9IG1vZGVsLmlkKClcbiAgICBjb25zdCBtb2RlbENsYXNzTmFtZSA9IG1vZGVsLm1vZGVsQ2xhc3NEYXRhKCkubmFtZVxuXG4gICAgaWYgKGFyZ3MuZGVzdHJveWVkW21vZGVsQ2xhc3NOYW1lXSAmJiBhcmdzLmRlc3Ryb3llZFttb2RlbENsYXNzTmFtZV0uaW5jbHVkZXMoaWQpKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtjaGVja2VkOiBmYWxzZX0pXG4gICAgfVxuICB9XG59KSlcbiJdfQ==