import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from "react/jsx-runtime";
/* eslint-disable implicit-arrow-linebreak, import/no-unresolved, max-len, react/button-has-type, react/jsx-sort-props, react/no-array-index-key, sort-imports */
import BaseComponent from "../../base-component";
import { digg, digs } from "diggerize";
import Filter from "./filter";
import FilterForm from "./filter-form";
import { FlashNotifications } from "flash-notifications";
import LoadSearchModal from "./load-search-modal";
import SaveSearchModal from "./save-search-modal";
import Params from "../../params.js";
import PropTypes from "prop-types";
import { TableSearch } from "models.js";
import memo from "set-state-compare/build/memo.js";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import React from "react";
import useI18n from "i18n-on-steroids/src/use-i18n.mjs";
import useQueryParams from "on-location-changed/build/use-query-params.js";
import { View } from "react-native";
export default memo(shapeComponent(class ApiMakerTableFilters extends BaseComponent {
    static propTypes = {
        currentUser: PropTypes.object,
        modelClass: PropTypes.func.isRequired,
        queryName: PropTypes.string.isRequired,
        querySName: PropTypes.string.isRequired
    };
    setup() {
        const { t } = useI18n({ namespace: "js.api_maker.table.filters" });
        this.queryParams = useQueryParams();
        this.t = t;
        this.useStates({
            filter: undefined,
            showLoadSearchModal: undefined,
            showSaveSearchModal: false
        });
    }
    render() {
        const { modelClass, querySName } = digs(this.props, "modelClass", "querySName");
        const { currentUser } = this.props;
        const { filter, showLoadSearchModal, showSaveSearchModal } = digs(this.state, "filter", "showLoadSearchModal", "showSaveSearchModal");
        const currentFilters = this.currentFilters();
        return (_jsxs(View, { dataSet: this.cache("rootViewDataSet", { class: "api-maker--table--filters" }), style: this.cache("rootViewStyle", { alignItems: "flex-start" }), children: [filter &&
                    _jsx(FilterForm, { filter: filter, modelClass: modelClass, onApplyClicked: this.tt.onApplyClicked, onRequestClose: this.tt.onFilterFormRequestClose, querySearchName: querySName }, `filter-${filter.filterIndex}`), showLoadSearchModal &&
                    _jsx(LoadSearchModal, { currentUser: currentUser, modelClass: modelClass, onEditSearchPressed: digg(this, "onEditSearchPressed"), onRequestClose: digg(this, "onRequestCloseLoadSearchModal"), querySearchName: querySName }), showSaveSearchModal &&
                    _jsx(SaveSearchModal, { currentFilters: digg(this, "currentFilters"), currentUser: currentUser, onRequestClose: digg(this, "onRequestCloseSaveSearchModal"), search: showSaveSearchModal }), currentFilters?.map((filterData, filterIndex) => _jsx(Filter, { filterIndex: filterIndex, onClick: this.tt.onFilterClicked, onRemoveClicked: this.tt.onRemoveClicked, ...filterData }, filterIndex)), _jsxs(View, { dataSet: this.cache("filterActionsDataSet", { class: "filter-actions" }), style: this.cache("filterActionsStyle", { flexDirection: "row", marginTop: 10 }), children: [_jsx("button", { className: "add-new-filter-button", onClick: this.tt.onAddFilterClicked, children: this.t(".add_new_filter", { defaultValue: "Add new filter" }) }), currentUser &&
                            _jsxs(_Fragment, { children: [_jsx("button", { className: "save-search-button", onClick: this.tt.onSaveSearchClicked, style: { marginLeft: 10 }, children: this.t(".save_search", { defaultValue: "Save search" }) }), _jsx("button", { className: "load-search-button", onClick: this.tt.onLoadSearchClicked, style: { marginLeft: 10 }, children: this.t(".load_search", { defaultValue: "Load search" }) })] })] })] }));
    }
    currentFilters = () => {
        const { querySName } = digs(this.props, "querySName");
        const currentFilters = this.queryParams[querySName] || [];
        return currentFilters.map((currentFilter) => JSON.parse(currentFilter));
    };
    onAddFilterClicked = (e) => {
        e.preventDefault();
        const newFilterIndex = this.currentFilters().length;
        this.setState({
            filter: {
                filterIndex: newFilterIndex
            }
        });
    };
    onApplyClicked = () => this.setState({ filter: undefined });
    onEditSearchPressed = ({ search }) => {
        this.onRequestCloseLoadSearchModal();
        this.setState({
            showSaveSearchModal: search
        });
    };
    onFilterClicked = (filter) => this.setState({ filter });
    onFilterFormRequestClose = () => this.setState({ filter: undefined });
    onLoadSearchClicked = (e) => {
        e.preventDefault();
        this.setState({
            showLoadSearchModal: true
        });
    };
    onRemoveClicked = ({ filterIndex }) => {
        const { querySName } = digs(this.props, "querySName");
        const searchParams = Params.parse()[querySName] || {};
        delete searchParams[filterIndex];
        const newParams = {};
        newParams[querySName] = searchParams;
        Params.changeParams(newParams);
        this.setState({
            filter: undefined
        });
    };
    onRequestCloseLoadSearchModal = () => this.setState({ showLoadSearchModal: false });
    onRequestCloseSaveSearchModal = () => this.setState({ showSaveSearchModal: undefined });
    onSaveSearchClicked = (e) => {
        e.preventDefault();
        if (this.hasAnyFilters()) {
            this.setState({ showSaveSearchModal: new TableSearch() });
        }
        else {
            FlashNotifications.alert(this.t(".no_filters_has_been_set", { defaultValue: "No filters has been set" }));
        }
    };
    hasAnyFilters = () => Object.keys(this.currentFilters()).length > 0;
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbInRhYmxlL2ZpbHRlcnMvaW5kZXguanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxpS0FBaUs7QUFDakssT0FBTyxhQUFhLE1BQU0sc0JBQXNCLENBQUE7QUFDaEQsT0FBTyxFQUFDLElBQUksRUFBRSxJQUFJLEVBQUMsTUFBTSxXQUFXLENBQUE7QUFDcEMsT0FBTyxNQUFNLE1BQU0sVUFBVSxDQUFBO0FBQzdCLE9BQU8sVUFBVSxNQUFNLGVBQWUsQ0FBQTtBQUN0QyxPQUFPLEVBQUMsa0JBQWtCLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQTtBQUN0RCxPQUFPLGVBQWUsTUFBTSxxQkFBcUIsQ0FBQTtBQUNqRCxPQUFPLGVBQWUsTUFBTSxxQkFBcUIsQ0FBQTtBQUNqRCxPQUFPLE1BQU0sTUFBTSxpQkFBaUIsQ0FBQTtBQUNwQyxPQUFPLFNBQVMsTUFBTSxZQUFZLENBQUE7QUFDbEMsT0FBTyxFQUFDLFdBQVcsRUFBQyxNQUFNLFdBQVcsQ0FBQTtBQUNyQyxPQUFPLElBQUksTUFBTSxpQ0FBaUMsQ0FBQTtBQUNsRCxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sNENBQTRDLENBQUE7QUFDekUsT0FBTyxLQUFLLE1BQU0sT0FBTyxDQUFBO0FBQ3pCLE9BQU8sT0FBTyxNQUFNLG1DQUFtQyxDQUFBO0FBQ3ZELE9BQU8sY0FBYyxNQUFNLCtDQUErQyxDQUFBO0FBQzFFLE9BQU8sRUFBQyxJQUFJLEVBQUMsTUFBTSxjQUFjLENBQUE7QUFFakMsZUFBZSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sb0JBQXFCLFNBQVEsYUFBYTtJQUNqRixNQUFNLENBQUMsU0FBUyxHQUFHO1FBQ2pCLFdBQVcsRUFBRSxTQUFTLENBQUMsTUFBTTtRQUM3QixVQUFVLEVBQUUsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVO1FBQ3JDLFNBQVMsRUFBRSxTQUFTLENBQUMsTUFBTSxDQUFDLFVBQVU7UUFDdEMs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bnQiOlsiLyogZXNsaW50LWRpc2FibGUgaW1wbGljaXQtYXJyb3ctbGluZWJyZWFrLCBpbXBvcnQvbm8tdW5yZXNvbHZlZCwgbWF4LWxlbiwgcmVhY3QvYnV0dG9uLWhhcy10eXBlLCByZWFjdC9qc3gtc29ydC1wcm9wcywgcmVhY3Qvbm8tYXJyYXktaW5kZXgta2V5LCBzb3J0LWltcG9ydHMgKi9cbmltcG9ydCBCYXNlQ29tcG9uZW50IGZyb20gXCIuLi8uLi9iYXNlLWNvbXBvbmVudFwiXG5pbXBvcnQge2RpZ2csIGRpZ3N9IGZyb20gXCJkaWdnZXJpemVcIlxuaW1wb3J0IEZpbHRlciBmcm9tIFwiLi9maWx0ZXJcIlxuaW1wb3J0IEZpbHRlckZvcm0gZnJvbSBcIi4vZmlsdGVyLWZvcm1cIlxuaW1wb3J0IHtGbGFzaE5vdGlmaWNhdGlvbnN9IGZyb20gXCJmbGFzaC1ub3RpZmljYXRpb25zXCJcbmltcG9ydCBMb2FkU2VhcmNoTW9kYWwgZnJvbSBcIi4vbG9hZC1zZWFyY2gtbW9kYWxcIlxuaW1wb3J0IFNhdmVTZWFyY2hNb2RhbCBmcm9tIFwiLi9zYXZlLXNlYXJjaC1tb2RhbFwiXG5pbXBvcnQgUGFyYW1zIGZyb20gXCIuLi8uLi9wYXJhbXMuanNcIlxuaW1wb3J0IFByb3BUeXBlcyBmcm9tIFwicHJvcC10eXBlc1wiXG5pbXBvcnQge1RhYmxlU2VhcmNofSBmcm9tIFwibW9kZWxzLmpzXCJcbmltcG9ydCBtZW1vIGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9tZW1vLmpzXCJcbmltcG9ydCB7c2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IFJlYWN0IGZyb20gXCJyZWFjdFwiXG5pbXBvcnQgdXNlSTE4biBmcm9tIFwiaTE4bi1vbi1zdGVyb2lkcy9zcmMvdXNlLWkxOG4ubWpzXCJcbmltcG9ydCB1c2VRdWVyeVBhcmFtcyBmcm9tIFwib24tbG9jYXRpb24tY2hhbmdlZC9idWlsZC91c2UtcXVlcnktcGFyYW1zLmpzXCJcbmltcG9ydCB7Vmlld30gZnJvbSBcInJlYWN0LW5hdGl2ZVwiXG5cbmV4cG9ydCBkZWZhdWx0IG1lbW8oc2hhcGVDb21wb25lbnQoY2xhc3MgQXBpTWFrZXJUYWJsZUZpbHRlcnMgZXh0ZW5kcyBCYXNlQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBjdXJyZW50VXNlcjogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBtb2RlbENsYXNzOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHF1ZXJ5TmFtZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIHF1ZXJ5U05hbWU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZFxuICB9XG5cbiAgc2V0dXAoKSB7XG4gICAgY29uc3Qge3R9ID0gdXNlSTE4bih7bmFtZXNwYWNlOiBcImpzLmFwaV9tYWtlci50YWJsZS5maWx0ZXJzXCJ9KVxuXG4gICAgdGhpcy5xdWVyeVBhcmFtcyA9IHVzZVF1ZXJ5UGFyYW1zKClcbiAgICB0aGlzLnQgPSB0XG4gICAgdGhpcy51c2VTdGF0ZXMoe1xuICAgICAgZmlsdGVyOiB1bmRlZmluZWQsXG4gICAgICBzaG93TG9hZFNlYXJjaE1vZGFsOiB1bmRlZmluZWQsXG4gICAgICBzaG93U2F2ZVNlYXJjaE1vZGFsOiBmYWxzZVxuICAgIH0pXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge21vZGVsQ2xhc3MsIHF1ZXJ5U05hbWV9ID0gZGlncyh0aGlzLnByb3BzLCBcIm1vZGVsQ2xhc3NcIiwgXCJxdWVyeVNOYW1lXCIpXG4gICAgY29uc3Qge2N1cnJlbnRVc2VyfSA9IHRoaXMucHJvcHNcbiAgICBjb25zdCB7ZmlsdGVyLCBzaG93TG9hZFNlYXJjaE1vZGFsLCBzaG93U2F2ZVNlYXJjaE1vZGFsfSA9IGRpZ3ModGhpcy5zdGF0ZSwgXCJmaWx0ZXJcIiwgXCJzaG93TG9hZFNlYXJjaE1vZGFsXCIsIFwic2hvd1NhdmVTZWFyY2hNb2RhbFwiKVxuICAgIGNvbnN0IGN1cnJlbnRGaWx0ZXJzID0gdGhpcy5jdXJyZW50RmlsdGVycygpXG5cbiAgICByZXR1cm4gKFxuICAgICAgPFZpZXcgZGF0YVNldD17dGhpcy5jYWNoZShcInJvb3RWaWV3RGF0YVNldFwiLCB7Y2xhc3M6IFwiYXBpLW1ha2VyLS10YWJsZS0tZmlsdGVyc1wifSl9IHN0eWxlPXt0aGlzLmNhY2hlKFwicm9vdFZpZXdTdHlsZVwiLCB7YWxpZ25JdGVtczogXCJmbGV4LXN0YXJ0XCJ9KX0+XG4gICAgICAgIHtmaWx0ZXIgJiZcbiAgICAgICAgICA8RmlsdGVyRm9ybVxuICAgICAgICAgICAgZmlsdGVyPXtmaWx0ZXJ9XG4gICAgICAgICAgICBrZXk9e2BmaWx0ZXItJHtmaWx0ZXIuZmlsdGVySW5kZXh9YH1cbiAgICAgICAgICAgIG1vZGVsQ2xhc3M9e21vZGVsQ2xhc3N9XG4gICAgICAgICAgICBvbkFwcGx5Q2xpY2tlZD17dGhpcy50dC5vbkFwcGx5Q2xpY2tlZH1cbiAgICAgICAgICAgIG9uUmVxdWVzdENsb3NlPXt0aGlzLnR0Lm9uRmlsdGVyRm9ybVJlcXVlc3RDbG9zZX1cbiAgICAgICAgICAgIHF1ZXJ5U2VhcmNoTmFtZT17cXVlcnlTTmFtZX1cbiAgICAgICAgICAvPlxuICAgICAgICB9XG4gICAgICAgIHtzaG93TG9hZFNlYXJjaE1vZGFsICYmXG4gICAgICAgICAgPExvYWRTZWFyY2hNb2RhbFxuICAgICAgICAgICAgY3VycmVudFVzZXI9e2N1cnJlbnRVc2VyfVxuICAgICAgICAgICAgbW9kZWxDbGFzcz17bW9kZWxDbGFzc31cbiAgICAgICAgICAgIG9uRWRpdFNlYXJjaFByZXNzZWQ9e2RpZ2codGhpcywgXCJvbkVkaXRTZWFyY2hQcmVzc2VkXCIpfVxuICAgICAgICAgICAgb25SZXF1ZXN0Q2xvc2U9e2RpZ2codGhpcywgXCJvblJlcXVlc3RDbG9zZUxvYWRTZWFyY2hNb2RhbFwiKX1cbiAgICAgICAgICAgIHF1ZXJ5U2VhcmNoTmFtZT17cXVlcnlTTmFtZX1cbiAgICAgICAgICAvPlxuICAgICAgICB9XG4gICAgICAgIHtzaG93U2F2ZVNlYXJjaE1vZGFsICYmXG4gICAgICAgICAgPFNhdmVTZWFyY2hNb2RhbFxuICAgICAgICAgICAgY3VycmVudEZpbHRlcnM9e2RpZ2codGhpcywgXCJjdXJyZW50RmlsdGVyc1wiKX1cbiAgICAgICAgICAgIGN1cnJlbnRVc2VyPXtjdXJyZW50VXNlcn1cbiAgICAgICAgICAgIG9uUmVxdWVzdENsb3NlPXtkaWdnKHRoaXMsIFwib25SZXF1ZXN0Q2xvc2VTYXZlU2VhcmNoTW9kYWxcIil9XG4gICAgICAgICAgICBzZWFyY2g9e3Nob3dTYXZlU2VhcmNoTW9kYWx9XG4gICAgICAgICAgLz5cbiAgICAgICAgfVxuICAgICAgICB7Y3VycmVudEZpbHRlcnM/Lm1hcCgoZmlsdGVyRGF0YSwgZmlsdGVySW5kZXgpID0+XG4gICAgICAgICAgPEZpbHRlclxuICAgICAgICAgICAga2V5PXtmaWx0ZXJJbmRleH1cbiAgICAgICAgICAgIGZpbHRlckluZGV4PXtmaWx0ZXJJbmRleH1cbiAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMudHQub25GaWx0ZXJDbGlja2VkfVxuICAgICAgICAgICAgb25SZW1vdmVDbGlja2VkPXt0aGlzLnR0Lm9uUmVtb3ZlQ2xpY2tlZH1cbiAgICAgICAgICAgIHsuLi5maWx0ZXJEYXRhfVxuICAgICAgICAgIC8+XG4gICAgICAgICl9XG4gICAgICAgIDxWaWV3IGRhdGFTZXQ9e3RoaXMuY2FjaGUoXCJmaWx0ZXJBY3Rpb25zRGF0YVNldFwiLCB7Y2xhc3M6IFwiZmlsdGVyLWFjdGlvbnNcIn0pfSBzdHlsZT17dGhpcy5jYWNoZShcImZpbHRlckFjdGlvbnNTdHlsZVwiLCB7ZmxleERpcmVjdGlvbjogXCJyb3dcIiwgbWFyZ2luVG9wOiAxMH0pfT5cbiAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT1cImFkZC1uZXctZmlsdGVyLWJ1dHRvblwiIG9uQ2xpY2s9e3RoaXMudHQub25BZGRGaWx0ZXJDbGlja2VkfT5cbiAgICAgICAgICAgIHt0aGlzLnQoXCIuYWRkX25ld19maWx0ZXJcIiwge2RlZmF1bHRWYWx1ZTogXCJBZGQgbmV3IGZpbHRlclwifSl9XG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAge2N1cnJlbnRVc2VyICYmXG4gICAgICAgICAgICA8PlxuICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT1cInNhdmUtc2VhcmNoLWJ1dHRvblwiIG9uQ2xpY2s9e3RoaXMudHQub25TYXZlU2VhcmNoQ2xpY2tlZH0gc3R5bGU9e3ttYXJnaW5MZWZ0OiAxMH19PlxuICAgICAgICAgICAgICAgIHt0aGlzLnQoXCIuc2F2ZV9zZWFyY2hcIiwge2RlZmF1bHRWYWx1ZTogXCJTYXZlIHNlYXJjaFwifSl9XG4gICAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT1cImxvYWQtc2VhcmNoLWJ1dHRvblwiIG9uQ2xpY2s9e3RoaXMudHQub25Mb2FkU2VhcmNoQ2xpY2tlZH0gc3R5bGU9e3ttYXJnaW5MZWZ0OiAxMH19PlxuICAgICAgICAgICAgICAgIHt0aGlzLnQoXCIubG9hZF9zZWFyY2hcIiwge2RlZmF1bHRWYWx1ZTogXCJMb2FkIHNlYXJjaFwifSl9XG4gICAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgPC8+XG4gICAgICAgICAgfVxuICAgICAgICA8L1ZpZXc+XG4gICAgICA8L1ZpZXc+XG4gICAgKVxuICB9XG5cbiAgY3VycmVudEZpbHRlcnMgPSAoKSA9PiB7XG4gICAgY29uc3Qge3F1ZXJ5U05hbWV9ID0gZGlncyh0aGlzLnByb3BzLCBcInF1ZXJ5U05hbWVcIilcbiAgICBjb25zdCBjdXJyZW50RmlsdGVycyA9IHRoaXMucXVlcnlQYXJhbXNbcXVlcnlTTmFtZV0gfHwgW11cblxuICAgIHJldHVybiBjdXJyZW50RmlsdGVycy5tYXAoKGN1cnJlbnRGaWx0ZXIpID0+IEpTT04ucGFyc2UoY3VycmVudEZpbHRlcikpXG4gIH1cblxuICBvbkFkZEZpbHRlckNsaWNrZWQgPSAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKVxuXG4gICAgY29uc3QgbmV3RmlsdGVySW5kZXggPSB0aGlzLmN1cnJlbnRGaWx0ZXJzKCkubGVuZ3RoXG5cbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGZpbHRlcjoge1xuICAgICAgICBmaWx0ZXJJbmRleDogbmV3RmlsdGVySW5kZXhcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgb25BcHBseUNsaWNrZWQgPSAoKSA9PiB0aGlzLnNldFN0YXRlKHtmaWx0ZXI6IHVuZGVmaW5lZH0pXG5cbiAgb25FZGl0U2VhcmNoUHJlc3NlZCA9ICh7c2VhcmNofSkgPT4ge1xuICAgIHRoaXMub25SZXF1ZXN0Q2xvc2VMb2FkU2VhcmNoTW9kYWwoKVxuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgc2hvd1NhdmVTZWFyY2hNb2RhbDogc2VhcmNoXG4gICAgfSlcbiAgfVxuXG4gIG9uRmlsdGVyQ2xpY2tlZCA9IChmaWx0ZXIpID0+IHRoaXMuc2V0U3RhdGUoe2ZpbHRlcn0pXG4gIG9uRmlsdGVyRm9ybVJlcXVlc3RDbG9zZSA9ICgpID0+IHRoaXMuc2V0U3RhdGUoe2ZpbHRlcjogdW5kZWZpbmVkfSlcblxuICBvbkxvYWRTZWFyY2hDbGlja2VkID0gKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KClcblxuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgc2hvd0xvYWRTZWFyY2hNb2RhbDogdHJ1ZVxuICAgIH0pXG4gIH1cblxuICBvblJlbW92ZUNsaWNrZWQgPSAoe2ZpbHRlckluZGV4fSkgPT4ge1xuICAgIGNvbnN0IHtxdWVyeVNOYW1lfSA9IGRpZ3ModGhpcy5wcm9wcywgXCJxdWVyeVNOYW1lXCIpXG4gICAgY29uc3Qgc2VhcmNoUGFyYW1zID0gUGFyYW1zLnBhcnNlKClbcXVlcnlTTmFtZV0gfHwge31cblxuICAgIGRlbGV0ZSBzZWFyY2hQYXJhbXNbZmlsdGVySW5kZXhdXG5cbiAgICBjb25zdCBuZXdQYXJhbXMgPSB7fVxuXG4gICAgbmV3UGFyYW1zW3F1ZXJ5U05hbWVdID0gc2VhcmNoUGFyYW1zXG5cbiAgICBQYXJhbXMuY2hhbmdlUGFyYW1zKG5ld1BhcmFtcylcblxuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgZmlsdGVyOiB1bmRlZmluZWRcbiAgICB9KVxuICB9XG5cbiAgb25SZXF1ZXN0Q2xvc2VMb2FkU2VhcmNoTW9kYWwgPSAoKSA9PiB0aGlzLnNldFN0YXRlKHtzaG93TG9hZFNlYXJjaE1vZGFsOiBmYWxzZX0pXG4gIG9uUmVxdWVzdENsb3NlU2F2ZVNlYXJjaE1vZGFsID0gKCkgPT4gdGhpcy5zZXRTdGF0ZSh7c2hvd1NhdmVTZWFyY2hNb2RhbDogdW5kZWZpbmVkfSlcblxuICBvblNhdmVTZWFyY2hDbGlja2VkID0gKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KClcblxuICAgIGlmICh0aGlzLmhhc0FueUZpbHRlcnMoKSkge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7c2hvd1NhdmVTZWFyY2hNb2RhbDogbmV3IFRhYmxlU2VhcmNoKCl9KVxuICAgIH0gZWxzZSB7XG4gICAgICBGbGFzaE5vdGlmaWNhdGlvbnMuYWxlcnQodGhpcy50KFwiLm5vX2ZpbHRlcnNfaGFzX2JlZW5fc2V0XCIsIHtkZWZhdWx0VmFsdWU6IFwiTm8gZmlsdGVycyBoYXMgYmVlbiBzZXRcIn0pKVxuICAgIH1cbiAgfVxuXG4gIGhhc0FueUZpbHRlcnMgPSAoKSA9PiBPYmplY3Qua2V5cyh0aGlzLmN1cnJlbnRGaWx0ZXJzKCkpLmxlbmd0aCA+IDBcbn0pKVxuIl19