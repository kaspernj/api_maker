import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
/* eslint-disable implicit-arrow-linebreak, max-len, react/jsx-sort-props, sort-imports */
import { Pressable } from "react-native";
import BaseComponent from "../base-component";
import Column from "./components/column";
import columnIdentifier from "./column-identifier.js";
import { EventEmitter } from "eventemitter3";
import { FlashNotifications } from "flash-notifications";
import Icon from "../utils/icon";
import * as inflection from "inflection";
import modelCallbackArgs from "./model-callback-args.js";
import Link from "../link";
import ModelColumn from "./model-column";
import PropTypes from "prop-types";
import propTypesExact from "prop-types-exact";
import React from "react";
import Row from "./components/row";
import memo from "set-state-compare/build/memo.js";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import useI18n from "i18n-on-steroids/src/use-i18n.mjs";
import WorkerPluginsCheckbox from "./worker-plugins-checkbox";
export default memo(shapeComponent(class ApiMakerBootStrapLiveTableModelRow extends BaseComponent {
    static propTypes = propTypesExact({
        cacheKey: PropTypes.string.isRequired,
        columns: PropTypes.array,
        columnWidths: PropTypes.object.isRequired,
        events: PropTypes.instanceOf(EventEmitter).isRequired,
        index: PropTypes.number.isRequired,
        model: PropTypes.object.isRequired,
        table: PropTypes.object.isRequired,
        tableSettingFullCacheKey: PropTypes.string.isRequired
    });
    setup() {
        const { t } = useI18n({ namespace: "js.api_maker.table.model_row" });
        this.t = t;
    }
    render() {
        const { index, table, model } = this.p;
        const { modelClass, workplace } = table.p;
        const { actionsContent, destroyEnabled, editModelPath, viewModelPath } = table.props;
        const { columns, currentWorkplace } = table.state;
        const { styleForColumn, styleForRow } = table.tt;
        const even = index % 2 == 0;
        this.modelCallbackArgs = modelCallbackArgs(table, model); // 'model' can change so this needs to be re-cached for every render
        let editPath, viewPath;
        if (editModelPath && model.can("edit")) {
            editPath = editModelPath(this.modelCallbackArgs);
        }
        if (viewModelPath && model.can("show")) {
            viewPath = viewModelPath(this.modelCallbackArgs);
        }
        return (_jsxs(Row, { dataSet: this.cache("rowDataSet", { class: `${inflection.dasherize(modelClass.modelClassData().paramKey)}-row`, modelId: model.id() }, [model.id(), modelClass.modelClassData().paramKey]), style: styleForRow({ even }), children: [workplace &&
                    _jsx(Column, { dataSet: this.cache("columnDataSet", { class: "workplace-column" }), style: styleForColumn({ even, style: { width: 41 } }), children: _jsx(WorkerPluginsCheckbox, { currentWorkplace: currentWorkplace, model: model, style: this.cache("workerPluginsCheckboxStyle", { marginHorizontal: "auto" }) }) }), columns && this.columnsContentFromColumns(model, even), _jsxs(Column, { dataSet: this.cache("actionsColumnDataSet", { class: "actions-column" }), style: styleForColumn({ even, style: {}, type: "actions" }), children: [actionsContent && actionsContent(this.tt.modelCallbackArgs), viewPath &&
                            _jsx(Link, { dataSet: this.cache("viewButtonDataSet", { class: "view-button" }), style: this.cache("searchLinkStyle", { marginLeft: 2, marginRight: 2 }), to: viewPath, children: _jsx(Icon, { name: "search", size: 18 }) }), editPath &&
                            _jsx(Link, { dataSet: this.cache("editButtonDataSet", { class: "edit-button" }), style: this.cache("editButtonStyle", { marginLeft: 2, marginRight: 2 }), to: editPath, children: _jsx(Icon, { name: "pencil", size: 20 }) }), destroyEnabled && model.can("destroy") &&
                            _jsx(Pressable, { dataSet: this.cache("destroyButtonDataSet", { class: "destroy-button" }), style: this.cache("destroyButtonStyle", { marginLeft: 2, marginRight: 2 }), onPress: this.tt.onDestroyClicked, children: _jsx(Icon, { name: "remove", size: 22 }) })] })] }));
    }
    columnsContentFromColumns(model, even) {
        const { columns, events, table } = this.p;
        return columns?.map(({ animatedPosition, animatedWidth, animatedZIndex, column, tableSettingColumn }, columnIndex) => _jsx(ModelColumn, { animatedPosition: animatedPosition, animatedWidth: animatedWidth, animatedZIndex: animatedZIndex, column: column, columnIndex: columnIndex, even: even, events: events, model: model, table: table, tableSettingColumn: tableSettingColumn }, columnIdentifier(column)));
    }
    onDestroyClicked = async () => {
        const { t } = this.tt;
        const { destroyMessage } = this.p.table.props;
        const { model } = this.p;
        // eslint-disable-next-line no-alert
        if (!confirm(t("js.shared.are_you_sure"))) {
            return;
        }
        try {
            await model.destroy();
            if (destroyMessage) {
                FlashNotifications.success(destroyMessage);
            }
        }
        catch (error) {
            FlashNotifications.errorResponse(error);
        }
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kZWwtcm93LmpzIiwic291cmNlUm9vdCI6Ii9zcmMvIiwic291cmNlcyI6WyJ0YWJsZS9tb2RlbC1yb3cuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSwwRkFBMEY7QUFDMUYsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLGNBQWMsQ0FBQTtBQUN0QyxPQUFPLGFBQWEsTUFBTSxtQkFBbUIsQ0FBQTtBQUM3QyxPQUFPLE1BQU0sTUFBTSxxQkFBcUIsQ0FBQTtBQUN4QyxPQUFPLGdCQUFnQixNQUFNLHdCQUF3QixDQUFBO0FBQ3JELE9BQU8sRUFBQyxZQUFZLEVBQUMsTUFBTSxlQUFlLENBQUE7QUFDMUMsT0FBTyxFQUFDLGtCQUFrQixFQUFDLE1BQU0scUJBQXFCLENBQUE7QUFDdEQsT0FBTyxJQUFJLE1BQU0sZUFBZSxDQUFBO0FBQ2hDLE9BQU8sS0FBSyxVQUFVLE1BQU0sWUFBWSxDQUFBO0FBQ3hDLE9BQU8saUJBQWlCLE1BQU0sMEJBQTBCLENBQUE7QUFDeEQsT0FBTyxJQUFJLE1BQU0sU0FBUyxDQUFBO0FBQzFCLE9BQU8sV0FBVyxNQUFNLGdCQUFnQixDQUFBO0FBQ3hDLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQTtBQUNsQyxPQUFPLGNBQWMsTUFBTSxrQkFBa0IsQ0FBQTtBQUM3QyxPQUFPLEtBQUssTUFBTSxPQUFPLENBQUE7QUFDekIsT0FBTyxHQUFHLE1BQU0sa0JBQWtCLENBQUE7QUFDbEMsT0FBTyxJQUFJLE1BQU0saUNBQWlDLENBQUE7QUFDbEQsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLDRDQUE0QyxDQUFBO0FBQ3pFLE9BQU8sT0FBTyxNQUFNLG1DQUFtQyxDQUFBO0FBQ3ZELE9BQU8scUJBQXFCLE1BQU0sMkJBQTJCLENBQUE7QUFFN0QsZUFBZSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sa0NBQW1DLFNBQVEsYUFBYTtJQUMvRixNQUFNLENBQUMsU0FBUyxHQUFHLGNBQWMsQ0FBQztRQUNoQyxRQUFRLEVBQUUsU0FB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QixDQUNILENBQUE7SUFDSCxDQUFDO0lBRUQsZ0JBQWdCLEdBQUcsS0FBSyxJQUFJLEVBQUU7UUFDNUIsTUFBTSxFQUFDLENBQUMsRUFBQyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUE7UUFDbkIsTUFBTSxFQUFDLGNBQWMsRUFBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQTtRQUMzQyxNQUFNLEVBQUMsS0FBSyxFQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQTtRQUV0QixvQ0FBb0M7UUFDcEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDMUMsT0FBTTtRQUNSLENBQUM7UUFFRCxJQUFJLENBQUM7WUFDSCxNQUFNLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQTtZQUVyQixJQUFJLGNBQWMsRUFBRSxDQUFDO2dCQUNuQixrQkFBa0IsQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUE7WUFDNUMsQ0FBQztRQUNILENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2Ysa0JBQWtCLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBQ3pDLENBQUM7SUFDSCxDQUFDLENBQUE7Q0FDRixDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIGltcGxpY2l0LWFycm93LWxpbmVicmVhaywgbWF4LWxlbiwgcmVhY3QvanN4LXNvcnQtcHJvcHMsIHNvcnQtaW1wb3J0cyAqL1xuaW1wb3J0IHtQcmVzc2FibGV9IGZyb20gXCJyZWFjdC1uYXRpdmVcIlxuaW1wb3J0IEJhc2VDb21wb25lbnQgZnJvbSBcIi4uL2Jhc2UtY29tcG9uZW50XCJcbmltcG9ydCBDb2x1bW4gZnJvbSBcIi4vY29tcG9uZW50cy9jb2x1bW5cIlxuaW1wb3J0IGNvbHVtbklkZW50aWZpZXIgZnJvbSBcIi4vY29sdW1uLWlkZW50aWZpZXIuanNcIlxuaW1wb3J0IHtFdmVudEVtaXR0ZXJ9IGZyb20gXCJldmVudGVtaXR0ZXIzXCJcbmltcG9ydCB7Rmxhc2hOb3RpZmljYXRpb25zfSBmcm9tIFwiZmxhc2gtbm90aWZpY2F0aW9uc1wiXG5pbXBvcnQgSWNvbiBmcm9tIFwiLi4vdXRpbHMvaWNvblwiXG5pbXBvcnQgKiBhcyBpbmZsZWN0aW9uIGZyb20gXCJpbmZsZWN0aW9uXCJcbmltcG9ydCBtb2RlbENhbGxiYWNrQXJncyBmcm9tIFwiLi9tb2RlbC1jYWxsYmFjay1hcmdzLmpzXCJcbmltcG9ydCBMaW5rIGZyb20gXCIuLi9saW5rXCJcbmltcG9ydCBNb2RlbENvbHVtbiBmcm9tIFwiLi9tb2RlbC1jb2x1bW5cIlxuaW1wb3J0IFByb3BUeXBlcyBmcm9tIFwicHJvcC10eXBlc1wiXG5pbXBvcnQgcHJvcFR5cGVzRXhhY3QgZnJvbSBcInByb3AtdHlwZXMtZXhhY3RcIlxuaW1wb3J0IFJlYWN0IGZyb20gXCJyZWFjdFwiXG5pbXBvcnQgUm93IGZyb20gXCIuL2NvbXBvbmVudHMvcm93XCJcbmltcG9ydCBtZW1vIGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9tZW1vLmpzXCJcbmltcG9ydCB7c2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IHVzZUkxOG4gZnJvbSBcImkxOG4tb24tc3Rlcm9pZHMvc3JjL3VzZS1pMThuLm1qc1wiXG5pbXBvcnQgV29ya2VyUGx1Z2luc0NoZWNrYm94IGZyb20gXCIuL3dvcmtlci1wbHVnaW5zLWNoZWNrYm94XCJcblxuZXhwb3J0IGRlZmF1bHQgbWVtbyhzaGFwZUNvbXBvbmVudChjbGFzcyBBcGlNYWtlckJvb3RTdHJhcExpdmVUYWJsZU1vZGVsUm93IGV4dGVuZHMgQmFzZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSBwcm9wVHlwZXNFeGFjdCh7XG4gICAgY2FjaGVLZXk6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICBjb2x1bW5zOiBQcm9wVHlwZXMuYXJyYXksXG4gICAgY29sdW1uV2lkdGhzOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgZXZlbnRzOiBQcm9wVHlwZXMuaW5zdGFuY2VPZihFdmVudEVtaXR0ZXIpLmlzUmVxdWlyZWQsXG4gICAgaW5kZXg6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcbiAgICBtb2RlbDogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIHRhYmxlOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgdGFibGVTZXR0aW5nRnVsbENhY2hlS2V5OiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWRcbiAgfSlcblxuICBzZXR1cCgpIHtcbiAgICBjb25zdCB7dH0gPSB1c2VJMThuKHtuYW1lc3BhY2U6IFwianMuYXBpX21ha2VyLnRhYmxlLm1vZGVsX3Jvd1wifSlcblxuICAgIHRoaXMudCA9IHRcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7aW5kZXgsIHRhYmxlLCBtb2RlbH0gPSB0aGlzLnBcbiAgICBjb25zdCB7bW9kZWxDbGFzcywgd29ya3BsYWNlfSA9IHRhYmxlLnBcbiAgICBjb25zdCB7YWN0aW9uc0NvbnRlbnQsIGRlc3Ryb3lFbmFibGVkLCBlZGl0TW9kZWxQYXRoLCB2aWV3TW9kZWxQYXRofSA9IHRhYmxlLnByb3BzXG4gICAgY29uc3Qge2NvbHVtbnMsIGN1cnJlbnRXb3JrcGxhY2V9ID0gdGFibGUuc3RhdGVcbiAgICBjb25zdCB7c3R5bGVGb3JDb2x1bW4sIHN0eWxlRm9yUm93fSA9IHRhYmxlLnR0XG4gICAgY29uc3QgZXZlbiA9IGluZGV4ICUgMiA9PSAwXG5cbiAgICB0aGlzLm1vZGVsQ2FsbGJhY2tBcmdzID0gbW9kZWxDYWxsYmFja0FyZ3ModGFibGUsIG1vZGVsKSAvLyAnbW9kZWwnIGNhbiBjaGFuZ2Ugc28gdGhpcyBuZWVkcyB0byBiZSByZS1jYWNoZWQgZm9yIGV2ZXJ5IHJlbmRlclxuXG4gICAgbGV0IGVkaXRQYXRoLCB2aWV3UGF0aFxuXG4gICAgaWYgKGVkaXRNb2RlbFBhdGggJiYgbW9kZWwuY2FuKFwiZWRpdFwiKSkge1xuICAgICAgZWRpdFBhdGggPSBlZGl0TW9kZWxQYXRoKHRoaXMubW9kZWxDYWxsYmFja0FyZ3MpXG4gICAgfVxuXG4gICAgaWYgKHZpZXdNb2RlbFBhdGggJiYgbW9kZWwuY2FuKFwic2hvd1wiKSkge1xuICAgICAgdmlld1BhdGggPSB2aWV3TW9kZWxQYXRoKHRoaXMubW9kZWxDYWxsYmFja0FyZ3MpXG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxSb3dcbiAgICAgICAgZGF0YVNldD17dGhpcy5jYWNoZShcInJvd0RhdGFTZXRcIiwge2NsYXNzOiBgJHtpbmZsZWN0aW9uLmRhc2hlcml6ZShtb2RlbENsYXNzLm1vZGVsQ2xhc3NEYXRhKCkucGFyYW1LZXkpfS1yb3dgLCBtb2RlbElkOiBtb2RlbC5pZCgpfSwgW21vZGVsLmlkKCksIG1vZGVsQ2xhc3MubW9kZWxDbGFzc0RhdGEoKS5wYXJhbUtleV0pfVxuICAgICAgICBzdHlsZT17c3R5bGVGb3JSb3coe2V2ZW59KX1cbiAgICAgID5cbiAgICAgICAge3dvcmtwbGFjZSAmJlxuICAgICAgICAgIDxDb2x1bW4gZGF0YVNldD17dGhpcy5jYWNoZShcImNvbHVtbkRhdGFTZXRcIiwge2NsYXNzOiBcIndvcmtwbGFjZS1jb2x1bW5cIn0pfSBzdHlsZT17c3R5bGVGb3JDb2x1bW4oe2V2ZW4sIHN0eWxlOiB7d2lkdGg6IDQxfX0pfT5cbiAgICAgICAgICAgIDxXb3JrZXJQbHVnaW5zQ2hlY2tib3hcbiAgICAgICAgICAgICAgY3VycmVudFdvcmtwbGFjZT17Y3VycmVudFdvcmtwbGFjZX1cbiAgICAgICAgICAgICAgbW9kZWw9e21vZGVsfVxuICAgICAgICAgICAgICBzdHlsZT17dGhpcy5jYWNoZShcIndvcmtlclBsdWdpbnNDaGVja2JveFN0eWxlXCIsIHttYXJnaW5Ib3Jpem9udGFsOiBcImF1dG9cIn0pfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L0NvbHVtbj5cbiAgICAgICAgfVxuICAgICAgICB7Y29sdW1ucyAmJiB0aGlzLmNvbHVtbnNDb250ZW50RnJvbUNvbHVtbnMobW9kZWwsIGV2ZW4pfVxuICAgICAgICA8Q29sdW1uIGRhdGFTZXQ9e3RoaXMuY2FjaGUoXCJhY3Rpb25zQ29sdW1uRGF0YVNldFwiLCB7Y2xhc3M6IFwiYWN0aW9ucy1jb2x1bW5cIn0pfSBzdHlsZT17c3R5bGVGb3JDb2x1bW4oe2V2ZW4sIHN0eWxlOiB7fSwgdHlwZTogXCJhY3Rpb25zXCJ9KX0+XG4gICAgICAgICAge2FjdGlvbnNDb250ZW50ICYmIGFjdGlvbnNDb250ZW50KHRoaXMudHQubW9kZWxDYWxsYmFja0FyZ3MpfVxuICAgICAgICAgIHt2aWV3UGF0aCAmJlxuICAgICAgICAgICAgPExpbmsgZGF0YVNldD17dGhpcy5jYWNoZShcInZpZXdCdXR0b25EYXRhU2V0XCIsIHtjbGFzczogXCJ2aWV3LWJ1dHRvblwifSl9IHN0eWxlPXt0aGlzLmNhY2hlKFwic2VhcmNoTGlua1N0eWxlXCIsIHttYXJnaW5MZWZ0OiAyLCBtYXJnaW5SaWdodDogMn0pfSB0bz17dmlld1BhdGh9PlxuICAgICAgICAgICAgICA8SWNvbiBuYW1lPVwic2VhcmNoXCIgc2l6ZT17MTh9IC8+XG4gICAgICAgICAgICA8L0xpbms+XG4gICAgICAgICAgfVxuICAgICAgICAgIHtlZGl0UGF0aCAmJlxuICAgICAgICAgICAgPExpbmsgZGF0YVNldD17dGhpcy5jYWNoZShcImVkaXRCdXR0b25EYXRhU2V0XCIsIHtjbGFzczogXCJlZGl0LWJ1dHRvblwifSl9IHN0eWxlPXt0aGlzLmNhY2hlKFwiZWRpdEJ1dHRvblN0eWxlXCIsIHttYXJnaW5MZWZ0OiAyLCBtYXJnaW5SaWdodDogMn0pfSB0bz17ZWRpdFBhdGh9PlxuICAgICAgICAgICAgICA8SWNvbiBuYW1lPVwicGVuY2lsXCIgc2l6ZT17MjB9IC8+XG4gICAgICAgICAgICA8L0xpbms+XG4gICAgICAgICAgfVxuICAgICAgICAgIHtkZXN0cm95RW5hYmxlZCAmJiBtb2RlbC5jYW4oXCJkZXN0cm95XCIpICYmXG4gICAgICAgICAgICA8UHJlc3NhYmxlXG4gICAgICAgICAgICAgIGRhdGFTZXQ9e3RoaXMuY2FjaGUoXCJkZXN0cm95QnV0dG9uRGF0YVNldFwiLCB7Y2xhc3M6IFwiZGVzdHJveS1idXR0b25cIn0pfVxuICAgICAgICAgICAgICBzdHlsZT17dGhpcy5jYWNoZShcImRlc3Ryb3lCdXR0b25TdHlsZVwiLCB7bWFyZ2luTGVmdDogMiwgbWFyZ2luUmlnaHQ6IDJ9KX1cbiAgICAgICAgICAgICAgb25QcmVzcz17dGhpcy50dC5vbkRlc3Ryb3lDbGlja2VkfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8SWNvbiBuYW1lPVwicmVtb3ZlXCIgc2l6ZT17MjJ9IC8+XG4gICAgICAgICAgICA8L1ByZXNzYWJsZT5cbiAgICAgICAgICB9XG4gICAgICAgIDwvQ29sdW1uPlxuICAgICAgPC9Sb3c+XG4gICAgKVxuICB9XG5cbiAgY29sdW1uc0NvbnRlbnRGcm9tQ29sdW1ucyhtb2RlbCwgZXZlbikge1xuICAgIGNvbnN0IHtjb2x1bW5zLCBldmVudHMsIHRhYmxlfSA9IHRoaXMucFxuXG4gICAgcmV0dXJuIGNvbHVtbnM/Lm1hcCgoe2FuaW1hdGVkUG9zaXRpb24sIGFuaW1hdGVkV2lkdGgsIGFuaW1hdGVkWkluZGV4LCBjb2x1bW4sIHRhYmxlU2V0dGluZ0NvbHVtbn0sIGNvbHVtbkluZGV4KSA9PlxuICAgICAgPE1vZGVsQ29sdW1uXG4gICAgICAgIGFuaW1hdGVkUG9zaXRpb249e2FuaW1hdGVkUG9zaXRpb259XG4gICAgICAgIGFuaW1hdGVkV2lkdGg9e2FuaW1hdGVkV2lkdGh9XG4gICAgICAgIGFuaW1hdGVkWkluZGV4PXthbmltYXRlZFpJbmRleH1cbiAgICAgICAgY29sdW1uPXtjb2x1bW59XG4gICAgICAgIGNvbHVtbkluZGV4PXtjb2x1bW5JbmRleH1cbiAgICAgICAgZXZlbj17ZXZlbn1cbiAgICAgICAgZXZlbnRzPXtldmVudHN9XG4gICAgICAgIGtleT17Y29sdW1uSWRlbnRpZmllcihjb2x1bW4pfVxuICAgICAgICBtb2RlbD17bW9kZWx9XG4gICAgICAgIHRhYmxlPXt0YWJsZX1cbiAgICAgICAgdGFibGVTZXR0aW5nQ29sdW1uPXt0YWJsZVNldHRpbmdDb2x1bW59XG4gICAgICAvPlxuICAgIClcbiAgfVxuXG4gIG9uRGVzdHJveUNsaWNrZWQgPSBhc3luYyAoKSA9PiB7XG4gICAgY29uc3Qge3R9ID0gdGhpcy50dFxuICAgIGNvbnN0IHtkZXN0cm95TWVzc2FnZX0gPSB0aGlzLnAudGFibGUucHJvcHNcbiAgICBjb25zdCB7bW9kZWx9ID0gdGhpcy5wXG5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tYWxlcnRcbiAgICBpZiAoIWNvbmZpcm0odChcImpzLnNoYXJlZC5hcmVfeW91X3N1cmVcIikpKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgbW9kZWwuZGVzdHJveSgpXG5cbiAgICAgIGlmIChkZXN0cm95TWVzc2FnZSkge1xuICAgICAgICBGbGFzaE5vdGlmaWNhdGlvbnMuc3VjY2VzcyhkZXN0cm95TWVzc2FnZSlcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgRmxhc2hOb3RpZmljYXRpb25zLmVycm9yUmVzcG9uc2UoZXJyb3IpXG4gICAgfVxuICB9XG59KSlcbiJdfQ==