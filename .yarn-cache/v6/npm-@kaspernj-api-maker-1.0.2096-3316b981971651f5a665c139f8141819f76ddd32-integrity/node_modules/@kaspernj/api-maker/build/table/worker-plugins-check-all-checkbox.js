import { jsx as _jsx } from "react/jsx-runtime";
/* eslint-disable import/no-unresolved, sort-imports */
import React, { useEffect, useMemo, useRef } from "react";
import BaseComponent from "../base-component";
import classNames from "classnames";
import Collection from "../collection.js";
import memo from "set-state-compare/build/memo.js";
import PropTypes from "prop-types";
import propTypesExact from "prop-types-exact";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import { simpleObjectDifferent } from "set-state-compare/build/diff-utils.js";
import useModelEvent from "../use-model-event.js";
const Checkbox = memo(shapeComponent(class Checkbox extends BaseComponent {
    render() {
        const { indeterminate, ...restProps } = this.props;
        const checkboxRef = useRef();
        useEffect(() => {
            checkboxRef.current.indeterminate = indeterminate;
        });
        return (_jsx("input", { ref: checkboxRef, type: "checkbox", ...restProps }));
    }
}));
export default memo(shapeComponent(class ApiMakerTableWorkerPluginsCheckAllCheckbox extends BaseComponent {
    static propTypes = propTypesExact({
        currentWorkplace: PropTypes.object,
        query: PropTypes.instanceOf(Collection),
        style: PropTypes.object
    });
    setup() {
        this.useStates({
            checked: false,
            indeterminate: false
        });
        useMemo(() => {
            this.updateAllChecked();
        }, []);
        useModelEvent(this.props.currentWorkplace, "workplace_links_created", this.tt.onLinksCreated);
        useModelEvent(this.props.currentWorkplace, "workplace_links_destroyed", this.tt.onLinksDestroyed);
    }
    componentDidUpdate(prevProps) {
        const previousParams = prevProps.query.params();
        const currentParams = this.props.query.params();
        if (simpleObjectDifferent(previousParams, currentParams)) {
            this.updateAllChecked();
        }
    }
    async updateAllChecked() {
        const { query, currentWorkplace } = this.props;
        const queryLinksStatusResult = await currentWorkplace.queryLinksStatus({ query });
        const allChecked = queryLinksStatusResult.all_checked;
        const someChecked = queryLinksStatusResult.some_checked;
        this.setState({
            checked: allChecked,
            indeterminate: someChecked
        });
    }
    render() {
        const { className, style } = this.props;
        const { checked, indeterminate } = this.state;
        return (_jsx(Checkbox, { checked: checked, className: classNames("api-maker--table--worker-plugins-check-all-checkbox", className), indeterminate: indeterminate, onChange: this.onCheckedChanged, style: style }));
    }
    modelClassName = () => this.props.query.modelClass().modelClassData().name;
    onCheckedChanged = async (e) => {
        e.preventDefault();
        const { currentWorkplace, query } = this.props;
        const checkbox = e.target;
        if (checkbox.checked) {
            await currentWorkplace.addQuery({ query });
            this.setState({ checked: true, indeterminate: false });
        }
        else {
            await currentWorkplace.removeQuery({ query });
            this.setState({ checked: false, indeterminate: false });
        }
    };
    onLinksCreated = ({ args }) => {
        if (args.created[this.modelClassName()]) {
            this.updateAllChecked();
        }
    };
    onLinksDestroyed = ({ args }) => {
        if (args.destroyed[this.modelClassName()]) {
            this.updateAllChecked();
        }
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29ya2VyLXBsdWdpbnMtY2hlY2stYWxsLWNoZWNrYm94LmpzIiwic291cmNlUm9vdCI6Ii9zcmMvIiwic291cmNlcyI6WyJ0YWJsZS93b3JrZXItcGx1Z2lucy1jaGVjay1hbGwtY2hlY2tib3guanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSx1REFBdUQ7QUFDdkQsT0FBTyxLQUFLLEVBQUUsRUFBQyxTQUFTLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBQyxNQUFNLE9BQU8sQ0FBQTtBQUN2RCxPQUFPLGFBQWEsTUFBTSxtQkFBbUIsQ0FBQTtBQUM3QyxPQUFPLFVBQVUsTUFBTSxZQUFZLENBQUE7QUFDbkMsT0FBTyxVQUFVLE1BQU0sa0JBQWtCLENBQUE7QUFDekMsT0FBTyxJQUFJLE1BQU0saUNBQWlDLENBQUE7QUFDbEQsT0FBTyxTQUFTLE1BQU0sWUFBWSxDQUFBO0FBQ2xDLE9BQU8sY0FBYyxNQUFNLGtCQUFrQixDQUFBO0FBQzdDLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSw0Q0FBNEMsQ0FBQTtBQUN6RSxPQUFPLEVBQUMscUJBQXFCLEVBQUMsTUFBTSx1Q0FBdUMsQ0FBQTtBQUMzRSxPQUFPLGFBQWEsTUFBTSx1QkFBdUIsQ0FBQTtBQUVqRCxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sUUFBUyxTQUFRLGFBQWE7SUFDdkUsTUFBTTtRQUNKLE1BQU0sRUFBQyxhQUFhLEVBQUUsR0FBRyxTQUFTLEVBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFBO1FBQ2hELE1BQU0sV0FBVyxHQUFHLE1BQU0sRUFBRSxDQUFBO1FBRTVCLFNBQVMsQ0FBQyxHQUFHLEVBQUU7WUFDYixXQUFXLENBQUMsT0FBTyxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUE7UUFDbkQsQ0FBQyxDQUFDLENBQUE7UUFFRixPQUFPLENBQ0wsZ0JBQU8sR0FBRyxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUMsVUFBVSxLQUFLLFNBQVMsR0FBSSxDQUMz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USxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUE7UUFFekIsSUFBSSxRQUFRLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDckIsTUFBTSxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsRUFBQyxLQUFLLEVBQUMsQ0FBQyxDQUFBO1lBQ3hDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBQyxPQUFPLEVBQUUsSUFBSSxFQUFFLGFBQWEsRUFBRSxLQUFLLEVBQUMsQ0FBQyxDQUFBO1FBQ3RELENBQUM7YUFBTSxDQUFDO1lBQ04sTUFBTSxnQkFBZ0IsQ0FBQyxXQUFXLENBQUMsRUFBQyxLQUFLLEVBQUMsQ0FBQyxDQUFBO1lBQzNDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLGFBQWEsRUFBRSxLQUFLLEVBQUMsQ0FBQyxDQUFBO1FBQ3ZELENBQUM7SUFDSCxDQUFDLENBQUE7SUFFRCxjQUFjLEdBQUcsQ0FBQyxFQUFDLElBQUksRUFBQyxFQUFFLEVBQUU7UUFDMUIsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQyxFQUFFLENBQUM7WUFDeEMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUE7UUFDekIsQ0FBQztJQUNILENBQUMsQ0FBQTtJQUVELGdCQUFnQixHQUFHLENBQUMsRUFBQyxJQUFJLEVBQUMsRUFBRSxFQUFFO1FBQzVCLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUMsRUFBRSxDQUFDO1lBQzFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFBO1FBQ3pCLENBQUM7SUFDSCxDQUFDLENBQUE7Q0FDRixDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIGltcG9ydC9uby11bnJlc29sdmVkLCBzb3J0LWltcG9ydHMgKi9cbmltcG9ydCBSZWFjdCwge3VzZUVmZmVjdCwgdXNlTWVtbywgdXNlUmVmfSBmcm9tIFwicmVhY3RcIlxuaW1wb3J0IEJhc2VDb21wb25lbnQgZnJvbSBcIi4uL2Jhc2UtY29tcG9uZW50XCJcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gXCJjbGFzc25hbWVzXCJcbmltcG9ydCBDb2xsZWN0aW9uIGZyb20gXCIuLi9jb2xsZWN0aW9uLmpzXCJcbmltcG9ydCBtZW1vIGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9tZW1vLmpzXCJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIlxuaW1wb3J0IHByb3BUeXBlc0V4YWN0IGZyb20gXCJwcm9wLXR5cGVzLWV4YWN0XCJcbmltcG9ydCB7c2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IHtzaW1wbGVPYmplY3REaWZmZXJlbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9kaWZmLXV0aWxzLmpzXCJcbmltcG9ydCB1c2VNb2RlbEV2ZW50IGZyb20gXCIuLi91c2UtbW9kZWwtZXZlbnQuanNcIlxuXG5jb25zdCBDaGVja2JveCA9IG1lbW8oc2hhcGVDb21wb25lbnQoY2xhc3MgQ2hlY2tib3ggZXh0ZW5kcyBCYXNlQ29tcG9uZW50IHtcbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtpbmRldGVybWluYXRlLCAuLi5yZXN0UHJvcHN9ID0gdGhpcy5wcm9wc1xuICAgIGNvbnN0IGNoZWNrYm94UmVmID0gdXNlUmVmKClcblxuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICBjaGVja2JveFJlZi5jdXJyZW50LmluZGV0ZXJtaW5hdGUgPSBpbmRldGVybWluYXRlXG4gICAgfSlcblxuICAgIHJldHVybiAoXG4gICAgICA8aW5wdXQgcmVmPXtjaGVja2JveFJlZn0gdHlwZT1cImNoZWNrYm94XCIgey4uLnJlc3RQcm9wc30gLz5cbiAgICApXG4gIH1cbn0pKVxuXG5leHBvcnQgZGVmYXVsdCBtZW1vKHNoYXBlQ29tcG9uZW50KGNsYXNzIEFwaU1ha2VyVGFibGVXb3JrZXJQbHVnaW5zQ2hlY2tBbGxDaGVja2JveCBleHRlbmRzIEJhc2VDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0gcHJvcFR5cGVzRXhhY3Qoe1xuICAgIGN1cnJlbnRXb3JrcGxhY2U6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgcXVlcnk6IFByb3BUeXBlcy5pbnN0YW5jZU9mKENvbGxlY3Rpb24pLFxuICAgIHN0eWxlOiBQcm9wVHlwZXMub2JqZWN0XG4gIH0pXG5cbiAgc2V0dXAoKSB7XG4gICAgdGhpcy51c2VTdGF0ZXMoe1xuICAgICAgY2hlY2tlZDogZmFsc2UsXG4gICAgICBpbmRldGVybWluYXRlOiBmYWxzZVxuICAgIH0pXG5cbiAgICB1c2VNZW1vKCgpID0+IHtcbiAgICAgIHRoaXMudXBkYXRlQWxsQ2hlY2tlZCgpXG4gICAgfSwgW10pXG5cbiAgICB1c2VNb2RlbEV2ZW50KHRoaXMucHJvcHMuY3VycmVudFdvcmtwbGFjZSwgXCJ3b3JrcGxhY2VfbGlua3NfY3JlYXRlZFwiLCB0aGlzLnR0Lm9uTGlua3NDcmVhdGVkKVxuICAgIHVzZU1vZGVsRXZlbnQodGhpcy5wcm9wcy5jdXJyZW50V29ya3BsYWNlLCBcIndvcmtwbGFjZV9saW5rc19kZXN0cm95ZWRcIiwgdGhpcy50dC5vbkxpbmtzRGVzdHJveWVkKVxuICB9XG5cbiAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xuICAgIGNvbnN0IHByZXZpb3VzUGFyYW1zID0gcHJldlByb3BzLnF1ZXJ5LnBhcmFtcygpXG4gICAgY29uc3QgY3VycmVudFBhcmFtcyA9IHRoaXMucHJvcHMucXVlcnkucGFyYW1zKClcblxuICAgIGlmIChzaW1wbGVPYmplY3REaWZmZXJlbnQocHJldmlvdXNQYXJhbXMsIGN1cnJlbnRQYXJhbXMpKSB7XG4gICAgICB0aGlzLnVwZGF0ZUFsbENoZWNrZWQoKVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZUFsbENoZWNrZWQoKSB7XG4gICAgY29uc3Qge3F1ZXJ5LCBjdXJyZW50V29ya3BsYWNlfSA9IHRoaXMucHJvcHNcbiAgICBjb25zdCBxdWVyeUxpbmtzU3RhdHVzUmVzdWx0ID0gYXdhaXQgY3VycmVudFdvcmtwbGFjZS5xdWVyeUxpbmtzU3RhdHVzKHtxdWVyeX0pXG4gICAgY29uc3QgYWxsQ2hlY2tlZCA9IHF1ZXJ5TGlua3NTdGF0dXNSZXN1bHQuYWxsX2NoZWNrZWRcbiAgICBjb25zdCBzb21lQ2hlY2tlZCA9IHF1ZXJ5TGlua3NTdGF0dXNSZXN1bHQuc29tZV9jaGVja2VkXG5cbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGNoZWNrZWQ6IGFsbENoZWNrZWQsXG4gICAgICBpbmRldGVybWluYXRlOiBzb21lQ2hlY2tlZFxuICAgIH0pXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge2NsYXNzTmFtZSwgc3R5bGV9ID0gdGhpcy5wcm9wc1xuICAgIGNvbnN0IHtjaGVja2VkLCBpbmRldGVybWluYXRlfSA9IHRoaXMuc3RhdGVcblxuICAgIHJldHVybiAoXG4gICAgICA8Q2hlY2tib3hcbiAgICAgICAgY2hlY2tlZD17Y2hlY2tlZH1cbiAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKFwiYXBpLW1ha2VyLS10YWJsZS0td29ya2VyLXBsdWdpbnMtY2hlY2stYWxsLWNoZWNrYm94XCIsIGNsYXNzTmFtZSl9XG4gICAgICAgIGluZGV0ZXJtaW5hdGU9e2luZGV0ZXJtaW5hdGV9XG4gICAgICAgIG9uQ2hhbmdlPXt0aGlzLm9uQ2hlY2tlZENoYW5nZWR9XG4gICAgICAgIHN0eWxlPXtzdHlsZX1cbiAgICAgIC8+XG4gICAgKVxuICB9XG5cbiAgbW9kZWxDbGFzc05hbWUgPSAoKSA9PiB0aGlzLnByb3BzLnF1ZXJ5Lm1vZGVsQ2xhc3MoKS5tb2RlbENsYXNzRGF0YSgpLm5hbWVcblxuICBvbkNoZWNrZWRDaGFuZ2VkID0gYXN5bmMgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KClcblxuICAgIGNvbnN0IHtjdXJyZW50V29ya3BsYWNlLCBxdWVyeX0gPSB0aGlzLnByb3BzXG4gICAgY29uc3QgY2hlY2tib3ggPSBlLnRhcmdldFxuXG4gICAgaWYgKGNoZWNrYm94LmNoZWNrZWQpIHtcbiAgICAgIGF3YWl0IGN1cnJlbnRXb3JrcGxhY2UuYWRkUXVlcnkoe3F1ZXJ5fSlcbiAgICAgIHRoaXMuc2V0U3RhdGUoe2NoZWNrZWQ6IHRydWUsIGluZGV0ZXJtaW5hdGU6IGZhbHNlfSlcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgY3VycmVudFdvcmtwbGFjZS5yZW1vdmVRdWVyeSh7cXVlcnl9KVxuICAgICAgdGhpcy5zZXRTdGF0ZSh7Y2hlY2tlZDogZmFsc2UsIGluZGV0ZXJtaW5hdGU6IGZhbHNlfSlcbiAgICB9XG4gIH1cblxuICBvbkxpbmtzQ3JlYXRlZCA9ICh7YXJnc30pID0+IHtcbiAgICBpZiAoYXJncy5jcmVhdGVkW3RoaXMubW9kZWxDbGFzc05hbWUoKV0pIHtcbiAgICAgIHRoaXMudXBkYXRlQWxsQ2hlY2tlZCgpXG4gICAgfVxuICB9XG5cbiAgb25MaW5rc0Rlc3Ryb3llZCA9ICh7YXJnc30pID0+IHtcbiAgICBpZiAoYXJncy5kZXN0cm95ZWRbdGhpcy5tb2RlbENsYXNzTmFtZSgpXSkge1xuICAgICAgdGhpcy51cGRhdGVBbGxDaGVja2VkKClcbiAgICB9XG4gIH1cbn0pKVxuIl19