import objectToFormData from "object-to-formdata";
export default class ApiMakerCommandSubmitData {
    /**
     * @param {object} data
     * @param {Record<string, any>} [data.global]
     * @param {import("./commands-pool.js").PoolDataType} data.pool
     */
    constructor(data) {
        this.data = data;
        this.filesCount = 0;
        this.jsonData = this.traverseObject(this.data, "json");
    }
    /** @returns {number} */
    getFilesCount = () => this.filesCount;
    /** @returns {Record<string, object>} */
    getJsonData = () => this.jsonData;
    getRawData() {
        if (!this.rawData) {
            this.rawData = this.traverseObject(this.data, "raw");
        }
        return this.rawData;
    }
    getFormData() {
        const objectForFormData = this.getRawData() || {};
        objectForFormData.json = JSON.stringify(this.getJsonData());
        const formData = objectToFormData.serialize(objectForFormData);
        return formData;
    }
    /**
     * @param {any} value
     * @param {string} type
     * @returns
     */
    convertDynamic(value, type) {
        if (Array.isArray(value)) {
            return this.traverseArray(value, type);
        }
        else if (typeof value == "object" && value !== null && value.constructor.name == "Object") {
            return this.traverseObject(value, type);
        }
        else {
            return value;
        }
    }
    /**
     * @param {any} object
     * @param {string} type
     * @returns {boolean}
     */
    shouldSkip(object, type) {
        if (type == "json" && object instanceof File) {
            this.filesCount += 1;
            return true;
        }
        if (type == "raw" && !Array.isArray(object) && !this.isObject(object) && !(object instanceof File)) {
            return true;
        }
        return false;
    }
    /**
     * @param {any} value
     * @returns {boolean}
     */
    isObject(value) {
        if (typeof value == "object" && value !== null && value.constructor.name == "Object") {
            return true;
        }
        return false;
    }
    /**
     * @param {Array<any>} array
     * @param {string} type
     * @returns {Array<any>}
     */
    traverseArray(array, type) {
        const newArray = [];
        for (const value of array) {
            if (!this.shouldSkip(value, type)) {
                if (Array.isArray(value)) {
                    newArray.push(this.convertDynamic(value, type));
                }
                else if (this.isObject(value)) {
                    newArray.push(this.convertDynamic(value, type));
                }
                else {
                    newArray.push(value);
                }
            }
        }
        return newArray;
    }
    /**
     * @param {Record<any, any>} object
     * @param {string} type
     * @returns {Record<any, any>}
     */
    traverseObject(object, type) {
        const newObject = {};
        for (const key in object) {
            const value = object[key];
            if (!this.shouldSkip(value, type)) {
                if (Array.isArray(value)) {
                    newObject[key] = this.convertDynamic(value, type);
                }
                else if (this.isObject(value)) {
                    newObject[key] = this.convertDynamic(value, type);
                }
                else {
                    newObject[key] = value;
                }
            }
        }
        return newObject;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbWFuZC1zdWJtaXQtZGF0YS5qcyIsInNvdXJjZVJvb3QiOiIvc3JjLyIsInNvdXJjZXMiOlsiY29tbWFuZC1zdWJtaXQtZGF0YS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLGdCQUFnQixNQUFNLG9CQUFvQixDQUFBO0FBRWpELE1BQU0sQ0FBQyxPQUFPLE9BQU8seUJBQXlCO0lBQzVDOzs7O09BSUc7SUFDSCxZQUFhLElBQUk7UUFDZixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQTtRQUNoQixJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQTtRQUNuQixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQTtJQUN4RCxDQUFDO0lBRUQsd0JBQXdCO0lBQ3hCLGFBQWEsR0FBRyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFBO0lBRXJDLHdDQUF3QztJQUN4QyxXQUFXLEdBQUcsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQTtJQUVqQyxVQUFVO1FBQ1IsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNsQixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQTtRQUN0RCxDQUFDO1FBRUQsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFBO0lBQ3JCLENBQUM7SUFFRCxXQUFXO1FBQ1QsTUFBTSxpQkFBaUIsR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksRUFBRSxDQUFBO1FBRWpELGlCQUFpQixDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFBO1FBRTNELE1BQU0sUUFBUSxHQUFHLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFB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SyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO29CQUN6QixTQUFTLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUE7Z0JBQ25ELENBQUM7cUJBQU0sSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7b0JBQ2hDLFNBQVMsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQTtnQkFDbkQsQ0FBQztxQkFBTSxDQUFDO29CQUNOLFNBQVMsQ0FBQyxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUE7Z0JBQ3hCLENBQUM7WUFDSCxDQUFDO1FBQ0gsQ0FBQztRQUVELE9BQU8sU0FBUyxDQUFBO0lBQ2xCLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBvYmplY3RUb0Zvcm1EYXRhIGZyb20gXCJvYmplY3QtdG8tZm9ybWRhdGFcIlxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBcGlNYWtlckNvbW1hbmRTdWJtaXREYXRhIHtcbiAgLyoqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhXG4gICAqIEBwYXJhbSB7UmVjb3JkPHN0cmluZywgYW55Pn0gW2RhdGEuZ2xvYmFsXVxuICAgKiBAcGFyYW0ge2ltcG9ydChcIi4vY29tbWFuZHMtcG9vbC5qc1wiKS5Qb29sRGF0YVR5cGV9IGRhdGEucG9vbFxuICAgKi9cbiAgY29uc3RydWN0b3IgKGRhdGEpIHtcbiAgICB0aGlzLmRhdGEgPSBkYXRhXG4gICAgdGhpcy5maWxlc0NvdW50ID0gMFxuICAgIHRoaXMuanNvbkRhdGEgPSB0aGlzLnRyYXZlcnNlT2JqZWN0KHRoaXMuZGF0YSwgXCJqc29uXCIpXG4gIH1cblxuICAvKiogQHJldHVybnMge251bWJlcn0gKi9cbiAgZ2V0RmlsZXNDb3VudCA9ICgpID0+IHRoaXMuZmlsZXNDb3VudFxuXG4gIC8qKiBAcmV0dXJucyB7UmVjb3JkPHN0cmluZywgb2JqZWN0Pn0gKi9cbiAgZ2V0SnNvbkRhdGEgPSAoKSA9PiB0aGlzLmpzb25EYXRhXG5cbiAgZ2V0UmF3RGF0YSAoKSB7XG4gICAgaWYgKCF0aGlzLnJhd0RhdGEpIHtcbiAgICAgIHRoaXMucmF3RGF0YSA9IHRoaXMudHJhdmVyc2VPYmplY3QodGhpcy5kYXRhLCBcInJhd1wiKVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnJhd0RhdGFcbiAgfVxuXG4gIGdldEZvcm1EYXRhICgpIHtcbiAgICBjb25zdCBvYmplY3RGb3JGb3JtRGF0YSA9IHRoaXMuZ2V0UmF3RGF0YSgpIHx8IHt9XG5cbiAgICBvYmplY3RGb3JGb3JtRGF0YS5qc29uID0gSlNPTi5zdHJpbmdpZnkodGhpcy5nZXRKc29uRGF0YSgpKVxuXG4gICAgY29uc3QgZm9ybURhdGEgPSBvYmplY3RUb0Zvcm1EYXRhLnNlcmlhbGl6ZShvYmplY3RGb3JGb3JtRGF0YSlcblxuICAgIHJldHVybiBmb3JtRGF0YVxuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7YW55fSB2YWx1ZVxuICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZVxuICAgKiBAcmV0dXJuc1xuICAgKi9cbiAgY29udmVydER5bmFtaWModmFsdWUsIHR5cGUpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgIHJldHVybiB0aGlzLnRyYXZlcnNlQXJyYXkodmFsdWUsIHR5cGUpXG4gICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT0gXCJvYmplY3RcIiAmJiB2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZS5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcbiAgICAgIHJldHVybiB0aGlzLnRyYXZlcnNlT2JqZWN0KHZhbHVlLCB0eXBlKVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdmFsdWVcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHthbnl9IG9iamVjdFxuICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZVxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn1cbiAgICovXG4gIHNob3VsZFNraXAob2JqZWN0LCB0eXBlKSB7XG4gICAgaWYgKHR5cGUgPT0gXCJqc29uXCIgJiYgb2JqZWN0IGluc3RhbmNlb2YgRmlsZSkge1xuICAgICAgdGhpcy5maWxlc0NvdW50ICs9IDFcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuXG4gICAgaWYgKHR5cGUgPT0gXCJyYXdcIiAmJiAhQXJyYXkuaXNBcnJheShvYmplY3QpICYmICF0aGlzLmlzT2JqZWN0KG9iamVjdCkgJiYgIShvYmplY3QgaW5zdGFuY2VvZiBGaWxlKSkge1xuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge2FueX0gdmFsdWVcbiAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAqL1xuICBpc09iamVjdCh2YWx1ZSkge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gXCJvYmplY3RcIiAmJiB2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZS5jb25zdHJ1Y3Rvci5uYW1lID09IFwiT2JqZWN0XCIpIHtcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtBcnJheTxhbnk+fSBhcnJheVxuICAgKiBAcGFyYW0ge3N0cmluZ30gdHlwZVxuICAgKiBAcmV0dXJucyB7QXJyYXk8YW55Pn1cbiAgICovXG4gIHRyYXZlcnNlQXJyYXkoYXJyYXksIHR5cGUpIHtcbiAgICBjb25zdCBuZXdBcnJheSA9IFtdXG5cbiAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIGFycmF5KSB7XG4gICAgICBpZiAoIXRoaXMuc2hvdWxkU2tpcCh2YWx1ZSwgdHlwZSkpIHtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgbmV3QXJyYXkucHVzaCh0aGlzLmNvbnZlcnREeW5hbWljKHZhbHVlLCB0eXBlKSlcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmlzT2JqZWN0KHZhbHVlKSkge1xuICAgICAgICAgIG5ld0FycmF5LnB1c2godGhpcy5jb252ZXJ0RHluYW1pYyh2YWx1ZSwgdHlwZSkpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbmV3QXJyYXkucHVzaCh2YWx1ZSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBuZXdBcnJheVxuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7UmVjb3JkPGFueSwgYW55Pn0gb2JqZWN0XG4gICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlXG4gICAqIEByZXR1cm5zIHtSZWNvcmQ8YW55LCBhbnk+fVxuICAgKi9cbiAgdHJhdmVyc2VPYmplY3Qob2JqZWN0LCB0eXBlKSB7XG4gICAgY29uc3QgbmV3T2JqZWN0ID0ge31cblxuICAgIGZvciAoY29uc3Qga2V5IGluIG9iamVjdCkge1xuICAgICAgY29uc3QgdmFsdWUgPSBvYmplY3Rba2V5XVxuXG4gICAgICBpZiAoIXRoaXMuc2hvdWxkU2tpcCh2YWx1ZSwgdHlwZSkpIHtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgICAgbmV3T2JqZWN0W2tleV0gPSB0aGlzLmNvbnZlcnREeW5hbWljKHZhbHVlLCB0eXBlKVxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaXNPYmplY3QodmFsdWUpKSB7XG4gICAgICAgICAgbmV3T2JqZWN0W2tleV0gPSB0aGlzLmNvbnZlcnREeW5hbWljKHZhbHVlLCB0eXBlKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5ld09iamVjdFtrZXldID0gdmFsdWVcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBuZXdPYmplY3RcbiAgfVxufVxuIl19