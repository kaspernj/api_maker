import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
/* eslint-disable implicit-arrow-linebreak, newline-per-chained-call, no-throw-literal, sort-imports */
import { shapeComponent, ShapeComponent } from "set-state-compare/build/shape-component.js";
import React, { useMemo } from "react";
import Checkbox from "./checkbox";
import { digs } from "diggerize";
import { useForm } from "../form";
import * as inflection from "inflection";
import InvalidFeedback from "./invalid-feedback";
import memo from "set-state-compare/build/memo.js";
import PropTypes from "prop-types";
import propTypesExact from "prop-types-exact";
import Text from "./text";
import useInput from "../use-input.js";
import { View } from "react-native";
const OptionElement = memo(shapeComponent(class OptionElement extends ShapeComponent {
    static propTypes = propTypesExact({
        checked: PropTypes.bool.isRequired,
        inputName: PropTypes.string.isRequired,
        onChange: PropTypes.func.isRequired,
        option: PropTypes.array.isRequired
    });
    render() {
        const { checked, inputName, option } = this.p;
        const dataSet = useMemo(() => ({
            component: "api-maker/utils/checkboxes/option",
            name: inputName,
            value: option[1]
        }), [inputName, option[1]]);
        return (_jsx(View, { children: _jsx(Checkbox, { checked: checked, dataSet: dataSet, label: option[0], onCheckedChange: this.tt.onChange }) }));
    }
    onChange = (checked) => this.p.onChange({ checked, option: this.p.option });
}));
export default memo(shapeComponent(class ApiMakerUtilsCheckboxes extends ShapeComponent {
    static propTypes = propTypesExact({
        attribute: PropTypes.string,
        defaultValue: PropTypes.array,
        label: PropTypes.string,
        labelClassName: PropTypes.string,
        model: PropTypes.object,
        name: PropTypes.string,
        onChange: PropTypes.func,
        options: PropTypes.array.isRequired
    });
    setup() {
        const { inputProps, wrapperOpts } = useInput({ props: this.props });
        this.generatedId = useMemo(() => Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15), []);
        this.setInstance({
            form: useForm(),
            inputProps,
            wrapperOpts
        });
        this.useStates({
            checkedOptions: () => {
                if (Array.isArray(this.props.defaultValue))
                    return this.props.defaultValue;
                if (this.props.defaultValue)
                    return [this.props.defaultValue];
                return [];
            }
        });
        useMemo(() => {
            if (this.form && inputProps.name) {
                this.form.setValue(inputProps.name, this.s.checkedOptions);
            }
        }, []);
    }
    render() {
        const { wrapperOpts } = this.tt;
        const { errors } = digs(wrapperOpts, "errors");
        return (_jsxs(View, { dataSet: this.cache("rootViewDataSet", { component: "api-maker/utils/checkboxes" }), children: [_jsx(Text, { style: this.cache("textStyle", { fontWeight: "bold" }), children: this.tt.wrapperOpts.label }), this.props.options.map((option) => _jsx(OptionElement, { checked: this.isChecked(option), inputName: this.inputName(), onChange: this.tt.onOptionChecked, option: option }, option[1])), errors.length > 0 &&
                    _jsx(InvalidFeedback, { errors: errors })] }));
    }
    inputDefaultValue() {
        const { attribute, defaultValue, model } = this.props;
        if (defaultValue) {
            return defaultValue;
        }
        else if (attribute && model) {
            if (!model[attribute])
                throw `No such attribute: ${attribute}`;
            return this.props.model[attribute]();
        }
    }
    inputName() {
        if (this.props.name) {
            return `${this.props.name}[]`;
        }
        else if (this.props.model) {
            return `${this.props.model.modelClassData().paramKey}[${inflection.underscore(this.props.attribute)}]`;
        }
    }
    isChecked = (option) => this.s.checkedOptions.includes(option[1]);
    onOptionChecked = ({ checked, option }) => {
        const { inputProps, form } = this.tt;
        const { name } = inputProps;
        let newOptions;
        if (checked) {
            newOptions = this.s.checkedOptions.concat([option[1]]);
            this.setState({ checkedOptions: newOptions });
        }
        else {
            newOptions = this.s.checkedOptions.filter((value) => value != option[1]);
            this.setState({ checkedOptions: newOptions });
        }
        if (this.props.onChange) {
            this.p.onChange({ checked, option });
        }
        if (form && name) {
            form.setValue(name, newOptions);
        }
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hlY2tib3hlcy5qcyIsInNvdXJjZVJvb3QiOiIvc3JjLyIsInNvdXJjZXMiOlsidXRpbHMvY2hlY2tib3hlcy5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLHVHQUF1RztBQUN2RyxPQUFPLEVBQUMsY0FBYyxFQUFFLGNBQWMsRUFBQyxNQUFNLDRDQUE0QyxDQUFBO0FBQ3pGLE9BQU8sS0FBSyxFQUFFLEVBQUMsT0FBTyxFQUFDLE1BQU0sT0FBTyxDQUFBO0FBQ3BDLE9BQU8sUUFBUSxNQUFNLFlBQVksQ0FBQTtBQUNqQyxPQUFPLEVBQUMsSUFBSSxFQUFDLE1BQU0sV0FBVyxDQUFBO0FBQzlCLE9BQU8sRUFBQyxPQUFPLEVBQUMsTUFBTSxTQUFTLENBQUE7QUFDL0IsT0FBTyxLQUFLLFVBQVUsTUFBTSxZQUFZLENBQUE7QUFDeEMsT0FBTyxlQUFlLE1BQU0sb0JBQW9CLENBQUE7QUFDaEQsT0FBTyxJQUFJLE1BQU0saUNBQWlDLENBQUE7QUFDbEQsT0FBTyxTQUFTLE1BQU0sWUFBWSxDQUFBO0FBQ2xDLE9BQU8sY0FBYyxNQUFNLGtCQUFrQixDQUFBO0FBQzdDLE9BQU8sSUFBSSxNQUFNLFFBQVEsQ0FBQTtBQUN6QixPQUFPLFFBQVEsTUFBTSxpQkFBaUIsQ0FBQTtBQUN0QyxPQUFPLEVBQUMsSUFBSSxFQUFDLE1BQU0sY0FBYyxDQUFBO0FBRWpDLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxhQUFjLFNBQVEsY0FBYztJQUNsRixNQUFNLENBQUMsU0FBUyxHQUFHLGNBQWMsQ0FBQztRQUNoQyxPQUFPLEVBQUUsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVO1FBQ2xDLFNBQVMsRUFBRSxTQUFTLENBQUMsTUFBTSxDQUFDLFVBQVU7UUFDdEMsUUFBUSxFQUFFLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVTtRQUNuQyxNQUFNLEVBQUUsU0FBUyxDQUFDLEtBQUssQ0FBQyxVQUFVO0tBQ25DLENBQUMsQ0FBQTtJQUVGLE1B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LFVBQVUsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO1lBRXRELElBQUksQ0FBQyxRQUFRLENBQUMsRUFBQyxjQUFjLEVBQUUsVUFBVSxFQUFDLENBQUMsQ0FBQTtRQUM3QyxDQUFDO2FBQU0sQ0FBQztZQUNOLFVBQVUsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLEtBQUssSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtZQUV4RSxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUMsY0FBYyxFQUFFLFVBQVUsRUFBQyxDQUFDLENBQUE7UUFDN0MsQ0FBQztRQUVELElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUN4QixJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUMsQ0FBQyxDQUFBO1FBQ3BDLENBQUM7UUFFRCxJQUFJLElBQUksSUFBSSxJQUFJLEVBQUUsQ0FBQztZQUNqQixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxVQUFVLENBQUMsQ0FBQTtRQUNqQyxDQUFDO0lBQ0gsQ0FBQyxDQUFBO0NBQ0YsQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBpbXBsaWNpdC1hcnJvdy1saW5lYnJlYWssIG5ld2xpbmUtcGVyLWNoYWluZWQtY2FsbCwgbm8tdGhyb3ctbGl0ZXJhbCwgc29ydC1pbXBvcnRzICovXG5pbXBvcnQge3NoYXBlQ29tcG9uZW50LCBTaGFwZUNvbXBvbmVudH0gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL3NoYXBlLWNvbXBvbmVudC5qc1wiXG5pbXBvcnQgUmVhY3QsIHt1c2VNZW1vfSBmcm9tIFwicmVhY3RcIlxuaW1wb3J0IENoZWNrYm94IGZyb20gXCIuL2NoZWNrYm94XCJcbmltcG9ydCB7ZGlnc30gZnJvbSBcImRpZ2dlcml6ZVwiXG5pbXBvcnQge3VzZUZvcm19IGZyb20gXCIuLi9mb3JtXCJcbmltcG9ydCAqIGFzIGluZmxlY3Rpb24gZnJvbSBcImluZmxlY3Rpb25cIlxuaW1wb3J0IEludmFsaWRGZWVkYmFjayBmcm9tIFwiLi9pbnZhbGlkLWZlZWRiYWNrXCJcbmltcG9ydCBtZW1vIGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9tZW1vLmpzXCJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIlxuaW1wb3J0IHByb3BUeXBlc0V4YWN0IGZyb20gXCJwcm9wLXR5cGVzLWV4YWN0XCJcbmltcG9ydCBUZXh0IGZyb20gXCIuL3RleHRcIlxuaW1wb3J0IHVzZUlucHV0IGZyb20gXCIuLi91c2UtaW5wdXQuanNcIlxuaW1wb3J0IHtWaWV3fSBmcm9tIFwicmVhY3QtbmF0aXZlXCJcblxuY29uc3QgT3B0aW9uRWxlbWVudCA9IG1lbW8oc2hhcGVDb21wb25lbnQoY2xhc3MgT3B0aW9uRWxlbWVudCBleHRlbmRzIFNoYXBlQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHByb3BUeXBlc0V4YWN0KHtcbiAgICBjaGVja2VkOiBQcm9wVHlwZXMuYm9vbC5pc1JlcXVpcmVkLFxuICAgIGlucHV0TmFtZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIG9uQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIG9wdGlvbjogUHJvcFR5cGVzLmFycmF5LmlzUmVxdWlyZWRcbiAgfSlcblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge2NoZWNrZWQsIGlucHV0TmFtZSwgb3B0aW9ufSA9IHRoaXMucFxuICAgIGNvbnN0IGRhdGFTZXQgPSB1c2VNZW1vKCgpID0+ICh7XG4gICAgICBjb21wb25lbnQ6IFwiYXBpLW1ha2VyL3V0aWxzL2NoZWNrYm94ZXMvb3B0aW9uXCIsXG4gICAgICBuYW1lOiBpbnB1dE5hbWUsXG4gICAgICB2YWx1ZTogb3B0aW9uWzFdXG4gICAgfSksIFtpbnB1dE5hbWUsIG9wdGlvblsxXV0pXG5cbiAgICByZXR1cm4gKFxuICAgICAgPFZpZXcgPlxuICAgICAgICA8Q2hlY2tib3hcbiAgICAgICAgICBjaGVja2VkPXtjaGVja2VkfVxuICAgICAgICAgIGRhdGFTZXQ9e2RhdGFTZXR9XG4gICAgICAgICAgbGFiZWw9e29wdGlvblswXX1cbiAgICAgICAgICBvbkNoZWNrZWRDaGFuZ2U9e3RoaXMudHQub25DaGFuZ2V9XG4gICAgICAgIC8+XG4gICAgICA8L1ZpZXc+XG4gICAgKVxuICB9XG5cbiAgb25DaGFuZ2UgPSAoY2hlY2tlZCkgPT4gdGhpcy5wLm9uQ2hhbmdlKHtjaGVja2VkLCBvcHRpb246IHRoaXMucC5vcHRpb259KVxufSkpXG5cbmV4cG9ydCBkZWZhdWx0IG1lbW8oc2hhcGVDb21wb25lbnQoY2xhc3MgQXBpTWFrZXJVdGlsc0NoZWNrYm94ZXMgZXh0ZW5kcyBTaGFwZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSBwcm9wVHlwZXNFeGFjdCh7XG4gICAgYXR0cmlidXRlOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGRlZmF1bHRWYWx1ZTogUHJvcFR5cGVzLmFycmF5LFxuICAgIGxhYmVsOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGxhYmVsQ2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIG1vZGVsOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIG5hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgb25DaGFuZ2U6IFByb3BUeXBlcy5mdW5jLFxuICAgIG9wdGlvbnM6IFByb3BUeXBlcy5hcnJheS5pc1JlcXVpcmVkXG4gIH0pXG5cbiAgc2V0dXAoKSB7XG4gICAgY29uc3Qge2lucHV0UHJvcHMsIHdyYXBwZXJPcHRzfSA9IHVzZUlucHV0KHtwcm9wczogdGhpcy5wcm9wc30pXG5cbiAgICB0aGlzLmdlbmVyYXRlZElkID0gdXNlTWVtbyhcbiAgICAgICgpID0+IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCAxNSkgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgMTUpLFxuICAgICAgW11cbiAgICApXG5cbiAgICB0aGlzLnNldEluc3RhbmNlKHtcbiAgICAgIGZvcm06IHVzZUZvcm0oKSxcbiAgICAgIGlucHV0UHJvcHMsXG4gICAgICB3cmFwcGVyT3B0c1xuICAgIH0pXG4gICAgdGhpcy51c2VTdGF0ZXMoe1xuICAgICAgY2hlY2tlZE9wdGlvbnM6ICgpID0+IHtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodGhpcy5wcm9wcy5kZWZhdWx0VmFsdWUpKSByZXR1cm4gdGhpcy5wcm9wcy5kZWZhdWx0VmFsdWVcbiAgICAgICAgaWYgKHRoaXMucHJvcHMuZGVmYXVsdFZhbHVlKSByZXR1cm4gW3RoaXMucHJvcHMuZGVmYXVsdFZhbHVlXVxuXG4gICAgICAgIHJldHVybiBbXVxuICAgICAgfVxuICAgIH0pXG5cbiAgICB1c2VNZW1vKCgpID0+IHtcbiAgICAgIGlmICh0aGlzLmZvcm0gJiYgaW5wdXRQcm9wcy5uYW1lKSB7XG4gICAgICAgIHRoaXMuZm9ybS5zZXRWYWx1ZShpbnB1dFByb3BzLm5hbWUsIHRoaXMucy5jaGVja2VkT3B0aW9ucylcbiAgICAgIH1cbiAgICB9LCBbXSlcbiAgfVxuXG4gIHJlbmRlciAoKSB7XG4gICAgY29uc3Qge3dyYXBwZXJPcHRzfSA9IHRoaXMudHRcbiAgICBjb25zdCB7ZXJyb3JzfSA9IGRpZ3Mod3JhcHBlck9wdHMsIFwiZXJyb3JzXCIpXG5cbiAgICByZXR1cm4gKFxuICAgICAgPFZpZXcgZGF0YVNldD17dGhpcy5jYWNoZShcInJvb3RWaWV3RGF0YVNldFwiLCB7Y29tcG9uZW50OiBcImFwaS1tYWtlci91dGlscy9jaGVja2JveGVzXCJ9KX0+XG4gICAgICAgIDxUZXh0IHN0eWxlPXt0aGlzLmNhY2hlKFwidGV4dFN0eWxlXCIsIHtmb250V2VpZ2h0OiBcImJvbGRcIn0pfT5cbiAgICAgICAgICB7dGhpcy50dC53cmFwcGVyT3B0cy5sYWJlbH1cbiAgICAgICAgPC9UZXh0PlxuICAgICAgICB7dGhpcy5wcm9wcy5vcHRpb25zLm1hcCgob3B0aW9uKSA9PlxuICAgICAgICAgIDxPcHRpb25FbGVtZW50XG4gICAgICAgICAgICBjaGVja2VkPXt0aGlzLmlzQ2hlY2tlZChvcHRpb24pfVxuICAgICAgICAgICAgaW5wdXROYW1lPXt0aGlzLmlucHV0TmFtZSgpfVxuICAgICAgICAgICAga2V5PXtvcHRpb25bMV19XG4gICAgICAgICAgICBvbkNoYW5nZT17dGhpcy50dC5vbk9wdGlvbkNoZWNrZWR9XG4gICAgICAgICAgICBvcHRpb249e29wdGlvbn1cbiAgICAgICAgICAvPlxuICAgICAgICApfVxuICAgICAgICB7ZXJyb3JzLmxlbmd0aCA+IDAgJiZcbiAgICAgICAgICA8SW52YWxpZEZlZWRiYWNrIGVycm9ycz17ZXJyb3JzfSAvPlxuICAgICAgICB9XG4gICAgICA8L1ZpZXc+XG4gICAgKVxuICB9XG5cbiAgaW5wdXREZWZhdWx0VmFsdWUgKCkge1xuICAgIGNvbnN0IHthdHRyaWJ1dGUsIGRlZmF1bHRWYWx1ZSwgbW9kZWx9ID0gdGhpcy5wcm9wc1xuXG4gICAgaWYgKGRlZmF1bHRWYWx1ZSkge1xuICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZVxuICAgIH0gZWxzZSBpZiAoYXR0cmlidXRlICYmIG1vZGVsKSB7XG4gICAgICBpZiAoIW1vZGVsW2F0dHJpYnV0ZV0pIHRocm93IGBObyBzdWNoIGF0dHJpYnV0ZTogJHthdHRyaWJ1dGV9YFxuXG4gICAgICByZXR1cm4gdGhpcy5wcm9wcy5tb2RlbFthdHRyaWJ1dGVdKClcbiAgICB9XG4gIH1cblxuICBpbnB1dE5hbWUgKCkge1xuICAgIGlmICh0aGlzLnByb3BzLm5hbWUpIHtcbiAgICAgIHJldHVybiBgJHt0aGlzLnByb3BzLm5hbWV9W11gXG4gICAgfSBlbHNlIGlmICh0aGlzLnByb3BzLm1vZGVsKSB7XG4gICAgICByZXR1cm4gYCR7dGhpcy5wcm9wcy5tb2RlbC5tb2RlbENsYXNzRGF0YSgpLnBhcmFtS2V5fVske2luZmxlY3Rpb24udW5kZXJzY29yZSh0aGlzLnByb3BzLmF0dHJpYnV0ZSl9XWBcbiAgICB9XG4gIH1cblxuICBpc0NoZWNrZWQgPSAob3B0aW9uKSA9PiB0aGlzLnMuY2hlY2tlZE9wdGlvbnMuaW5jbHVkZXMob3B0aW9uWzFdKVxuXG4gIG9uT3B0aW9uQ2hlY2tlZCA9ICh7Y2hlY2tlZCwgb3B0aW9ufSkgPT4ge1xuICAgIGNvbnN0IHtpbnB1dFByb3BzLCBmb3JtfSA9IHRoaXMudHRcbiAgICBjb25zdCB7bmFtZX0gPSBpbnB1dFByb3BzXG4gICAgbGV0IG5ld09wdGlvbnNcblxuICAgIGlmIChjaGVja2VkKSB7XG4gICAgICBuZXdPcHRpb25zID0gdGhpcy5zLmNoZWNrZWRPcHRpb25zLmNvbmNhdChbb3B0aW9uWzFdXSlcblxuICAgICAgdGhpcy5zZXRTdGF0ZSh7Y2hlY2tlZE9wdGlvbnM6IG5ld09wdGlvbnN9KVxuICAgIH0gZWxzZSB7XG4gICAgICBuZXdPcHRpb25zID0gdGhpcy5zLmNoZWNrZWRPcHRpb25zLmZpbHRlcigodmFsdWUpID0+IHZhbHVlICE9IG9wdGlvblsxXSlcblxuICAgICAgdGhpcy5zZXRTdGF0ZSh7Y2hlY2tlZE9wdGlvbnM6IG5ld09wdGlvbnN9KVxuICAgIH1cblxuICAgIGlmICh0aGlzLnByb3BzLm9uQ2hhbmdlKSB7XG4gICAgICB0aGlzLnAub25DaGFuZ2Uoe2NoZWNrZWQsIG9wdGlvbn0pXG4gICAgfVxuXG4gICAgaWYgKGZvcm0gJiYgbmFtZSkge1xuICAgICAgZm9ybS5zZXRWYWx1ZShuYW1lLCBuZXdPcHRpb25zKVxuICAgIH1cbiAgfVxufSkpXG4iXX0=