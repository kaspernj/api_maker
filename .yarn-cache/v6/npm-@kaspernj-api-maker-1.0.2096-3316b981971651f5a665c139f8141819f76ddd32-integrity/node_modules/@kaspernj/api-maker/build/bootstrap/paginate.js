import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
/* eslint-disable no-return-assign */
import React, { useMemo } from "react";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import BaseComponent from "../base-component"; // eslint-disable-line sort-imports
import Link from "../link";
import PropTypes from "prop-types";
import Result from "../result.js";
import Text from "../utils/text";
import instanceOfClassName from "../instance-of-class-name.js";
import memo from "set-state-compare/build/memo.js";
import propTypesExact from "prop-types-exact";
import qs from "qs";
import urlEncode from "../url-encode.js";
const dataSets = {};
const FIRST_PAGE_LABEL = "⇤";
const PREVIOUS_PAGE_LABEL = "←";
const NEXT_PAGE_LABEL = "→";
const LAST_PAGE_LABEL = "⇥";
const ELLIPSIS_LABEL = "…";
export default memo(shapeComponent(class ApiMakerBootstrapPaginate extends BaseComponent {
    static propTypes = propTypesExact({
        result: PropTypes.oneOfType([
            instanceOfClassName("ApiMakerResult"),
            PropTypes.instanceOf(Result)
        ]).isRequired
    });
    setup() {
        const { result } = this.p;
        this.totalPages = useMemo(() => Math.ceil(result.count() / result.perPage()), [result.count(), result.perPage()]);
        this.pages = useMemo(() => this.calculatePages(), [result.currentPage(), this.totalPages]);
    }
    calculatePages() {
        const { result } = this.p;
        const { totalPages } = this.tt;
        const currentPage = result.currentPage();
        const pages = [];
        let pagesFrom = currentPage - 5;
        let pagesTo = currentPage + 5;
        if (pagesFrom < 1) {
            pagesFrom = 1;
        }
        if (pagesTo > totalPages) {
            pagesTo = totalPages;
        }
        for (let i = pagesFrom; i <= pagesTo; i++) {
            pages.push(i);
        }
        return pages;
    }
    isPageActiveClass = (pageNumber) => {
        if (this.p.result.currentPage() == pageNumber) {
            return "active";
        }
        return "not-active";
    };
    pagePath(pageNumber) {
        let pageKey = this.p.result.data.collection.queryArgs.pageKey;
        if (!pageKey) {
            pageKey = "page";
        }
        const currentParams = qs.parse(globalThis.location.search.substr(1));
        currentParams[pageKey] = pageNumber;
        const newParams = qs.stringify(currentParams, { encoder: urlEncode });
        const newPath = `${location.pathname}?${newParams}`;
        return newPath;
    }
    previousPagePath() {
        const { result } = this.p;
        let previousPage;
        if (result.currentPage() > 1) {
            previousPage = result.currentPage() - 1;
        }
        else {
            previousPage = result.currentPage();
        }
        return this.pagePath(previousPage);
    }
    nextPagePath() {
        const { result } = this.p;
        let nextPage;
        if (result.currentPage() < this.tt.totalPages) {
            nextPage = result.currentPage() + 1;
        }
        else {
            nextPage = result.currentPage();
        }
        return this.pagePath(nextPage);
    }
    showBackwardsDots = () => this.p.result.currentPage() - 5 > 1;
    showForwardsDots = () => this.p.result.currentPage() + 5 < this.tt.totalPages;
    render() {
        const { result } = this.p;
        const { pages, totalPages } = this.tt;
        const showNextPage = result.currentPage() < totalPages;
        const showLastPage = result.currentPage() < totalPages;
        const showPreviousPage = result.currentPage() > 1;
        const showFirstPage = result.currentPage() > 1;
        const previousPageDisabled = !showPreviousPage;
        const firstPageDisabled = !showFirstPage;
        const nextPageDisabled = !showNextPage;
        const lastPageDisabled = !showLastPage;
        return (_jsxs("ul", { className: "pagination", "data-pages-length": pages.length, children: [_jsxs("li", { className: `page-item ${previousPageDisabled ? "disabled" : ""}`, children: [previousPageDisabled &&
                            _jsx(Text, { children: FIRST_PAGE_LABEL }), showPreviousPage &&
                            _jsx(Link, { dataSet: dataSets.pageLink ||= { class: "page-link" }, to: this.pagePath(1), children: _jsx(Text, { children: FIRST_PAGE_LABEL }) })] }, "page-first"), _jsxs("li", { className: `page-item ${firstPageDisabled ? "disabled" : ""}`, children: [firstPageDisabled &&
                            _jsx(Text, { children: PREVIOUS_PAGE_LABEL }), showFirstPage &&
                            _jsx(Link, { dataSet: dataSets.pageLink ||= { class: "page-link" }, to: this.previousPagePath(), children: _jsx(Text, { children: PREVIOUS_PAGE_LABEL }) })] }, "page-previous"), this.showBackwardsDots() &&
                    _jsx("li", { className: "page-item disabled", children: _jsx(Text, { children: ELLIPSIS_LABEL }) }), pages.map((page) => ( // eslint-disable-line no-extra-parens
                _jsxs("li", { className: `page-item ${this.isPageActiveClass(page)}`, "data-active": this.isPageActiveClass(page) == "active", "data-page": page, children: [this.isPageActiveClass(page) == "active" &&
                            _jsx(Text, { children: page }), this.isPageActiveClass(page) == "not-active" &&
                            _jsx(Link, { dataSet: dataSets.pageLink ||= { class: "page-link" }, to: this.pagePath(page), children: _jsx(Text, { children: page }) })] }, `page-${page}`))), this.showForwardsDots() &&
                    _jsx("li", { className: "page-item disabled", children: _jsx(Text, { children: ELLIPSIS_LABEL }) }), _jsxs("li", { className: `page-item ${nextPageDisabled ? "disabled" : ""}`, children: [nextPageDisabled &&
                            _jsx(Text, { children: NEXT_PAGE_LABEL }), showNextPage &&
                            _jsx(Link, { dataSet: dataSets.pageLink ||= { class: "page-link" }, to: this.nextPagePath(), children: _jsx(Text, { children: NEXT_PAGE_LABEL }) })] }, "page-next"), _jsxs("li", { className: `page-item ${lastPageDisabled ? "disabled" : ""}`, children: [lastPageDisabled &&
                            _jsx(Text, { children: LAST_PAGE_LABEL }), showLastPage &&
                            _jsx(Link, { dataSet: dataSets.pageLink ||= { class: "page-link" }, to: this.pagePath(totalPages), children: _jsx(Text, { children: LAST_PAGE_LABEL }) })] }, "page-last")] }));
    }
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnaW5hdGUuanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbImJvb3RzdHJhcC9wYWdpbmF0ZS5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLHFDQUFxQztBQUNyQyxPQUFPLEtBQUssRUFBRSxFQUFDLE9BQU8sRUFBQyxNQUFNLE9BQU8sQ0FBQTtBQUNwQyxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sNENBQTRDLENBQUE7QUFDekUsT0FBTyxhQUFhLE1BQU0sbUJBQW1CLENBQUEsQ0FBQyxtQ0FBbUM7QUFDakYsT0FBTyxJQUFJLE1BQU0sU0FBUyxDQUFBO0FBQzFCLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQTtBQUNsQyxPQUFPLE1BQU0sTUFBTSxjQUFjLENBQUE7QUFDakMsT0FBTyxJQUFJLE1BQU0sZUFBZSxDQUFBO0FBQ2hDLE9BQU8sbUJBQW1CLE1BQU0sOEJBQThCLENBQUE7QUFDOUQsT0FBTyxJQUFJLE1BQU0saUNBQWlDLENBQUE7QUFDbEQsT0FBTyxjQUFjLE1BQU0sa0JBQWtCLENBQUE7QUFDN0MsT0FBTyxFQUFFLE1BQU0sSUFBSSxDQUFBO0FBQ25CLE9BQU8sU0FBUyxNQUFNLGtCQUFrQixDQUFBO0FBRXhDLE1BQU0sUUFBUSxHQUFHLEVBQUUsQ0FBQTtBQUVuQixNQUFNLGdCQUFnQixHQUFHLEdBQUcsQ0FBQTtBQUM1QixNQUFNLG1CQUFtQixHQUFHLEdBQUcsQ0FBQTtBQUMvQixNQUFNLGVBQWUsR0FBRyxHQUFHLENBQUE7QUFDM0IsTUFBTSxlQUFlLEdBQUcsR0FBRyxDQUFBO0FBQzNCLE1BQU0sY0FBYyxHQUFHLEdBQUcsQ0FBQTtBQUUxQixlQUFlLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSx5QkFBMEIsU0FBUSxhQUFhO0lBQ3RGLE1BQU0sQ0FBQyxTQUFTLEdBQUcsY0FBYyxDQUFDO1FBQ2hDLE1BQU0sRUFBRSxTQUFTLENBQUMsU0FBUyxDQUFDO1lBQzFCLG1CQUFtQixDQUFDLGdCQUFnQixDQUFD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QUFDLENBQUMsRUFBRSxFQUFFLGFBQzdELGdCQUFnQjs0QkFDZixLQUFDLElBQUksY0FDRixlQUFlLEdBQ1gsRUFFUixZQUFZOzRCQUNYLEtBQUMsSUFBSSxJQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsUUFBUSxLQUFLLEVBQUMsS0FBSyxFQUFFLFdBQVcsRUFBQyxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsWUFBWSxFQUFFLFlBQ2hGLEtBQUMsSUFBSSxjQUNGLGVBQWUsR0FDWCxHQUNGLEtBWDJELFdBQVcsQ0FhNUUsRUFDTCxjQUFJLFNBQVMsRUFBRSxhQUFhLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxhQUM3RCxnQkFBZ0I7NEJBQ2YsS0FBQyxJQUFJLGNBQ0YsZUFBZSxHQUNYLEVBRVIsWUFBWTs0QkFDWCxLQUFDLElBQUksSUFBQyxPQUFPLEVBQUUsUUFBUSxDQUFDLFFBQVEsS0FBSyxFQUFDLEtBQUssRUFBRSxXQUFXLEVBQUMsRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsWUFDdEYsS0FBQyxJQUFJLGNBQ0YsZUFBZSxHQUNYLEdBQ0YsS0FYMkQsV0FBVyxDQWE1RSxJQUNGLENBQ04sQ0FBQTtJQUNILENBQUM7Q0FDRixDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIG5vLXJldHVybi1hc3NpZ24gKi9cbmltcG9ydCBSZWFjdCwge3VzZU1lbW99IGZyb20gXCJyZWFjdFwiXG5pbXBvcnQge3NoYXBlQ29tcG9uZW50fSBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvc2hhcGUtY29tcG9uZW50LmpzXCJcbmltcG9ydCBCYXNlQ29tcG9uZW50IGZyb20gXCIuLi9iYXNlLWNvbXBvbmVudFwiIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgc29ydC1pbXBvcnRzXG5pbXBvcnQgTGluayBmcm9tIFwiLi4vbGlua1wiXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gXCJwcm9wLXR5cGVzXCJcbmltcG9ydCBSZXN1bHQgZnJvbSBcIi4uL3Jlc3VsdC5qc1wiXG5pbXBvcnQgVGV4dCBmcm9tIFwiLi4vdXRpbHMvdGV4dFwiXG5pbXBvcnQgaW5zdGFuY2VPZkNsYXNzTmFtZSBmcm9tIFwiLi4vaW5zdGFuY2Utb2YtY2xhc3MtbmFtZS5qc1wiXG5pbXBvcnQgbWVtbyBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvbWVtby5qc1wiXG5pbXBvcnQgcHJvcFR5cGVzRXhhY3QgZnJvbSBcInByb3AtdHlwZXMtZXhhY3RcIlxuaW1wb3J0IHFzIGZyb20gXCJxc1wiXG5pbXBvcnQgdXJsRW5jb2RlIGZyb20gXCIuLi91cmwtZW5jb2RlLmpzXCJcblxuY29uc3QgZGF0YVNldHMgPSB7fVxuXG5jb25zdCBGSVJTVF9QQUdFX0xBQkVMID0gXCLih6RcIlxuY29uc3QgUFJFVklPVVNfUEFHRV9MQUJFTCA9IFwi4oaQXCJcbmNvbnN0IE5FWFRfUEFHRV9MQUJFTCA9IFwi4oaSXCJcbmNvbnN0IExBU1RfUEFHRV9MQUJFTCA9IFwi4oelXCJcbmNvbnN0IEVMTElQU0lTX0xBQkVMID0gXCLigKZcIlxuXG5leHBvcnQgZGVmYXVsdCBtZW1vKHNoYXBlQ29tcG9uZW50KGNsYXNzIEFwaU1ha2VyQm9vdHN0cmFwUGFnaW5hdGUgZXh0ZW5kcyBCYXNlQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHByb3BUeXBlc0V4YWN0KHtcbiAgICByZXN1bHQ6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgICAgaW5zdGFuY2VPZkNsYXNzTmFtZShcIkFwaU1ha2VyUmVzdWx0XCIpLFxuICAgICAgUHJvcFR5cGVzLmluc3RhbmNlT2YoUmVzdWx0KVxuICAgIF0pLmlzUmVxdWlyZWRcbiAgfSlcblxuICBzZXR1cCgpIHtcbiAgICBjb25zdCB7cmVzdWx0fSA9IHRoaXMucFxuXG4gICAgdGhpcy50b3RhbFBhZ2VzID0gdXNlTWVtbyhcbiAgICAgICgpID0+IE1hdGguY2VpbChyZXN1bHQuY291bnQoKSAvIHJlc3VsdC5wZXJQYWdlKCkpLFxuICAgICAgW3Jlc3VsdC5jb3VudCgpLCByZXN1bHQucGVyUGFnZSgpXVxuICAgIClcbiAgICB0aGlzLnBhZ2VzID0gdXNlTWVtbyhcbiAgICAgICgpID0+IHRoaXMuY2FsY3VsYXRlUGFnZXMoKSxcbiAgICAgIFtyZXN1bHQuY3VycmVudFBhZ2UoKSwgdGhpcy50b3RhbFBhZ2VzXVxuICAgIClcbiAgfVxuXG4gIGNhbGN1bGF0ZVBhZ2VzICgpIHtcbiAgICBjb25zdCB7cmVzdWx0fSA9IHRoaXMucFxuICAgIGNvbnN0IHt0b3RhbFBhZ2VzfSA9IHRoaXMudHRcbiAgICBjb25zdCBjdXJyZW50UGFnZSA9IHJlc3VsdC5jdXJyZW50UGFnZSgpXG4gICAgY29uc3QgcGFnZXMgPSBbXVxuXG4gICAgbGV0IHBhZ2VzRnJvbSA9IGN1cnJlbnRQYWdlIC0gNVxuICAgIGxldCBwYWdlc1RvID0gY3VycmVudFBhZ2UgKyA1XG5cbiAgICBpZiAocGFnZXNGcm9tIDwgMSkge1xuICAgICAgcGFnZXNGcm9tID0gMVxuICAgIH1cblxuICAgIGlmIChwYWdlc1RvID4gdG90YWxQYWdlcykge1xuICAgICAgcGFnZXNUbyA9IHRvdGFsUGFnZXNcbiAgICB9XG5cbiAgICBmb3IgKGxldCBpID0gcGFnZXNGcm9tOyBpIDw9IHBhZ2VzVG87IGkrKykge1xuICAgICAgcGFnZXMucHVzaChpKVxuICAgIH1cblxuICAgIHJldHVybiBwYWdlc1xuICB9XG5cbiAgaXNQYWdlQWN0aXZlQ2xhc3MgPSAocGFnZU51bWJlcikgPT4ge1xuICAgIGlmICh0aGlzLnAucmVzdWx0LmN1cnJlbnRQYWdlKCkgPT0gcGFnZU51bWJlcikge1xuICAgICAgcmV0dXJuIFwiYWN0aXZlXCJcbiAgICB9XG5cbiAgICByZXR1cm4gXCJub3QtYWN0aXZlXCJcbiAgfVxuXG4gIHBhZ2VQYXRoIChwYWdlTnVtYmVyKSB7XG4gICAgbGV0IHBhZ2VLZXkgPSB0aGlzLnAucmVzdWx0LmRhdGEuY29sbGVjdGlvbi5xdWVyeUFyZ3MucGFnZUtleVxuXG4gICAgaWYgKCFwYWdlS2V5KSB7XG4gICAgICBwYWdlS2V5ID0gXCJwYWdlXCJcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50UGFyYW1zID0gcXMucGFyc2UoZ2xvYmFsVGhpcy5sb2NhdGlvbi5zZWFyY2guc3Vic3RyKDEpKVxuICAgIGN1cnJlbnRQYXJhbXNbcGFnZUtleV0gPSBwYWdlTnVtYmVyXG4gICAgY29uc3QgbmV3UGFyYW1zID0gcXMuc3RyaW5naWZ5KGN1cnJlbnRQYXJhbXMsIHtlbmNvZGVyOiB1cmxFbmNvZGV9KVxuICAgIGNvbnN0IG5ld1BhdGggPSBgJHtsb2NhdGlvbi5wYXRobmFtZX0/JHtuZXdQYXJhbXN9YFxuXG4gICAgcmV0dXJuIG5ld1BhdGhcbiAgfVxuXG4gIHByZXZpb3VzUGFnZVBhdGggKCkge1xuICAgIGNvbnN0IHtyZXN1bHR9ID0gdGhpcy5wXG4gICAgbGV0IHByZXZpb3VzUGFnZVxuXG4gICAgaWYgKHJlc3VsdC5jdXJyZW50UGFnZSgpID4gMSkge1xuICAgICAgcHJldmlvdXNQYWdlID0gcmVzdWx0LmN1cnJlbnRQYWdlKCkgLSAxXG4gICAgfSBlbHNlIHtcbiAgICAgIHByZXZpb3VzUGFnZSA9IHJlc3VsdC5jdXJyZW50UGFnZSgpXG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMucGFnZVBhdGgocHJldmlvdXNQYWdlKVxuICB9XG5cbiAgbmV4dFBhZ2VQYXRoICgpIHtcbiAgICBjb25zdCB7cmVzdWx0fSA9IHRoaXMucFxuICAgIGxldCBuZXh0UGFnZVxuXG4gICAgaWYgKHJlc3VsdC5jdXJyZW50UGFnZSgpIDwgdGhpcy50dC50b3RhbFBhZ2VzKSB7XG4gICAgICBuZXh0UGFnZSA9IHJlc3VsdC5jdXJyZW50UGFnZSgpICsgMVxuICAgIH0gZWxzZSB7XG4gICAgICBuZXh0UGFnZSA9IHJlc3VsdC5jdXJyZW50UGFnZSgpXG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMucGFnZVBhdGgobmV4dFBhZ2UpXG4gIH1cblxuICBzaG93QmFja3dhcmRzRG90cyA9ICgpID0+IHRoaXMucC5yZXN1bHQuY3VycmVudFBhZ2UoKSAtIDUgPiAxXG4gIHNob3dGb3J3YXJkc0RvdHMgPSAoKSA9PiB0aGlzLnAucmVzdWx0LmN1cnJlbnRQYWdlKCkgKyA1IDwgdGhpcy50dC50b3RhbFBhZ2VzXG5cbiAgcmVuZGVyICgpIHtcbiAgICBjb25zdCB7cmVzdWx0fSA9IHRoaXMucFxuICAgIGNvbnN0IHtwYWdlcywgdG90YWxQYWdlc30gPSB0aGlzLnR0XG4gICAgY29uc3Qgc2hvd05leHRQYWdlID0gcmVzdWx0LmN1cnJlbnRQYWdlKCkgPCB0b3RhbFBhZ2VzXG4gICAgY29uc3Qgc2hvd0xhc3RQYWdlID0gcmVzdWx0LmN1cnJlbnRQYWdlKCkgPCB0b3RhbFBhZ2VzXG4gICAgY29uc3Qgc2hvd1ByZXZpb3VzUGFnZSA9IHJlc3VsdC5jdXJyZW50UGFnZSgpID4gMVxuICAgIGNvbnN0IHNob3dGaXJzdFBhZ2UgPSByZXN1bHQuY3VycmVudFBhZ2UoKSA+IDFcblxuICAgIGNvbnN0IHByZXZpb3VzUGFnZURpc2FibGVkID0gIXNob3dQcmV2aW91c1BhZ2VcbiAgICBjb25zdCBmaXJzdFBhZ2VEaXNhYmxlZCA9ICFzaG93Rmlyc3RQYWdlXG4gICAgY29uc3QgbmV4dFBhZ2VEaXNhYmxlZCA9ICFzaG93TmV4dFBhZ2VcbiAgICBjb25zdCBsYXN0UGFnZURpc2FibGVkID0gIXNob3dMYXN0UGFnZVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDx1bCBjbGFzc05hbWU9XCJwYWdpbmF0aW9uXCIgZGF0YS1wYWdlcy1sZW5ndGg9e3BhZ2VzLmxlbmd0aH0+XG4gICAgICAgIDxsaSBjbGFzc05hbWU9e2BwYWdlLWl0ZW0gJHtwcmV2aW91c1BhZ2VEaXNhYmxlZCA/IFwiZGlzYWJsZWRcIiA6IFwiXCJ9YH0ga2V5PVwicGFnZS1maXJzdFwiPlxuICAgICAgICAgIHtwcmV2aW91c1BhZ2VEaXNhYmxlZCAmJlxuICAgICAgICAgICAgPFRleHQ+XG4gICAgICAgICAgICAgIHtGSVJTVF9QQUdFX0xBQkVMfVxuICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgIH1cbiAgICAgICAgICB7c2hvd1ByZXZpb3VzUGFnZSAmJlxuICAgICAgICAgICAgPExpbmsgZGF0YVNldD17ZGF0YVNldHMucGFnZUxpbmsgfHw9IHtjbGFzczogXCJwYWdlLWxpbmtcIn19IHRvPXt0aGlzLnBhZ2VQYXRoKDEpfT5cbiAgICAgICAgICAgICAgPFRleHQ+XG4gICAgICAgICAgICAgICAge0ZJUlNUX1BBR0VfTEFCRUx9XG4gICAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICAgIDwvTGluaz5cbiAgICAgICAgICB9XG4gICAgICAgIDwvbGk+XG4gICAgICAgIDxsaSBjbGFzc05hbWU9e2BwYWdlLWl0ZW0gJHtmaXJzdFBhZ2VEaXNhYmxlZCA/IFwiZGlzYWJsZWRcIiA6IFwiXCJ9YH0ga2V5PVwicGFnZS1wcmV2aW91c1wiPlxuICAgICAgICAgIHtmaXJzdFBhZ2VEaXNhYmxlZCAmJlxuICAgICAgICAgICAgPFRleHQ+XG4gICAgICAgICAgICAgIHtQUkVWSU9VU19QQUdFX0xBQkVMfVxuICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgIH1cbiAgICAgICAgICB7c2hvd0ZpcnN0UGFnZSAmJlxuICAgICAgICAgICAgPExpbmsgZGF0YVNldD17ZGF0YVNldHMucGFnZUxpbmsgfHw9IHtjbGFzczogXCJwYWdlLWxpbmtcIn19IHRvPXt0aGlzLnByZXZpb3VzUGFnZVBhdGgoKX0+XG4gICAgICAgICAgICAgIDxUZXh0PlxuICAgICAgICAgICAgICAgIHtQUkVWSU9VU19QQUdFX0xBQkVMfVxuICAgICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgICA8L0xpbms+XG4gICAgICAgICAgfVxuICAgICAgICA8L2xpPlxuICAgICAgICB7dGhpcy5zaG93QmFja3dhcmRzRG90cygpICYmXG4gICAgICAgICAgPGxpIGNsYXNzTmFtZT1cInBhZ2UtaXRlbSBkaXNhYmxlZFwiPlxuICAgICAgICAgICAgPFRleHQ+XG4gICAgICAgICAgICAgIHtFTExJUFNJU19MQUJFTH1cbiAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICA8L2xpPlxuICAgICAgICB9XG4gICAgICAgIHtwYWdlcy5tYXAoKHBhZ2UpID0+ICggLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1leHRyYS1wYXJlbnNcbiAgICAgICAgICA8bGlcbiAgICAgICAgICAgIGNsYXNzTmFtZT17YHBhZ2UtaXRlbSAke3RoaXMuaXNQYWdlQWN0aXZlQ2xhc3MocGFnZSl9YH1cbiAgICAgICAgICAgIGRhdGEtYWN0aXZlPXt0aGlzLmlzUGFnZUFjdGl2ZUNsYXNzKHBhZ2UpID09IFwiYWN0aXZlXCJ9XG4gICAgICAgICAgICBkYXRhLXBhZ2U9e3BhZ2V9XG4gICAgICAgICAgICBrZXk9e2BwYWdlLSR7cGFnZX1gfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHt0aGlzLmlzUGFnZUFjdGl2ZUNsYXNzKHBhZ2UpID09IFwiYWN0aXZlXCIgJiZcbiAgICAgICAgICAgICAgPFRleHQ+XG4gICAgICAgICAgICAgICAge3BhZ2V9XG4gICAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHt0aGlzLmlzUGFnZUFjdGl2ZUNsYXNzKHBhZ2UpID09IFwibm90LWFjdGl2ZVwiICYmXG4gICAgICAgICAgICAgIDxMaW5rIGRhdGFTZXQ9e2RhdGFTZXRzLnBhZ2VMaW5rIHx8PSB7Y2xhc3M6IFwicGFnZS1saW5rXCJ9fSB0bz17dGhpcy5wYWdlUGF0aChwYWdlKX0+XG4gICAgICAgICAgICAgICAgPFRleHQ+XG4gICAgICAgICAgICAgICAgICB7cGFnZX1cbiAgICAgICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgICAgIDwvTGluaz5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICA8L2xpPlxuICAgICAgICApKX1cbiAgICAgICAge3RoaXMuc2hvd0ZvcndhcmRzRG90cygpICYmXG4gICAgICAgICAgPGxpIGNsYXNzTmFtZT1cInBhZ2UtaXRlbSBkaXNhYmxlZFwiPlxuICAgICAgICAgICAgPFRleHQ+XG4gICAgICAgICAgICAgIHtFTExJUFNJU19MQUJFTH1cbiAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICA8L2xpPlxuICAgICAgICB9XG4gICAgICAgIDxsaSBjbGFzc05hbWU9e2BwYWdlLWl0ZW0gJHtuZXh0UGFnZURpc2FibGVkID8gXCJkaXNhYmxlZFwiIDogXCJcIn1gfSBrZXk9XCJwYWdlLW5leHRcIj5cbiAgICAgICAgICB7bmV4dFBhZ2VEaXNhYmxlZCAmJlxuICAgICAgICAgICAgPFRleHQ+XG4gICAgICAgICAgICAgIHtORVhUX1BBR0VfTEFCRUx9XG4gICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgfVxuICAgICAgICAgIHtzaG93TmV4dFBhZ2UgJiZcbiAgICAgICAgICAgIDxMaW5rIGRhdGFTZXQ9e2RhdGFTZXRzLnBhZ2VMaW5rIHx8PSB7Y2xhc3M6IFwicGFnZS1saW5rXCJ9fSB0bz17dGhpcy5uZXh0UGFnZVBhdGgoKX0+XG4gICAgICAgICAgICAgIDxUZXh0PlxuICAgICAgICAgICAgICAgIHtORVhUX1BBR0VfTEFCRUx9XG4gICAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICAgIDwvTGluaz5cbiAgICAgICAgICB9XG4gICAgICAgIDwvbGk+XG4gICAgICAgIDxsaSBjbGFzc05hbWU9e2BwYWdlLWl0ZW0gJHtsYXN0UGFnZURpc2FibGVkID8gXCJkaXNhYmxlZFwiIDogXCJcIn1gfSBrZXk9XCJwYWdlLWxhc3RcIj5cbiAgICAgICAgICB7bGFzdFBhZ2VEaXNhYmxlZCAmJlxuICAgICAgICAgICAgPFRleHQ+XG4gICAgICAgICAgICAgIHtMQVNUX1BBR0VfTEFCRUx9XG4gICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgfVxuICAgICAgICAgIHtzaG93TGFzdFBhZ2UgJiZcbiAgICAgICAgICAgIDxMaW5rIGRhdGFTZXQ9e2RhdGFTZXRzLnBhZ2VMaW5rIHx8PSB7Y2xhc3M6IFwicGFnZS1saW5rXCJ9fSB0bz17dGhpcy5wYWdlUGF0aCh0b3RhbFBhZ2VzKX0+XG4gICAgICAgICAgICAgIDxUZXh0PlxuICAgICAgICAgICAgICAgIHtMQVNUX1BBR0VfTEFCRUx9XG4gICAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICAgIDwvTGluaz5cbiAgICAgICAgICB9XG4gICAgICAgIDwvbGk+XG4gICAgICA8L3VsPlxuICAgIClcbiAgfVxufSkpXG4iXX0=