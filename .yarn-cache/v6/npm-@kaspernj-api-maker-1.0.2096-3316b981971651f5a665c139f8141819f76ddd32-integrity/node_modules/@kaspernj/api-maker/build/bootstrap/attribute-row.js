import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
/* eslint-disable no-return-assign */
import * as inflection from "inflection";
import React, { useMemo } from "react";
import { ShapeComponent, shapeComponent } from "set-state-compare/build/shape-component.js";
import { View } from "react-native";
import { digg } from "diggerize";
import MoneyFormatter from "../money-formatter.js"; // eslint-disable-line sort-imports
import PropTypes from "prop-types";
import Text from "../utils/text";
import memo from "set-state-compare/build/memo.js";
import strftime from "strftime";
import useI18n from "i18n-on-steroids/src/use-i18n.mjs";
const dataSets = {};
export default memo(shapeComponent(class ApiMakerBootstrapAttributeRow extends ShapeComponent {
    static defaultProps = {
        checkIfAttributeLoaded: false
    };
    static propTypes = {
        attribute: PropTypes.string,
        checkIfAttributeLoaded: PropTypes.bool.isRequired,
        children: PropTypes.any,
        identifier: PropTypes.string,
        label: PropTypes.oneOfType([PropTypes.any, PropTypes.string]),
        model: PropTypes.object,
        value: PropTypes.any
    };
    setup() {
        const { l, t } = useI18n({ namespace: "js.api_maker.attribute_row" });
        this.l = l;
        this.t = t;
        this.attribute = useMemo(() => {
            if (this.props.attribute) {
                return this.props.model?.constructor?.attributes()?.find((attribute) => attribute.name() == inflection.underscore(this.props.attribute));
            }
        }, [this.props.attribute, this.props.model]);
    }
    render() {
        const { attribute, checkIfAttributeLoaded, children, className, identifier, label, model, style, value, ...restProps } = this.props;
        const actualStyle = {
            paddingVertical: 8,
            ...style
        };
        return (_jsxs(View, { dataSet: dataSets[`attributeRow-${attribute}-${className}-${identifier}`] ||= {
                attribute,
                class: className,
                component: "api-maker/attribute-row",
                identifier
            }, style: actualStyle, ...restProps, children: [_jsx(Text, { dataSet: this.cache("labelTextDataSet", { class: "attribute-row-label" }), style: this.cache("labelTextStyle", { fontWeight: "bold" }), children: this.label() }), _jsx(View, { dataSet: this.cache("valueViewDataSet", { class: "attribute-row-value" }), style: this.cache("valueViewStyle", { marginTop: 3 }), children: this.value() })] }));
    }
    label() {
        const { attribute, label, model } = this.props;
        if ("label" in this.props)
            return label;
        if (attribute && model)
            return model.constructor.humanAttributeName(attribute);
        throw new Error("Couldn't figure out label");
    }
    value() {
        const { attribute, checkIfAttributeLoaded, children, model } = this.props;
        if (children)
            return children;
        if (attribute && !(attribute in model))
            throw new Error(`Attribute not found: ${digg(model.modelClassData(), "name")}#${attribute}`);
        if (attribute && checkIfAttributeLoaded && !model.isAttributeLoaded(attribute))
            return null;
        if (attribute && model) {
            const value = model[attribute]();
            return this.valueContent(value);
        }
    }
    valueContent(value) {
        const { l, t } = this.tt;
        const columnType = this.attribute?.getColumn()?.getType();
        if (columnType == "date") {
            return (_jsx(Text, { children: l("date.formats.default", value) }));
        }
        else if (value instanceof Date) {
            return (_jsx(Text, { children: strftime("%Y-%m-%d %H:%M", value) }));
        }
        else if (typeof value === "boolean") {
            if (value) {
                return (_jsx(Text, { children: t("js.shared.yes", { defaultValue: "Yes" }) }));
            }
            return (_jsx(Text, { children: t("js.shared.no", { defaultValue: "No" }) }));
        }
        else if (MoneyFormatter.isMoney(value)) {
            return (_jsx(Text, { children: MoneyFormatter.format(value) }));
        }
        else if (typeof value == "string") {
            return (_jsx(Text, { children: value }));
        }
        else {
            return value;
        }
    }
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXR0cmlidXRlLXJvdy5qcyIsInNvdXJjZVJvb3QiOiIvc3JjLyIsInNvdXJjZXMiOlsiYm9vdHN0cmFwL2F0dHJpYnV0ZS1yb3cuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxxQ0FBcUM7QUFDckMsT0FBTyxLQUFLLFVBQVUsTUFBTSxZQUFZLENBQUE7QUFDeEMsT0FBTyxLQUFLLEVBQUUsRUFBQyxPQUFPLEVBQUMsTUFBTSxPQUFPLENBQUE7QUFDcEMsT0FBTyxFQUFDLGNBQWMsRUFBRSxjQUFjLEVBQUMsTUFBTSw0Q0FBNEMsQ0FBQTtBQUN6RixPQUFPLEVBQUMsSUFBSSxFQUFDLE1BQU0sY0FBYyxDQUFBO0FBQ2pDLE9BQU8sRUFBQyxJQUFJLEVBQUMsTUFBTSxXQUFXLENBQUE7QUFDOUIsT0FBTyxjQUFjLE1BQU0sdUJBQXVCLENBQUEsQ0FBQyxtQ0FBbUM7QUFDdEYsT0FBTyxTQUFTLE1BQU0sWUFBWSxDQUFBO0FBQ2xDLE9BQU8sSUFBSSxNQUFNLGVBQWUsQ0FBQTtBQUNoQyxPQUFPLElBQUksTUFBTSxpQ0FBaUMsQ0FBQTtBQUNsRCxPQUFPLFFBQVEsTUFBTSxVQUFVLENBQUE7QUFDL0IsT0FBTyxPQUFPLE1BQU0sbUNBQW1DLENBQUE7QUFFdkQsTUFBTSxRQUFRLEdBQUcsRUFBRSxDQUFBO0FBRW5CLGVBQWUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLDZCQUE4QixTQUFRLGNBQWM7SUFDM0YsTUFBTSxDQUFDLFlBQVksR0FBRztRQUNwQixzQkFBc0IsRUFBRSxLQUFLO0tBQzlCLENBQUE7SUFFRCxNQUFNLENBQUMsU0FBUyxHQUFHO1FBQ2pCLFNBQVMsRUFBRSxTQUFTLENBQUMsTUFBTTtRQUMzQixzQkFBc0IsRUFBRSxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVU7UUFDakQsUUFBUSxFQUFFLFNBQVMsQ0FBQyxHQUFHO1FBQ3ZCLFVBQVUsRUFBRSxTQUFTLENBQUMsTUFBTTtRQUM1QixLQUFLLEVBQUUsU0FBUyxDQUFDLFNBQVMs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RUFBRSxLQUFLLENBQUMsR0FDN0IsQ0FDUixDQUFBO1FBQ0gsQ0FBQzthQUFNLElBQUksT0FBTyxLQUFLLEtBQUssU0FBUyxFQUFFLENBQUM7WUFDdEMsSUFBSSxLQUFLLEVBQUUsQ0FBQztnQkFDVixPQUFPLENBQ0wsS0FBQyxJQUFJLGNBQ0YsQ0FBQyxDQUFDLGVBQWUsRUFBRSxFQUFDLFlBQVksRUFBRSxLQUFLLEVBQUMsQ0FBQyxHQUNyQyxDQUNSLENBQUE7WUFDSCxDQUFDO1lBRUQsT0FBTyxDQUNMLEtBQUMsSUFBSSxjQUNGLENBQUMsQ0FBQyxjQUFjLEVBQUUsRUFBQyxZQUFZLEVBQUUsSUFBSSxFQUFDLENBQUMsR0FDbkMsQ0FDUixDQUFBO1FBQ0gsQ0FBQzthQUFNLElBQUksY0FBYyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ3pDLE9BQU8sQ0FDTCxLQUFDLElBQUksY0FDRixjQUFjLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUN4QixDQUNSLENBQUE7UUFDSCxDQUFDO2FBQU0sSUFBSSxPQUFPLEtBQUssSUFBSSxRQUFRLEVBQUUsQ0FBQztZQUNwQyxPQUFPLENBQ0wsS0FBQyxJQUFJLGNBQ0YsS0FBSyxHQUNELENBQ1IsQ0FBQTtRQUNILENBQUM7YUFBTSxDQUFDO1lBQ04sT0FBTyxLQUFLLENBQUE7UUFDZCxDQUFDO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgbm8tcmV0dXJuLWFzc2lnbiAqL1xuaW1wb3J0ICogYXMgaW5mbGVjdGlvbiBmcm9tIFwiaW5mbGVjdGlvblwiXG5pbXBvcnQgUmVhY3QsIHt1c2VNZW1vfSBmcm9tIFwicmVhY3RcIlxuaW1wb3J0IHtTaGFwZUNvbXBvbmVudCwgc2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IHtWaWV3fSBmcm9tIFwicmVhY3QtbmF0aXZlXCJcbmltcG9ydCB7ZGlnZ30gZnJvbSBcImRpZ2dlcml6ZVwiXG5pbXBvcnQgTW9uZXlGb3JtYXR0ZXIgZnJvbSBcIi4uL21vbmV5LWZvcm1hdHRlci5qc1wiIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgc29ydC1pbXBvcnRzXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gXCJwcm9wLXR5cGVzXCJcbmltcG9ydCBUZXh0IGZyb20gXCIuLi91dGlscy90ZXh0XCJcbmltcG9ydCBtZW1vIGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9tZW1vLmpzXCJcbmltcG9ydCBzdHJmdGltZSBmcm9tIFwic3RyZnRpbWVcIlxuaW1wb3J0IHVzZUkxOG4gZnJvbSBcImkxOG4tb24tc3Rlcm9pZHMvc3JjL3VzZS1pMThuLm1qc1wiXG5cbmNvbnN0IGRhdGFTZXRzID0ge31cblxuZXhwb3J0IGRlZmF1bHQgbWVtbyhzaGFwZUNvbXBvbmVudChjbGFzcyBBcGlNYWtlckJvb3RzdHJhcEF0dHJpYnV0ZVJvdyBleHRlbmRzIFNoYXBlQ29tcG9uZW50IHtcbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBjaGVja0lmQXR0cmlidXRlTG9hZGVkOiBmYWxzZVxuICB9XG5cbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBhdHRyaWJ1dGU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgY2hlY2tJZkF0dHJpYnV0ZUxvYWRlZDogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCxcbiAgICBjaGlsZHJlbjogUHJvcFR5cGVzLmFueSxcbiAgICBpZGVudGlmaWVyOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGxhYmVsOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMuYW55LCBQcm9wVHlwZXMuc3RyaW5nXSksXG4gICAgbW9kZWw6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgdmFsdWU6IFByb3BUeXBlcy5hbnlcbiAgfVxuXG4gIHNldHVwKCkge1xuICAgIGNvbnN0IHtsLCB0fSA9IHVzZUkxOG4oe25hbWVzcGFjZTogXCJqcy5hcGlfbWFrZXIuYXR0cmlidXRlX3Jvd1wifSlcblxuICAgIHRoaXMubCA9IGxcbiAgICB0aGlzLnQgPSB0XG4gICAgdGhpcy5hdHRyaWJ1dGUgPSB1c2VNZW1vKFxuICAgICAgKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5hdHRyaWJ1dGUpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5wcm9wcy5tb2RlbD8uY29uc3RydWN0b3I/LmF0dHJpYnV0ZXMoKT8uZmluZCgoYXR0cmlidXRlKSA9PiBhdHRyaWJ1dGUubmFtZSgpID09IGluZmxlY3Rpb24udW5kZXJzY29yZSh0aGlzLnByb3BzLmF0dHJpYnV0ZSkpXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBbdGhpcy5wcm9wcy5hdHRyaWJ1dGUsIHRoaXMucHJvcHMubW9kZWxdXG4gICAgKVxuICB9XG5cbiAgcmVuZGVyICgpIHtcbiAgICBjb25zdCB7YXR0cmlidXRlLCBjaGVja0lmQXR0cmlidXRlTG9hZGVkLCBjaGlsZHJlbiwgY2xhc3NOYW1lLCBpZGVudGlmaWVyLCBsYWJlbCwgbW9kZWwsIHN0eWxlLCB2YWx1ZSwgLi4ucmVzdFByb3BzfSA9IHRoaXMucHJvcHNcbiAgICBjb25zdCBhY3R1YWxTdHlsZSA9IHtcbiAgICAgIHBhZGRpbmdWZXJ0aWNhbDogOCxcbiAgICAgIC4uLnN0eWxlXG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxWaWV3XG4gICAgICAgIGRhdGFTZXQ9e2RhdGFTZXRzW2BhdHRyaWJ1dGVSb3ctJHthdHRyaWJ1dGV9LSR7Y2xhc3NOYW1lfS0ke2lkZW50aWZpZXJ9YF0gfHw9IHtcbiAgICAgICAgICBhdHRyaWJ1dGUsXG4gICAgICAgICAgY2xhc3M6IGNsYXNzTmFtZSxcbiAgICAgICAgICBjb21wb25lbnQ6IFwiYXBpLW1ha2VyL2F0dHJpYnV0ZS1yb3dcIixcbiAgICAgICAgICBpZGVudGlmaWVyXG4gICAgICAgIH19XG4gICAgICAgIHN0eWxlPXthY3R1YWxTdHlsZX1cbiAgICAgICAgey4uLnJlc3RQcm9wc31cbiAgICAgID5cbiAgICAgICAgPFRleHQgZGF0YVNldD17dGhpcy5jYWNoZShcImxhYmVsVGV4dERhdGFTZXRcIiwge2NsYXNzOiBcImF0dHJpYnV0ZS1yb3ctbGFiZWxcIn0pfSBzdHlsZT17dGhpcy5jYWNoZShcImxhYmVsVGV4dFN0eWxlXCIsIHtmb250V2VpZ2h0OiBcImJvbGRcIn0pfT5cbiAgICAgICAgICB7dGhpcy5sYWJlbCgpfVxuICAgICAgICA8L1RleHQ+XG4gICAgICAgIDxWaWV3IGRhdGFTZXQ9e3RoaXMuY2FjaGUoXCJ2YWx1ZVZpZXdEYXRhU2V0XCIsIHtjbGFzczogXCJhdHRyaWJ1dGUtcm93LXZhbHVlXCJ9KX0gc3R5bGU9e3RoaXMuY2FjaGUoXCJ2YWx1ZVZpZXdTdHlsZVwiLCB7bWFyZ2luVG9wOiAzfSl9PlxuICAgICAgICAgIHt0aGlzLnZhbHVlKCl9XG4gICAgICAgIDwvVmlldz5cbiAgICAgIDwvVmlldz5cbiAgICApXG4gIH1cblxuICBsYWJlbCgpIHtcbiAgICBjb25zdCB7YXR0cmlidXRlLCBsYWJlbCwgbW9kZWx9ID0gdGhpcy5wcm9wc1xuXG4gICAgaWYgKFwibGFiZWxcIiBpbiB0aGlzLnByb3BzKSByZXR1cm4gbGFiZWxcbiAgICBpZiAoYXR0cmlidXRlICYmIG1vZGVsKSByZXR1cm4gbW9kZWwuY29uc3RydWN0b3IuaHVtYW5BdHRyaWJ1dGVOYW1lKGF0dHJpYnV0ZSlcblxuICAgIHRocm93IG5ldyBFcnJvcihcIkNvdWxkbid0IGZpZ3VyZSBvdXQgbGFiZWxcIilcbiAgfVxuXG4gIHZhbHVlKCkge1xuICAgIGNvbnN0IHthdHRyaWJ1dGUsIGNoZWNrSWZBdHRyaWJ1dGVMb2FkZWQsIGNoaWxkcmVuLCBtb2RlbH0gPSB0aGlzLnByb3BzXG5cbiAgICBpZiAoY2hpbGRyZW4pIHJldHVybiBjaGlsZHJlblxuXG4gICAgaWYgKGF0dHJpYnV0ZSAmJiAhKGF0dHJpYnV0ZSBpbiBtb2RlbCkpXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEF0dHJpYnV0ZSBub3QgZm91bmQ6ICR7ZGlnZyhtb2RlbC5tb2RlbENsYXNzRGF0YSgpLCBcIm5hbWVcIil9IyR7YXR0cmlidXRlfWApXG5cbiAgICBpZiAoYXR0cmlidXRlICYmIGNoZWNrSWZBdHRyaWJ1dGVMb2FkZWQgJiYgIW1vZGVsLmlzQXR0cmlidXRlTG9hZGVkKGF0dHJpYnV0ZSkpXG4gICAgICByZXR1cm4gbnVsbFxuXG4gICAgaWYgKGF0dHJpYnV0ZSAmJiBtb2RlbCkge1xuICAgICAgY29uc3QgdmFsdWUgPSBtb2RlbFthdHRyaWJ1dGVdKClcblxuICAgICAgcmV0dXJuIHRoaXMudmFsdWVDb250ZW50KHZhbHVlKVxuICAgIH1cbiAgfVxuXG4gIHZhbHVlQ29udGVudCh2YWx1ZSkge1xuICAgIGNvbnN0IHtsLCB0fSA9IHRoaXMudHRcbiAgICBjb25zdCBjb2x1bW5UeXBlID0gdGhpcy5hdHRyaWJ1dGU/LmdldENvbHVtbigpPy5nZXRUeXBlKClcblxuICAgIGlmIChjb2x1bW5UeXBlID09IFwiZGF0ZVwiKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8VGV4dD5cbiAgICAgICAgICB7bChcImRhdGUuZm9ybWF0cy5kZWZhdWx0XCIsIHZhbHVlKX1cbiAgICAgICAgPC9UZXh0PlxuICAgICAgKVxuICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8VGV4dD5cbiAgICAgICAgICB7c3RyZnRpbWUoXCIlWS0lbS0lZCAlSDolTVwiLCB2YWx1ZSl9XG4gICAgICAgIDwvVGV4dD5cbiAgICAgIClcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJib29sZWFuXCIpIHtcbiAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIDxUZXh0PlxuICAgICAgICAgICAge3QoXCJqcy5zaGFyZWQueWVzXCIsIHtkZWZhdWx0VmFsdWU6IFwiWWVzXCJ9KX1cbiAgICAgICAgICA8L1RleHQ+XG4gICAgICAgIClcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPFRleHQ+XG4gICAgICAgICAge3QoXCJqcy5zaGFyZWQubm9cIiwge2RlZmF1bHRWYWx1ZTogXCJOb1wifSl9XG4gICAgICAgIDwvVGV4dD5cbiAgICAgIClcbiAgICB9IGVsc2UgaWYgKE1vbmV5Rm9ybWF0dGVyLmlzTW9uZXkodmFsdWUpKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8VGV4dD5cbiAgICAgICAgICB7TW9uZXlGb3JtYXR0ZXIuZm9ybWF0KHZhbHVlKX1cbiAgICAgICAgPC9UZXh0PlxuICAgICAgKVxuICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09IFwic3RyaW5nXCIpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxUZXh0PlxuICAgICAgICAgIHt2YWx1ZX1cbiAgICAgICAgPC9UZXh0PlxuICAgICAgKVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdmFsdWVcbiAgICB9XG4gIH1cbn0pKVxuIl19