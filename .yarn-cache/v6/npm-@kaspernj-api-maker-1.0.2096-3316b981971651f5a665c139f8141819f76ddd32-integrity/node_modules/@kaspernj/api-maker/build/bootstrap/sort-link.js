import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import * as inflection from "inflection";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import BaseComponent from "../base-component"; // eslint-disable-line sort-imports
import Icon from "../utils/icon";
import Link from "../link";
import PropTypes from "prop-types";
import React from "react";
import Text from "../utils/text";
import memo from "set-state-compare/build/memo.js";
import qs from "qs";
import urlEncode from "../url-encode.js";
import useQueryParams from "on-location-changed/build/use-query-params.js";
import useSorting from "../table/use-sorting.js";
export default memo(shapeComponent(class ApiMakerBootstrapSortLink extends BaseComponent {
    static propTypes = {
        attribute: PropTypes.string.isRequired,
        className: PropTypes.string,
        defaultParams: PropTypes.object,
        linkComponent: PropTypes.object,
        onChanged: PropTypes.func,
        query: PropTypes.object.isRequired,
        title: PropTypes.any
    };
    setup() {
        const { attribute, defaultParams, query } = this.props;
        const { qParams, searchKey, sortAttribute, sortMode } = useSorting({ defaultParams, query });
        this.setInstance({
            isSortedByAttribute: sortAttribute == attribute,
            qParams,
            searchKey,
            sortMode
        });
        this.queryParams = useQueryParams();
        this.searchKey = this.p.query.queryArgs.searchKey || "q";
        this.attribute = inflection.underscore(this.p.attribute);
    }
    href() {
        const qParams = { ...this.tt.qParams };
        const { attribute, queryParams, searchKey, sortMode } = this.tt;
        const newQueryParams = { ...queryParams };
        qParams.s = `${attribute} ${sortMode == "asc" ? "desc" : "asc"}`;
        newQueryParams[searchKey] = JSON.stringify(qParams);
        const newParams = qs.stringify(newQueryParams, { encoder: urlEncode });
        const newPath = `${location.pathname}?${newParams}`;
        return newPath;
    }
    render() {
        const { isSortedByAttribute, sortMode } = this.tt;
        const LinkComponent = this.linkComponent();
        const { attribute, className, dataSet, defaultParams, linkComponent, onChanged, query, style, textProps, title, ...restProps } = this.props;
        const actualDataSet = {
            attribute,
            class: className,
            component: "api-maker/bootstrap/sort-link",
            sortMode: this.tt.sortMode,
            ...dataSet
        };
        const actualStyle = {
            display: "flex",
            flexDirection: "row",
            alignItems: "center",
            ...style
        };
        return (_jsxs(LinkComponent, { dataSet: actualDataSet, style: actualStyle, to: this.href(), ...restProps, children: [_jsx(Text, { ...textProps, children: this.title() }), isSortedByAttribute && sortMode == "asc" &&
                    _jsx(Icon, { name: "chevron-down", size: 14, style: this.cache("downIconStyle", { marginLeft: 3 }) }), isSortedByAttribute && sortMode == "desc" &&
                    _jsx(Icon, { name: "chevron-up", size: 14, style: this.cache("upIconStyle", { marginLeft: 3 }) })] }));
    }
    linkComponent = () => this.props.linkComponent || Link;
    title() {
        const { attribute, query } = this.p;
        const { title } = this.props;
        if (title)
            return title;
        return query.modelClass().humanAttributeName(attribute);
    }
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29ydC1saW5rLmpzIiwic291cmNlUm9vdCI6Ii9zcmMvIiwic291cmNlcyI6WyJib290c3RyYXAvc29ydC1saW5rLmpzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxLQUFLLFVBQVUsTUFBTSxZQUFZLENBQUE7QUFDeEMsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLDRDQUE0QyxDQUFBO0FBQ3pFLE9BQU8sYUFBYSxNQUFNLG1CQUFtQixDQUFBLENBQUMsbUNBQW1DO0FBQ2pGLE9BQU8sSUFBSSxNQUFNLGVBQWUsQ0FBQTtBQUNoQyxPQUFPLElBQUksTUFBTSxTQUFTLENBQUE7QUFDMUIsT0FBTyxTQUFTLE1BQU0sWUFBWSxDQUFBO0FBQ2xDLE9BQU8sS0FBSyxNQUFNLE9BQU8sQ0FBQTtBQUN6QixPQUFPLElBQUksTUFBTSxlQUFlLENBQUE7QUFDaEMsT0FBTyxJQUFJLE1BQU0saUNBQWlDLENBQUE7QUFDbEQsT0FBTyxFQUFFLE1BQU0sSUFBSSxDQUFBO0FBQ25CLE9BQU8sU0FBUyxNQUFNLGtCQUFrQixDQUFBO0FBQ3hDLE9BQU8sY0FBYyxNQUFNLCtDQUErQyxDQUFBO0FBQzFFLE9BQU8sVUFBVSxNQUFNLHlCQUF5QixDQUFBO0FBRWhELGVBQWUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLHlCQUEwQixTQUFRLGFBQWE7SUFDdEYsTUFBTSxDQUFDLFNBQVMsR0FBRztRQUNqQixTQUFTLEVBQUUsU0FBUyxDQUFDLE1BQU0sQ0FBQyxVQUFVO1FBQ3RDLFNBQVMsRUFBRSxTQUFTLENBQUMsTUFBTTtRQUMzQixhQUFhLEVBQUUsU0FBUyxDQUFDLE1BQU07UUFDL0IsYUFBYSxFQUFFLFNBQVMsQ0FBQyxNQUFNO1FBQy9CLFNBQVMsRUFBRSxTQUFTLENBQUMsSUFBSTtRQUN6QixLQUFLLEVBQUUsU0FBUyxDQUFDLE1BQU0sQ0FBQyxVQUFVO1FBQ2xDLEtBQUssRUFBRSxTQUFTLENBQUMsR0FBRztLQUNyQixDQUFBO0lBRUQsS0FBSztRQUNI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QUMsY0FBYyxFQUFDLElBQUksRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsZUFBZSxFQUFFLEVBQUMsVUFBVSxFQUFFLENBQUMsRUFBQyxDQUFDLEdBQUksRUFFNUYsbUJBQW1CLElBQUksUUFBUSxJQUFJLE1BQU07b0JBQ3hDLEtBQUMsSUFBSSxJQUFDLElBQUksRUFBQyxZQUFZLEVBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLEVBQUUsRUFBQyxVQUFVLEVBQUUsQ0FBQyxFQUFDLENBQUMsR0FBSSxJQUUzRSxDQUNqQixDQUFBO0lBQ0gsQ0FBQztJQUVELGFBQWEsR0FBRyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsSUFBSSxJQUFJLENBQUE7SUFFdEQsS0FBSztRQUNILE1BQU0sRUFBQyxTQUFTLEVBQUUsS0FBSyxFQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQTtRQUNqQyxNQUFNLEVBQUMsS0FBSyxFQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQTtRQUUxQixJQUFJLEtBQUs7WUFBRSxPQUFPLEtBQUssQ0FBQTtRQUV2QixPQUFPLEtBQUssQ0FBQyxVQUFVLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLENBQUMsQ0FBQTtJQUN6RCxDQUFDO0NBQ0YsQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBpbmZsZWN0aW9uIGZyb20gXCJpbmZsZWN0aW9uXCJcbmltcG9ydCB7c2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IEJhc2VDb21wb25lbnQgZnJvbSBcIi4uL2Jhc2UtY29tcG9uZW50XCIgLy8gZXNsaW50LWRpc2FibGUtbGluZSBzb3J0LWltcG9ydHNcbmltcG9ydCBJY29uIGZyb20gXCIuLi91dGlscy9pY29uXCJcbmltcG9ydCBMaW5rIGZyb20gXCIuLi9saW5rXCJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIlxuaW1wb3J0IFJlYWN0IGZyb20gXCJyZWFjdFwiXG5pbXBvcnQgVGV4dCBmcm9tIFwiLi4vdXRpbHMvdGV4dFwiXG5pbXBvcnQgbWVtbyBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvbWVtby5qc1wiXG5pbXBvcnQgcXMgZnJvbSBcInFzXCJcbmltcG9ydCB1cmxFbmNvZGUgZnJvbSBcIi4uL3VybC1lbmNvZGUuanNcIlxuaW1wb3J0IHVzZVF1ZXJ5UGFyYW1zIGZyb20gXCJvbi1sb2NhdGlvbi1jaGFuZ2VkL2J1aWxkL3VzZS1xdWVyeS1wYXJhbXMuanNcIlxuaW1wb3J0IHVzZVNvcnRpbmcgZnJvbSBcIi4uL3RhYmxlL3VzZS1zb3J0aW5nLmpzXCJcblxuZXhwb3J0IGRlZmF1bHQgbWVtbyhzaGFwZUNvbXBvbmVudChjbGFzcyBBcGlNYWtlckJvb3RzdHJhcFNvcnRMaW5rIGV4dGVuZHMgQmFzZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgYXR0cmlidXRlOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGRlZmF1bHRQYXJhbXM6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgbGlua0NvbXBvbmVudDogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBvbkNoYW5nZWQ6IFByb3BUeXBlcy5mdW5jLFxuICAgIHF1ZXJ5OiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgdGl0bGU6IFByb3BUeXBlcy5hbnlcbiAgfVxuXG4gIHNldHVwKCkge1xuICAgIGNvbnN0IHthdHRyaWJ1dGUsIGRlZmF1bHRQYXJhbXMsIHF1ZXJ5fSA9IHRoaXMucHJvcHNcbiAgICBjb25zdCB7cVBhcmFtcywgc2VhcmNoS2V5LCBzb3J0QXR0cmlidXRlLCBzb3J0TW9kZX0gPSB1c2VTb3J0aW5nKHtkZWZhdWx0UGFyYW1zLCBxdWVyeX0pXG5cbiAgICB0aGlzLnNldEluc3RhbmNlKHtcbiAgICAgIGlzU29ydGVkQnlBdHRyaWJ1dGU6IHNvcnRBdHRyaWJ1dGUgPT0gYXR0cmlidXRlLFxuICAgICAgcVBhcmFtcyxcbiAgICAgIHNlYXJjaEtleSxcbiAgICAgIHNvcnRNb2RlXG4gICAgfSlcblxuICAgIHRoaXMucXVlcnlQYXJhbXMgPSB1c2VRdWVyeVBhcmFtcygpXG4gICAgdGhpcy5zZWFyY2hLZXkgPSB0aGlzLnAucXVlcnkucXVlcnlBcmdzLnNlYXJjaEtleSB8fCBcInFcIlxuICAgIHRoaXMuYXR0cmlidXRlID0gaW5mbGVjdGlvbi51bmRlcnNjb3JlKHRoaXMucC5hdHRyaWJ1dGUpXG4gIH1cblxuICBocmVmICgpIHtcbiAgICBjb25zdCBxUGFyYW1zID0gey4uLnRoaXMudHQucVBhcmFtc31cbiAgICBjb25zdCB7YXR0cmlidXRlLCBxdWVyeVBhcmFtcywgc2VhcmNoS2V5LCBzb3J0TW9kZX0gPSB0aGlzLnR0XG4gICAgY29uc3QgbmV3UXVlcnlQYXJhbXMgPSB7Li4ucXVlcnlQYXJhbXN9XG5cbiAgICBxUGFyYW1zLnMgPSBgJHthdHRyaWJ1dGV9ICR7c29ydE1vZGUgPT0gXCJhc2NcIiA/IFwiZGVzY1wiIDogXCJhc2NcIn1gXG5cbiAgICBuZXdRdWVyeVBhcmFtc1tzZWFyY2hLZXldID0gSlNPTi5zdHJpbmdpZnkocVBhcmFtcylcblxuICAgIGNvbnN0IG5ld1BhcmFtcyA9IHFzLnN0cmluZ2lmeShuZXdRdWVyeVBhcmFtcywge2VuY29kZXI6IHVybEVuY29kZX0pXG4gICAgY29uc3QgbmV3UGF0aCA9IGAke2xvY2F0aW9uLnBhdGhuYW1lfT8ke25ld1BhcmFtc31gXG5cbiAgICByZXR1cm4gbmV3UGF0aFxuICB9XG5cbiAgcmVuZGVyICgpIHtcbiAgICBjb25zdCB7aXNTb3J0ZWRCeUF0dHJpYnV0ZSwgc29ydE1vZGV9ID0gdGhpcy50dFxuICAgIGNvbnN0IExpbmtDb21wb25lbnQgPSB0aGlzLmxpbmtDb21wb25lbnQoKVxuICAgIGNvbnN0IHthdHRyaWJ1dGUsIGNsYXNzTmFtZSwgZGF0YVNldCwgZGVmYXVsdFBhcmFtcywgbGlua0NvbXBvbmVudCwgb25DaGFuZ2VkLCBxdWVyeSwgc3R5bGUsIHRleHRQcm9wcywgdGl0bGUsIC4uLnJlc3RQcm9wc30gPSB0aGlzLnByb3BzXG4gICAgY29uc3QgYWN0dWFsRGF0YVNldCA9IHtcbiAgICAgIGF0dHJpYnV0ZSxcbiAgICAgIGNsYXNzOiBjbGFzc05hbWUsXG4gICAgICBjb21wb25lbnQ6IFwiYXBpLW1ha2VyL2Jvb3RzdHJhcC9zb3J0LWxpbmtcIixcbiAgICAgIHNvcnRNb2RlOiB0aGlzLnR0LnNvcnRNb2RlLFxuICAgICAgLi4uZGF0YVNldFxuICAgIH1cbiAgICBjb25zdCBhY3R1YWxTdHlsZSA9IHtcbiAgICAgIGRpc3BsYXk6IFwiZmxleFwiLFxuICAgICAgZmxleERpcmVjdGlvbjogXCJyb3dcIixcbiAgICAgIGFsaWduSXRlbXM6IFwiY2VudGVyXCIsXG4gICAgICAuLi5zdHlsZVxuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICA8TGlua0NvbXBvbmVudFxuICAgICAgICBkYXRhU2V0PXthY3R1YWxEYXRhU2V0fVxuICAgICAgICBzdHlsZT17YWN0dWFsU3R5bGV9XG4gICAgICAgIHRvPXt0aGlzLmhyZWYoKX1cbiAgICAgICAgey4uLnJlc3RQcm9wc31cbiAgICAgID5cbiAgICAgICAgPFRleHQgey4uLnRleHRQcm9wc30+XG4gICAgICAgICAge3RoaXMudGl0bGUoKX1cbiAgICAgICAgPC9UZXh0PlxuICAgICAgICB7aXNTb3J0ZWRCeUF0dHJpYnV0ZSAmJiBzb3J0TW9kZSA9PSBcImFzY1wiICYmXG4gICAgICAgICAgPEljb24gbmFtZT1cImNoZXZyb24tZG93blwiIHNpemU9ezE0fSBzdHlsZT17dGhpcy5jYWNoZShcImRvd25JY29uU3R5bGVcIiwge21hcmdpbkxlZnQ6IDN9KX0gLz5cbiAgICAgICAgfVxuICAgICAgICB7aXNTb3J0ZWRCeUF0dHJpYnV0ZSAmJiBzb3J0TW9kZSA9PSBcImRlc2NcIiAmJlxuICAgICAgICAgIDxJY29uIG5hbWU9XCJjaGV2cm9uLXVwXCIgc2l6ZT17MTR9IHN0eWxlPXt0aGlzLmNhY2hlKFwidXBJY29uU3R5bGVcIiwge21hcmdpbkxlZnQ6IDN9KX0gLz5cbiAgICAgICAgfVxuICAgICAgPC9MaW5rQ29tcG9uZW50PlxuICAgIClcbiAgfVxuXG4gIGxpbmtDb21wb25lbnQgPSAoKSA9PiB0aGlzLnByb3BzLmxpbmtDb21wb25lbnQgfHwgTGlua1xuXG4gIHRpdGxlICgpIHtcbiAgICBjb25zdCB7YXR0cmlidXRlLCBxdWVyeX0gPSB0aGlzLnBcbiAgICBjb25zdCB7dGl0bGV9ID0gdGhpcy5wcm9wc1xuXG4gICAgaWYgKHRpdGxlKSByZXR1cm4gdGl0bGVcblxuICAgIHJldHVybiBxdWVyeS5tb2RlbENsYXNzKCkuaHVtYW5BdHRyaWJ1dGVOYW1lKGF0dHJpYnV0ZSlcbiAgfVxufSkpXG4iXX0=