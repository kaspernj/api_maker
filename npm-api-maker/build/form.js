import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import React, { createContext, useContext, useEffect, useMemo } from "react";
import BaseComponent from "./base-component";
import FormDataObjectizer from "form-data-objectizer";
import memo from "set-state-compare/build/memo.js";
import { Platform } from "react-native";
import PropTypes from "prop-types";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
const FormContext = createContext(null);
const useForm = () => useContext(FormContext);
class FormInputs {
    constructor(props) {
        this.inputs = {};
        this.onSubmit = props?.onSubmit;
    }
    asObject() {
        const result = {};
        const formDataObjectizer = new FormDataObjectizer();
        for (const key in this.inputs) {
            const value = this.inputs[key];
            formDataObjectizer.treatInitial(key, value, result);
        }
        return result;
    }
    getValue(name) {
        return this.inputs[name];
    }
    setValue(name, value) {
        if (!name)
            throw new Error("'name' is required");
        this.inputs[name] = value;
    }
    setValueWithHidden(name, value) {
        this.setValue(name, value);
        if (Platform.OS == "web") {
            return _jsx("input", { name: name, type: "hidden", value: value !== null && value !== undefined ? value : "" });
        }
    }
    submit() {
        if (this.onSubmit) {
            this.onSubmit();
        }
    }
}
const Form = memo(shapeComponent(class Form extends BaseComponent {
    static propTypes = {
        children: PropTypes.any,
        formObjectRef: PropTypes.object,
        formRef: PropTypes.object,
        onSubmit: PropTypes.func,
        setForm: PropTypes.func
    };
    render() {
        const { children, formObjectRef, formRef, onSubmit, setForm, ...restProps } = this.props;
        const form = useMemo(() => new FormInputs({ onSubmit }), []);
        useMemo(() => {
            if (formObjectRef) {
                formObjectRef.current = form;
            }
        }, [form, formObjectRef]);
        useEffect(() => {
            return () => {
                if (formObjectRef) {
                    formObjectRef.current = null;
                }
            };
        }, [form, formObjectRef]);
        useMemo(() => {
            if (setForm) {
                setForm(form);
            }
        }, [setForm]);
        return (_jsxs(FormContext.Provider, { value: form, children: [Platform.OS == "web" &&
                    _jsx("form", { ref: formRef, onSubmit: this.tt.onFormSubmit, ...restProps, children: children }), Platform.OS != "web" && this.props.children] }));
    }
    onFormSubmit = (e) => {
        e.preventDefault();
        if (this.props.onSubmit) {
            this.props.onSubmit();
        }
    };
}));
export { Form, FormContext, FormInputs, useForm };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS5qcyIsInNvdXJjZVJvb3QiOiIvc3JjLyIsInNvdXJjZXMiOlsiZm9ybS5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sS0FBSyxFQUFFLEVBQUMsYUFBYSxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFDLE1BQU0sT0FBTyxDQUFBO0FBQzFFLE9BQU8sYUFBYSxNQUFNLGtCQUFrQixDQUFBO0FBQzVDLE9BQU8sa0JBQWtCLE1BQU0sc0JBQXNCLENBQUE7QUFDckQsT0FBTyxJQUFJLE1BQU0saUNBQWlDLENBQUE7QUFDbEQsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLGNBQWMsQ0FBQTtBQUNyQyxPQUFPLFNBQVMsTUFBTSxZQUFZLENBQUE7QUFDbEMsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLDRDQUE0QyxDQUFBO0FBRXpFLE1BQU0sV0FBVyxHQUFHLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQTtBQUN2QyxNQUFNLE9BQU8sR0FBRyxHQUFHLEVBQUUsQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLENBQUE7QUFFN0MsTUFBTSxVQUFVO0lBQ2QsWUFBWSxLQUFLO1FBQ2YsSUFBSSxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUE7UUFDaEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLEVBQUUsUUFBUSxDQUFBO0lBQ2pDLENBQUM7SUFFRCxRQUFRO1FBQ04sTUFBTSxNQUFNLEdBQUcsRUFBRSxDQUFBO1FBQ2pCLE1BQU0sa0JBQWtCLEdBQUcsSUFBSSxrQkFBa0IsRUFBRSxDQUFBO1FBRW5ELEtBQUksTUFBTSxHQUFHLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQzdCLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7WUFFOUIsa0JBQWtCLENBQUMsWUFBWSxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUE7UUFDckQsQ0FBQztRQUVELE9BQU8sTUFBTSxDQUFBO0lBQ2YsQ0FBQztJQUVELFFBQVEsQ0FBQyxJQUFJO1FBQ1gsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQzFCLENBQUM7SUFFRCxRQUFRLENBQUMsSUFBSSxFQUFFLEtBQUs7UUFDbEIsSUFBSSxDQUFDLElBQUk7WUFBRSxNQUFNLElBQUksS0FBSyxDQUFDLG9CQUFvQixDQUFDLENBQUE7UUFFaEQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLENBQUE7SUFDM0IsQ0FBQztJQUVELGtCQUFrQixDQUFDLElBQUksRUFBRSxLQUFLO1FBQzVCLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFBO1FBRTFCLElBQUksUUFBUSxDQUFDLEVBQUUsSUFBSSxLQUFLLEVBQUUsQ0FBQztZQUN6QixPQUFPLGdCQUFPLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFDLFFBQVEsRUFBQyxLQUFLLEVBQUUsS0FBSyxLQUFLLElBQUksSUFBSSxLQUFLLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBSSxDQUFBO1FBQ3ZHLENBQUM7SUFDSCxDQUFDO0lBRUQsTUFBTTtRQUNKLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ2xCLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtRQUNqQixDQUFDO0lBQ0gsQ0FBQztDQUNGO0FBRUQsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLElBQUssU0FBUSxhQUFhO0lBQy9ELE1BQU0sQ0FBQyxTQUFTLEdBQUc7UUFDakIsUUFBUSxFQUFFLFNBQVMsQ0FBQyxHQUFHO1FBQ3ZCLGFBQWEsRUFBRSxTQUFTLENBQUMsTUFBTTtRQUMvQixPQUFPLEVBQUUsU0FBUyxDQUFDLE1BQU07UUFDekIsUUFBUSxFQUFFLFNBQVMsQ0FBQyxJQUFJO1FBQ3hCLE9BQU8sRUFBRSxTQUFTLENBQUMsSUFBSTtLQUN4QixDQUFBO0lBRUQsTUFBTTtRQUNKLE1BQU0sRUFBQyxRQUFRLEVBQUUsYUFBYSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLEdBQUcsU0FBUyxFQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQTtRQUN0RixNQUFNLElBQUksR0FBRyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxVQUFVLENBQUMsRUFBQyxRQUFRLEVBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFBO1FBRTFELE9BQU8sQ0FBQyxHQUFHLEVBQUU7WUFDWCxJQUFJLGFBQWEsRUFBRSxDQUFDO2dCQUNsQixhQUFhLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQTtZQUM5QixDQUFDO1FBQ0gsQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQUE7UUFFekIsU0FBUyxDQUFDLEdBQUcsRUFBRTtZQUNiLE9BQU8sR0FBRyxFQUFFO2dCQUNWLElBQUksYUFBYSxFQUFFLENBQUM7b0JBQ2xCLGFBQWEsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFBO2dCQUM5QixDQUFDO1lBQ0gsQ0FBQyxDQUFBO1FBQ0gsQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQUE7UUFFekIsT0FBTyxDQUFDLEdBQUcsRUFBRTtZQUNYLElBQUksT0FBTyxFQUFFLENBQUM7Z0JBQ1osT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFBO1lBQ2YsQ0FBQztRQUNILENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUE7UUFFYixPQUFPLENBQ0wsTUFBQyxXQUFXLENBQUMsUUFBUSxJQUFDLEtBQUssRUFBRSxJQUFJLGFBQzlCLFFBQVEsQ0FBQyxFQUFFLElBQUksS0FBSztvQkFDbkIsZUFBTSxHQUFHLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLFlBQVksS0FBTSxTQUFTLFlBQzlELFFBQVEsR0FDSixFQUVSLFFBQVEsQ0FBQyxFQUFFLElBQUksS0FBSyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxJQUN2QixDQUN4QixDQUFBO0lBQ0gsQ0FBQztJQUVELFlBQVksR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFO1FBQ25CLENBQUMsQ0FBQyxjQUFjLEVBQUUsQ0FBQTtRQUVsQixJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDeEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQTtRQUN2QixDQUFDO0lBQ0gsQ0FBQyxDQUFBO0NBQ0YsQ0FBQyxDQUFDLENBQUE7QUFFSCxPQUFPLEVBQUMsSUFBSSxFQUFFLFdBQVcsRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHtjcmVhdGVDb250ZXh0LCB1c2VDb250ZXh0LCB1c2VFZmZlY3QsIHVzZU1lbW99IGZyb20gXCJyZWFjdFwiXG5pbXBvcnQgQmFzZUNvbXBvbmVudCBmcm9tIFwiLi9iYXNlLWNvbXBvbmVudFwiXG5pbXBvcnQgRm9ybURhdGFPYmplY3RpemVyIGZyb20gXCJmb3JtLWRhdGEtb2JqZWN0aXplclwiXG5pbXBvcnQgbWVtbyBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvbWVtby5qc1wiXG5pbXBvcnQge1BsYXRmb3JtfSBmcm9tIFwicmVhY3QtbmF0aXZlXCJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIlxuaW1wb3J0IHtzaGFwZUNvbXBvbmVudH0gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL3NoYXBlLWNvbXBvbmVudC5qc1wiXG5cbmNvbnN0IEZvcm1Db250ZXh0ID0gY3JlYXRlQ29udGV4dChudWxsKVxuY29uc3QgdXNlRm9ybSA9ICgpID0+IHVzZUNvbnRleHQoRm9ybUNvbnRleHQpXG5cbmNsYXNzIEZvcm1JbnB1dHMge1xuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHRoaXMuaW5wdXRzID0ge31cbiAgICB0aGlzLm9uU3VibWl0ID0gcHJvcHM/Lm9uU3VibWl0XG4gIH1cblxuICBhc09iamVjdCgpIHtcbiAgICBjb25zdCByZXN1bHQgPSB7fVxuICAgIGNvbnN0IGZvcm1EYXRhT2JqZWN0aXplciA9IG5ldyBGb3JtRGF0YU9iamVjdGl6ZXIoKVxuXG4gICAgZm9yKGNvbnN0IGtleSBpbiB0aGlzLmlucHV0cykge1xuICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmlucHV0c1trZXldXG5cbiAgICAgIGZvcm1EYXRhT2JqZWN0aXplci50cmVhdEluaXRpYWwoa2V5LCB2YWx1ZSwgcmVzdWx0KVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHRcbiAgfVxuXG4gIGdldFZhbHVlKG5hbWUpIHtcbiAgICByZXR1cm4gdGhpcy5pbnB1dHNbbmFtZV1cbiAgfVxuXG4gIHNldFZhbHVlKG5hbWUsIHZhbHVlKSB7XG4gICAgaWYgKCFuYW1lKSB0aHJvdyBuZXcgRXJyb3IoXCInbmFtZScgaXMgcmVxdWlyZWRcIilcblxuICAgIHRoaXMuaW5wdXRzW25hbWVdID0gdmFsdWVcbiAgfVxuXG4gIHNldFZhbHVlV2l0aEhpZGRlbihuYW1lLCB2YWx1ZSkge1xuICAgIHRoaXMuc2V0VmFsdWUobmFtZSwgdmFsdWUpXG5cbiAgICBpZiAoUGxhdGZvcm0uT1MgPT0gXCJ3ZWJcIikge1xuICAgICAgcmV0dXJuIDxpbnB1dCBuYW1lPXtuYW1lfSB0eXBlPVwiaGlkZGVuXCIgdmFsdWU9e3ZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWQgPyB2YWx1ZSA6IFwiXCJ9IC8+XG4gICAgfVxuICB9XG5cbiAgc3VibWl0KCkge1xuICAgIGlmICh0aGlzLm9uU3VibWl0KSB7XG4gICAgICB0aGlzLm9uU3VibWl0KClcbiAgICB9XG4gIH1cbn1cblxuY29uc3QgRm9ybSA9IG1lbW8oc2hhcGVDb21wb25lbnQoY2xhc3MgRm9ybSBleHRlbmRzIEJhc2VDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIGNoaWxkcmVuOiBQcm9wVHlwZXMuYW55LFxuICAgIGZvcm1PYmplY3RSZWY6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgZm9ybVJlZjogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBvblN1Ym1pdDogUHJvcFR5cGVzLmZ1bmMsXG4gICAgc2V0Rm9ybTogUHJvcFR5cGVzLmZ1bmNcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7Y2hpbGRyZW4sIGZvcm1PYmplY3RSZWYsIGZvcm1SZWYsIG9uU3VibWl0LCBzZXRGb3JtLCAuLi5yZXN0UHJvcHN9ID0gdGhpcy5wcm9wc1xuICAgIGNvbnN0IGZvcm0gPSB1c2VNZW1vKCgpID0+IG5ldyBGb3JtSW5wdXRzKHtvblN1Ym1pdH0pLCBbXSlcblxuICAgIHVzZU1lbW8oKCkgPT4ge1xuICAgICAgaWYgKGZvcm1PYmplY3RSZWYpIHtcbiAgICAgICAgZm9ybU9iamVjdFJlZi5jdXJyZW50ID0gZm9ybVxuICAgICAgfVxuICAgIH0sIFtmb3JtLCBmb3JtT2JqZWN0UmVmXSlcblxuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICBpZiAoZm9ybU9iamVjdFJlZikge1xuICAgICAgICAgIGZvcm1PYmplY3RSZWYuY3VycmVudCA9IG51bGxcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sIFtmb3JtLCBmb3JtT2JqZWN0UmVmXSlcblxuICAgIHVzZU1lbW8oKCkgPT4ge1xuICAgICAgaWYgKHNldEZvcm0pIHtcbiAgICAgICAgc2V0Rm9ybShmb3JtKVxuICAgICAgfVxuICAgIH0sIFtzZXRGb3JtXSlcblxuICAgIHJldHVybiAoXG4gICAgICA8Rm9ybUNvbnRleHQuUHJvdmlkZXIgdmFsdWU9e2Zvcm19PlxuICAgICAgICB7UGxhdGZvcm0uT1MgPT0gXCJ3ZWJcIiAmJlxuICAgICAgICAgIDxmb3JtIHJlZj17Zm9ybVJlZn0gb25TdWJtaXQ9e3RoaXMudHQub25Gb3JtU3VibWl0fSB7Li4ucmVzdFByb3BzfT5cbiAgICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgICA8L2Zvcm0+XG4gICAgICAgIH1cbiAgICAgICAge1BsYXRmb3JtLk9TICE9IFwid2ViXCIgJiYgdGhpcy5wcm9wcy5jaGlsZHJlbn1cbiAgICAgIDwvRm9ybUNvbnRleHQuUHJvdmlkZXI+XG4gICAgKVxuICB9XG5cbiAgb25Gb3JtU3VibWl0ID0gKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KClcblxuICAgIGlmICh0aGlzLnByb3BzLm9uU3VibWl0KSB7XG4gICAgICB0aGlzLnByb3BzLm9uU3VibWl0KClcbiAgICB9XG4gIH1cbn0pKVxuXG5leHBvcnQge0Zvcm0sIEZvcm1Db250ZXh0LCBGb3JtSW5wdXRzLCB1c2VGb3JtfVxuIl19