import React, { createContext, useContext, useEffect, useMemo } from "react";
import BaseComponent from "./base-component.js";
import FormDataObjectizer from "form-data-objectizer";
import memo from "set-state-compare/build/memo.js";
import { Platform } from "react-native";
import PropTypes from "prop-types";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
const FormContext = createContext(null);
const useForm = () => useContext(FormContext);
class FormInputs {
    constructor(props) {
        this.inputs = {};
        this.onSubmit = props?.onSubmit;
    }
    asObject() {
        const result = {};
        const formDataObjectizer = new FormDataObjectizer();
        for (const key in this.inputs) {
            const value = this.inputs[key];
            formDataObjectizer.treatInitial(key, value, result);
        }
        return result;
    }
    getValue(name) {
        return this.inputs[name];
    }
    setValue(name, value) {
        if (!name)
            throw new Error("'name' is required");
        this.inputs[name] = value;
    }
    setValueWithHidden(name, value) {
        this.setValue(name, value);
        if (Platform.OS == "web") {
            return <input name={name} type="hidden" value={value !== null && value !== undefined ? value : ""}/>;
        }
    }
    submit() {
        if (this.onSubmit) {
            this.onSubmit();
        }
    }
}
const Form = memo(shapeComponent(class Form extends BaseComponent {
    static propTypes = {
        children: PropTypes.any,
        formObjectRef: PropTypes.object,
        formRef: PropTypes.object,
        onSubmit: PropTypes.func,
        setForm: PropTypes.func
    };
    render() {
        const { children, formObjectRef, formRef, onSubmit, setForm, ...restProps } = this.props;
        const form = useMemo(() => new FormInputs({ onSubmit }), []);
        useMemo(() => {
            if (formObjectRef) {
                formObjectRef.current = form;
            }
        }, [form, formObjectRef]);
        useEffect(() => {
            return () => {
                if (formObjectRef) {
                    formObjectRef.current = null;
                }
            };
        }, [form, formObjectRef]);
        useMemo(() => {
            if (setForm) {
                setForm(form);
            }
        }, [setForm]);
        return (<FormContext.Provider value={form}>
        {Platform.OS == "web" &&
                <form ref={formRef} onSubmit={this.tt.onFormSubmit} {...restProps}>
            {children}
          </form>}
        {Platform.OS != "web" && this.props.children}
      </FormContext.Provider>);
    }
    onFormSubmit = (e) => {
        e.preventDefault();
        if (this.props.onSubmit) {
            this.props.onSubmit();
        }
    };
}));
export { Form, FormContext, FormInputs, useForm };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS5qcyIsInNvdXJjZVJvb3QiOiIvc3JjLyIsInNvdXJjZXMiOlsiZm9ybS5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLEVBQUUsRUFBQyxhQUFhLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUMsTUFBTSxPQUFPLENBQUE7QUFDMUUsT0FBTyxhQUFhLE1BQU0scUJBQXFCLENBQUE7QUFDL0MsT0FBTyxrQkFBa0IsTUFBTSxzQkFBc0IsQ0FBQTtBQUNyRCxPQUFPLElBQUksTUFBTSxpQ0FBaUMsQ0FBQTtBQUNsRCxPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0sY0FBYyxDQUFBO0FBQ3JDLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQTtBQUNsQyxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sNENBQTRDLENBQUE7QUFFekUsTUFBTSxXQUFXLEdBQUcsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFBO0FBQ3ZDLE1BQU0sT0FBTyxHQUFHLEdBQUcsRUFBRSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQTtBQUU3QyxNQUFNLFVBQVU7SUFDZCxZQUFZLEtBQUs7UUFDZixJQUFJLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQTtRQUNoQixJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssRUFBRSxRQUFRLENBQUE7SUFDakMsQ0FBQztJQUVELFFBQVE7UUFDTixNQUFNLE1BQU0sR0FBRyxFQUFFLENBQUE7UUFDakIsTUFBTSxrQkFBa0IsR0FBRyxJQUFJLGtCQUFrQixFQUFFLENBQUE7UUFFbkQsS0FBSSxNQUFNLEdBQUcsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDN0IsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTtZQUU5QixrQkFBa0IsQ0FBQyxZQUFZLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQTtRQUNyRCxDQUFDO1FBRUQsT0FBTyxN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LEVBQUUsQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLFNBQVMsQ0FBQyxDQUNoRTtZQUFBLENBQUMsUUFBUSxDQUNYO1VBQUEsRUFBRSxJQUFJLENBQ1IsQ0FDQTtRQUFBLENBQUMsUUFBUSxDQUFDLEVBQUUsSUFBSSxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQzlDO01BQUEsRUFBRSxXQUFXLENBQUMsUUFBUSxDQUFDLENBQ3hCLENBQUE7SUFDSCxDQUFDO0lBRUQsWUFBWSxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUU7UUFDbkIsQ0FBQyxDQUFDLGNBQWMsRUFBRSxDQUFBO1FBRWxCLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUN4QixJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFBO1FBQ3ZCLENBQUM7SUFDSCxDQUFDLENBQUE7Q0FDRixDQUFDLENBQUMsQ0FBQTtBQUVILE9BQU8sRUFBQyxJQUFJLEVBQUUsV0FBVyxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwge2NyZWF0ZUNvbnRleHQsIHVzZUNvbnRleHQsIHVzZUVmZmVjdCwgdXNlTWVtb30gZnJvbSBcInJlYWN0XCJcbmltcG9ydCBCYXNlQ29tcG9uZW50IGZyb20gXCIuL2Jhc2UtY29tcG9uZW50LmpzXCJcbmltcG9ydCBGb3JtRGF0YU9iamVjdGl6ZXIgZnJvbSBcImZvcm0tZGF0YS1vYmplY3RpemVyXCJcbmltcG9ydCBtZW1vIGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9tZW1vLmpzXCJcbmltcG9ydCB7UGxhdGZvcm19IGZyb20gXCJyZWFjdC1uYXRpdmVcIlxuaW1wb3J0IFByb3BUeXBlcyBmcm9tIFwicHJvcC10eXBlc1wiXG5pbXBvcnQge3NoYXBlQ29tcG9uZW50fSBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvc2hhcGUtY29tcG9uZW50LmpzXCJcblxuY29uc3QgRm9ybUNvbnRleHQgPSBjcmVhdGVDb250ZXh0KG51bGwpXG5jb25zdCB1c2VGb3JtID0gKCkgPT4gdXNlQ29udGV4dChGb3JtQ29udGV4dClcblxuY2xhc3MgRm9ybUlucHV0cyB7XG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgdGhpcy5pbnB1dHMgPSB7fVxuICAgIHRoaXMub25TdWJtaXQgPSBwcm9wcz8ub25TdWJtaXRcbiAgfVxuXG4gIGFzT2JqZWN0KCkge1xuICAgIGNvbnN0IHJlc3VsdCA9IHt9XG4gICAgY29uc3QgZm9ybURhdGFPYmplY3RpemVyID0gbmV3IEZvcm1EYXRhT2JqZWN0aXplcigpXG5cbiAgICBmb3IoY29uc3Qga2V5IGluIHRoaXMuaW5wdXRzKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuaW5wdXRzW2tleV1cblxuICAgICAgZm9ybURhdGFPYmplY3RpemVyLnRyZWF0SW5pdGlhbChrZXksIHZhbHVlLCByZXN1bHQpXG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdFxuICB9XG5cbiAgZ2V0VmFsdWUobmFtZSkge1xuICAgIHJldHVybiB0aGlzLmlucHV0c1tuYW1lXVxuICB9XG5cbiAgc2V0VmFsdWUobmFtZSwgdmFsdWUpIHtcbiAgICBpZiAoIW5hbWUpIHRocm93IG5ldyBFcnJvcihcIiduYW1lJyBpcyByZXF1aXJlZFwiKVxuXG4gICAgdGhpcy5pbnB1dHNbbmFtZV0gPSB2YWx1ZVxuICB9XG5cbiAgc2V0VmFsdWVXaXRoSGlkZGVuKG5hbWUsIHZhbHVlKSB7XG4gICAgdGhpcy5zZXRWYWx1ZShuYW1lLCB2YWx1ZSlcblxuICAgIGlmIChQbGF0Zm9ybS5PUyA9PSBcIndlYlwiKSB7XG4gICAgICByZXR1cm4gPGlucHV0IG5hbWU9e25hbWV9IHR5cGU9XCJoaWRkZW5cIiB2YWx1ZT17dmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCA/IHZhbHVlIDogXCJcIn0gLz5cbiAgICB9XG4gIH1cblxuICBzdWJtaXQoKSB7XG4gICAgaWYgKHRoaXMub25TdWJtaXQpIHtcbiAgICAgIHRoaXMub25TdWJtaXQoKVxuICAgIH1cbiAgfVxufVxuXG5jb25zdCBGb3JtID0gbWVtbyhzaGFwZUNvbXBvbmVudChjbGFzcyBGb3JtIGV4dGVuZHMgQmFzZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgY2hpbGRyZW46IFByb3BUeXBlcy5hbnksXG4gICAgZm9ybU9iamVjdFJlZjogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBmb3JtUmVmOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIG9uU3VibWl0OiBQcm9wVHlwZXMuZnVuYyxcbiAgICBzZXRGb3JtOiBQcm9wVHlwZXMuZnVuY1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtjaGlsZHJlbiwgZm9ybU9iamVjdFJlZiwgZm9ybVJlZiwgb25TdWJtaXQsIHNldEZvcm0sIC4uLnJlc3RQcm9wc30gPSB0aGlzLnByb3BzXG4gICAgY29uc3QgZm9ybSA9IHVzZU1lbW8oKCkgPT4gbmV3IEZvcm1JbnB1dHMoe29uU3VibWl0fSksIFtdKVxuXG4gICAgdXNlTWVtbygoKSA9PiB7XG4gICAgICBpZiAoZm9ybU9iamVjdFJlZikge1xuICAgICAgICBmb3JtT2JqZWN0UmVmLmN1cnJlbnQgPSBmb3JtXG4gICAgICB9XG4gICAgfSwgW2Zvcm0sIGZvcm1PYmplY3RSZWZdKVxuXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgIGlmIChmb3JtT2JqZWN0UmVmKSB7XG4gICAgICAgICAgZm9ybU9iamVjdFJlZi5jdXJyZW50ID0gbnVsbFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSwgW2Zvcm0sIGZvcm1PYmplY3RSZWZdKVxuXG4gICAgdXNlTWVtbygoKSA9PiB7XG4gICAgICBpZiAoc2V0Rm9ybSkge1xuICAgICAgICBzZXRGb3JtKGZvcm0pXG4gICAgICB9XG4gICAgfSwgW3NldEZvcm1dKVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxGb3JtQ29udGV4dC5Qcm92aWRlciB2YWx1ZT17Zm9ybX0+XG4gICAgICAgIHtQbGF0Zm9ybS5PUyA9PSBcIndlYlwiICYmXG4gICAgICAgICAgPGZvcm0gcmVmPXtmb3JtUmVmfSBvblN1Ym1pdD17dGhpcy50dC5vbkZvcm1TdWJtaXR9IHsuLi5yZXN0UHJvcHN9PlxuICAgICAgICAgICAge2NoaWxkcmVufVxuICAgICAgICAgIDwvZm9ybT5cbiAgICAgICAgfVxuICAgICAgICB7UGxhdGZvcm0uT1MgIT0gXCJ3ZWJcIiAmJiB0aGlzLnByb3BzLmNoaWxkcmVufVxuICAgICAgPC9Gb3JtQ29udGV4dC5Qcm92aWRlcj5cbiAgICApXG4gIH1cblxuICBvbkZvcm1TdWJtaXQgPSAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKVxuXG4gICAgaWYgKHRoaXMucHJvcHMub25TdWJtaXQpIHtcbiAgICAgIHRoaXMucHJvcHMub25TdWJtaXQoKVxuICAgIH1cbiAgfVxufSkpXG5cbmV4cG9ydCB7Rm9ybSwgRm9ybUNvbnRleHQsIEZvcm1JbnB1dHMsIHVzZUZvcm19XG4iXX0=