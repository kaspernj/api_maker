import { useCallback } from "react";
import config from "./config.js";
import { Dimensions } from "react-native";
import * as inflection from "inflection";
import isExpo from "./is-expo.js";
import useEventEmitter from "./use-event-emitter.js";
import useEventListener from "./use-event-listener.js";
import useShape from "set-state-compare/build/use-shape.js";
function calculateBreakPoint(breakpoints) {
    let windowWidth;
    if (isExpo) {
        windowWidth = Dimensions.get("window").width;
    }
    else if (typeof window !== "undefined" && window.innerWidth !== undefined) {
        // Use 'window.innerWidth' outside Expo because sometimes window width excludes scroll
        windowWidth = window.innerWidth;
    }
    else {
        throw new Error("Didn't know where to get window width from");
    }
    const result = {};
    for (const breakpointData of breakpoints) {
        const breakpoint = breakpointData[0];
        const width = breakpointData[1];
        if (!result.name && windowWidth >= width) {
            result.name = breakpoint;
            result[`${breakpoint}Down`] = true;
        }
        else {
            result[`${breakpoint}Down`] = !result.name;
        }
        result[`${breakpoint}Up`] = Boolean(result.name);
    }
    if (result.name) {
        return result;
    }
    throw new Error(`Couldn't not find breakpoint from window width: ${windowWidth}`);
}
const sizeTypes = ["down", "up"];
const useBreakpoint = (args = {}) => {
    const s = useShape(args);
    s.meta.breakpoints ||= config.getBreakpoints();
    const checkAndUpdateBreakpoint = useCallback(() => {
        const breakpoint = calculateBreakPoint(s.m.breakpoints);
        if (breakpoint.name != s.s.breakpoint.name) {
            s.set({ breakpoint });
        }
    }, []);
    const onDimensionsChange = useCallback(() => {
        checkAndUpdateBreakpoint();
    }, []);
    const onBreakpointsChange = useCallback(({ newValue }) => {
        s.meta.breakpoints = newValue;
        checkAndUpdateBreakpoint();
    }, []);
    s.useStates({
        breakpoint: () => calculateBreakPoint(s.m.breakpoints)
    });
    const styling = useCallback((args) => {
        const style = Object.assign({}, args.base);
        for (const breakpointData of s.m.breakpoints) {
            const breakpoint = breakpointData[0];
            for (const sizeType of sizeTypes) {
                const breakpointWithSizeType = `${breakpoint}${inflection.camelize(sizeType)}`;
                if (args[breakpointWithSizeType] && s.s.breakpoint[breakpointWithSizeType]) {
                    Object.assign(style, args[breakpointWithSizeType]);
                }
            }
        }
        return style;
    }, []);
    useEventEmitter(config.getEvents(), "onBreakpointsChange", onBreakpointsChange);
    useEventListener(Dimensions, "change", onDimensionsChange);
    return {
        styling,
        ...s.s.breakpoint
    };
};
export default useBreakpoint;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlLWJyZWFrcG9pbnQuanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbInVzZS1icmVha3BvaW50LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxXQUFXLEVBQUMsTUFBTSxPQUFPLENBQUE7QUFDakMsT0FBTyxNQUFNLE1BQU0sYUFBYSxDQUFBO0FBQ2hDLE9BQU8sRUFBQyxVQUFVLEVBQUMsTUFBTSxjQUFjLENBQUE7QUFDdkMsT0FBTyxLQUFLLFVBQVUsTUFBTSxZQUFZLENBQUE7QUFDeEMsT0FBTyxNQUFNLE1BQU0sY0FBYyxDQUFBO0FBQ2pDLE9BQU8sZUFBZSxNQUFNLHdCQUF3QixDQUFBO0FBQ3BELE9BQU8sZ0JBQWdCLE1BQU0seUJBQXlCLENBQUE7QUFDdEQsT0FBTyxRQUFRLE1BQU0sc0NBQXNDLENBQUE7QUFFM0QsU0FBUyxtQkFBbUIsQ0FBQyxXQUFXO0lBQ3RDLElBQUksV0FBVyxDQUFBO0lBRWYsSUFBSSxNQUFNLEVBQUUsQ0FBQztRQUNYLFdBQVcsR0FBRyxVQUFVLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEtBQUssQ0FBQTtJQUM5QyxDQUFDO1NBQU0sSUFBSSxPQUFPLE1BQU0sS0FBSyxXQUFXLElBQUksTUFBTSxDQUFDLFVBQVUsS0FBSyxTQUFTLEVBQUUsQ0FBQztRQUM1RSxzRkFBc0Y7UUFDdEYsV0FBVyxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUE7SUFDakMsQ0FBQztTQUFNLENBQUM7UUFDTixNQUFNLElBQUksS0FBSyxDQUFDLDRDQUE0QyxDQUFDLENBQUE7SUFDL0QsQ0FBQztJQUVELE1BQU0sTUFBTSxHQUFHLEVBQUUsQ0FBQTtJQUVqQixLQUFLLE1BQU0sY0FBYyxJQUFJLFdBQVcsRUFBRSxDQUFDO1FBQ3pDLE1BQU0sVUFBVSxHQUFHLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUNwQyxNQUFNLEtBQUssR0FBRyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFF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LENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFBO2dCQUNwRCxDQUFDO1lBQ0gsQ0FBQztRQUNILENBQUM7UUFFRCxPQUFPLEtBQUssQ0FBQTtJQUNkLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQTtJQUVOLGVBQWUsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLEVBQUUscUJBQXFCLEVBQUUsbUJBQW1CLENBQUMsQ0FBQTtJQUMvRSxnQkFBZ0IsQ0FBQyxVQUFVLEVBQUUsUUFBUSxFQUFFLGtCQUFrQixDQUFDLENBQUE7SUFFMUQsT0FBTztRQUNMLE9BQU87UUFDUCxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVTtLQUNsQixDQUFBO0FBQ0gsQ0FBQyxDQUFBO0FBRUQsZUFBZSxhQUFhLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge3VzZUNhbGxiYWNrfSBmcm9tIFwicmVhY3RcIlxuaW1wb3J0IGNvbmZpZyBmcm9tIFwiLi9jb25maWcuanNcIlxuaW1wb3J0IHtEaW1lbnNpb25zfSBmcm9tIFwicmVhY3QtbmF0aXZlXCJcbmltcG9ydCAqIGFzIGluZmxlY3Rpb24gZnJvbSBcImluZmxlY3Rpb25cIlxuaW1wb3J0IGlzRXhwbyBmcm9tIFwiLi9pcy1leHBvLmpzXCJcbmltcG9ydCB1c2VFdmVudEVtaXR0ZXIgZnJvbSBcIi4vdXNlLWV2ZW50LWVtaXR0ZXIuanNcIlxuaW1wb3J0IHVzZUV2ZW50TGlzdGVuZXIgZnJvbSBcIi4vdXNlLWV2ZW50LWxpc3RlbmVyLmpzXCJcbmltcG9ydCB1c2VTaGFwZSBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvdXNlLXNoYXBlLmpzXCJcblxuZnVuY3Rpb24gY2FsY3VsYXRlQnJlYWtQb2ludChicmVha3BvaW50cykge1xuICBsZXQgd2luZG93V2lkdGhcblxuICBpZiAoaXNFeHBvKSB7XG4gICAgd2luZG93V2lkdGggPSBEaW1lbnNpb25zLmdldChcIndpbmRvd1wiKS53aWR0aFxuICB9IGVsc2UgaWYgKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgJiYgd2luZG93LmlubmVyV2lkdGggIT09IHVuZGVmaW5lZCkge1xuICAgIC8vIFVzZSAnd2luZG93LmlubmVyV2lkdGgnIG91dHNpZGUgRXhwbyBiZWNhdXNlIHNvbWV0aW1lcyB3aW5kb3cgd2lkdGggZXhjbHVkZXMgc2Nyb2xsXG4gICAgd2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aFxuICB9IGVsc2Uge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkRpZG4ndCBrbm93IHdoZXJlIHRvIGdldCB3aW5kb3cgd2lkdGggZnJvbVwiKVxuICB9XG5cbiAgY29uc3QgcmVzdWx0ID0ge31cblxuICBmb3IgKGNvbnN0IGJyZWFrcG9pbnREYXRhIG9mIGJyZWFrcG9pbnRzKSB7XG4gICAgY29uc3QgYnJlYWtwb2ludCA9IGJyZWFrcG9pbnREYXRhWzBdXG4gICAgY29uc3Qgd2lkdGggPSBicmVha3BvaW50RGF0YVsxXVxuXG4gICAgaWYgKCFyZXN1bHQubmFtZSAmJiB3aW5kb3dXaWR0aCA+PSB3aWR0aCkge1xuICAgICAgcmVzdWx0Lm5hbWUgPSBicmVha3BvaW50XG4gICAgICByZXN1bHRbYCR7YnJlYWtwb2ludH1Eb3duYF0gPSB0cnVlXG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc3VsdFtgJHticmVha3BvaW50fURvd25gXSA9ICFyZXN1bHQubmFtZVxuICAgIH1cblxuICAgIHJlc3VsdFtgJHticmVha3BvaW50fVVwYF0gPSBCb29sZWFuKHJlc3VsdC5uYW1lKVxuICB9XG5cbiAgaWYgKHJlc3VsdC5uYW1lKSB7XG4gICAgcmV0dXJuIHJlc3VsdFxuICB9XG5cbiAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZG4ndCBub3QgZmluZCBicmVha3BvaW50IGZyb20gd2luZG93IHdpZHRoOiAke3dpbmRvd1dpZHRofWApXG59XG5cbmNvbnN0IHNpemVUeXBlcyA9IFtcImRvd25cIiwgXCJ1cFwiXVxuXG5jb25zdCB1c2VCcmVha3BvaW50ID0gKGFyZ3MgPSB7fSkgPT4ge1xuICBjb25zdCBzID0gdXNlU2hhcGUoYXJncylcblxuICBzLm1ldGEuYnJlYWtwb2ludHMgfHw9IGNvbmZpZy5nZXRCcmVha3BvaW50cygpXG5cbiAgY29uc3QgY2hlY2tBbmRVcGRhdGVCcmVha3BvaW50ID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGNvbnN0IGJyZWFrcG9pbnQgPSBjYWxjdWxhdGVCcmVha1BvaW50KHMubS5icmVha3BvaW50cylcblxuICAgIGlmIChicmVha3BvaW50Lm5hbWUgIT0gcy5zLmJyZWFrcG9pbnQubmFtZSkge1xuICAgICAgcy5zZXQoe2JyZWFrcG9pbnR9KVxuICAgIH1cbiAgfSwgW10pXG5cbiAgY29uc3Qgb25EaW1lbnNpb25zQ2hhbmdlID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGNoZWNrQW5kVXBkYXRlQnJlYWtwb2ludCgpXG4gIH0sIFtdKVxuXG4gIGNvbnN0IG9uQnJlYWtwb2ludHNDaGFuZ2UgPSB1c2VDYWxsYmFjaygoe25ld1ZhbHVlfSkgPT4ge1xuICAgIHMubWV0YS5icmVha3BvaW50cyA9IG5ld1ZhbHVlXG4gICAgY2hlY2tBbmRVcGRhdGVCcmVha3BvaW50KClcbiAgfSwgW10pXG5cbiAgcy51c2VTdGF0ZXMoe1xuICAgIGJyZWFrcG9pbnQ6ICgpID0+IGNhbGN1bGF0ZUJyZWFrUG9pbnQocy5tLmJyZWFrcG9pbnRzKVxuICB9KVxuXG4gIGNvbnN0IHN0eWxpbmcgPSB1c2VDYWxsYmFjaygoYXJncykgPT4ge1xuICAgIGNvbnN0IHN0eWxlID0gT2JqZWN0LmFzc2lnbih7fSwgYXJncy5iYXNlKVxuXG4gICAgZm9yIChjb25zdCBicmVha3BvaW50RGF0YSBvZiBzLm0uYnJlYWtwb2ludHMpIHtcbiAgICAgIGNvbnN0IGJyZWFrcG9pbnQgPSBicmVha3BvaW50RGF0YVswXVxuXG4gICAgICBmb3IgKGNvbnN0IHNpemVUeXBlIG9mIHNpemVUeXBlcykge1xuICAgICAgICBjb25zdCBicmVha3BvaW50V2l0aFNpemVUeXBlID0gYCR7YnJlYWtwb2ludH0ke2luZmxlY3Rpb24uY2FtZWxpemUoc2l6ZVR5cGUpfWBcblxuICAgICAgICBpZiAoYXJnc1ticmVha3BvaW50V2l0aFNpemVUeXBlXSAmJiBzLnMuYnJlYWtwb2ludFticmVha3BvaW50V2l0aFNpemVUeXBlXSkge1xuICAgICAgICAgIE9iamVjdC5hc3NpZ24oc3R5bGUsIGFyZ3NbYnJlYWtwb2ludFdpdGhTaXplVHlwZV0pXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gc3R5bGVcbiAgfSwgW10pXG5cbiAgdXNlRXZlbnRFbWl0dGVyKGNvbmZpZy5nZXRFdmVudHMoKSwgXCJvbkJyZWFrcG9pbnRzQ2hhbmdlXCIsIG9uQnJlYWtwb2ludHNDaGFuZ2UpXG4gIHVzZUV2ZW50TGlzdGVuZXIoRGltZW5zaW9ucywgXCJjaGFuZ2VcIiwgb25EaW1lbnNpb25zQ2hhbmdlKVxuXG4gIHJldHVybiB7XG4gICAgc3R5bGluZyxcbiAgICAuLi5zLnMuYnJlYWtwb2ludFxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IHVzZUJyZWFrcG9pbnRcbiJdfQ==