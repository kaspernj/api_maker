import { jsx as _jsx } from "react/jsx-runtime";
import { Platform, Pressable } from "react-native";
import BaseComponent from "./base-component";
import dataSetToAttributes from "./data-set-to-attributes.js";
import memo from "set-state-compare/build/memo.js";
import PropTypes from "prop-types";
import React from "react";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import { useApiMaker } from "@kaspernj/api-maker/build/with-api-maker.js";
export default memo(shapeComponent(class ApiMakerLink extends BaseComponent {
    static propTypes = {
        usePressable: PropTypes.bool
    };
    setup() {
        this.apiMaker = useApiMaker();
    }
    render() {
        const { dataSet, to, onClick, onPress, testID, usePressable, ...restProps } = this.props;
        if (Platform.OS == "web" && !usePressable) {
            return (_jsx("a", { ...dataSetToAttributes(Object.assign({ testid: testID }, dataSet)), href: to || "#", ...restProps, onClick: this.tt.onLinkClicked }));
        }
        return (_jsx(Pressable, { dataSet: dataSet, onPress: this.tt.onPress, testID: testID, ...restProps }));
    }
    onLinkClicked = (e, ...restArgs) => {
        const { onClick, onPress } = this.props;
        if (onClick) {
            onClick(e, ...restArgs);
        }
        if (onPress) {
            onPress(e, ...restArgs);
        }
        if (!e.defaultPrevented && !e.ctrlKey && !e.metaKey && this.props.target != "_blank") {
            e.preventDefault();
            this.redirect();
        }
    };
    onPress = () => {
        const { onClick, onPress } = this.props;
        if (onClick) {
            onClick(e, ...restArgs);
        }
        if (onPress) {
            onPress(e, ...restArgs);
        }
        this.redirect();
    };
    redirect = () => {
        // If no timeout is used, this can cause an "component suspended while responding to synchronous input"-error
        setTimeout(() => { this._historyPush(); }, 0);
    };
    _historyPush() {
        const history = this.apiMaker.config.getHistory();
        if (!history)
            throw new Error("History hasn't been set in the API maker configuration");
        history.push(this.props.to);
    }
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGluay5qcyIsInNvdXJjZVJvb3QiOiIvc3JjLyIsInNvdXJjZXMiOlsibGluay5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBQyxRQUFRLEVBQUUsU0FBUyxFQUFDLE1BQU0sY0FBYyxDQUFBO0FBQ2hELE9BQU8sYUFBYSxNQUFNLGtCQUFrQixDQUFBO0FBQzVDLE9BQU8sbUJBQW1CLE1BQU0sNkJBQTZCLENBQUE7QUFDN0QsT0FBTyxJQUFJLE1BQU0saUNBQWlDLENBQUE7QUFDbEQsT0FBTyxTQUFTLE1BQU0sWUFBWSxDQUFBO0FBQ2xDLE9BQU8sS0FBSyxNQUFNLE9BQU8sQ0FBQTtBQUN6QixPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sNENBQTRDLENBQUE7QUFDekUsT0FBTyxFQUFDLFdBQVcsRUFBQyxNQUFNLDZDQUE2QyxDQUFBO0FBRXZFLGVBQWUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLFlBQWEsU0FBUSxhQUFhO0lBQ3pFLE1BQU0sQ0FBQyxTQUFTLEdBQUc7UUFDakIsWUFBWSxFQUFFLFNBQVMsQ0FBQyxJQUFJO0tBQzdCLENBQUE7SUFFRCxLQUFLO1FBQ0gsSUFBSSxDQUFDLFFBQVEsR0FBRyxXQUFXLEVBQUUsQ0FBQTtJQUMvQixDQUFDO0lBRUQsTUFBTTtRQUNKLE1BQU0sRUFBQyxPQUFPLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxHQUFHLFNBQVMsRUFBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUE7UUFFdEYsSUFBSSxRQUFRLENBQUMsRUFBRSxJQUFJLEtBQUssSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQzFDLE9BQU8sQ0FDTCxlQUFPLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBQyxNQUFNLEVBQUUsTUFBTSxFQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsRUFBRSxJQUFJLEdBQUcsS0FBTSxTQUFTLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxHQUFJLENBQ3pJLENBQUE7UUFDSCxDQUFDO1FBRUQsT0FBTyxDQUNMLEtBQUMsU0FBUyxJQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLEtBQU0sU0FBUyxHQUFJLENBQ3pGLENBQUE7SUFDSCxDQUFDO0lBRUQsYUFBYSxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsUUFBUSxFQUFFLEVBQUU7UUFDakMsTUFBTSxFQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFBO1FBRXJDLElBQUksT0FBTyxFQUFFLENBQUM7WUFDWixPQUFPLENBQUMsQ0FBQyxFQUFFLEdBQUcsUUFBUSxDQUFDLENBQUE7UUFDekIsQ0FBQztRQUVELElBQUksT0FBTyxFQUFFLENBQUM7WUFDWixPQUFPLENBQUMsQ0FBQyxFQUFFLEdBQUcsUUFBUSxDQUFDLENBQUE7UUFDekIsQ0FBQztRQUVELElBQUksQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLElBQUksQ0FBQyxDQUFDLENBQUMsT0FBTyxJQUFJLENBQUMsQ0FBQyxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sSUFBSSxRQUFRLEVBQUUsQ0FBQztZQUNyRixDQUFDLENBQUMsY0FBYyxFQUFFLENBQUE7WUFFbEIsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFBO1FBQ2pCLENBQUM7SUFDSCxDQUFDLENBQUE7SUFFRCxPQUFPLEdBQUcsR0FBRyxFQUFFO1FBQ2IsTUFBTSxFQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFBO1FBRXJDLElBQUksT0FBTyxFQUFFLENBQUM7WUFDWixPQUFPLENBQUMsQ0FBQyxFQUFFLEdBQUcsUUFBUSxDQUFDLENBQUE7UUFDekIsQ0FBQztRQUVELElBQUksT0FBTyxFQUFFLENBQUM7WUFDWixPQUFPLENBQUMsQ0FBQyxFQUFFLEdBQUcsUUFBUSxDQUFDLENBQUE7UUFDekIsQ0FBQztRQUVELElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtJQUNqQixDQUFDLENBQUE7SUFFRCxRQUFRLEdBQUcsR0FBRyxFQUFFO1FBQ2QsNkdBQTZHO1FBQzdHLFVBQVUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7SUFDOUMsQ0FBQyxDQUFBO0lBRUQsWUFBWTtRQUNWLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLFVBQVUsRUFBRSxDQUFBO1FBRWpELElBQUksQ0FBQyxPQUFPO1lBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyx3REFBd0QsQ0FBQyxDQUFBO1FBRXZGLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQTtJQUM3QixDQUFDO0NBQ0YsQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1BsYXRmb3JtLCBQcmVzc2FibGV9IGZyb20gXCJyZWFjdC1uYXRpdmVcIlxuaW1wb3J0IEJhc2VDb21wb25lbnQgZnJvbSBcIi4vYmFzZS1jb21wb25lbnRcIlxuaW1wb3J0IGRhdGFTZXRUb0F0dHJpYnV0ZXMgZnJvbSBcIi4vZGF0YS1zZXQtdG8tYXR0cmlidXRlcy5qc1wiXG5pbXBvcnQgbWVtbyBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvbWVtby5qc1wiXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gXCJwcm9wLXR5cGVzXCJcbmltcG9ydCBSZWFjdCBmcm9tIFwicmVhY3RcIlxuaW1wb3J0IHtzaGFwZUNvbXBvbmVudH0gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL3NoYXBlLWNvbXBvbmVudC5qc1wiXG5pbXBvcnQge3VzZUFwaU1ha2VyfSBmcm9tIFwiQGthc3Blcm5qL2FwaS1tYWtlci9idWlsZC93aXRoLWFwaS1tYWtlci5qc1wiXG5cbmV4cG9ydCBkZWZhdWx0IG1lbW8oc2hhcGVDb21wb25lbnQoY2xhc3MgQXBpTWFrZXJMaW5rIGV4dGVuZHMgQmFzZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgdXNlUHJlc3NhYmxlOiBQcm9wVHlwZXMuYm9vbFxuICB9XG5cbiAgc2V0dXAoKSB7XG4gICAgdGhpcy5hcGlNYWtlciA9IHVzZUFwaU1ha2VyKClcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7ZGF0YVNldCwgdG8sIG9uQ2xpY2ssIG9uUHJlc3MsIHRlc3RJRCwgdXNlUHJlc3NhYmxlLCAuLi5yZXN0UHJvcHN9ID0gdGhpcy5wcm9wc1xuXG4gICAgaWYgKFBsYXRmb3JtLk9TID09IFwid2ViXCIgJiYgIXVzZVByZXNzYWJsZSkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGEgey4uLmRhdGFTZXRUb0F0dHJpYnV0ZXMoT2JqZWN0LmFzc2lnbih7dGVzdGlkOiB0ZXN0SUR9LCBkYXRhU2V0KSl9IGhyZWY9e3RvIHx8IFwiI1wifSB7Li4ucmVzdFByb3BzfSBvbkNsaWNrPXt0aGlzLnR0Lm9uTGlua0NsaWNrZWR9IC8+XG4gICAgICApXG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxQcmVzc2FibGUgZGF0YVNldD17ZGF0YVNldH0gb25QcmVzcz17dGhpcy50dC5vblByZXNzfSB0ZXN0SUQ9e3Rlc3RJRH0gey4uLnJlc3RQcm9wc30gLz5cbiAgICApXG4gIH1cblxuICBvbkxpbmtDbGlja2VkID0gKGUsIC4uLnJlc3RBcmdzKSA9PiB7XG4gICAgY29uc3Qge29uQ2xpY2ssIG9uUHJlc3N9ID0gdGhpcy5wcm9wc1xuXG4gICAgaWYgKG9uQ2xpY2spIHtcbiAgICAgIG9uQ2xpY2soZSwgLi4ucmVzdEFyZ3MpXG4gICAgfVxuXG4gICAgaWYgKG9uUHJlc3MpIHtcbiAgICAgIG9uUHJlc3MoZSwgLi4ucmVzdEFyZ3MpXG4gICAgfVxuXG4gICAgaWYgKCFlLmRlZmF1bHRQcmV2ZW50ZWQgJiYgIWUuY3RybEtleSAmJiAhZS5tZXRhS2V5ICYmIHRoaXMucHJvcHMudGFyZ2V0ICE9IFwiX2JsYW5rXCIpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKVxuXG4gICAgICB0aGlzLnJlZGlyZWN0KClcbiAgICB9XG4gIH1cblxuICBvblByZXNzID0gKCkgPT4ge1xuICAgIGNvbnN0IHtvbkNsaWNrLCBvblByZXNzfSA9IHRoaXMucHJvcHNcblxuICAgIGlmIChvbkNsaWNrKSB7XG4gICAgICBvbkNsaWNrKGUsIC4uLnJlc3RBcmdzKVxuICAgIH1cblxuICAgIGlmIChvblByZXNzKSB7XG4gICAgICBvblByZXNzKGUsIC4uLnJlc3RBcmdzKVxuICAgIH1cblxuICAgIHRoaXMucmVkaXJlY3QoKVxuICB9XG5cbiAgcmVkaXJlY3QgPSAoKSA9PiB7XG4gICAgLy8gSWYgbm8gdGltZW91dCBpcyB1c2VkLCB0aGlzIGNhbiBjYXVzZSBhbiBcImNvbXBvbmVudCBzdXNwZW5kZWQgd2hpbGUgcmVzcG9uZGluZyB0byBzeW5jaHJvbm91cyBpbnB1dFwiLWVycm9yXG4gICAgc2V0VGltZW91dCgoKSA9PiB7IHRoaXMuX2hpc3RvcnlQdXNoKCkgfSwgMClcbiAgfVxuXG4gIF9oaXN0b3J5UHVzaCgpIHtcbiAgICBjb25zdCBoaXN0b3J5ID0gdGhpcy5hcGlNYWtlci5jb25maWcuZ2V0SGlzdG9yeSgpXG5cbiAgICBpZiAoIWhpc3RvcnkpIHRocm93IG5ldyBFcnJvcihcIkhpc3RvcnkgaGFzbid0IGJlZW4gc2V0IGluIHRoZSBBUEkgbWFrZXIgY29uZmlndXJhdGlvblwiKVxuXG4gICAgaGlzdG9yeS5wdXNoKHRoaXMucHJvcHMudG8pXG4gIH1cbn0pKVxuIl19