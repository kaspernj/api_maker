import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import React, { useMemo } from "react";
import { digg } from "diggerize";
import * as inflection from "inflection";
import memo from "set-state-compare/build/memo.js";
import MoneyFormatter from "../money-formatter.js";
import PropTypes from "prop-types";
import { shapeComponent, ShapeComponent } from "set-state-compare/build/shape-component.js";
import strftime from "strftime";
import Text from "../utils/text";
import useI18n from "i18n-on-steroids/src/use-i18n.mjs";
import { View } from "react-native";
export default memo(shapeComponent(class ApiMakerBootstrapAttributeRow extends ShapeComponent {
    static defaultProps = {
        checkIfAttributeLoaded: false
    };
    static propTypes = {
        attribute: PropTypes.string,
        checkIfAttributeLoaded: PropTypes.bool.isRequired,
        children: PropTypes.any,
        identifier: PropTypes.string,
        label: PropTypes.oneOfType([PropTypes.any, PropTypes.string]),
        model: PropTypes.object,
        value: PropTypes.any
    };
    setup() {
        const { l, t } = useI18n({ namespace: "js.api_maker.attribute_row" });
        this.l = l;
        this.t = t;
        this.attribute = useMemo(() => {
            if (this.props.attribute) {
                return this.props.model?.constructor?.attributes()?.find((attribute) => attribute.name() == inflection.underscore(this.props.attribute));
            }
        }, [this.props.attribute, this.props.model]);
    }
    render() {
        const { attribute, checkIfAttributeLoaded, children, className, identifier, label, model, style, value, ...restProps } = this.props;
        const actualStyle = Object.assign({
            paddingVertical: 8
        }, style);
        return (_jsxs(View, { dataSet: {
                attribute,
                class: className,
                component: "api-maker/attribute-row",
                identifier
            }, style: actualStyle, ...restProps, children: [_jsx(Text, { dataSet: this.cache("labelTextDataSet", { class: "attribute-row-label" }), style: this.cache("labelTextStyle", { fontWeight: "bold" }), children: this.label() }), _jsx(View, { dataSet: this.cache("valueViewDataSet", { class: "attribute-row-value" }), style: this.cache("valueViewStyle", { marginTop: 3 }), children: this.value() })] }));
    }
    label() {
        const { attribute, label, model } = this.props;
        if ("label" in this.props)
            return label;
        if (attribute && model)
            return model.constructor.humanAttributeName(attribute);
        throw new Error("Couldn't figure out label");
    }
    value() {
        const { attribute, checkIfAttributeLoaded, children, model } = this.props;
        if (children)
            return children;
        if (attribute && !(attribute in model))
            throw new Error(`Attribute not found: ${digg(model.modelClassData(), "name")}#${attribute}`);
        if (attribute && checkIfAttributeLoaded && !model.isAttributeLoaded(attribute))
            return null;
        if (attribute && model) {
            const value = model[attribute]();
            return this.valueContent(value);
        }
    }
    valueContent(value) {
        const { l, t } = this.tt;
        const columnType = this.attribute?.getColumn()?.getType();
        if (columnType == "date") {
            return (_jsx(Text, { children: l("date.formats.default", value) }));
        }
        else if (value instanceof Date) {
            return (_jsx(Text, { children: strftime("%Y-%m-%d %H:%M", value) }));
        }
        else if (typeof value === "boolean") {
            if (value) {
                return (_jsx(Text, { children: t("js.shared.yes", { defaultValue: "Yes" }) }));
            }
            return (_jsx(Text, { children: t("js.shared.no", { defaultValue: "No" }) }));
        }
        else if (MoneyFormatter.isMoney(value)) {
            return (_jsx(Text, { children: MoneyFormatter.format(value) }));
        }
        else if (typeof value == "string") {
            return (_jsx(Text, { children: value }));
        }
        else {
            return value;
        }
    }
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXR0cmlidXRlLXJvdy5qcyIsInNvdXJjZVJvb3QiOiIvc3JjLyIsInNvdXJjZXMiOlsiYm9vdHN0cmFwL2F0dHJpYnV0ZS1yb3cuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEtBQUssRUFBRSxFQUFDLE9BQU8sRUFBQyxNQUFNLE9BQU8sQ0FBQTtBQUNwQyxPQUFPLEVBQUMsSUFBSSxFQUFDLE1BQU0sV0FBVyxDQUFBO0FBQzlCLE9BQU8sS0FBSyxVQUFVLE1BQU0sWUFBWSxDQUFBO0FBQ3hDLE9BQU8sSUFBSSxNQUFNLGlDQUFpQyxDQUFBO0FBQ2xELE9BQU8sY0FBYyxNQUFNLHVCQUF1QixDQUFBO0FBQ2xELE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQTtBQUNsQyxPQUFPLEVBQUMsY0FBYyxFQUFFLGNBQWMsRUFBQyxNQUFNLDRDQUE0QyxDQUFBO0FBQ3pGLE9BQU8sUUFBUSxNQUFNLFVBQVUsQ0FBQTtBQUMvQixPQUFPLElBQUksTUFBTSxlQUFlLENBQUE7QUFDaEMsT0FBTyxPQUFPLE1BQU0sbUNBQW1DLENBQUE7QUFDdkQsT0FBTyxFQUFDLElBQUksRUFBQyxNQUFNLGNBQWMsQ0FBQTtBQUVqQyxlQUFlLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSw2QkFBOEIsU0FBUSxjQUFjO0lBQzNGLE1BQU0sQ0FBQyxZQUFZLEdBQUc7UUFDcEIsc0JBQXNCLEVBQUUsS0FBSztLQUM5QixDQUFBO0lBRUQsTUFBTSxDQUFDLFNBQVMsR0FBRztRQUNqQixTQUFTLEVBQUUsU0FBUyxDQUFDLE1BQU07UUFDM0Isc0JBQXNCLEVBQUUsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVO1FBQ2pELFFBQVEsRUFBRSxTQUFTLENBQUMsR0FBRztRQUN2QixVQUFVLEVBQUUsU0FBUyxDQUFDLE1BQU07UUFDNUIsS0FBSyxFQUFFLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztR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QUssRUFBRSxDQUFDO2dCQUNWLE9BQU8sQ0FDTCxLQUFDLElBQUksY0FBRSxDQUFDLENBQUMsZUFBZSxFQUFFLEVBQUMsWUFBWSxFQUFFLEtBQUssRUFBQyxDQUFDLEdBQVEsQ0FDekQsQ0FBQTtZQUNILENBQUM7WUFFRCxPQUFPLENBQ0wsS0FBQyxJQUFJLGNBQUUsQ0FBQyxDQUFDLGNBQWMsRUFBRSxFQUFDLFlBQVksRUFBRSxJQUFJLEVBQUMsQ0FBQyxHQUFRLENBQ3ZELENBQUE7UUFDSCxDQUFDO2FBQU0sSUFBSSxjQUFjLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDekMsT0FBTyxDQUNMLEtBQUMsSUFBSSxjQUFFLGNBQWMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQVEsQ0FDNUMsQ0FBQTtRQUNILENBQUM7YUFBTSxJQUFJLE9BQU8sS0FBSyxJQUFJLFFBQVEsRUFBRSxDQUFDO1lBQ3BDLE9BQU8sQ0FDTCxLQUFDLElBQUksY0FBRSxLQUFLLEdBQVEsQ0FDckIsQ0FBQTtRQUNILENBQUM7YUFBTSxDQUFDO1lBQ04sT0FBTyxLQUFLLENBQUE7UUFDZCxDQUFDO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7dXNlTWVtb30gZnJvbSBcInJlYWN0XCJcbmltcG9ydCB7ZGlnZ30gZnJvbSBcImRpZ2dlcml6ZVwiXG5pbXBvcnQgKiBhcyBpbmZsZWN0aW9uIGZyb20gXCJpbmZsZWN0aW9uXCJcbmltcG9ydCBtZW1vIGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9tZW1vLmpzXCJcbmltcG9ydCBNb25leUZvcm1hdHRlciBmcm9tIFwiLi4vbW9uZXktZm9ybWF0dGVyLmpzXCJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIlxuaW1wb3J0IHtzaGFwZUNvbXBvbmVudCwgU2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IHN0cmZ0aW1lIGZyb20gXCJzdHJmdGltZVwiXG5pbXBvcnQgVGV4dCBmcm9tIFwiLi4vdXRpbHMvdGV4dFwiXG5pbXBvcnQgdXNlSTE4biBmcm9tIFwiaTE4bi1vbi1zdGVyb2lkcy9zcmMvdXNlLWkxOG4ubWpzXCJcbmltcG9ydCB7Vmlld30gZnJvbSBcInJlYWN0LW5hdGl2ZVwiXG5cbmV4cG9ydCBkZWZhdWx0IG1lbW8oc2hhcGVDb21wb25lbnQoY2xhc3MgQXBpTWFrZXJCb290c3RyYXBBdHRyaWJ1dGVSb3cgZXh0ZW5kcyBTaGFwZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgY2hlY2tJZkF0dHJpYnV0ZUxvYWRlZDogZmFsc2VcbiAgfVxuXG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgYXR0cmlidXRlOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGNoZWNrSWZBdHRyaWJ1dGVMb2FkZWQ6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsXG4gICAgY2hpbGRyZW46IFByb3BUeXBlcy5hbnksXG4gICAgaWRlbnRpZmllcjogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBsYWJlbDogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLmFueSwgUHJvcFR5cGVzLnN0cmluZ10pLFxuICAgIG1vZGVsOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIHZhbHVlOiBQcm9wVHlwZXMuYW55XG4gIH1cblxuICBzZXR1cCgpIHtcbiAgICBjb25zdCB7bCwgdH0gPSB1c2VJMThuKHtuYW1lc3BhY2U6IFwianMuYXBpX21ha2VyLmF0dHJpYnV0ZV9yb3dcIn0pXG5cbiAgICB0aGlzLmwgPSBsXG4gICAgdGhpcy50ID0gdFxuICAgIHRoaXMuYXR0cmlidXRlID0gdXNlTWVtbyhcbiAgICAgICgpID0+IHtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMuYXR0cmlidXRlKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMucHJvcHMubW9kZWw/LmNvbnN0cnVjdG9yPy5hdHRyaWJ1dGVzKCk/LmZpbmQoKGF0dHJpYnV0ZSkgPT4gYXR0cmlidXRlLm5hbWUoKSA9PSBpbmZsZWN0aW9uLnVuZGVyc2NvcmUodGhpcy5wcm9wcy5hdHRyaWJ1dGUpKVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgW3RoaXMucHJvcHMuYXR0cmlidXRlLCB0aGlzLnByb3BzLm1vZGVsXVxuICAgIClcbiAgfVxuXG4gIHJlbmRlciAoKSB7XG4gICAgY29uc3Qge2F0dHJpYnV0ZSwgY2hlY2tJZkF0dHJpYnV0ZUxvYWRlZCwgY2hpbGRyZW4sIGNsYXNzTmFtZSwgaWRlbnRpZmllciwgbGFiZWwsIG1vZGVsLCBzdHlsZSwgdmFsdWUsIC4uLnJlc3RQcm9wc30gPSB0aGlzLnByb3BzXG4gICAgY29uc3QgYWN0dWFsU3R5bGUgPSBPYmplY3QuYXNzaWduKFxuICAgICAge1xuICAgICAgICBwYWRkaW5nVmVydGljYWw6IDhcbiAgICAgIH0sXG4gICAgICBzdHlsZVxuICAgIClcblxuICAgIHJldHVybiAoXG4gICAgICA8Vmlld1xuICAgICAgICBkYXRhU2V0PXt7XG4gICAgICAgICAgYXR0cmlidXRlLFxuICAgICAgICAgIGNsYXNzOiBjbGFzc05hbWUsXG4gICAgICAgICAgY29tcG9uZW50OiBcImFwaS1tYWtlci9hdHRyaWJ1dGUtcm93XCIsXG4gICAgICAgICAgaWRlbnRpZmllclxuICAgICAgICB9fVxuICAgICAgICBzdHlsZT17YWN0dWFsU3R5bGV9XG4gICAgICAgIHsuLi5yZXN0UHJvcHN9XG4gICAgICA+XG4gICAgICAgIDxUZXh0IGRhdGFTZXQ9e3RoaXMuY2FjaGUoXCJsYWJlbFRleHREYXRhU2V0XCIsIHtjbGFzczogXCJhdHRyaWJ1dGUtcm93LWxhYmVsXCJ9KX0gc3R5bGU9e3RoaXMuY2FjaGUoXCJsYWJlbFRleHRTdHlsZVwiLCB7Zm9udFdlaWdodDogXCJib2xkXCJ9KX0+XG4gICAgICAgICAge3RoaXMubGFiZWwoKX1cbiAgICAgICAgPC9UZXh0PlxuICAgICAgICA8VmlldyBkYXRhU2V0PXt0aGlzLmNhY2hlKFwidmFsdWVWaWV3RGF0YVNldFwiLCB7Y2xhc3M6IFwiYXR0cmlidXRlLXJvdy12YWx1ZVwifSl9IHN0eWxlPXt0aGlzLmNhY2hlKFwidmFsdWVWaWV3U3R5bGVcIiwge21hcmdpblRvcDogM30pfT5cbiAgICAgICAgICB7dGhpcy52YWx1ZSgpfVxuICAgICAgICA8L1ZpZXc+XG4gICAgICA8L1ZpZXc+XG4gICAgKVxuICB9XG5cbiAgbGFiZWwoKSB7XG4gICAgY29uc3Qge2F0dHJpYnV0ZSwgbGFiZWwsIG1vZGVsfSA9IHRoaXMucHJvcHNcblxuICAgIGlmIChcImxhYmVsXCIgaW4gdGhpcy5wcm9wcykgcmV0dXJuIGxhYmVsXG4gICAgaWYgKGF0dHJpYnV0ZSAmJiBtb2RlbCkgcmV0dXJuIG1vZGVsLmNvbnN0cnVjdG9yLmh1bWFuQXR0cmlidXRlTmFtZShhdHRyaWJ1dGUpXG5cbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZG4ndCBmaWd1cmUgb3V0IGxhYmVsXCIpXG4gIH1cblxuICB2YWx1ZSgpIHtcbiAgICBjb25zdCB7YXR0cmlidXRlLCBjaGVja0lmQXR0cmlidXRlTG9hZGVkLCBjaGlsZHJlbiwgbW9kZWx9ID0gdGhpcy5wcm9wc1xuXG4gICAgaWYgKGNoaWxkcmVuKSByZXR1cm4gY2hpbGRyZW5cblxuICAgIGlmIChhdHRyaWJ1dGUgJiYgIShhdHRyaWJ1dGUgaW4gbW9kZWwpKVxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBBdHRyaWJ1dGUgbm90IGZvdW5kOiAke2RpZ2cobW9kZWwubW9kZWxDbGFzc0RhdGEoKSwgXCJuYW1lXCIpfSMke2F0dHJpYnV0ZX1gKVxuXG4gICAgaWYgKGF0dHJpYnV0ZSAmJiBjaGVja0lmQXR0cmlidXRlTG9hZGVkICYmICFtb2RlbC5pc0F0dHJpYnV0ZUxvYWRlZChhdHRyaWJ1dGUpKVxuICAgICAgcmV0dXJuIG51bGxcblxuICAgIGlmIChhdHRyaWJ1dGUgJiYgbW9kZWwpIHtcbiAgICAgIGNvbnN0IHZhbHVlID0gbW9kZWxbYXR0cmlidXRlXSgpXG5cbiAgICAgIHJldHVybiB0aGlzLnZhbHVlQ29udGVudCh2YWx1ZSlcbiAgICB9XG4gIH1cblxuICB2YWx1ZUNvbnRlbnQodmFsdWUpIHtcbiAgICBjb25zdCB7bCwgdH0gPSB0aGlzLnR0XG4gICAgY29uc3QgY29sdW1uVHlwZSA9IHRoaXMuYXR0cmlidXRlPy5nZXRDb2x1bW4oKT8uZ2V0VHlwZSgpXG5cbiAgICBpZiAoY29sdW1uVHlwZSA9PSBcImRhdGVcIikge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPFRleHQ+e2woXCJkYXRlLmZvcm1hdHMuZGVmYXVsdFwiLCB2YWx1ZSl9PC9UZXh0PlxuICAgICAgKVxuICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8VGV4dD57c3RyZnRpbWUoXCIlWS0lbS0lZCAlSDolTVwiLCB2YWx1ZSl9PC9UZXh0PlxuICAgICAgKVxuICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSBcImJvb2xlYW5cIikge1xuICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgPFRleHQ+e3QoXCJqcy5zaGFyZWQueWVzXCIsIHtkZWZhdWx0VmFsdWU6IFwiWWVzXCJ9KX08L1RleHQ+XG4gICAgICAgIClcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPFRleHQ+e3QoXCJqcy5zaGFyZWQubm9cIiwge2RlZmF1bHRWYWx1ZTogXCJOb1wifSl9PC9UZXh0PlxuICAgICAgKVxuICAgIH0gZWxzZSBpZiAoTW9uZXlGb3JtYXR0ZXIuaXNNb25leSh2YWx1ZSkpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxUZXh0PntNb25leUZvcm1hdHRlci5mb3JtYXQodmFsdWUpfTwvVGV4dD5cbiAgICAgIClcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PSBcInN0cmluZ1wiKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8VGV4dD57dmFsdWV9PC9UZXh0PlxuICAgICAgKVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdmFsdWVcbiAgICB9XG4gIH1cbn0pKVxuIl19