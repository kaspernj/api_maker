import React, { useMemo } from "react";
import { digg } from "diggerize";
import * as inflection from "inflection";
import memo from "set-state-compare/build/memo.js";
import MoneyFormatter from "../money-formatter.js";
import PropTypes from "prop-types";
import { shapeComponent, ShapeComponent } from "set-state-compare/build/shape-component.js";
import strftime from "strftime";
import Text from "../utils/text.js";
import useI18n from "i18n-on-steroids/src/use-i18n.mjs";
import { View } from "react-native";
export default memo(shapeComponent(class ApiMakerBootstrapAttributeRow extends ShapeComponent {
    static defaultProps = {
        checkIfAttributeLoaded: false
    };
    static propTypes = {
        attribute: PropTypes.string,
        checkIfAttributeLoaded: PropTypes.bool.isRequired,
        children: PropTypes.any,
        identifier: PropTypes.string,
        label: PropTypes.oneOfType([PropTypes.any, PropTypes.string]),
        model: PropTypes.object,
        value: PropTypes.any
    };
    setup() {
        const { l, t } = useI18n({ namespace: "js.api_maker.attribute_row" });
        this.l = l;
        this.t = t;
        this.attribute = useMemo(() => {
            if (this.props.attribute) {
                return this.props.model?.constructor?.attributes()?.find((attribute) => attribute.name() == inflection.underscore(this.props.attribute));
            }
        }, [this.props.attribute, this.props.model]);
    }
    render() {
        const { attribute, checkIfAttributeLoaded, children, className, identifier, label, model, style, value, ...restProps } = this.props;
        const actualStyle = Object.assign({
            paddingVertical: 8
        }, style);
        return (<View dataSet={{
                attribute,
                class: className,
                component: "api-maker/attribute-row",
                identifier
            }} style={actualStyle} {...restProps}>
        <Text dataSet={this.cache("labelTextDataSet", { class: "attribute-row-label" })} style={this.cache("labelTextStyle", { fontWeight: "bold" })}>
          {this.label()}
        </Text>
        <View dataSet={this.cache("valueViewDataSet", { class: "attribute-row-value" })} style={this.cache("valueViewStyle", { marginTop: 3 })}>
          {this.value()}
        </View>
      </View>);
    }
    label() {
        const { attribute, label, model } = this.props;
        if ("label" in this.props)
            return label;
        if (attribute && model)
            return model.constructor.humanAttributeName(attribute);
        throw new Error("Couldn't figure out label");
    }
    value() {
        const { attribute, checkIfAttributeLoaded, children, model } = this.props;
        if (children)
            return children;
        if (attribute && !(attribute in model))
            throw new Error(`Attribute not found: ${digg(model.modelClassData(), "name")}#${attribute}`);
        if (attribute && checkIfAttributeLoaded && !model.isAttributeLoaded(attribute))
            return null;
        if (attribute && model) {
            const value = model[attribute]();
            return this.valueContent(value);
        }
    }
    valueContent(value) {
        const { l, t } = this.tt;
        const columnType = this.attribute?.getColumn()?.getType();
        if (columnType == "date") {
            return (<Text>{l("date.formats.default", value)}</Text>);
        }
        else if (value instanceof Date) {
            return (<Text>{strftime("%Y-%m-%d %H:%M", value)}</Text>);
        }
        else if (typeof value === "boolean") {
            if (value) {
                return (<Text>{t("js.shared.yes", { defaultValue: "Yes" })}</Text>);
            }
            return (<Text>{t("js.shared.no", { defaultValue: "No" })}</Text>);
        }
        else if (MoneyFormatter.isMoney(value)) {
            return (<Text>{MoneyFormatter.format(value)}</Text>);
        }
        else if (typeof value == "string") {
            return (<Text>{value}</Text>);
        }
        else {
            return value;
        }
    }
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXR0cmlidXRlLXJvdy5qcyIsInNvdXJjZVJvb3QiOiIvc3JjLyIsInNvdXJjZXMiOlsiYm9vdHN0cmFwL2F0dHJpYnV0ZS1yb3cuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxFQUFFLEVBQUMsT0FBTyxFQUFDLE1BQU0sT0FBTyxDQUFBO0FBQ3BDLE9BQU8sRUFBQyxJQUFJLEVBQUMsTUFBTSxXQUFXLENBQUE7QUFDOUIsT0FBTyxLQUFLLFVBQVUsTUFBTSxZQUFZLENBQUE7QUFDeEMsT0FBTyxJQUFJLE1BQU0saUNBQWlDLENBQUE7QUFDbEQsT0FBTyxjQUFjLE1BQU0sdUJBQXVCLENBQUE7QUFDbEQsT0FBTyxTQUFTLE1BQU0sWUFBWSxDQUFBO0FBQ2xDLE9BQU8sRUFBQyxjQUFjLEVBQUUsY0FBYyxFQUFDLE1BQU0sNENBQTRDLENBQUE7QUFDekYsT0FBTyxRQUFRLE1BQU0sVUFBVSxDQUFBO0FBQy9CLE9BQU8sSUFBSSxNQUFNLGtCQUFrQixDQUFBO0FBQ25DLE9BQU8sT0FBTyxNQUFNLG1DQUFtQyxDQUFBO0FBQ3ZELE9BQU8sRUFBQyxJQUFJLEVBQUMsTUFBTSxjQUFjLENBQUE7QUFFakMsZUFBZSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sNkJBQThCLFNBQVEsY0FBYztJQUMzRixNQUFNLENBQUMsWUFBWSxHQUFHO1FBQ3BCLHNCQUFzQixFQUFFLEtBQUs7S0FDOUIsQ0FBQTtJQUVELE1BQU0sQ0FBQyxTQUFTLEdBQUc7UUFDakIsU0FBUyxFQUFFLFNBQVMsQ0FBQyxNQUFNO1FBQzNCLHNCQUFzQixFQUFFLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVTtRQUNqRCxRQUFRLEVBQUUsU0FBUyxDQUFDLEdBQUc7UUFDdkIsVUFBVSxFQUFFLFNBQVMsQ0FBQyxNQUFNO1FBQzVCLEtBQUssRUFBRSxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7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SUFBSSxLQUFLLFlBQVksSUFBSSxFQUFFLENBQUM7WUFDakMsT0FBTyxDQUNMLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLGdCQUFnQixFQUFFLEtBQUssQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQ2pELENBQUE7UUFDSCxDQUFDO2FBQU0sSUFBSSxPQUFPLEtBQUssS0FBSyxTQUFTLEVBQUUsQ0FBQztZQUN0QyxJQUFJLEtBQUssRUFBRSxDQUFDO2dCQUNWLE9BQU8sQ0FDTCxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxlQUFlLEVBQUUsRUFBQyxZQUFZLEVBQUUsS0FBSyxFQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUN6RCxDQUFBO1lBQ0gsQ0FBQztZQUVELE9BQU8sQ0FDTCxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxjQUFjLEVBQUUsRUFBQyxZQUFZLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUN2RCxDQUFBO1FBQ0gsQ0FBQzthQUFNLElBQUksY0FBYyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ3pDLE9BQU8sQ0FDTCxDQUFDLElBQUksQ0FBQyxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FDNUMsQ0FBQTtRQUNILENBQUM7YUFBTSxJQUFJLE9BQU8sS0FBSyxJQUFJLFFBQVEsRUFBRSxDQUFDO1lBQ3BDLE9BQU8sQ0FDTCxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUNyQixDQUFBO1FBQ0gsQ0FBQzthQUFNLENBQUM7WUFDTixPQUFPLEtBQUssQ0FBQTtRQUNkLENBQUM7SUFDSCxDQUFDO0NBQ0YsQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHt1c2VNZW1vfSBmcm9tIFwicmVhY3RcIlxuaW1wb3J0IHtkaWdnfSBmcm9tIFwiZGlnZ2VyaXplXCJcbmltcG9ydCAqIGFzIGluZmxlY3Rpb24gZnJvbSBcImluZmxlY3Rpb25cIlxuaW1wb3J0IG1lbW8gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL21lbW8uanNcIlxuaW1wb3J0IE1vbmV5Rm9ybWF0dGVyIGZyb20gXCIuLi9tb25leS1mb3JtYXR0ZXIuanNcIlxuaW1wb3J0IFByb3BUeXBlcyBmcm9tIFwicHJvcC10eXBlc1wiXG5pbXBvcnQge3NoYXBlQ29tcG9uZW50LCBTaGFwZUNvbXBvbmVudH0gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL3NoYXBlLWNvbXBvbmVudC5qc1wiXG5pbXBvcnQgc3RyZnRpbWUgZnJvbSBcInN0cmZ0aW1lXCJcbmltcG9ydCBUZXh0IGZyb20gXCIuLi91dGlscy90ZXh0LmpzXCJcbmltcG9ydCB1c2VJMThuIGZyb20gXCJpMThuLW9uLXN0ZXJvaWRzL3NyYy91c2UtaTE4bi5tanNcIlxuaW1wb3J0IHtWaWV3fSBmcm9tIFwicmVhY3QtbmF0aXZlXCJcblxuZXhwb3J0IGRlZmF1bHQgbWVtbyhzaGFwZUNvbXBvbmVudChjbGFzcyBBcGlNYWtlckJvb3RzdHJhcEF0dHJpYnV0ZVJvdyBleHRlbmRzIFNoYXBlQ29tcG9uZW50IHtcbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBjaGVja0lmQXR0cmlidXRlTG9hZGVkOiBmYWxzZVxuICB9XG5cbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBhdHRyaWJ1dGU6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgY2hlY2tJZkF0dHJpYnV0ZUxvYWRlZDogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCxcbiAgICBjaGlsZHJlbjogUHJvcFR5cGVzLmFueSxcbiAgICBpZGVudGlmaWVyOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIGxhYmVsOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMuYW55LCBQcm9wVHlwZXMuc3RyaW5nXSksXG4gICAgbW9kZWw6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgdmFsdWU6IFByb3BUeXBlcy5hbnlcbiAgfVxuXG4gIHNldHVwKCkge1xuICAgIGNvbnN0IHtsLCB0fSA9IHVzZUkxOG4oe25hbWVzcGFjZTogXCJqcy5hcGlfbWFrZXIuYXR0cmlidXRlX3Jvd1wifSlcblxuICAgIHRoaXMubCA9IGxcbiAgICB0aGlzLnQgPSB0XG4gICAgdGhpcy5hdHRyaWJ1dGUgPSB1c2VNZW1vKFxuICAgICAgKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5wcm9wcy5hdHRyaWJ1dGUpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5wcm9wcy5tb2RlbD8uY29uc3RydWN0b3I/LmF0dHJpYnV0ZXMoKT8uZmluZCgoYXR0cmlidXRlKSA9PiBhdHRyaWJ1dGUubmFtZSgpID09IGluZmxlY3Rpb24udW5kZXJzY29yZSh0aGlzLnByb3BzLmF0dHJpYnV0ZSkpXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBbdGhpcy5wcm9wcy5hdHRyaWJ1dGUsIHRoaXMucHJvcHMubW9kZWxdXG4gICAgKVxuICB9XG5cbiAgcmVuZGVyICgpIHtcbiAgICBjb25zdCB7YXR0cmlidXRlLCBjaGVja0lmQXR0cmlidXRlTG9hZGVkLCBjaGlsZHJlbiwgY2xhc3NOYW1lLCBpZGVudGlmaWVyLCBsYWJlbCwgbW9kZWwsIHN0eWxlLCB2YWx1ZSwgLi4ucmVzdFByb3BzfSA9IHRoaXMucHJvcHNcbiAgICBjb25zdCBhY3R1YWxTdHlsZSA9IE9iamVjdC5hc3NpZ24oXG4gICAgICB7XG4gICAgICAgIHBhZGRpbmdWZXJ0aWNhbDogOFxuICAgICAgfSxcbiAgICAgIHN0eWxlXG4gICAgKVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxWaWV3XG4gICAgICAgIGRhdGFTZXQ9e3tcbiAgICAgICAgICBhdHRyaWJ1dGUsXG4gICAgICAgICAgY2xhc3M6IGNsYXNzTmFtZSxcbiAgICAgICAgICBjb21wb25lbnQ6IFwiYXBpLW1ha2VyL2F0dHJpYnV0ZS1yb3dcIixcbiAgICAgICAgICBpZGVudGlmaWVyXG4gICAgICAgIH19XG4gICAgICAgIHN0eWxlPXthY3R1YWxTdHlsZX1cbiAgICAgICAgey4uLnJlc3RQcm9wc31cbiAgICAgID5cbiAgICAgICAgPFRleHQgZGF0YVNldD17dGhpcy5jYWNoZShcImxhYmVsVGV4dERhdGFTZXRcIiwge2NsYXNzOiBcImF0dHJpYnV0ZS1yb3ctbGFiZWxcIn0pfSBzdHlsZT17dGhpcy5jYWNoZShcImxhYmVsVGV4dFN0eWxlXCIsIHtmb250V2VpZ2h0OiBcImJvbGRcIn0pfT5cbiAgICAgICAgICB7dGhpcy5sYWJlbCgpfVxuICAgICAgICA8L1RleHQ+XG4gICAgICAgIDxWaWV3IGRhdGFTZXQ9e3RoaXMuY2FjaGUoXCJ2YWx1ZVZpZXdEYXRhU2V0XCIsIHtjbGFzczogXCJhdHRyaWJ1dGUtcm93LXZhbHVlXCJ9KX0gc3R5bGU9e3RoaXMuY2FjaGUoXCJ2YWx1ZVZpZXdTdHlsZVwiLCB7bWFyZ2luVG9wOiAzfSl9PlxuICAgICAgICAgIHt0aGlzLnZhbHVlKCl9XG4gICAgICAgIDwvVmlldz5cbiAgICAgIDwvVmlldz5cbiAgICApXG4gIH1cblxuICBsYWJlbCgpIHtcbiAgICBjb25zdCB7YXR0cmlidXRlLCBsYWJlbCwgbW9kZWx9ID0gdGhpcy5wcm9wc1xuXG4gICAgaWYgKFwibGFiZWxcIiBpbiB0aGlzLnByb3BzKSByZXR1cm4gbGFiZWxcbiAgICBpZiAoYXR0cmlidXRlICYmIG1vZGVsKSByZXR1cm4gbW9kZWwuY29uc3RydWN0b3IuaHVtYW5BdHRyaWJ1dGVOYW1lKGF0dHJpYnV0ZSlcblxuICAgIHRocm93IG5ldyBFcnJvcihcIkNvdWxkbid0IGZpZ3VyZSBvdXQgbGFiZWxcIilcbiAgfVxuXG4gIHZhbHVlKCkge1xuICAgIGNvbnN0IHthdHRyaWJ1dGUsIGNoZWNrSWZBdHRyaWJ1dGVMb2FkZWQsIGNoaWxkcmVuLCBtb2RlbH0gPSB0aGlzLnByb3BzXG5cbiAgICBpZiAoY2hpbGRyZW4pIHJldHVybiBjaGlsZHJlblxuXG4gICAgaWYgKGF0dHJpYnV0ZSAmJiAhKGF0dHJpYnV0ZSBpbiBtb2RlbCkpXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEF0dHJpYnV0ZSBub3QgZm91bmQ6ICR7ZGlnZyhtb2RlbC5tb2RlbENsYXNzRGF0YSgpLCBcIm5hbWVcIil9IyR7YXR0cmlidXRlfWApXG5cbiAgICBpZiAoYXR0cmlidXRlICYmIGNoZWNrSWZBdHRyaWJ1dGVMb2FkZWQgJiYgIW1vZGVsLmlzQXR0cmlidXRlTG9hZGVkKGF0dHJpYnV0ZSkpXG4gICAgICByZXR1cm4gbnVsbFxuXG4gICAgaWYgKGF0dHJpYnV0ZSAmJiBtb2RlbCkge1xuICAgICAgY29uc3QgdmFsdWUgPSBtb2RlbFthdHRyaWJ1dGVdKClcblxuICAgICAgcmV0dXJuIHRoaXMudmFsdWVDb250ZW50KHZhbHVlKVxuICAgIH1cbiAgfVxuXG4gIHZhbHVlQ29udGVudCh2YWx1ZSkge1xuICAgIGNvbnN0IHtsLCB0fSA9IHRoaXMudHRcbiAgICBjb25zdCBjb2x1bW5UeXBlID0gdGhpcy5hdHRyaWJ1dGU/LmdldENvbHVtbigpPy5nZXRUeXBlKClcblxuICAgIGlmIChjb2x1bW5UeXBlID09IFwiZGF0ZVwiKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8VGV4dD57bChcImRhdGUuZm9ybWF0cy5kZWZhdWx0XCIsIHZhbHVlKX08L1RleHQ+XG4gICAgICApXG4gICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxUZXh0PntzdHJmdGltZShcIiVZLSVtLSVkICVIOiVNXCIsIHZhbHVlKX08L1RleHQ+XG4gICAgICApXG4gICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09IFwiYm9vbGVhblwiKSB7XG4gICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICA8VGV4dD57dChcImpzLnNoYXJlZC55ZXNcIiwge2RlZmF1bHRWYWx1ZTogXCJZZXNcIn0pfTwvVGV4dD5cbiAgICAgICAgKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gKFxuICAgICAgICA8VGV4dD57dChcImpzLnNoYXJlZC5ub1wiLCB7ZGVmYXVsdFZhbHVlOiBcIk5vXCJ9KX08L1RleHQ+XG4gICAgICApXG4gICAgfSBlbHNlIGlmIChNb25leUZvcm1hdHRlci5pc01vbmV5KHZhbHVlKSkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPFRleHQ+e01vbmV5Rm9ybWF0dGVyLmZvcm1hdCh2YWx1ZSl9PC9UZXh0PlxuICAgICAgKVxuICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09IFwic3RyaW5nXCIpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxUZXh0Pnt2YWx1ZX08L1RleHQ+XG4gICAgICApXG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB2YWx1ZVxuICAgIH1cbiAgfVxufSkpXG4iXX0=