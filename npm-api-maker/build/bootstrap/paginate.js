import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import BaseComponent from "../base-component";
import instanceOfClassName from "../instance-of-class-name.js";
import Link from "../link";
import PropTypes from "prop-types";
import propTypesExact from "prop-types-exact";
import memo from "set-state-compare/build/memo.js";
import qs from "qs";
import React, { useMemo } from "react";
import Text from "../utils/text";
import Result from "../result.js";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import urlEncode from "../url-encode.js";
export default memo(shapeComponent(class ApiMakerBootstrapPaginate extends BaseComponent {
    static propTypes = propTypesExact({
        result: PropTypes.oneOfType([
            instanceOfClassName("ApiMakerResult"),
            PropTypes.instanceOf(Result)
        ]).isRequired
    });
    setup() {
        const { result } = this.p;
        this.totalPages = useMemo(() => Math.ceil(result.count() / result.perPage()), [result.count(), result.perPage()]);
        this.pages = useMemo(() => this.calculatePages(), [result.currentPage(), this.totalPages]);
    }
    calculatePages() {
        const { result } = this.p;
        const { totalPages } = this.tt;
        const currentPage = result.currentPage();
        const pages = [];
        let pagesFrom = currentPage - 5;
        let pagesTo = currentPage + 5;
        if (pagesFrom < 1) {
            pagesFrom = 1;
        }
        if (pagesTo > totalPages) {
            pagesTo = totalPages;
        }
        for (let i = pagesFrom; i <= pagesTo; i++) {
            pages.push(i);
        }
        return pages;
    }
    isPageActiveClass = (pageNumber) => this.p.result.currentPage() == pageNumber ? "active" : "not-active";
    pagePath(pageNumber) {
        let pageKey = this.p.result.data.collection.queryArgs.pageKey;
        if (!pageKey) {
            pageKey = "page";
        }
        const currentParams = qs.parse(globalThis.location.search.substr(1));
        currentParams[pageKey] = pageNumber;
        const newParams = qs.stringify(currentParams, { encoder: urlEncode });
        const newPath = `${location.pathname}?${newParams}`;
        return newPath;
    }
    previousPagePath() {
        const { result } = this.p;
        let previousPage;
        if (result.currentPage() > 1) {
            previousPage = result.currentPage() - 1;
        }
        else {
            previousPage = result.currentPage();
        }
        return this.pagePath(previousPage);
    }
    nextPagePath() {
        const { result } = this.p;
        let nextPage;
        if (result.currentPage() < this.tt.totalPages) {
            nextPage = result.currentPage() + 1;
        }
        else {
            nextPage = result.currentPage();
        }
        return this.pagePath(nextPage);
    }
    showBackwardsDots = () => (this.p.result.currentPage() - 5 > 1);
    showForwardsDots = () => (this.p.result.currentPage() + 5 < this.tt.totalPages);
    render() {
        const { result } = this.p;
        const { pages, totalPages } = this.tt;
        const showNextPage = result.currentPage() < totalPages;
        const showLastPage = result.currentPage() < totalPages;
        const showPreviousPage = result.currentPage() > 1;
        const showFirstPage = result.currentPage() > 1;
        return (_jsx(_Fragment, { children: _jsxs("ul", { className: "pagination", "data-pages-length": pages.length, children: [_jsxs("li", { className: `page-item ${!showPreviousPage ? "disabled" : ""}`, children: [!showPreviousPage &&
                                _jsx(Text, { children: "\u21E4" }), showPreviousPage &&
                                _jsx(Link, { dataSet: { class: "page-link" }, to: this.pagePath(1), children: _jsx(Text, { children: "\u21E4" }) })] }, "page-first"), _jsxs("li", { className: `page-item ${!showFirstPage ? "disabled" : ""}`, children: [!showFirstPage &&
                                _jsx(Text, { children: "\u2190" }), showFirstPage &&
                                _jsx(Link, { dataSet: { class: "page-link" }, to: this.previousPagePath(), children: _jsx(Text, { children: "\u2190" }) })] }, "page-previous"), this.showBackwardsDots() &&
                        _jsx("li", { className: "page-item disabled", children: "\u2026" }), pages.map((page) => _jsxs("li", { className: `page-item ${this.isPageActiveClass(page)}`, "data-active": this.isPageActiveClass(page) == "active", "data-page": page, children: [this.isPageActiveClass(page) == "active" &&
                                page, this.isPageActiveClass(page) == "not-active" &&
                                _jsx(Link, { dataSet: { class: "page-link" }, to: this.pagePath(page), children: _jsx(Text, { children: page }) })] }, `page-${page}`)), this.showForwardsDots() &&
                        _jsx("li", { className: "page-item disabled", children: "\u2026" }), _jsxs("li", { className: `page-item ${!showNextPage ? "disabled" : ""}`, children: [!showNextPage &&
                                _jsx(Text, { children: "\u2192" }), showNextPage &&
                                _jsx(Link, { dataSet: { class: "page-link" }, to: this.nextPagePath(), children: _jsx(Text, { children: "\u2192" }) })] }, "page-next"), _jsxs("li", { className: `page-item ${!showLastPage ? "disabled" : ""}`, children: [!showLastPage &&
                                _jsx(Text, { children: "\u21E5" }), showLastPage &&
                                _jsx(Link, { dataSet: { class: "page-link" }, to: this.pagePath(totalPages), children: _jsx(Text, { children: "\u21E5" }) })] }, "page-last")] }) }));
    }
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnaW5hdGUuanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbImJvb3RzdHJhcC9wYWdpbmF0ZS5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sYUFBYSxNQUFNLG1CQUFtQixDQUFBO0FBQzdDLE9BQU8sbUJBQW1CLE1BQU0sOEJBQThCLENBQUE7QUFDOUQsT0FBTyxJQUFJLE1BQU0sU0FBUyxDQUFBO0FBQzFCLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQTtBQUNsQyxPQUFPLGNBQWMsTUFBTSxrQkFBa0IsQ0FBQTtBQUM3QyxPQUFPLElBQUksTUFBTSxpQ0FBaUMsQ0FBQTtBQUNsRCxPQUFPLEVBQUUsTUFBTSxJQUFJLENBQUE7QUFDbkIsT0FBTyxLQUFLLEVBQUUsRUFBQyxPQUFPLEVBQUMsTUFBTSxPQUFPLENBQUE7QUFDcEMsT0FBTyxJQUFJLE1BQU0sZUFBZSxDQUFBO0FBQ2hDLE9BQU8sTUFBTSxNQUFNLGNBQWMsQ0FBQTtBQUNqQyxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sNENBQTRDLENBQUE7QUFDekUsT0FBTyxTQUFTLE1BQU0sa0JBQWtCLENBQUE7QUFFeEMsZUFBZSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0seUJBQTBCLFNBQVEsYUFBYTtJQUN0RixNQUFNLENBQUMsU0FBUyxHQUFHLGNBQWMsQ0FBQztRQUNoQyxNQUFNLEVBQUUsU0FBUyxDQUFDLFNBQVMsQ0FBQztZQUMxQixtQkFBbUIsQ0FBQyxnQkFBZ0IsQ0FBQztZQUNyQyxTQUFTLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQztTQUM3QixDQUFDLENBQUMsVUFBVTtLQUNkLENBQUMsQ0FBQTtJQUVGLEtBQUs7UUFDSCxNQUFNLEVBQUMsTUFBTSxFQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQTtRQUV2QixJQUFJLENBQUMsVUFBVSxHQUFHLE9BQU8sQ0FDdkIsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMs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b20gXCIuLi9iYXNlLWNvbXBvbmVudFwiXG5pbXBvcnQgaW5zdGFuY2VPZkNsYXNzTmFtZSBmcm9tIFwiLi4vaW5zdGFuY2Utb2YtY2xhc3MtbmFtZS5qc1wiXG5pbXBvcnQgTGluayBmcm9tIFwiLi4vbGlua1wiXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gXCJwcm9wLXR5cGVzXCJcbmltcG9ydCBwcm9wVHlwZXNFeGFjdCBmcm9tIFwicHJvcC10eXBlcy1leGFjdFwiXG5pbXBvcnQgbWVtbyBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvbWVtby5qc1wiXG5pbXBvcnQgcXMgZnJvbSBcInFzXCJcbmltcG9ydCBSZWFjdCwge3VzZU1lbW99IGZyb20gXCJyZWFjdFwiXG5pbXBvcnQgVGV4dCBmcm9tIFwiLi4vdXRpbHMvdGV4dFwiXG5pbXBvcnQgUmVzdWx0IGZyb20gXCIuLi9yZXN1bHQuanNcIlxuaW1wb3J0IHtzaGFwZUNvbXBvbmVudH0gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL3NoYXBlLWNvbXBvbmVudC5qc1wiXG5pbXBvcnQgdXJsRW5jb2RlIGZyb20gXCIuLi91cmwtZW5jb2RlLmpzXCJcblxuZXhwb3J0IGRlZmF1bHQgbWVtbyhzaGFwZUNvbXBvbmVudChjbGFzcyBBcGlNYWtlckJvb3RzdHJhcFBhZ2luYXRlIGV4dGVuZHMgQmFzZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSBwcm9wVHlwZXNFeGFjdCh7XG4gICAgcmVzdWx0OiBQcm9wVHlwZXMub25lT2ZUeXBlKFtcbiAgICAgIGluc3RhbmNlT2ZDbGFzc05hbWUoXCJBcGlNYWtlclJlc3VsdFwiKSxcbiAgICAgIFByb3BUeXBlcy5pbnN0YW5jZU9mKFJlc3VsdClcbiAgICBdKS5pc1JlcXVpcmVkXG4gIH0pXG5cbiAgc2V0dXAoKSB7XG4gICAgY29uc3Qge3Jlc3VsdH0gPSB0aGlzLnBcblxuICAgIHRoaXMudG90YWxQYWdlcyA9IHVzZU1lbW8oXG4gICAgICAoKSA9PiBNYXRoLmNlaWwocmVzdWx0LmNvdW50KCkgLyByZXN1bHQucGVyUGFnZSgpKSxcbiAgICAgIFtyZXN1bHQuY291bnQoKSwgcmVzdWx0LnBlclBhZ2UoKV1cbiAgICApXG4gICAgdGhpcy5wYWdlcyA9IHVzZU1lbW8oXG4gICAgICAoKSA9PiB0aGlzLmNhbGN1bGF0ZVBhZ2VzKCksXG4gICAgICBbcmVzdWx0LmN1cnJlbnRQYWdlKCksIHRoaXMudG90YWxQYWdlc11cbiAgICApXG4gIH1cblxuICBjYWxjdWxhdGVQYWdlcyAoKSB7XG4gICAgY29uc3Qge3Jlc3VsdH0gPSB0aGlzLnBcbiAgICBjb25zdCB7dG90YWxQYWdlc30gPSB0aGlzLnR0XG4gICAgY29uc3QgY3VycmVudFBhZ2UgPSByZXN1bHQuY3VycmVudFBhZ2UoKVxuICAgIGNvbnN0IHBhZ2VzID0gW11cblxuICAgIGxldCBwYWdlc0Zyb20gPSBjdXJyZW50UGFnZSAtIDVcbiAgICBsZXQgcGFnZXNUbyA9IGN1cnJlbnRQYWdlICsgNVxuXG4gICAgaWYgKHBhZ2VzRnJvbSA8IDEpIHtcbiAgICAgIHBhZ2VzRnJvbSA9IDFcbiAgICB9XG5cbiAgICBpZiAocGFnZXNUbyA+IHRvdGFsUGFnZXMpIHtcbiAgICAgIHBhZ2VzVG8gPSB0b3RhbFBhZ2VzXG4gICAgfVxuXG4gICAgZm9yIChsZXQgaSA9IHBhZ2VzRnJvbTsgaSA8PSBwYWdlc1RvOyBpKyspIHtcbiAgICAgIHBhZ2VzLnB1c2goaSlcbiAgICB9XG5cbiAgICByZXR1cm4gcGFnZXNcbiAgfVxuXG4gIGlzUGFnZUFjdGl2ZUNsYXNzID0gKHBhZ2VOdW1iZXIpID0+IHRoaXMucC5yZXN1bHQuY3VycmVudFBhZ2UoKSA9PSBwYWdlTnVtYmVyID8gXCJhY3RpdmVcIiA6IFwibm90LWFjdGl2ZVwiXG5cbiAgcGFnZVBhdGggKHBhZ2VOdW1iZXIpIHtcbiAgICBsZXQgcGFnZUtleSA9IHRoaXMucC5yZXN1bHQuZGF0YS5jb2xsZWN0aW9uLnF1ZXJ5QXJncy5wYWdlS2V5XG5cbiAgICBpZiAoIXBhZ2VLZXkpIHtcbiAgICAgIHBhZ2VLZXkgPSBcInBhZ2VcIlxuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRQYXJhbXMgPSBxcy5wYXJzZShnbG9iYWxUaGlzLmxvY2F0aW9uLnNlYXJjaC5zdWJzdHIoMSkpXG4gICAgY3VycmVudFBhcmFtc1twYWdlS2V5XSA9IHBhZ2VOdW1iZXJcbiAgICBjb25zdCBuZXdQYXJhbXMgPSBxcy5zdHJpbmdpZnkoY3VycmVudFBhcmFtcywge2VuY29kZXI6IHVybEVuY29kZX0pXG4gICAgY29uc3QgbmV3UGF0aCA9IGAke2xvY2F0aW9uLnBhdGhuYW1lfT8ke25ld1BhcmFtc31gXG5cbiAgICByZXR1cm4gbmV3UGF0aFxuICB9XG5cbiAgcHJldmlvdXNQYWdlUGF0aCAoKSB7XG4gICAgY29uc3Qge3Jlc3VsdH0gPSB0aGlzLnBcbiAgICBsZXQgcHJldmlvdXNQYWdlXG5cbiAgICBpZiAocmVzdWx0LmN1cnJlbnRQYWdlKCkgPiAxKSB7XG4gICAgICBwcmV2aW91c1BhZ2UgPSByZXN1bHQuY3VycmVudFBhZ2UoKSAtIDFcbiAgICB9IGVsc2Uge1xuICAgICAgcHJldmlvdXNQYWdlID0gcmVzdWx0LmN1cnJlbnRQYWdlKClcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5wYWdlUGF0aChwcmV2aW91c1BhZ2UpXG4gIH1cblxuICBuZXh0UGFnZVBhdGggKCkge1xuICAgIGNvbnN0IHtyZXN1bHR9ID0gdGhpcy5wXG4gICAgbGV0IG5leHRQYWdlXG5cbiAgICBpZiAocmVzdWx0LmN1cnJlbnRQYWdlKCkgPCB0aGlzLnR0LnRvdGFsUGFnZXMpIHtcbiAgICAgIG5leHRQYWdlID0gcmVzdWx0LmN1cnJlbnRQYWdlKCkgKyAxXG4gICAgfSBlbHNlIHtcbiAgICAgIG5leHRQYWdlID0gcmVzdWx0LmN1cnJlbnRQYWdlKClcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5wYWdlUGF0aChuZXh0UGFnZSlcbiAgfVxuXG4gIHNob3dCYWNrd2FyZHNEb3RzID0gKCkgPT4gKHRoaXMucC5yZXN1bHQuY3VycmVudFBhZ2UoKSAtIDUgPiAxKVxuICBzaG93Rm9yd2FyZHNEb3RzID0gKCkgPT4gKHRoaXMucC5yZXN1bHQuY3VycmVudFBhZ2UoKSArIDUgPCB0aGlzLnR0LnRvdGFsUGFnZXMpXG5cbiAgcmVuZGVyICgpIHtcbiAgICBjb25zdCB7cmVzdWx0fSA9IHRoaXMucFxuICAgIGNvbnN0IHtwYWdlcywgdG90YWxQYWdlc30gPSB0aGlzLnR0XG4gICAgY29uc3Qgc2hvd05leHRQYWdlID0gcmVzdWx0LmN1cnJlbnRQYWdlKCkgPCB0b3RhbFBhZ2VzXG4gICAgY29uc3Qgc2hvd0xhc3RQYWdlID0gcmVzdWx0LmN1cnJlbnRQYWdlKCkgPCB0b3RhbFBhZ2VzXG4gICAgY29uc3Qgc2hvd1ByZXZpb3VzUGFnZSA9IHJlc3VsdC5jdXJyZW50UGFnZSgpID4gMVxuICAgIGNvbnN0IHNob3dGaXJzdFBhZ2UgPSByZXN1bHQuY3VycmVudFBhZ2UoKSA+IDFcblxuICAgIHJldHVybiAoXG4gICAgICA8PlxuICAgICAgICA8dWwgY2xhc3NOYW1lPVwicGFnaW5hdGlvblwiIGRhdGEtcGFnZXMtbGVuZ3RoPXtwYWdlcy5sZW5ndGh9PlxuICAgICAgICAgIDxsaSBjbGFzc05hbWU9e2BwYWdlLWl0ZW0gJHshc2hvd1ByZXZpb3VzUGFnZSA/IFwiZGlzYWJsZWRcIiA6IFwiXCJ9YH0ga2V5PVwicGFnZS1maXJzdFwiPlxuICAgICAgICAgICAgeyFzaG93UHJldmlvdXNQYWdlICYmXG4gICAgICAgICAgICAgIDxUZXh0PuKHpDwvVGV4dD5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHtzaG93UHJldmlvdXNQYWdlICYmXG4gICAgICAgICAgICAgIDxMaW5rIGRhdGFTZXQ9e3tjbGFzczogXCJwYWdlLWxpbmtcIn19IHRvPXt0aGlzLnBhZ2VQYXRoKDEpfT5cbiAgICAgICAgICAgICAgICA8VGV4dD7ih6Q8L1RleHQ+XG4gICAgICAgICAgICAgIDwvTGluaz5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICA8L2xpPlxuICAgICAgICAgIDxsaSBjbGFzc05hbWU9e2BwYWdlLWl0ZW0gJHshc2hvd0ZpcnN0UGFnZSA/IFwiZGlzYWJsZWRcIiA6IFwiXCJ9YH0ga2V5PVwicGFnZS1wcmV2aW91c1wiPlxuICAgICAgICAgICAgeyFzaG93Rmlyc3RQYWdlICYmXG4gICAgICAgICAgICAgIDxUZXh0PuKGkDwvVGV4dD5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHtzaG93Rmlyc3RQYWdlICYmXG4gICAgICAgICAgICAgIDxMaW5rIGRhdGFTZXQ9e3tjbGFzczogXCJwYWdlLWxpbmtcIn19IHRvPXt0aGlzLnByZXZpb3VzUGFnZVBhdGgoKX0+XG4gICAgICAgICAgICAgICAgPFRleHQ+4oaQPC9UZXh0PlxuICAgICAgICAgICAgICA8L0xpbms+XG4gICAgICAgICAgICB9XG4gICAgICAgICAgPC9saT5cbiAgICAgICAgICB7dGhpcy5zaG93QmFja3dhcmRzRG90cygpICYmXG4gICAgICAgICAgICA8bGkgY2xhc3NOYW1lPVwicGFnZS1pdGVtIGRpc2FibGVkXCI+XG4gICAgICAgICAgICAgICZoZWxsaXA7XG4gICAgICAgICAgICA8L2xpPlxuICAgICAgICAgIH1cbiAgICAgICAgICB7cGFnZXMubWFwKChwYWdlKSA9PlxuICAgICAgICAgICAgPGxpXG4gICAgICAgICAgICAgIGNsYXNzTmFtZT17YHBhZ2UtaXRlbSAke3RoaXMuaXNQYWdlQWN0aXZlQ2xhc3MocGFnZSl9YH1cbiAgICAgICAgICAgICAgZGF0YS1hY3RpdmU9e3RoaXMuaXNQYWdlQWN0aXZlQ2xhc3MocGFnZSkgPT0gXCJhY3RpdmVcIn1cbiAgICAgICAgICAgICAgZGF0YS1wYWdlPXtwYWdlfVxuICAgICAgICAgICAgICBrZXk9e2BwYWdlLSR7cGFnZX1gfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICB7dGhpcy5pc1BhZ2VBY3RpdmVDbGFzcyhwYWdlKSA9PSBcImFjdGl2ZVwiICYmXG4gICAgICAgICAgICAgICAgcGFnZVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHt0aGlzLmlzUGFnZUFjdGl2ZUNsYXNzKHBhZ2UpID09IFwibm90LWFjdGl2ZVwiICYmXG4gICAgICAgICAgICAgICAgPExpbmsgZGF0YVNldD17e2NsYXNzOiBcInBhZ2UtbGlua1wifX0gdG89e3RoaXMucGFnZVBhdGgocGFnZSl9PlxuICAgICAgICAgICAgICAgICAgPFRleHQ+e3BhZ2V9PC9UZXh0PlxuICAgICAgICAgICAgICAgIDwvTGluaz5cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgPC9saT5cbiAgICAgICAgICApfVxuICAgICAgICAgIHt0aGlzLnNob3dGb3J3YXJkc0RvdHMoKSAmJlxuICAgICAgICAgICAgPGxpIGNsYXNzTmFtZT1cInBhZ2UtaXRlbSBkaXNhYmxlZFwiPlxuICAgICAgICAgICAgICAmaGVsbGlwO1xuICAgICAgICAgICAgPC9saT5cbiAgICAgICAgICB9XG4gICAgICAgICAgPGxpIGNsYXNzTmFtZT17YHBhZ2UtaXRlbSAkeyFzaG93TmV4dFBhZ2UgPyBcImRpc2FibGVkXCIgOiBcIlwifWB9IGtleT1cInBhZ2UtbmV4dFwiPlxuICAgICAgICAgICAgeyFzaG93TmV4dFBhZ2UgJiZcbiAgICAgICAgICAgICAgPFRleHQ+4oaSPC9UZXh0PlxuICAgICAgICAgICAgfVxuICAgICAgICAgICAge3Nob3dOZXh0UGFnZSAmJlxuICAgICAgICAgICAgICA8TGluayBkYXRhU2V0PXt7Y2xhc3M6IFwicGFnZS1saW5rXCJ9fSB0bz17dGhpcy5uZXh0UGFnZVBhdGgoKX0+XG4gICAgICAgICAgICAgICAgPFRleHQ+4oaSPC9UZXh0PlxuICAgICAgICAgICAgICA8L0xpbms+XG4gICAgICAgICAgICB9XG4gICAgICAgICAgPC9saT5cbiAgICAgICAgICA8bGkgY2xhc3NOYW1lPXtgcGFnZS1pdGVtICR7IXNob3dMYXN0UGFnZSA/IFwiZGlzYWJsZWRcIiA6IFwiXCJ9YH0ga2V5PVwicGFnZS1sYXN0XCI+XG4gICAgICAgICAgICB7IXNob3dMYXN0UGFnZSAmJlxuICAgICAgICAgICAgICA8VGV4dD7ih6U8L1RleHQ+XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB7c2hvd0xhc3RQYWdlICYmXG4gICAgICAgICAgICAgIDxMaW5rIGRhdGFTZXQ9e3tjbGFzczogXCJwYWdlLWxpbmtcIn19IHRvPXt0aGlzLnBhZ2VQYXRoKHRvdGFsUGFnZXMpfT5cbiAgICAgICAgICAgICAgICA8VGV4dD7ih6U8L1RleHQ+XG4gICAgICAgICAgICAgIDwvTGluaz5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICA8L2xpPlxuICAgICAgICA8L3VsPlxuICAgICAgPC8+XG4gICAgKVxuICB9XG59KSlcbiJdfQ==