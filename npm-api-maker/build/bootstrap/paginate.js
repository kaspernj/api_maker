import BaseComponent from "../base-component.js";
import instanceOfClassName from "../instance-of-class-name.js";
import Link from "../link.js";
import PropTypes from "prop-types";
import propTypesExact from "prop-types-exact";
import memo from "set-state-compare/build/memo.js";
import qs from "qs";
import React, { useMemo } from "react";
import Text from "../utils/text.js";
import Result from "../result.js";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import urlEncode from "../url-encode.js";
export default memo(shapeComponent(class ApiMakerBootstrapPaginate extends BaseComponent {
    static propTypes = propTypesExact({
        result: PropTypes.oneOfType([
            instanceOfClassName("ApiMakerResult"),
            PropTypes.instanceOf(Result)
        ]).isRequired
    });
    setup() {
        const { result } = this.p;
        this.totalPages = useMemo(() => Math.ceil(result.count() / result.perPage()), [result.count(), result.perPage()]);
        this.pages = useMemo(() => this.calculatePages(), [result.currentPage(), this.totalPages]);
    }
    calculatePages() {
        const { result } = this.p;
        const { totalPages } = this.tt;
        const currentPage = result.currentPage();
        const pages = [];
        let pagesFrom = currentPage - 5;
        let pagesTo = currentPage + 5;
        if (pagesFrom < 1) {
            pagesFrom = 1;
        }
        if (pagesTo > totalPages) {
            pagesTo = totalPages;
        }
        for (let i = pagesFrom; i <= pagesTo; i++) {
            pages.push(i);
        }
        return pages;
    }
    isPageActiveClass = (pageNumber) => this.p.result.currentPage() == pageNumber ? "active" : "not-active";
    pagePath(pageNumber) {
        let pageKey = this.p.result.data.collection.queryArgs.pageKey;
        if (!pageKey) {
            pageKey = "page";
        }
        const currentParams = qs.parse(globalThis.location.search.substr(1));
        currentParams[pageKey] = pageNumber;
        const newParams = qs.stringify(currentParams, { encoder: urlEncode });
        const newPath = `${location.pathname}?${newParams}`;
        return newPath;
    }
    previousPagePath() {
        const { result } = this.p;
        let previousPage;
        if (result.currentPage() > 1) {
            previousPage = result.currentPage() - 1;
        }
        else {
            previousPage = result.currentPage();
        }
        return this.pagePath(previousPage);
    }
    nextPagePath() {
        const { result } = this.p;
        let nextPage;
        if (result.currentPage() < this.tt.totalPages) {
            nextPage = result.currentPage() + 1;
        }
        else {
            nextPage = result.currentPage();
        }
        return this.pagePath(nextPage);
    }
    showBackwardsDots = () => (this.p.result.currentPage() - 5 > 1);
    showForwardsDots = () => (this.p.result.currentPage() + 5 < this.tt.totalPages);
    render() {
        const { result } = this.p;
        const { pages, totalPages } = this.tt;
        const showNextPage = result.currentPage() < totalPages;
        const showLastPage = result.currentPage() < totalPages;
        const showPreviousPage = result.currentPage() > 1;
        const showFirstPage = result.currentPage() > 1;
        return (<>
        <ul className="pagination" data-pages-length={pages.length}>
          <li className={`page-item ${!showPreviousPage ? "disabled" : ""}`} key="page-first">
            {!showPreviousPage &&
                <Text>⇤</Text>}
            {showPreviousPage &&
                <Link dataSet={{ class: "page-link" }} to={this.pagePath(1)}>
                <Text>⇤</Text>
              </Link>}
          </li>
          <li className={`page-item ${!showFirstPage ? "disabled" : ""}`} key="page-previous">
            {!showFirstPage &&
                <Text>←</Text>}
            {showFirstPage &&
                <Link dataSet={{ class: "page-link" }} to={this.previousPagePath()}>
                <Text>←</Text>
              </Link>}
          </li>
          {this.showBackwardsDots() &&
                <li className="page-item disabled">
              &hellip;
            </li>}
          {pages.map((page) => <li className={`page-item ${this.isPageActiveClass(page)}`} data-active={this.isPageActiveClass(page) == "active"} data-page={page} key={`page-${page}`}>
              {this.isPageActiveClass(page) == "active" &&
                    page}
              {this.isPageActiveClass(page) == "not-active" &&
                    <Link dataSet={{ class: "page-link" }} to={this.pagePath(page)}>
                  <Text>{page}</Text>
                </Link>}
            </li>)}
          {this.showForwardsDots() &&
                <li className="page-item disabled">
              &hellip;
            </li>}
          <li className={`page-item ${!showNextPage ? "disabled" : ""}`} key="page-next">
            {!showNextPage &&
                <Text>→</Text>}
            {showNextPage &&
                <Link dataSet={{ class: "page-link" }} to={this.nextPagePath()}>
                <Text>→</Text>
              </Link>}
          </li>
          <li className={`page-item ${!showLastPage ? "disabled" : ""}`} key="page-last">
            {!showLastPage &&
                <Text>⇥</Text>}
            {showLastPage &&
                <Link dataSet={{ class: "page-link" }} to={this.pagePath(totalPages)}>
                <Text>⇥</Text>
              </Link>}
          </li>
        </ul>
      </>);
    }
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnaW5hdGUuanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbImJvb3RzdHJhcC9wYWdpbmF0ZS5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxhQUFhLE1BQU0sc0JBQXNCLENBQUE7QUFDaEQsT0FBTyxtQkFBbUIsTUFBTSw4QkFBOEIsQ0FBQTtBQUM5RCxPQUFPLElBQUksTUFBTSxZQUFZLENBQUE7QUFDN0IsT0FBTyxTQUFTLE1BQU0sWUFBWSxDQUFBO0FBQ2xDLE9BQU8sY0FBYyxNQUFNLGtCQUFrQixDQUFBO0FBQzdDLE9BQU8sSUFBSSxNQUFNLGlDQUFpQyxDQUFBO0FBQ2xELE9BQU8sRUFBRSxNQUFNLElBQUksQ0FBQTtBQUNuQixPQUFPLEtBQUssRUFBRSxFQUFDLE9BQU8sRUFBQyxNQUFNLE9BQU8sQ0FBQTtBQUNwQyxPQUFPLElBQUksTUFBTSxrQkFBa0IsQ0FBQTtBQUNuQyxPQUFPLE1BQU0sTUFBTSxjQUFjLENBQUE7QUFDakMsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLDRDQUE0QyxDQUFBO0FBQ3pFLE9BQU8sU0FBUyxNQUFNLGtCQUFrQixDQUFBO0FBRXhDLGVBQWUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLHlCQUEwQixTQUFRLGFBQWE7SUFDdEYsTUFBTSxDQUFDLFNBQVMsR0FBRyxjQUFjLENBQUM7UUFDaEMsTUFBTSxFQUFFLFNBQVMsQ0FBQyxTQUFTLENBQUM7WUFDMUIsbUJBQW1CLENBQUMsZ0JBQWdCLENBQUM7WUFDckMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUM7U0FDN0IsQ0FBQyxDQUFDLFVBQVU7S0FDZCxDQUFDLENBQUE7SUFFRixLQUFLO1FBQ0gsTUFBTSxFQUFDLE1BQU0sRUFBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUE7UUFFdkIsSUFBSSxDQUFDLFVBQVUsR0FBRyxPQUFPLENBQ3ZCLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFD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cG9ydCBCYXNlQ29tcG9uZW50IGZyb20gXCIuLi9iYXNlLWNvbXBvbmVudC5qc1wiXG5pbXBvcnQgaW5zdGFuY2VPZkNsYXNzTmFtZSBmcm9tIFwiLi4vaW5zdGFuY2Utb2YtY2xhc3MtbmFtZS5qc1wiXG5pbXBvcnQgTGluayBmcm9tIFwiLi4vbGluay5qc1wiXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gXCJwcm9wLXR5cGVzXCJcbmltcG9ydCBwcm9wVHlwZXNFeGFjdCBmcm9tIFwicHJvcC10eXBlcy1leGFjdFwiXG5pbXBvcnQgbWVtbyBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvbWVtby5qc1wiXG5pbXBvcnQgcXMgZnJvbSBcInFzXCJcbmltcG9ydCBSZWFjdCwge3VzZU1lbW99IGZyb20gXCJyZWFjdFwiXG5pbXBvcnQgVGV4dCBmcm9tIFwiLi4vdXRpbHMvdGV4dC5qc1wiXG5pbXBvcnQgUmVzdWx0IGZyb20gXCIuLi9yZXN1bHQuanNcIlxuaW1wb3J0IHtzaGFwZUNvbXBvbmVudH0gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL3NoYXBlLWNvbXBvbmVudC5qc1wiXG5pbXBvcnQgdXJsRW5jb2RlIGZyb20gXCIuLi91cmwtZW5jb2RlLmpzXCJcblxuZXhwb3J0IGRlZmF1bHQgbWVtbyhzaGFwZUNvbXBvbmVudChjbGFzcyBBcGlNYWtlckJvb3RzdHJhcFBhZ2luYXRlIGV4dGVuZHMgQmFzZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSBwcm9wVHlwZXNFeGFjdCh7XG4gICAgcmVzdWx0OiBQcm9wVHlwZXMub25lT2ZUeXBlKFtcbiAgICAgIGluc3RhbmNlT2ZDbGFzc05hbWUoXCJBcGlNYWtlclJlc3VsdFwiKSxcbiAgICAgIFByb3BUeXBlcy5pbnN0YW5jZU9mKFJlc3VsdClcbiAgICBdKS5pc1JlcXVpcmVkXG4gIH0pXG5cbiAgc2V0dXAoKSB7XG4gICAgY29uc3Qge3Jlc3VsdH0gPSB0aGlzLnBcblxuICAgIHRoaXMudG90YWxQYWdlcyA9IHVzZU1lbW8oXG4gICAgICAoKSA9PiBNYXRoLmNlaWwocmVzdWx0LmNvdW50KCkgLyByZXN1bHQucGVyUGFnZSgpKSxcbiAgICAgIFtyZXN1bHQuY291bnQoKSwgcmVzdWx0LnBlclBhZ2UoKV1cbiAgICApXG4gICAgdGhpcy5wYWdlcyA9IHVzZU1lbW8oXG4gICAgICAoKSA9PiB0aGlzLmNhbGN1bGF0ZVBhZ2VzKCksXG4gICAgICBbcmVzdWx0LmN1cnJlbnRQYWdlKCksIHRoaXMudG90YWxQYWdlc11cbiAgICApXG4gIH1cblxuICBjYWxjdWxhdGVQYWdlcyAoKSB7XG4gICAgY29uc3Qge3Jlc3VsdH0gPSB0aGlzLnBcbiAgICBjb25zdCB7dG90YWxQYWdlc30gPSB0aGlzLnR0XG4gICAgY29uc3QgY3VycmVudFBhZ2UgPSByZXN1bHQuY3VycmVudFBhZ2UoKVxuICAgIGNvbnN0IHBhZ2VzID0gW11cblxuICAgIGxldCBwYWdlc0Zyb20gPSBjdXJyZW50UGFnZSAtIDVcbiAgICBsZXQgcGFnZXNUbyA9IGN1cnJlbnRQYWdlICsgNVxuXG4gICAgaWYgKHBhZ2VzRnJvbSA8IDEpIHtcbiAgICAgIHBhZ2VzRnJvbSA9IDFcbiAgICB9XG5cbiAgICBpZiAocGFnZXNUbyA+IHRvdGFsUGFnZXMpIHtcbiAgICAgIHBhZ2VzVG8gPSB0b3RhbFBhZ2VzXG4gICAgfVxuXG4gICAgZm9yIChsZXQgaSA9IHBhZ2VzRnJvbTsgaSA8PSBwYWdlc1RvOyBpKyspIHtcbiAgICAgIHBhZ2VzLnB1c2goaSlcbiAgICB9XG5cbiAgICByZXR1cm4gcGFnZXNcbiAgfVxuXG4gIGlzUGFnZUFjdGl2ZUNsYXNzID0gKHBhZ2VOdW1iZXIpID0+IHRoaXMucC5yZXN1bHQuY3VycmVudFBhZ2UoKSA9PSBwYWdlTnVtYmVyID8gXCJhY3RpdmVcIiA6IFwibm90LWFjdGl2ZVwiXG5cbiAgcGFnZVBhdGggKHBhZ2VOdW1iZXIpIHtcbiAgICBsZXQgcGFnZUtleSA9IHRoaXMucC5yZXN1bHQuZGF0YS5jb2xsZWN0aW9uLnF1ZXJ5QXJncy5wYWdlS2V5XG5cbiAgICBpZiAoIXBhZ2VLZXkpIHtcbiAgICAgIHBhZ2VLZXkgPSBcInBhZ2VcIlxuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRQYXJhbXMgPSBxcy5wYXJzZShnbG9iYWxUaGlzLmxvY2F0aW9uLnNlYXJjaC5zdWJzdHIoMSkpXG4gICAgY3VycmVudFBhcmFtc1twYWdlS2V5XSA9IHBhZ2VOdW1iZXJcbiAgICBjb25zdCBuZXdQYXJhbXMgPSBxcy5zdHJpbmdpZnkoY3VycmVudFBhcmFtcywge2VuY29kZXI6IHVybEVuY29kZX0pXG4gICAgY29uc3QgbmV3UGF0aCA9IGAke2xvY2F0aW9uLnBhdGhuYW1lfT8ke25ld1BhcmFtc31gXG5cbiAgICByZXR1cm4gbmV3UGF0aFxuICB9XG5cbiAgcHJldmlvdXNQYWdlUGF0aCAoKSB7XG4gICAgY29uc3Qge3Jlc3VsdH0gPSB0aGlzLnBcbiAgICBsZXQgcHJldmlvdXNQYWdlXG5cbiAgICBpZiAocmVzdWx0LmN1cnJlbnRQYWdlKCkgPiAxKSB7XG4gICAgICBwcmV2aW91c1BhZ2UgPSByZXN1bHQuY3VycmVudFBhZ2UoKSAtIDFcbiAgICB9IGVsc2Uge1xuICAgICAgcHJldmlvdXNQYWdlID0gcmVzdWx0LmN1cnJlbnRQYWdlKClcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5wYWdlUGF0aChwcmV2aW91c1BhZ2UpXG4gIH1cblxuICBuZXh0UGFnZVBhdGggKCkge1xuICAgIGNvbnN0IHtyZXN1bHR9ID0gdGhpcy5wXG4gICAgbGV0IG5leHRQYWdlXG5cbiAgICBpZiAocmVzdWx0LmN1cnJlbnRQYWdlKCkgPCB0aGlzLnR0LnRvdGFsUGFnZXMpIHtcbiAgICAgIG5leHRQYWdlID0gcmVzdWx0LmN1cnJlbnRQYWdlKCkgKyAxXG4gICAgfSBlbHNlIHtcbiAgICAgIG5leHRQYWdlID0gcmVzdWx0LmN1cnJlbnRQYWdlKClcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5wYWdlUGF0aChuZXh0UGFnZSlcbiAgfVxuXG4gIHNob3dCYWNrd2FyZHNEb3RzID0gKCkgPT4gKHRoaXMucC5yZXN1bHQuY3VycmVudFBhZ2UoKSAtIDUgPiAxKVxuICBzaG93Rm9yd2FyZHNEb3RzID0gKCkgPT4gKHRoaXMucC5yZXN1bHQuY3VycmVudFBhZ2UoKSArIDUgPCB0aGlzLnR0LnRvdGFsUGFnZXMpXG5cbiAgcmVuZGVyICgpIHtcbiAgICBjb25zdCB7cmVzdWx0fSA9IHRoaXMucFxuICAgIGNvbnN0IHtwYWdlcywgdG90YWxQYWdlc30gPSB0aGlzLnR0XG4gICAgY29uc3Qgc2hvd05leHRQYWdlID0gcmVzdWx0LmN1cnJlbnRQYWdlKCkgPCB0b3RhbFBhZ2VzXG4gICAgY29uc3Qgc2hvd0xhc3RQYWdlID0gcmVzdWx0LmN1cnJlbnRQYWdlKCkgPCB0b3RhbFBhZ2VzXG4gICAgY29uc3Qgc2hvd1ByZXZpb3VzUGFnZSA9IHJlc3VsdC5jdXJyZW50UGFnZSgpID4gMVxuICAgIGNvbnN0IHNob3dGaXJzdFBhZ2UgPSByZXN1bHQuY3VycmVudFBhZ2UoKSA+IDFcblxuICAgIHJldHVybiAoXG4gICAgICA8PlxuICAgICAgICA8dWwgY2xhc3NOYW1lPVwicGFnaW5hdGlvblwiIGRhdGEtcGFnZXMtbGVuZ3RoPXtwYWdlcy5sZW5ndGh9PlxuICAgICAgICAgIDxsaSBjbGFzc05hbWU9e2BwYWdlLWl0ZW0gJHshc2hvd1ByZXZpb3VzUGFnZSA/IFwiZGlzYWJsZWRcIiA6IFwiXCJ9YH0ga2V5PVwicGFnZS1maXJzdFwiPlxuICAgICAgICAgICAgeyFzaG93UHJldmlvdXNQYWdlICYmXG4gICAgICAgICAgICAgIDxUZXh0PuKHpDwvVGV4dD5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHtzaG93UHJldmlvdXNQYWdlICYmXG4gICAgICAgICAgICAgIDxMaW5rIGRhdGFTZXQ9e3tjbGFzczogXCJwYWdlLWxpbmtcIn19IHRvPXt0aGlzLnBhZ2VQYXRoKDEpfT5cbiAgICAgICAgICAgICAgICA8VGV4dD7ih6Q8L1RleHQ+XG4gICAgICAgICAgICAgIDwvTGluaz5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICA8L2xpPlxuICAgICAgICAgIDxsaSBjbGFzc05hbWU9e2BwYWdlLWl0ZW0gJHshc2hvd0ZpcnN0UGFnZSA/IFwiZGlzYWJsZWRcIiA6IFwiXCJ9YH0ga2V5PVwicGFnZS1wcmV2aW91c1wiPlxuICAgICAgICAgICAgeyFzaG93Rmlyc3RQYWdlICYmXG4gICAgICAgICAgICAgIDxUZXh0PuKGkDwvVGV4dD5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHtzaG93Rmlyc3RQYWdlICYmXG4gICAgICAgICAgICAgIDxMaW5rIGRhdGFTZXQ9e3tjbGFzczogXCJwYWdlLWxpbmtcIn19IHRvPXt0aGlzLnByZXZpb3VzUGFnZVBhdGgoKX0+XG4gICAgICAgICAgICAgICAgPFRleHQ+4oaQPC9UZXh0PlxuICAgICAgICAgICAgICA8L0xpbms+XG4gICAgICAgICAgICB9XG4gICAgICAgICAgPC9saT5cbiAgICAgICAgICB7dGhpcy5zaG93QmFja3dhcmRzRG90cygpICYmXG4gICAgICAgICAgICA8bGkgY2xhc3NOYW1lPVwicGFnZS1pdGVtIGRpc2FibGVkXCI+XG4gICAgICAgICAgICAgICZoZWxsaXA7XG4gICAgICAgICAgICA8L2xpPlxuICAgICAgICAgIH1cbiAgICAgICAgICB7cGFnZXMubWFwKChwYWdlKSA9PlxuICAgICAgICAgICAgPGxpXG4gICAgICAgICAgICAgIGNsYXNzTmFtZT17YHBhZ2UtaXRlbSAke3RoaXMuaXNQYWdlQWN0aXZlQ2xhc3MocGFnZSl9YH1cbiAgICAgICAgICAgICAgZGF0YS1hY3RpdmU9e3RoaXMuaXNQYWdlQWN0aXZlQ2xhc3MocGFnZSkgPT0gXCJhY3RpdmVcIn1cbiAgICAgICAgICAgICAgZGF0YS1wYWdlPXtwYWdlfVxuICAgICAgICAgICAgICBrZXk9e2BwYWdlLSR7cGFnZX1gfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICB7dGhpcy5pc1BhZ2VBY3RpdmVDbGFzcyhwYWdlKSA9PSBcImFjdGl2ZVwiICYmXG4gICAgICAgICAgICAgICAgcGFnZVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHt0aGlzLmlzUGFnZUFjdGl2ZUNsYXNzKHBhZ2UpID09IFwibm90LWFjdGl2ZVwiICYmXG4gICAgICAgICAgICAgICAgPExpbmsgZGF0YVNldD17e2NsYXNzOiBcInBhZ2UtbGlua1wifX0gdG89e3RoaXMucGFnZVBhdGgocGFnZSl9PlxuICAgICAgICAgICAgICAgICAgPFRleHQ+e3BhZ2V9PC9UZXh0PlxuICAgICAgICAgICAgICAgIDwvTGluaz5cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgPC9saT5cbiAgICAgICAgICApfVxuICAgICAgICAgIHt0aGlzLnNob3dGb3J3YXJkc0RvdHMoKSAmJlxuICAgICAgICAgICAgPGxpIGNsYXNzTmFtZT1cInBhZ2UtaXRlbSBkaXNhYmxlZFwiPlxuICAgICAgICAgICAgICAmaGVsbGlwO1xuICAgICAgICAgICAgPC9saT5cbiAgICAgICAgICB9XG4gICAgICAgICAgPGxpIGNsYXNzTmFtZT17YHBhZ2UtaXRlbSAkeyFzaG93TmV4dFBhZ2UgPyBcImRpc2FibGVkXCIgOiBcIlwifWB9IGtleT1cInBhZ2UtbmV4dFwiPlxuICAgICAgICAgICAgeyFzaG93TmV4dFBhZ2UgJiZcbiAgICAgICAgICAgICAgPFRleHQ+4oaSPC9UZXh0PlxuICAgICAgICAgICAgfVxuICAgICAgICAgICAge3Nob3dOZXh0UGFnZSAmJlxuICAgICAgICAgICAgICA8TGluayBkYXRhU2V0PXt7Y2xhc3M6IFwicGFnZS1saW5rXCJ9fSB0bz17dGhpcy5uZXh0UGFnZVBhdGgoKX0+XG4gICAgICAgICAgICAgICAgPFRleHQ+4oaSPC9UZXh0PlxuICAgICAgICAgICAgICA8L0xpbms+XG4gICAgICAgICAgICB9XG4gICAgICAgICAgPC9saT5cbiAgICAgICAgICA8bGkgY2xhc3NOYW1lPXtgcGFnZS1pdGVtICR7IXNob3dMYXN0UGFnZSA/IFwiZGlzYWJsZWRcIiA6IFwiXCJ9YH0ga2V5PVwicGFnZS1sYXN0XCI+XG4gICAgICAgICAgICB7IXNob3dMYXN0UGFnZSAmJlxuICAgICAgICAgICAgICA8VGV4dD7ih6U8L1RleHQ+XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB7c2hvd0xhc3RQYWdlICYmXG4gICAgICAgICAgICAgIDxMaW5rIGRhdGFTZXQ9e3tjbGFzczogXCJwYWdlLWxpbmtcIn19IHRvPXt0aGlzLnBhZ2VQYXRoKHRvdGFsUGFnZXMpfT5cbiAgICAgICAgICAgICAgICA8VGV4dD7ih6U8L1RleHQ+XG4gICAgICAgICAgICAgIDwvTGluaz5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICA8L2xpPlxuICAgICAgICA8L3VsPlxuICAgICAgPC8+XG4gICAgKVxuICB9XG59KSlcbiJdfQ==