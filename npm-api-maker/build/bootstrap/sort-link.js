import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import BaseComponent from "../base-component";
import * as inflection from "inflection";
import Icon from "../utils/icon";
import PropTypes from "prop-types";
import qs from "qs";
import memo from "set-state-compare/build/memo.js";
import React from "react";
import Text from "../utils/text";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import urlEncode from "../url-encode.js";
import useSorting from "../table/use-sorting.js";
import Link from "../link";
import useQueryParams from "on-location-changed/build/use-query-params.js";
export default memo(shapeComponent(class ApiMakerBootstrapSortLink extends BaseComponent {
    static propTypes = {
        attribute: PropTypes.string.isRequired,
        className: PropTypes.string,
        defaultParams: PropTypes.object,
        linkComponent: PropTypes.object,
        onChanged: PropTypes.func,
        query: PropTypes.object.isRequired,
        title: PropTypes.any
    };
    setup() {
        const { attribute, defaultParams, query } = this.props;
        const { qParams, searchKey, sortAttribute, sortMode } = useSorting({ defaultParams, query });
        this.setInstance({
            isSortedByAttribute: sortAttribute == attribute,
            qParams,
            searchKey,
            sortMode
        });
        this.queryParams = useQueryParams();
        this.searchKey = this.p.query.queryArgs.searchKey || "q";
        this.attribute = inflection.underscore(this.p.attribute);
    }
    href() {
        const qParams = Object.assign({}, this.tt.qParams);
        const { attribute, queryParams, searchKey, sortMode } = this.tt;
        const newQueryParams = { ...queryParams };
        qParams.s = `${attribute} ${sortMode == "asc" ? "desc" : "asc"}`; // eslint-disable-line id-length
        newQueryParams[searchKey] = JSON.stringify(qParams);
        const newParams = qs.stringify(newQueryParams, { encoder: urlEncode });
        const newPath = `${location.pathname}?${newParams}`;
        return newPath;
    }
    render() {
        const { isSortedByAttribute, sortMode } = this.tt;
        const LinkComponent = this.linkComponent();
        const { attribute, className, dataSet, defaultParams, linkComponent, onChanged, query, style, textProps, title, ...restProps } = this.props;
        const actualDataSet = Object.assign({
            attribute,
            class: className,
            component: "api-maker/bootstrap/sort-link",
            sortMode: this.tt.sortMode
        }, dataSet);
        const actualStyle = Object.assign({ display: "flex", flexDirection: "row", alignItems: "center" }, style);
        return (_jsxs(LinkComponent, { dataSet: actualDataSet, style: actualStyle, to: this.href(), ...restProps, children: [_jsx(Text, { ...textProps, children: this.title() }), isSortedByAttribute && sortMode == "asc" &&
                    _jsx(Icon, { name: "chevron-down", size: 14, style: this.cache("downIconStyle", { marginLeft: 3 }) }), isSortedByAttribute && sortMode == "desc" &&
                    _jsx(Icon, { name: "chevron-up", size: 14, style: this.cache("upIconStyle", { marginLeft: 3 }) })] }));
    }
    linkComponent = () => this.props.linkComponent || Link;
    title() {
        const { attribute, query } = this.p;
        const { title } = this.props;
        if (title)
            return title;
        return query.modelClass().humanAttributeName(attribute);
    }
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29ydC1saW5rLmpzIiwic291cmNlUm9vdCI6Ii9zcmMvIiwic291cmNlcyI6WyJib290c3RyYXAvc29ydC1saW5rLmpzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxhQUFhLE1BQU0sbUJBQW1CLENBQUE7QUFDN0MsT0FBTyxLQUFLLFVBQVUsTUFBTSxZQUFZLENBQUE7QUFDeEMsT0FBTyxJQUFJLE1BQU0sZUFBZSxDQUFBO0FBQ2hDLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQTtBQUNsQyxPQUFPLEVBQUUsTUFBTSxJQUFJLENBQUE7QUFDbkIsT0FBTyxJQUFJLE1BQU0saUNBQWlDLENBQUE7QUFDbEQsT0FBTyxLQUFLLE1BQU0sT0FBTyxDQUFBO0FBQ3pCLE9BQU8sSUFBSSxNQUFNLGVBQWUsQ0FBQTtBQUNoQyxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sNENBQTRDLENBQUE7QUFDekUsT0FBTyxTQUFTLE1BQU0sa0JBQWtCLENBQUE7QUFDeEMsT0FBTyxVQUFVLE1BQU0seUJBQXlCLENBQUE7QUFFaEQsT0FBTyxJQUFJLE1BQU0sU0FBUyxDQUFBO0FBQzFCLE9BQU8sY0FBYyxNQUFNLCtDQUErQyxDQUFBO0FBRTFFLGVBQWUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLHlCQUEwQixTQUFRLGFBQWE7SUFDdEYsTUFBTSxDQUFDLFNBQVMsR0FBRztRQUNqQixTQUFTLEVBQUUsU0FBUyxDQUFDLE1BQU0sQ0FBQyxVQUFVO1FBQ3RDLFNBQVMsRUFBRSxTQUFTLENBQUMsTUFBTTtRQUMzQixhQUFhLEVBQUUsU0FBUyxDQUFDLE1BQU07UUFDL0IsYUFBYSxFQUFFLFNBQVMsQ0FBQyxNQUFNO1FBQy9CLFNBQVMsRUFBRSxTQUFTLENBQUMsSUFBSTtRQUN6QixLQUFLLEVBQUUsU0FBUyxDQUFDLE1BQU0sQ0FBQyxVQUFVO1FBQ2xDLEtBQUssRUFBRSxTQUFTLENBQUMsR0FBRztLQUNyQixDQUFBO0lBRUQsS0FBSztRQUNILE1BQU0sRUFBQyxTQUFTLEVBQUUsYUFBYSxFQUFFLEtBQUssRUFBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUE7UUFDcEQsTUFBTSxFQUFDLE9BQU8sRUFBRSxTQUFTLEVBQUUsYUFBYSxFQUFFLFFBQVEsRUFBQyxHQUFHLFVBQVUsQ0FBQyxFQUFDLGFBQWEsRUFBRSxLQUFLLEVBQUMsQ0FBQyxDQUFBO1FBRXhGLElBQUksQ0FBQyxXQUFXLENBQUM7WUFDZixtQkFBbUIsRUFBRSxhQUFhLElBQUksU0FBUztZQUMvQyxPQUFPO1lBQ1AsU0FBUztZQUNULFFBQVE7U0FDVCxDQUFDLENBQUE7UUFFRixJQUFJLENBQUMsV0FBVyxHQUFHLGNBQWMsRUFBRSxDQUFBO1FBQ25DLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLFNBQVMsSUFBSSxHQUFHLENBQUE7UUFDeEQsSUFBSSxDQUFDLFNBQVMsR0FBRyxVQUFVLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUE7SUFDMUQsQ0FBQztJQUVELElBQUk7UUFDRixNQUFNLE9BQU8sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFBO1FBQ2xELE1BQU0sRUFBQyxTQUFTLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFBO1FBQzdELE1BQU0sY0FBYyxHQUFHLEVBQUMsR0FBRyxXQUFXLEVBQUMsQ0FBQTtRQUV2QyxPQUFPLENBQUMsQ0FBQyxHQUFHLEdBQUcsU0FBUyxJQUFJLFFBQVEsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUEsQ0FBQyxnQ0FBZ0M7UUFFakcsY0FBYyxDQUFDLFNBQVMsQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUE7UUFFbkQsTUFBTSxTQUFTLEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQyxjQUFjLEVBQUUsRUFBQyxPQUFPLEVBQUUsU0FBUyxFQUFDLENBQUMsQ0FBQTtRQUNwRSxNQUFNLE9BQU8sR0FBRyxHQUFHLFFBQVEsQ0FBQyxRQUFRLElBQUksU0FBUyxFQUFFLENBQUE7UUFFbkQsT0FBTyxPQUFPLENBQUE7SUFDaEIsQ0FBQztJQUVELE1BQU07UUFDSixNQUFNLEVBQUMsbUJBQW1CLEVBQUUsUUFBUSxFQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQTtRQUMvQyxNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUE7UUFDMUMsTUFBTSxFQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLGFBQWEsRUFBRSxhQUFhLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxHQUFHLFNBQVMsRUFBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUE7UUFDekksTUFBTSxhQUFhLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FDakM7WUFDRSxTQUFTO1lBQ1QsS0FBSyxFQUFFLFNBQVM7WUFDaEIsU0FBUyxFQUFFLCtCQUErQjtZQUMxQyxRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRO1NBQzNCLEVBQ0QsT0FBTyxDQUNSLENBQUE7UUFDRCxNQUFNLFdBQVcsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUMvQixFQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsYUFBYSxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFDLEVBQzdELEtBQUssQ0FDTixDQUFBO1FBRUQsT0FBTyxDQUNMLE1BQUMsYUFBYSxJQUNaLE9BQU8sRUFBRSxhQUFhLEVBQ3RCLEtBQUssRUFBRSxXQUFXLEVBQ2xCLEVBQUUsRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLEtBQ1gsU0FBUyxhQUViLEtBQUMsSUFBSSxPQUFLLFNBQVMsWUFDaEIsSUFBSSxDQUFDLEtBQUssRUFBRSxHQUNSLEVBQ04sbUJBQW1CLElBQUksUUFBUSxJQUFJLEtBQUs7b0JBQ3ZDLEtBQUMsSUFBSSxJQUFDLElBQUksRUFBQyxjQUFjLEVBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxlQUFlLEVBQUUsRUFBQyxVQUFVLEVBQUUsQ0FBQyxFQUFDLENBQUMsR0FBSSxFQUU1RixtQkFBbUIsSUFBSSxRQUFRLElBQUksTUFBTTtvQkFDeEMsS0FBQyxJQUFJLElBQUMsSUFBSSxFQUFDLFlBQVksRUFBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsRUFBRSxFQUFDLFVBQVUsRUFBRSxDQUFDLEVBQUMsQ0FBQyxHQUFJLElBRTNFLENBQ2pCLENBQUE7SUFDSCxDQUFDO0lBRUQsYUFBYSxHQUFHLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYSxJQUFJLElBQUksQ0FBQTtJQUV0RCxLQUFLO1FBQ0gsTUFBTSxFQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFBO1FBQ2pDLE1BQU0sRUFBQyxLQUFLLEVBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFBO1FBRTFCLElBQUksS0FBSztZQUFFLE9BQU8sS0FBSyxDQUFBO1FBRXZCLE9BQU8sS0FBSyxDQUFDLFVBQVUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLFNBQVMsQ0FBQyxDQUFBO0lBQ3pELENBQUM7Q0FDRixDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCYXNlQ29tcG9uZW50IGZyb20gXCIuLi9iYXNlLWNvbXBvbmVudFwiXG5pbXBvcnQgKiBhcyBpbmZsZWN0aW9uIGZyb20gXCJpbmZsZWN0aW9uXCJcbmltcG9ydCBJY29uIGZyb20gXCIuLi91dGlscy9pY29uXCJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIlxuaW1wb3J0IHFzIGZyb20gXCJxc1wiXG5pbXBvcnQgbWVtbyBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvbWVtby5qc1wiXG5pbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCJcbmltcG9ydCBUZXh0IGZyb20gXCIuLi91dGlscy90ZXh0XCJcbmltcG9ydCB7c2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IHVybEVuY29kZSBmcm9tIFwiLi4vdXJsLWVuY29kZS5qc1wiXG5pbXBvcnQgdXNlU29ydGluZyBmcm9tIFwiLi4vdGFibGUvdXNlLXNvcnRpbmcuanNcIlxuXG5pbXBvcnQgTGluayBmcm9tIFwiLi4vbGlua1wiXG5pbXBvcnQgdXNlUXVlcnlQYXJhbXMgZnJvbSBcIm9uLWxvY2F0aW9uLWNoYW5nZWQvYnVpbGQvdXNlLXF1ZXJ5LXBhcmFtcy5qc1wiXG5cbmV4cG9ydCBkZWZhdWx0IG1lbW8oc2hhcGVDb21wb25lbnQoY2xhc3MgQXBpTWFrZXJCb290c3RyYXBTb3J0TGluayBleHRlbmRzIEJhc2VDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIGF0dHJpYnV0ZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBkZWZhdWx0UGFyYW1zOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIGxpbmtDb21wb25lbnQ6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgb25DaGFuZ2VkOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBxdWVyeTogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIHRpdGxlOiBQcm9wVHlwZXMuYW55XG4gIH1cblxuICBzZXR1cCgpIHtcbiAgICBjb25zdCB7YXR0cmlidXRlLCBkZWZhdWx0UGFyYW1zLCBxdWVyeX0gPSB0aGlzLnByb3BzXG4gICAgY29uc3Qge3FQYXJhbXMsIHNlYXJjaEtleSwgc29ydEF0dHJpYnV0ZSwgc29ydE1vZGV9ID0gdXNlU29ydGluZyh7ZGVmYXVsdFBhcmFtcywgcXVlcnl9KVxuXG4gICAgdGhpcy5zZXRJbnN0YW5jZSh7XG4gICAgICBpc1NvcnRlZEJ5QXR0cmlidXRlOiBzb3J0QXR0cmlidXRlID09IGF0dHJpYnV0ZSxcbiAgICAgIHFQYXJhbXMsXG4gICAgICBzZWFyY2hLZXksXG4gICAgICBzb3J0TW9kZVxuICAgIH0pXG5cbiAgICB0aGlzLnF1ZXJ5UGFyYW1zID0gdXNlUXVlcnlQYXJhbXMoKVxuICAgIHRoaXMuc2VhcmNoS2V5ID0gdGhpcy5wLnF1ZXJ5LnF1ZXJ5QXJncy5zZWFyY2hLZXkgfHwgXCJxXCJcbiAgICB0aGlzLmF0dHJpYnV0ZSA9IGluZmxlY3Rpb24udW5kZXJzY29yZSh0aGlzLnAuYXR0cmlidXRlKVxuICB9XG5cbiAgaHJlZiAoKSB7XG4gICAgY29uc3QgcVBhcmFtcyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMudHQucVBhcmFtcylcbiAgICBjb25zdCB7YXR0cmlidXRlLCBxdWVyeVBhcmFtcywgc2VhcmNoS2V5LCBzb3J0TW9kZX0gPSB0aGlzLnR0XG4gICAgY29uc3QgbmV3UXVlcnlQYXJhbXMgPSB7Li4ucXVlcnlQYXJhbXN9XG5cbiAgICBxUGFyYW1zLnMgPSBgJHthdHRyaWJ1dGV9ICR7c29ydE1vZGUgPT0gXCJhc2NcIiA/IFwiZGVzY1wiIDogXCJhc2NcIn1gIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgaWQtbGVuZ3RoXG5cbiAgICBuZXdRdWVyeVBhcmFtc1tzZWFyY2hLZXldID0gSlNPTi5zdHJpbmdpZnkocVBhcmFtcylcblxuICAgIGNvbnN0IG5ld1BhcmFtcyA9IHFzLnN0cmluZ2lmeShuZXdRdWVyeVBhcmFtcywge2VuY29kZXI6IHVybEVuY29kZX0pXG4gICAgY29uc3QgbmV3UGF0aCA9IGAke2xvY2F0aW9uLnBhdGhuYW1lfT8ke25ld1BhcmFtc31gXG5cbiAgICByZXR1cm4gbmV3UGF0aFxuICB9XG5cbiAgcmVuZGVyICgpIHtcbiAgICBjb25zdCB7aXNTb3J0ZWRCeUF0dHJpYnV0ZSwgc29ydE1vZGV9ID0gdGhpcy50dFxuICAgIGNvbnN0IExpbmtDb21wb25lbnQgPSB0aGlzLmxpbmtDb21wb25lbnQoKVxuICAgIGNvbnN0IHthdHRyaWJ1dGUsIGNsYXNzTmFtZSwgZGF0YVNldCwgZGVmYXVsdFBhcmFtcywgbGlua0NvbXBvbmVudCwgb25DaGFuZ2VkLCBxdWVyeSwgc3R5bGUsIHRleHRQcm9wcywgdGl0bGUsIC4uLnJlc3RQcm9wc30gPSB0aGlzLnByb3BzXG4gICAgY29uc3QgYWN0dWFsRGF0YVNldCA9IE9iamVjdC5hc3NpZ24oXG4gICAgICB7XG4gICAgICAgIGF0dHJpYnV0ZSxcbiAgICAgICAgY2xhc3M6IGNsYXNzTmFtZSxcbiAgICAgICAgY29tcG9uZW50OiBcImFwaS1tYWtlci9ib290c3RyYXAvc29ydC1saW5rXCIsXG4gICAgICAgIHNvcnRNb2RlOiB0aGlzLnR0LnNvcnRNb2RlXG4gICAgICB9LFxuICAgICAgZGF0YVNldFxuICAgIClcbiAgICBjb25zdCBhY3R1YWxTdHlsZSA9IE9iamVjdC5hc3NpZ24oXG4gICAgICB7ZGlzcGxheTogXCJmbGV4XCIsIGZsZXhEaXJlY3Rpb246IFwicm93XCIsIGFsaWduSXRlbXM6IFwiY2VudGVyXCJ9LFxuICAgICAgc3R5bGVcbiAgICApXG5cbiAgICByZXR1cm4gKFxuICAgICAgPExpbmtDb21wb25lbnRcbiAgICAgICAgZGF0YVNldD17YWN0dWFsRGF0YVNldH1cbiAgICAgICAgc3R5bGU9e2FjdHVhbFN0eWxlfVxuICAgICAgICB0bz17dGhpcy5ocmVmKCl9XG4gICAgICAgIHsuLi5yZXN0UHJvcHN9XG4gICAgICA+XG4gICAgICAgIDxUZXh0IHsuLi50ZXh0UHJvcHN9PlxuICAgICAgICAgIHt0aGlzLnRpdGxlKCl9XG4gICAgICAgIDwvVGV4dD5cbiAgICAgICAge2lzU29ydGVkQnlBdHRyaWJ1dGUgJiYgc29ydE1vZGUgPT0gXCJhc2NcIiAmJlxuICAgICAgICAgIDxJY29uIG5hbWU9XCJjaGV2cm9uLWRvd25cIiBzaXplPXsxNH0gc3R5bGU9e3RoaXMuY2FjaGUoXCJkb3duSWNvblN0eWxlXCIsIHttYXJnaW5MZWZ0OiAzfSl9IC8+XG4gICAgICAgIH1cbiAgICAgICAge2lzU29ydGVkQnlBdHRyaWJ1dGUgJiYgc29ydE1vZGUgPT0gXCJkZXNjXCIgJiZcbiAgICAgICAgICA8SWNvbiBuYW1lPVwiY2hldnJvbi11cFwiIHNpemU9ezE0fSBzdHlsZT17dGhpcy5jYWNoZShcInVwSWNvblN0eWxlXCIsIHttYXJnaW5MZWZ0OiAzfSl9IC8+XG4gICAgICAgIH1cbiAgICAgIDwvTGlua0NvbXBvbmVudD5cbiAgICApXG4gIH1cblxuICBsaW5rQ29tcG9uZW50ID0gKCkgPT4gdGhpcy5wcm9wcy5saW5rQ29tcG9uZW50IHx8IExpbmtcblxuICB0aXRsZSAoKSB7XG4gICAgY29uc3Qge2F0dHJpYnV0ZSwgcXVlcnl9ID0gdGhpcy5wXG4gICAgY29uc3Qge3RpdGxlfSA9IHRoaXMucHJvcHNcblxuICAgIGlmICh0aXRsZSkgcmV0dXJuIHRpdGxlXG5cbiAgICByZXR1cm4gcXVlcnkubW9kZWxDbGFzcygpLmh1bWFuQXR0cmlidXRlTmFtZShhdHRyaWJ1dGUpXG4gIH1cbn0pKVxuIl19