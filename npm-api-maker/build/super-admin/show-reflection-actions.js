import BaseComponent from "../base-component.js";
import { digg } from "diggerize";
import * as inflection from "inflection";
import Link from "../link.js";
import memo from "set-state-compare/build/memo.js";
import React, { useMemo } from "react";
import Params from "../params.js";
import PropTypes from "prop-types";
import propTypesExact from "prop-types-exact";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import useCanCan from "../use-can-can.js";
export default memo(shapeComponent(class SuperAdminShowReflectionActions extends BaseComponent {
    static propTypes = propTypesExact({
        model: PropTypes.object,
        modelClass: PropTypes.func,
        reflectionName: PropTypes.string
    });
    setup() {
        const { modelClass, reflectionName } = this.p;
        this.reflection = useMemo(() => modelClass.reflections().find((reflection) => reflection.name() == reflectionName), [modelClass, reflectionName]);
        this.canCan = useCanCan(() => [[this.reflection.modelClass(), ["new"]]]);
    }
    render() {
        const { canCan, reflection } = this.tt;
        const { model } = this.p;
        const modelClassName = digg(reflection, "reflectionData", "className");
        const modelData = {};
        const dataParamName = inflection.singularize(reflection.reflectionData.collectionName);
        modelData[reflection.foreignKey()] = model?.id();
        const linkParams = {
            model: modelClassName,
            mode: "new"
        };
        linkParams[dataParamName] = modelData;
        const dataSet = useMemo(() => ({ class: "create-new-model-link" }), []);
        return (<>
        {canCan?.can("new", reflection.modelClass()) &&
                <Link dataSet={dataSet} to={Params.withParams(linkParams)}>
            Create new
          </Link>}
      </>);
    }
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hvdy1yZWZsZWN0aW9uLWFjdGlvbnMuanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbInN1cGVyLWFkbWluL3Nob3ctcmVmbGVjdGlvbi1hY3Rpb25zLmpzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLGFBQWEsTUFBTSxzQkFBc0IsQ0FBQTtBQUNoRCxPQUFPLEVBQUMsSUFBSSxFQUFDLE1BQU0sV0FBVyxDQUFBO0FBQzlCLE9BQU8sS0FBSyxVQUFVLE1BQU0sWUFBWSxDQUFBO0FBQ3hDLE9BQU8sSUFBSSxNQUFNLFlBQVksQ0FBQTtBQUM3QixPQUFPLElBQUksTUFBTSxpQ0FBaUMsQ0FBQTtBQUNsRCxPQUFPLEtBQUssRUFBRSxFQUFDLE9BQU8sRUFBQyxNQUFNLE9BQU8sQ0FBQTtBQUNwQyxPQUFPLE1BQU0sTUFBTSxjQUFjLENBQUE7QUFDakMsT0FBTyxTQUFTLE1BQU0sWUFBWSxDQUFBO0FBQ2xDLE9BQU8sY0FBYyxNQUFNLGtCQUFrQixDQUFBO0FBQzdDLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSw0Q0FBNEMsQ0FBQTtBQUN6RSxPQUFPLFNBQVMsTUFBTSxtQkFBbUIsQ0FBQTtBQUV6QyxlQUFlLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSwrQkFBZ0MsU0FBUSxhQUFhO0lBQzVGLE1BQU0sQ0FBQyxTQUFTLEdBQUcsY0FBYyxDQUFDO1FBQ2hDLEtBQUssRUFBRSxTQUFTLENBQUMsTUFBTTtRQUN2QixVQUFVLEVBQUUsU0FBUyxDQUFDLElBQUk7UUFDMUIsY0FBYyxFQUFFLFNBQVMsQ0FBQyxNQUFNO0tBQ2pDLENBQUMsQ0FBQTtJQUVGLEtBQUs7UUFDSCxNQUFNLEVBQUMsVUFBVSxFQUFFLGNBQWMsRUFBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUE7UUFFM0MsSUFBSSxDQUFDLFVBQVUsR0FBRyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUMsVUFBVSxDQUFDLFdBQVcsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLFVBQVUsRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxJQUFJLGNBQWMsQ0FBQyxFQUFFLENBQUMsVUFBVSxFQUFFLGNBQWMsQ0FBQyxDQUFDLENBQUE7UUFDakosSUFBSSxDQUFDLE1BQU0sR0FBRyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUMxRSxDQUFDO0lBRUQsTUFBTTtRQUNKLE1BQU0sRUFBQyxNQUFNLEVBQUUsVUFBVSxFQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQTtRQUNwQyxNQUFNLEVBQUMsS0FBSyxFQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQTtRQUN0QixNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLGdCQUFnQixFQUFFLFdBQVcsQ0FBQyxDQUFBO1FBQ3RFLE1BQU0sU0FBUyxHQUFHLEVBQUUsQ0FBQTtRQUNwQixNQUFNLGFBQWEsR0FBRyxVQUFVLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxjQUFjLENBQUMsY0FBYyxDQUFDLENBQUE7UUFFdEYsU0FBUyxDQUFDLFVBQVUsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxHQUFHLEtBQUssRUFBRSxFQUFFLEVBQUUsQ0FBQTtRQUVoRCxNQUFNLFVBQVUsR0FBRztZQUNqQixLQUFLLEVBQUUsY0FBYztZQUNyQixJQUFJLEVBQUUsS0FBSztTQUNaLENBQUE7UUFFRCxVQUFVLENBQUMsYUFBYSxDQUFDLEdBQUcsU0FBUyxDQUFBO1FBRXJDLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUMsS0FBSyxFQUFFLHVCQUF1QixFQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQTtRQUVyRSxPQUFPLENBQ0wsRUFDRTtRQUFBLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxLQUFLLEVBQUUsVUFBVSxDQUFDLFVBQVUsRUFBRSxDQUFDO2dCQUMxQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQ3hEOztVQUNGLEVBQUUsSUFBSSxDQUNSLENBQ0Y7TUFBQSxHQUFHLENBQ0osQ0FBQTtJQUNILENBQUM7Q0FDRixDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCYXNlQ29tcG9uZW50IGZyb20gXCIuLi9iYXNlLWNvbXBvbmVudC5qc1wiXG5pbXBvcnQge2RpZ2d9IGZyb20gXCJkaWdnZXJpemVcIlxuaW1wb3J0ICogYXMgaW5mbGVjdGlvbiBmcm9tIFwiaW5mbGVjdGlvblwiXG5pbXBvcnQgTGluayBmcm9tIFwiLi4vbGluay5qc1wiXG5pbXBvcnQgbWVtbyBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvbWVtby5qc1wiXG5pbXBvcnQgUmVhY3QsIHt1c2VNZW1vfSBmcm9tIFwicmVhY3RcIlxuaW1wb3J0IFBhcmFtcyBmcm9tIFwiLi4vcGFyYW1zLmpzXCJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIlxuaW1wb3J0IHByb3BUeXBlc0V4YWN0IGZyb20gXCJwcm9wLXR5cGVzLWV4YWN0XCJcbmltcG9ydCB7c2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IHVzZUNhbkNhbiBmcm9tIFwiLi4vdXNlLWNhbi1jYW4uanNcIlxuXG5leHBvcnQgZGVmYXVsdCBtZW1vKHNoYXBlQ29tcG9uZW50KGNsYXNzIFN1cGVyQWRtaW5TaG93UmVmbGVjdGlvbkFjdGlvbnMgZXh0ZW5kcyBCYXNlQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHByb3BUeXBlc0V4YWN0KHtcbiAgICBtb2RlbDogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBtb2RlbENsYXNzOiBQcm9wVHlwZXMuZnVuYyxcbiAgICByZWZsZWN0aW9uTmFtZTogUHJvcFR5cGVzLnN0cmluZ1xuICB9KVxuXG4gIHNldHVwKCkge1xuICAgIGNvbnN0IHttb2RlbENsYXNzLCByZWZsZWN0aW9uTmFtZX0gPSB0aGlzLnBcblxuICAgIHRoaXMucmVmbGVjdGlvbiA9IHVzZU1lbW8oKCkgPT4gbW9kZWxDbGFzcy5yZWZsZWN0aW9ucygpLmZpbmQoKHJlZmxlY3Rpb24pID0+IHJlZmxlY3Rpb24ubmFtZSgpID09IHJlZmxlY3Rpb25OYW1lKSwgW21vZGVsQ2xhc3MsIHJlZmxlY3Rpb25OYW1lXSlcbiAgICB0aGlzLmNhbkNhbiA9IHVzZUNhbkNhbigoKSA9PiBbW3RoaXMucmVmbGVjdGlvbi5tb2RlbENsYXNzKCksIFtcIm5ld1wiXV1dKVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtjYW5DYW4sIHJlZmxlY3Rpb259ID0gdGhpcy50dFxuICAgIGNvbnN0IHttb2RlbH0gPSB0aGlzLnBcbiAgICBjb25zdCBtb2RlbENsYXNzTmFtZSA9IGRpZ2cocmVmbGVjdGlvbiwgXCJyZWZsZWN0aW9uRGF0YVwiLCBcImNsYXNzTmFtZVwiKVxuICAgIGNvbnN0IG1vZGVsRGF0YSA9IHt9XG4gICAgY29uc3QgZGF0YVBhcmFtTmFtZSA9IGluZmxlY3Rpb24uc2luZ3VsYXJpemUocmVmbGVjdGlvbi5yZWZsZWN0aW9uRGF0YS5jb2xsZWN0aW9uTmFtZSlcblxuICAgIG1vZGVsRGF0YVtyZWZsZWN0aW9uLmZvcmVpZ25LZXkoKV0gPSBtb2RlbD8uaWQoKVxuXG4gICAgY29uc3QgbGlua1BhcmFtcyA9IHtcbiAgICAgIG1vZGVsOiBtb2RlbENsYXNzTmFtZSxcbiAgICAgIG1vZGU6IFwibmV3XCJcbiAgICB9XG5cbiAgICBsaW5rUGFyYW1zW2RhdGFQYXJhbU5hbWVdID0gbW9kZWxEYXRhXG5cbiAgICBjb25zdCBkYXRhU2V0ID0gdXNlTWVtbygoKSA9PiAoe2NsYXNzOiBcImNyZWF0ZS1uZXctbW9kZWwtbGlua1wifSksIFtdKVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDw+XG4gICAgICAgIHtjYW5DYW4/LmNhbihcIm5ld1wiLCByZWZsZWN0aW9uLm1vZGVsQ2xhc3MoKSkgJiZcbiAgICAgICAgICA8TGluayBkYXRhU2V0PXtkYXRhU2V0fSB0bz17UGFyYW1zLndpdGhQYXJhbXMobGlua1BhcmFtcyl9PlxuICAgICAgICAgICAgQ3JlYXRlIG5ld1xuICAgICAgICAgIDwvTGluaz5cbiAgICAgICAgfVxuICAgICAgPC8+XG4gICAgKVxuICB9XG59KSlcbiJdfQ==