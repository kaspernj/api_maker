import { jsx as _jsx, Fragment as _Fragment } from "react/jsx-runtime";
import BaseComponent from "../base-component";
import { digg } from "diggerize";
import * as inflection from "inflection";
import Link from "../link";
import memo from "set-state-compare/build/memo.js";
import React, { useMemo } from "react";
import Params from "../params.js";
import PropTypes from "prop-types";
import propTypesExact from "prop-types-exact";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import useCanCan from "../use-can-can.js";
export default memo(shapeComponent(class SuperAdminShowReflectionActions extends BaseComponent {
    static propTypes = propTypesExact({
        model: PropTypes.object,
        modelClass: PropTypes.func,
        reflectionName: PropTypes.string
    });
    setup() {
        const { modelClass, reflectionName } = this.p;
        this.reflection = useMemo(() => modelClass.reflections().find((reflection) => reflection.name() == reflectionName), [modelClass, reflectionName]);
        this.canCan = useCanCan(() => [[this.reflection.modelClass(), ["new"]]]);
    }
    render() {
        const { canCan, reflection } = this.tt;
        const { model } = this.p;
        const modelClassName = digg(reflection, "reflectionData", "className");
        const modelData = {};
        const dataParamName = inflection.singularize(reflection.reflectionData.collectionName);
        modelData[reflection.foreignKey()] = model?.id();
        const linkParams = {
            model: modelClassName,
            mode: "new"
        };
        linkParams[dataParamName] = modelData;
        const dataSet = useMemo(() => ({ class: "create-new-model-link" }), []);
        return (_jsx(_Fragment, { children: canCan?.can("new", reflection.modelClass()) &&
                _jsx(Link, { dataSet: dataSet, to: Params.withParams(linkParams), children: "Create new" }) }));
    }
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hvdy1yZWZsZWN0aW9uLWFjdGlvbnMuanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbInN1cGVyLWFkbWluL3Nob3ctcmVmbGVjdGlvbi1hY3Rpb25zLmpzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxhQUFhLE1BQU0sbUJBQW1CLENBQUE7QUFDN0MsT0FBTyxFQUFDLElBQUksRUFBQyxNQUFNLFdBQVcsQ0FBQTtBQUM5QixPQUFPLEtBQUssVUFBVSxNQUFNLFlBQVksQ0FBQTtBQUN4QyxPQUFPLElBQUksTUFBTSxTQUFTLENBQUE7QUFDMUIsT0FBTyxJQUFJLE1BQU0saUNBQWlDLENBQUE7QUFDbEQsT0FBTyxLQUFLLEVBQUUsRUFBQyxPQUFPLEVBQUMsTUFBTSxPQUFPLENBQUE7QUFDcEMsT0FBTyxNQUFNLE1BQU0sY0FBYyxDQUFBO0FBQ2pDLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQTtBQUNsQyxPQUFPLGNBQWMsTUFBTSxrQkFBa0IsQ0FBQTtBQUM3QyxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sNENBQTRDLENBQUE7QUFDekUsT0FBTyxTQUFTLE1BQU0sbUJBQW1CLENBQUE7QUFFekMsZUFBZSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sK0JBQWdDLFNBQVEsYUFBYTtJQUM1RixNQUFNLENBQUMsU0FBUyxHQUFHLGNBQWMsQ0FBQztRQUNoQyxLQUFLLEVBQUUsU0FBUyxDQUFDLE1BQU07UUFDdkIsVUFBVSxFQUFFLFNBQVMsQ0FBQyxJQUFJO1FBQzFCLGNBQWMsRUFBRSxTQUFTLENBQUMsTUFBTTtLQUNqQyxDQUFDLENBQUE7SUFFRixLQUFLO1FBQ0gsTUFBTSxFQUFDLFVBQVUsRUFBRSxjQUFjLEVBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFBO1FBRTNDLElBQUksQ0FBQyxVQUFVLEdBQUcsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLFVBQVUsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxjQUFjLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFBO1FBQ2pKLElBQUksQ0FBQyxNQUFNLEdBQUcsU0FBUyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLFVBQVUsRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFDMUUsQ0FBQztJQUVELE1BQU07UUFDSixNQUFNLEVBQUMsTUFBTSxFQUFFLFVBQVUsRUFBQyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUE7UUFDcEMsTUFBTSxFQUFDLEtBQUssRUFBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUE7UUFDdEIsTUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRSxnQkFBZ0IsRUFBRSxXQUFXLENBQUMsQ0FBQTtRQUN0RSxNQUFNLFNBQVMsR0FBRyxFQUFFLENBQUE7UUFDcEIsTUFBTSxhQUFhLEdBQUcsVUFBVSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsY0FBYyxDQUFDLGNBQWMsQ0FBQyxDQUFBO1FBRXRGLFNBQVMsQ0FBQyxVQUFVLENBQUMsVUFBVSxFQUFFLENBQUMsR0FBRyxLQUFLLEVBQUUsRUFBRSxFQUFFLENBQUE7UUFFaEQsTUFBTSxVQUFVLEdBQUc7WUFDakIsS0FBSyxFQUFFLGNBQWM7WUFDckIsSUFBSSxFQUFFLEtBQUs7U0FDWixDQUFBO1FBRUQsVUFBVSxDQUFDLGFBQWEsQ0FBQyxHQUFHLFNBQVMsQ0FBQTtRQUVyQyxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFDLEtBQUssRUFBRSx1QkFBdUIsRUFBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUE7UUFFckUsT0FBTyxDQUNMLDRCQUNHLE1BQU0sRUFBRSxHQUFHLENBQUMsS0FBSyxFQUFFLFVBQVUsQ0FBQyxVQUFVLEVBQUUsQ0FBQztnQkFDMUMsS0FBQyxJQUFJLElBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUUsTUFBTSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsMkJBRWxELEdBRVIsQ0FDSixDQUFBO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJhc2VDb21wb25lbnQgZnJvbSBcIi4uL2Jhc2UtY29tcG9uZW50XCJcbmltcG9ydCB7ZGlnZ30gZnJvbSBcImRpZ2dlcml6ZVwiXG5pbXBvcnQgKiBhcyBpbmZsZWN0aW9uIGZyb20gXCJpbmZsZWN0aW9uXCJcbmltcG9ydCBMaW5rIGZyb20gXCIuLi9saW5rXCJcbmltcG9ydCBtZW1vIGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9tZW1vLmpzXCJcbmltcG9ydCBSZWFjdCwge3VzZU1lbW99IGZyb20gXCJyZWFjdFwiXG5pbXBvcnQgUGFyYW1zIGZyb20gXCIuLi9wYXJhbXMuanNcIlxuaW1wb3J0IFByb3BUeXBlcyBmcm9tIFwicHJvcC10eXBlc1wiXG5pbXBvcnQgcHJvcFR5cGVzRXhhY3QgZnJvbSBcInByb3AtdHlwZXMtZXhhY3RcIlxuaW1wb3J0IHtzaGFwZUNvbXBvbmVudH0gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL3NoYXBlLWNvbXBvbmVudC5qc1wiXG5pbXBvcnQgdXNlQ2FuQ2FuIGZyb20gXCIuLi91c2UtY2FuLWNhbi5qc1wiXG5cbmV4cG9ydCBkZWZhdWx0IG1lbW8oc2hhcGVDb21wb25lbnQoY2xhc3MgU3VwZXJBZG1pblNob3dSZWZsZWN0aW9uQWN0aW9ucyBleHRlbmRzIEJhc2VDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0gcHJvcFR5cGVzRXhhY3Qoe1xuICAgIG1vZGVsOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIG1vZGVsQ2xhc3M6IFByb3BUeXBlcy5mdW5jLFxuICAgIHJlZmxlY3Rpb25OYW1lOiBQcm9wVHlwZXMuc3RyaW5nXG4gIH0pXG5cbiAgc2V0dXAoKSB7XG4gICAgY29uc3Qge21vZGVsQ2xhc3MsIHJlZmxlY3Rpb25OYW1lfSA9IHRoaXMucFxuXG4gICAgdGhpcy5yZWZsZWN0aW9uID0gdXNlTWVtbygoKSA9PiBtb2RlbENsYXNzLnJlZmxlY3Rpb25zKCkuZmluZCgocmVmbGVjdGlvbikgPT4gcmVmbGVjdGlvbi5uYW1lKCkgPT0gcmVmbGVjdGlvbk5hbWUpLCBbbW9kZWxDbGFzcywgcmVmbGVjdGlvbk5hbWVdKVxuICAgIHRoaXMuY2FuQ2FuID0gdXNlQ2FuQ2FuKCgpID0+IFtbdGhpcy5yZWZsZWN0aW9uLm1vZGVsQ2xhc3MoKSwgW1wibmV3XCJdXV0pXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge2NhbkNhbiwgcmVmbGVjdGlvbn0gPSB0aGlzLnR0XG4gICAgY29uc3Qge21vZGVsfSA9IHRoaXMucFxuICAgIGNvbnN0IG1vZGVsQ2xhc3NOYW1lID0gZGlnZyhyZWZsZWN0aW9uLCBcInJlZmxlY3Rpb25EYXRhXCIsIFwiY2xhc3NOYW1lXCIpXG4gICAgY29uc3QgbW9kZWxEYXRhID0ge31cbiAgICBjb25zdCBkYXRhUGFyYW1OYW1lID0gaW5mbGVjdGlvbi5zaW5ndWxhcml6ZShyZWZsZWN0aW9uLnJlZmxlY3Rpb25EYXRhLmNvbGxlY3Rpb25OYW1lKVxuXG4gICAgbW9kZWxEYXRhW3JlZmxlY3Rpb24uZm9yZWlnbktleSgpXSA9IG1vZGVsPy5pZCgpXG5cbiAgICBjb25zdCBsaW5rUGFyYW1zID0ge1xuICAgICAgbW9kZWw6IG1vZGVsQ2xhc3NOYW1lLFxuICAgICAgbW9kZTogXCJuZXdcIlxuICAgIH1cblxuICAgIGxpbmtQYXJhbXNbZGF0YVBhcmFtTmFtZV0gPSBtb2RlbERhdGFcblxuICAgIGNvbnN0IGRhdGFTZXQgPSB1c2VNZW1vKCgpID0+ICh7Y2xhc3M6IFwiY3JlYXRlLW5ldy1tb2RlbC1saW5rXCJ9KSwgW10pXG5cbiAgICByZXR1cm4gKFxuICAgICAgPD5cbiAgICAgICAge2NhbkNhbj8uY2FuKFwibmV3XCIsIHJlZmxlY3Rpb24ubW9kZWxDbGFzcygpKSAmJlxuICAgICAgICAgIDxMaW5rIGRhdGFTZXQ9e2RhdGFTZXR9IHRvPXtQYXJhbXMud2l0aFBhcmFtcyhsaW5rUGFyYW1zKX0+XG4gICAgICAgICAgICBDcmVhdGUgbmV3XG4gICAgICAgICAgPC9MaW5rPlxuICAgICAgICB9XG4gICAgICA8Lz5cbiAgICApXG4gIH1cbn0pKVxuIl19