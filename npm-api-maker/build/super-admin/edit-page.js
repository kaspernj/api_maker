import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { Pressable, View } from "react-native";
import BaseComponent from "../base-component";
import ConfigReader from "./config-reader";
import { digg } from "diggerize";
import EditAttribute from "./edit-page/edit-attribute";
import { FlashNotifications } from "flash-notifications";
import { Form } from "../form";
import * as inflection from "inflection";
// @ts-expect-error
import Locales from "shared/locales.js";
import memo from "set-state-compare/build/memo.js";
import Params from "../params.js";
import PropTypes from "prop-types";
import propTypesExact from "prop-types-exact";
import React from "react";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import Text from "../utils/text";
import useCurrentUser from "../use-current-user.js";
import useModel from "../use-model.js";
import useQueryParams from "on-location-changed/build/use-query-params.js";
export default memo(shapeComponent(class ApiMakerSuperAdminEditPage extends BaseComponent {
    static propTypes = propTypesExact({
        modelClass: PropTypes.func.isRequired
    });
    setup() {
        const { modelClass } = this.p;
        const modelClassName = modelClass.modelClassData().name;
        const availableLocales = Locales.availableLocales();
        this.configReader = ConfigReader.forModel(modelClass);
        const currentUser = useCurrentUser();
        const queryParams = useQueryParams();
        const selectedModelAttributes = ["id"];
        const selectedAttributes = {};
        this.attributes = this.configReader.modelConfig?.edit?.attributes;
        if (!this.attributes) {
            throw new Error(`No 'attributes' given from edit config for ${modelClass.modelClassData().name}`);
        }
        for (const attribute of this.attributes) {
            if (attribute.translated) {
                for (const locale of availableLocales) {
                    selectedModelAttributes.push(`${attribute.attribute}${inflection.camelize(locale)}`);
                }
            }
            else {
                selectedModelAttributes.push(attribute.attribute);
            }
        }
        selectedAttributes[modelClassName] = selectedModelAttributes;
        const useModelResult = useModel(modelClass, {
            cacheArgs: [currentUser?.id()],
            loadByQueryParam: (props) => props.queryParams.model_id,
            newIfNoId: this.configReader.modelConfig?.edit?.newIfNoId || true,
            preload: this.configReader.modelConfig?.edit?.preload,
            select: selectedAttributes
        });
        const modelIdVarName = `${inflection.camelize(modelClass.modelClassData().name, true)}Id`;
        const modelVarName = inflection.camelize(modelClass.modelClassData().name, true);
        this.model = digg(useModelResult, modelVarName);
        this.modelId = queryParams.model_id;
        this.modelArgs = {};
        this.modelArgs[modelIdVarName] = this.modelId;
        this.useStates({ form: null });
    }
    render() {
        const { attributes, model } = this.tt;
        const { modelClass } = this.p;
        const extraContent = this.configReader.modelConfig?.edit?.extraContentconst;
        return (_jsx(View, { testID: "super-admin--edit-page", children: _jsxs(Form, { setForm: this.setStates.form, children: [model && attributes?.map((attribute) => _jsx(EditAttribute, { attribute: attribute, model: model, modelClass: modelClass }, attribute.attribute)), extraContent && extraContent(modelArgs), _jsx(Pressable, { onPress: this.tt.onSubmit, style: this.cache("pressableStyle", {
                            paddingTop: 18,
                            paddingRight: 24,
                            paddingBottom: 18,
                            paddingLeft: 24,
                            borderRadius: 10,
                            backgroundColor: "#4c93ff",
                            marginTop: 10
                        }), testID: "submit-button", children: _jsx(Text, { style: this.cache("buttonTextStyle", { color: "#fff" }), children: "Submit" }) })] }) }));
    }
    onSubmit = async () => {
        try {
            const { model } = this.tt;
            const formObject = this.s.form.asObject();
            model.assignAttributes(formObject);
            await model.save();
            Params.changeParams({ mode: undefined, model_id: model.id() });
        }
        catch (error) {
            FlashNotifications.errorResponse(error);
        }
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWRpdC1wYWdlLmpzIiwic291cmNlUm9vdCI6Ii9zcmMvIiwic291cmNlcyI6WyJzdXBlci1hZG1pbi9lZGl0LXBhZ2UuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFFLElBQUksRUFBQyxNQUFNLGNBQWMsQ0FBQTtBQUM1QyxPQUFPLGFBQWEsTUFBTSxtQkFBbUIsQ0FBQTtBQUM3QyxPQUFPLFlBQVksTUFBTSxpQkFBaUIsQ0FBQTtBQUMxQyxPQUFPLEVBQUMsSUFBSSxFQUFDLE1BQU0sV0FBVyxDQUFBO0FBQzlCLE9BQU8sYUFBYSxNQUFNLDRCQUE0QixDQUFBO0FBQ3RELE9BQU8sRUFBQyxrQkFBa0IsRUFBQyxNQUFNLHFCQUFxQixDQUFBO0FBQ3RELE9BQU8sRUFBQyxJQUFJLEVBQUMsTUFBTSxTQUFTLENBQUE7QUFDNUIsT0FBTyxLQUFLLFVBQVUsTUFBTSxZQUFZLENBQUE7QUFDeEMsbUJBQW1CO0FBQ25CLE9BQU8sT0FBTyxNQUFNLG1CQUFtQixDQUFBO0FBQ3ZDLE9BQU8sSUFBSSxNQUFNLGlDQUFpQyxDQUFBO0FBQ2xELE9BQU8sTUFBTSxNQUFNLGNBQWMsQ0FBQTtBQUNqQyxPQUFPLFNBQVMsTUFBTSxZQUFZLENBQUE7QUFDbEMsT0FBTyxjQUFjLE1BQU0sa0JBQWtCLENBQUE7QUFDN0MsT0FBTyxLQUFLLE1BQU0sT0FBTyxDQUFBO0FBQ3pCLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSw0Q0FBNEMsQ0FBQTtBQUN6RSxPQUFPLElBQUksTUFBTSxlQUFlLENBQUE7QUFDaEMsT0FBTyxjQUFjLE1BQU0sd0JBQXdCLENBQUE7QUFDbkQsT0FBTyxRQUFRLE1BQU0saUJBQWlCLENBQUE7QUFDdEMsT0FBTyxjQUFjLE1BQU0sK0NBQStDLENBQUE7QUFFMUUsZUFBZSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sMEJBQTJCLFNBQVEsYUFBYTtJQUN2RixNQUFNLENBQUMsU0FBUyxHQUFHLGNBQWMsQ0FBQztR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LElBQ1AsR0FDRixDQUNSLENBQUE7SUFDSCxDQUFDO0lBRUQsUUFBUSxHQUFHLEtBQUssSUFBSSxFQUFFO1FBQ3BCLElBQUksQ0FBQztZQUNILE1BQU0sRUFBQyxLQUFLLEVBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFBO1lBQ3ZCLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFBO1lBRXpDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQTtZQUNsQyxNQUFNLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQTtZQUNsQixNQUFNLENBQUMsWUFBWSxDQUFDLEVBQUMsSUFBSSxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRSxFQUFDLENBQUMsQ0FBQTtRQUM5RCxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLGtCQUFrQixDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUN6QyxDQUFDO0lBQ0gsQ0FBQyxDQUFBO0NBQ0YsQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1ByZXNzYWJsZSwgVmlld30gZnJvbSBcInJlYWN0LW5hdGl2ZVwiXG5pbXBvcnQgQmFzZUNvbXBvbmVudCBmcm9tIFwiLi4vYmFzZS1jb21wb25lbnRcIlxuaW1wb3J0IENvbmZpZ1JlYWRlciBmcm9tIFwiLi9jb25maWctcmVhZGVyXCJcbmltcG9ydCB7ZGlnZ30gZnJvbSBcImRpZ2dlcml6ZVwiXG5pbXBvcnQgRWRpdEF0dHJpYnV0ZSBmcm9tIFwiLi9lZGl0LXBhZ2UvZWRpdC1hdHRyaWJ1dGVcIlxuaW1wb3J0IHtGbGFzaE5vdGlmaWNhdGlvbnN9IGZyb20gXCJmbGFzaC1ub3RpZmljYXRpb25zXCJcbmltcG9ydCB7Rm9ybX0gZnJvbSBcIi4uL2Zvcm1cIlxuaW1wb3J0ICogYXMgaW5mbGVjdGlvbiBmcm9tIFwiaW5mbGVjdGlvblwiXG4vLyBAdHMtZXhwZWN0LWVycm9yXG5pbXBvcnQgTG9jYWxlcyBmcm9tIFwic2hhcmVkL2xvY2FsZXMuanNcIlxuaW1wb3J0IG1lbW8gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL21lbW8uanNcIlxuaW1wb3J0IFBhcmFtcyBmcm9tIFwiLi4vcGFyYW1zLmpzXCJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIlxuaW1wb3J0IHByb3BUeXBlc0V4YWN0IGZyb20gXCJwcm9wLXR5cGVzLWV4YWN0XCJcbmltcG9ydCBSZWFjdCBmcm9tIFwicmVhY3RcIlxuaW1wb3J0IHtzaGFwZUNvbXBvbmVudH0gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL3NoYXBlLWNvbXBvbmVudC5qc1wiXG5pbXBvcnQgVGV4dCBmcm9tIFwiLi4vdXRpbHMvdGV4dFwiXG5pbXBvcnQgdXNlQ3VycmVudFVzZXIgZnJvbSBcIi4uL3VzZS1jdXJyZW50LXVzZXIuanNcIlxuaW1wb3J0IHVzZU1vZGVsIGZyb20gXCIuLi91c2UtbW9kZWwuanNcIlxuaW1wb3J0IHVzZVF1ZXJ5UGFyYW1zIGZyb20gXCJvbi1sb2NhdGlvbi1jaGFuZ2VkL2J1aWxkL3VzZS1xdWVyeS1wYXJhbXMuanNcIlxuXG5leHBvcnQgZGVmYXVsdCBtZW1vKHNoYXBlQ29tcG9uZW50KGNsYXNzIEFwaU1ha2VyU3VwZXJBZG1pbkVkaXRQYWdlIGV4dGVuZHMgQmFzZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSBwcm9wVHlwZXNFeGFjdCh7XG4gICAgbW9kZWxDbGFzczogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZFxuICB9KVxuXG4gIHNldHVwKCkge1xuICAgIGNvbnN0IHttb2RlbENsYXNzfSA9IHRoaXMucFxuICAgIGNvbnN0IG1vZGVsQ2xhc3NOYW1lID0gbW9kZWxDbGFzcy5tb2RlbENsYXNzRGF0YSgpLm5hbWVcbiAgICBjb25zdCBhdmFpbGFibGVMb2NhbGVzID0gTG9jYWxlcy5hdmFpbGFibGVMb2NhbGVzKClcbiAgICB0aGlzLmNvbmZpZ1JlYWRlciA9IENvbmZpZ1JlYWRlci5mb3JNb2RlbChtb2RlbENsYXNzKVxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gdXNlQ3VycmVudFVzZXIoKVxuICAgIGNvbnN0IHF1ZXJ5UGFyYW1zID0gdXNlUXVlcnlQYXJhbXMoKVxuICAgIGNvbnN0IHNlbGVjdGVkTW9kZWxBdHRyaWJ1dGVzID0gW1wiaWRcIl1cbiAgICBjb25zdCBzZWxlY3RlZEF0dHJpYnV0ZXMgPSB7fVxuICAgIHRoaXMuYXR0cmlidXRlcyA9IHRoaXMuY29uZmlnUmVhZGVyLm1vZGVsQ29uZmlnPy5lZGl0Py5hdHRyaWJ1dGVzXG5cbiAgICBpZiAoIXRoaXMuYXR0cmlidXRlcykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyAnYXR0cmlidXRlcycgZ2l2ZW4gZnJvbSBlZGl0IGNvbmZpZyBmb3IgJHttb2RlbENsYXNzLm1vZGVsQ2xhc3NEYXRhKCkubmFtZX1gKVxuICAgIH1cblxuICAgIGZvciAoY29uc3QgYXR0cmlidXRlIG9mIHRoaXMuYXR0cmlidXRlcykge1xuICAgICAgaWYgKGF0dHJpYnV0ZS50cmFuc2xhdGVkKSB7XG4gICAgICAgIGZvciAoY29uc3QgbG9jYWxlIG9mIGF2YWlsYWJsZUxvY2FsZXMpIHtcbiAgICAgICAgICBzZWxlY3RlZE1vZGVsQXR0cmlidXRlcy5wdXNoKGAke2F0dHJpYnV0ZS5hdHRyaWJ1dGV9JHtpbmZsZWN0aW9uLmNhbWVsaXplKGxvY2FsZSl9YClcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2VsZWN0ZWRNb2RlbEF0dHJpYnV0ZXMucHVzaChhdHRyaWJ1dGUuYXR0cmlidXRlKVxuICAgICAgfVxuICAgIH1cblxuICAgIHNlbGVjdGVkQXR0cmlidXRlc1ttb2RlbENsYXNzTmFtZV0gPSBzZWxlY3RlZE1vZGVsQXR0cmlidXRlc1xuXG4gICAgY29uc3QgdXNlTW9kZWxSZXN1bHQgPSB1c2VNb2RlbChtb2RlbENsYXNzLCB7XG4gICAgICBjYWNoZUFyZ3M6IFtjdXJyZW50VXNlcj8uaWQoKV0sXG4gICAgICBsb2FkQnlRdWVyeVBhcmFtOiAocHJvcHMpID0+IHByb3BzLnF1ZXJ5UGFyYW1zLm1vZGVsX2lkLFxuICAgICAgbmV3SWZOb0lkOiB0aGlzLmNvbmZpZ1JlYWRlci5tb2RlbENvbmZpZz8uZWRpdD8ubmV3SWZOb0lkIHx8IHRydWUsXG4gICAgICBwcmVsb2FkOiB0aGlzLmNvbmZpZ1JlYWRlci5tb2RlbENvbmZpZz8uZWRpdD8ucHJlbG9hZCxcbiAgICAgIHNlbGVjdDogc2VsZWN0ZWRBdHRyaWJ1dGVzXG4gICAgfSlcblxuICAgIGNvbnN0IG1vZGVsSWRWYXJOYW1lID0gYCR7aW5mbGVjdGlvbi5jYW1lbGl6ZShtb2RlbENsYXNzLm1vZGVsQ2xhc3NEYXRhKCkubmFtZSwgdHJ1ZSl9SWRgXG4gICAgY29uc3QgbW9kZWxWYXJOYW1lID0gaW5mbGVjdGlvbi5jYW1lbGl6ZShtb2RlbENsYXNzLm1vZGVsQ2xhc3NEYXRhKCkubmFtZSwgdHJ1ZSlcblxuICAgIHRoaXMubW9kZWwgPSBkaWdnKHVzZU1vZGVsUmVzdWx0LCBtb2RlbFZhck5hbWUpXG4gICAgdGhpcy5tb2RlbElkID0gcXVlcnlQYXJhbXMubW9kZWxfaWRcbiAgICB0aGlzLm1vZGVsQXJncyA9IHt9XG4gICAgdGhpcy5tb2RlbEFyZ3NbbW9kZWxJZFZhck5hbWVdID0gdGhpcy5tb2RlbElkXG4gICAgdGhpcy51c2VTdGF0ZXMoe2Zvcm06IG51bGx9KVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHthdHRyaWJ1dGVzLCBtb2RlbH0gPSB0aGlzLnR0XG4gICAgY29uc3Qge21vZGVsQ2xhc3N9ID0gdGhpcy5wXG4gICAgY29uc3QgZXh0cmFDb250ZW50ID0gdGhpcy5jb25maWdSZWFkZXIubW9kZWxDb25maWc/LmVkaXQ/LmV4dHJhQ29udGVudGNvbnN0XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFZpZXcgdGVzdElEPVwic3VwZXItYWRtaW4tLWVkaXQtcGFnZVwiPlxuICAgICAgICA8Rm9ybSBzZXRGb3JtPXt0aGlzLnNldFN0YXRlcy5mb3JtfT5cbiAgICAgICAgICB7bW9kZWwgJiYgYXR0cmlidXRlcz8ubWFwKChhdHRyaWJ1dGUpID0+XG4gICAgICAgICAgICA8RWRpdEF0dHJpYnV0ZSBhdHRyaWJ1dGU9e2F0dHJpYnV0ZX0ga2V5PXthdHRyaWJ1dGUuYXR0cmlidXRlfSBtb2RlbD17bW9kZWx9IG1vZGVsQ2xhc3M9e21vZGVsQ2xhc3N9IC8+XG4gICAgICAgICAgKX1cbiAgICAgICAgICB7ZXh0cmFDb250ZW50ICYmIGV4dHJhQ29udGVudChtb2RlbEFyZ3MpfVxuICAgICAgICAgIDxQcmVzc2FibGVcbiAgICAgICAgICAgIG9uUHJlc3M9e3RoaXMudHQub25TdWJtaXR9XG4gICAgICAgICAgICBzdHlsZT17dGhpcy5jYWNoZShcInByZXNzYWJsZVN0eWxlXCIsIHtcbiAgICAgICAgICAgICAgcGFkZGluZ1RvcDogMTgsXG4gICAgICAgICAgICAgIHBhZGRpbmdSaWdodDogMjQsXG4gICAgICAgICAgICAgIHBhZGRpbmdCb3R0b206IDE4LFxuICAgICAgICAgICAgICBwYWRkaW5nTGVmdDogMjQsXG4gICAgICAgICAgICAgIGJvcmRlclJhZGl1czogMTAsXG4gICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogXCIjNGM5M2ZmXCIsXG4gICAgICAgICAgICAgIG1hcmdpblRvcDogMTBcbiAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgdGVzdElEPVwic3VibWl0LWJ1dHRvblwiXG4gICAgICAgICAgPlxuICAgICAgICAgICAgPFRleHQgc3R5bGU9e3RoaXMuY2FjaGUoXCJidXR0b25UZXh0U3R5bGVcIiwge2NvbG9yOiBcIiNmZmZcIn0pfT5cbiAgICAgICAgICAgICAgU3VibWl0XG4gICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgPC9QcmVzc2FibGU+XG4gICAgICAgIDwvRm9ybT5cbiAgICAgIDwvVmlldz5cbiAgICApXG4gIH1cblxuICBvblN1Ym1pdCA9IGFzeW5jICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qge21vZGVsfSA9IHRoaXMudHRcbiAgICAgIGNvbnN0IGZvcm1PYmplY3QgPSB0aGlzLnMuZm9ybS5hc09iamVjdCgpXG5cbiAgICAgIG1vZGVsLmFzc2lnbkF0dHJpYnV0ZXMoZm9ybU9iamVjdClcbiAgICAgIGF3YWl0IG1vZGVsLnNhdmUoKVxuICAgICAgUGFyYW1zLmNoYW5nZVBhcmFtcyh7bW9kZTogdW5kZWZpbmVkLCBtb2RlbF9pZDogbW9kZWwuaWQoKX0pXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIEZsYXNoTm90aWZpY2F0aW9ucy5lcnJvclJlc3BvbnNlKGVycm9yKVxuICAgIH1cbiAgfVxufSkpXG4iXX0=