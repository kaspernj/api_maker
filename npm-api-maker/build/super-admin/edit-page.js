import { Pressable, View } from "react-native";
import BaseComponent from "../base-component.js";
import ConfigReader from "./config-reader.js";
import { digg } from "diggerize";
import EditAttribute from "./edit-page/edit-attribute.js";
import { FlashNotifications } from "flash-notifications";
import { Form } from "../form.js";
import * as inflection from "inflection";
// @ts-expect-error
import Locales from "shared/locales.js";
import memo from "set-state-compare/build/memo.js";
import Params from "../params.js";
import PropTypes from "prop-types";
import propTypesExact from "prop-types-exact";
import React from "react";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import Text from "../utils/text.js";
import useCurrentUser from "../use-current-user.js";
import useModel from "../use-model.js";
import useQueryParams from "on-location-changed/build/use-query-params.js";
export default memo(shapeComponent(class ApiMakerSuperAdminEditPage extends BaseComponent {
    static propTypes = propTypesExact({
        modelClass: PropTypes.func.isRequired
    });
    setup() {
        const { modelClass } = this.p;
        const modelClassName = modelClass.modelClassData().name;
        const availableLocales = Locales.availableLocales();
        this.configReader = ConfigReader.forModel(modelClass);
        const currentUser = useCurrentUser();
        const queryParams = useQueryParams();
        const selectedModelAttributes = ["id"];
        const selectedAttributes = {};
        this.attributes = this.configReader.modelConfig?.edit?.attributes;
        if (!this.attributes) {
            throw new Error(`No 'attributes' given from edit config for ${modelClass.modelClassData().name}`);
        }
        for (const attribute of this.attributes) {
            if (attribute.translated) {
                for (const locale of availableLocales) {
                    selectedModelAttributes.push(`${attribute.attribute}${inflection.camelize(locale)}`);
                }
            }
            else {
                selectedModelAttributes.push(attribute.attribute);
            }
        }
        selectedAttributes[modelClassName] = selectedModelAttributes;
        const useModelResult = useModel(modelClass, {
            cacheArgs: [currentUser?.id()],
            loadByQueryParam: (props) => props.queryParams.model_id,
            newIfNoId: this.configReader.modelConfig?.edit?.newIfNoId || true,
            preload: this.configReader.modelConfig?.edit?.preload,
            select: selectedAttributes
        });
        const modelIdVarName = `${inflection.camelize(modelClass.modelClassData().name, true)}Id`;
        const modelVarName = inflection.camelize(modelClass.modelClassData().name, true);
        this.model = digg(useModelResult, modelVarName);
        this.modelId = queryParams.model_id;
        this.modelArgs = {};
        this.modelArgs[modelIdVarName] = this.modelId;
        this.useStates({ form: null });
    }
    render() {
        const { attributes, model } = this.tt;
        const { modelClass } = this.p;
        const extraContent = this.configReader.modelConfig?.edit?.extraContentconst;
        return (<View testID="super-admin--edit-page">
        <Form setForm={this.setStates.form}>
          {model && attributes?.map((attribute) => <EditAttribute attribute={attribute} key={attribute.attribute} model={model} modelClass={modelClass}/>)}
          {extraContent && extraContent(modelArgs)}
          <Pressable onPress={this.tt.onSubmit} style={this.cache("pressableStyle", {
                paddingTop: 18,
                paddingRight: 24,
                paddingBottom: 18,
                paddingLeft: 24,
                borderRadius: 10,
                backgroundColor: "#4c93ff",
                marginTop: 10
            })} testID="submit-button">
            <Text style={this.cache("buttonTextStyle", { color: "#fff" })}>
              Submit
            </Text>
          </Pressable>
        </Form>
      </View>);
    }
    onSubmit = async () => {
        try {
            const { model } = this.tt;
            const formObject = this.s.form.asObject();
            model.assignAttributes(formObject);
            await model.save();
            Params.changeParams({ mode: undefined, model_id: model.id() });
        }
        catch (error) {
            FlashNotifications.errorResponse(error);
        }
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWRpdC1wYWdlLmpzIiwic291cmNlUm9vdCI6Ii9zcmMvIiwic291cmNlcyI6WyJzdXBlci1hZG1pbi9lZGl0LXBhZ2UuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQUUsSUFBSSxFQUFDLE1BQU0sY0FBYyxDQUFBO0FBQzVDLE9BQU8sYUFBYSxNQUFNLHNCQUFzQixDQUFBO0FBQ2hELE9BQU8sWUFBWSxNQUFNLG9CQUFvQixDQUFBO0FBQzdDLE9BQU8sRUFBQyxJQUFJLEVBQUMsTUFBTSxXQUFXLENBQUE7QUFDOUIsT0FBTyxhQUFhLE1BQU0sK0JBQStCLENBQUE7QUFDekQsT0FBTyxFQUFDLGtCQUFrQixFQUFDLE1BQU0scUJBQXFCLENBQUE7QUFDdEQsT0FBTyxFQUFDLElBQUksRUFBQyxNQUFNLFlBQVksQ0FBQTtBQUMvQixPQUFPLEtBQUssVUFBVSxNQUFNLFlBQVksQ0FBQTtBQUN4QyxtQkFBbUI7QUFDbkIsT0FBTyxPQUFPLE1BQU0sbUJBQW1CLENBQUE7QUFDdkMsT0FBTyxJQUFJLE1BQU0saUNBQWlDLENBQUE7QUFDbEQsT0FBTyxNQUFNLE1BQU0sY0FBYyxDQUFBO0FBQ2pDLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQTtBQUNsQyxPQUFPLGNBQWMsTUFBTSxrQkFBa0IsQ0FBQTtBQUM3QyxPQUFPLEtBQUssTUFBTSxPQUFPLENBQUE7QUFDekIsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLDRDQUE0QyxDQUFBO0FBQ3pFLE9BQU8sSUFBSSxNQUFNLGtCQUFrQixDQUFBO0FBQ25DLE9BQU8sY0FBYyxNQUFNLHdCQUF3QixDQUFBO0FBQ25ELE9BQU8sUUFBUSxNQUFNLGlCQUFpQixDQUFBO0FBQ3RDLE9BQU8sY0FBYyxNQUFNLCtDQUErQyxDQUFBO0FBRTFFLGVBQWUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLDBCQUEyQixTQUFRLGFBQWE7SUFDdkYsTUFBTSxDQUFDLFNBQVMsR0FBRyxjQUFjLENBQUM7UUFDaEMsVUFBVSxFQUFFLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVTtLQUN0QyxDQUFDLENBQUE7SUFFRixLQUFLO1FBQ0gsTUFBTSxFQUFDLFVBQVUsRUFBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUE7UUFDM0IsTUFBTSxjQUFjLEdBQUcsVUFBVSxDQUFDLGNBQWMsRUFBRSxDQUFDLElBQUksQ0FBQTtRQUN2RCxNQUFNLGdCQUFnQixHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFBO1FBQ25ELElBQUksQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQTtRQUNyRCxNQUFNLFdBQVcsR0FBRyxjQUFjLEVBQUUsQ0FBQTtRQUNwQyxNQUFNLFdBQVcsR0FBRyxjQUFjLEVBQUUsQ0FBQTtRQUNwQyxNQUFNLHVCQUF1QixHQUFHLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDdEMsTUFBTSxrQkFBa0IsR0FBRyxFQUFFLENBQUE7UUFDN0IsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFdBQVcsRUFBRSxJQUFJLEVBQUUsVUFBVSxDQUFBO1FBRWpFLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDckIsTUFBTSxJQUFJLEtBQUssQ0FBQyw4Q0FBOEMsVUFBVSxDQUFDLGNBQWMsRUFBRSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUE7UUFDbkcsQ0FBQztRQUVELEtBQUssTUFBTSxTQUFTLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQ3hDLElBQUksU0FBUyxDQUFDLFVBQVUsRUFBRSxDQUFDO2dCQUN6QixLQUFLLE1BQU0sTUFBTSxJQUFJLGdCQUFnQixFQUFFLENBQUM7b0JBQ3RDLHVCQUF1QixDQUFDLElBQUksQ0FBQyxHQUFHLFNBQVMsQ0FBQyxTQUFTLEdBQUcsVUFBVSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUE7Z0JBQ3RGLENBQUM7WUFDSCxDQUFDO2lCQUFNLENBQUM7Z0JBQ04sdUJBQXVCLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQTtZQUNuRCxDQUFDO1FBQ0gsQ0FBQztRQUVELGtCQUFrQixDQUFDLGNBQWMsQ0FBQyxHQUFHLHVCQUF1QixDQUFBO1FBRTVELE1BQU0sY0FBYyxHQUFHLFFBQVEsQ0FBQyxVQUFVLEVBQUU7WUFDMUMsU0FBUyxFQUFFLENBQUMsV0FBVyxFQUFFLEVBQUUsRUFBRSxDQUFDO1lBQzlCLGdCQUFnQixFQUFFLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLFFBQVE7WUFDdkQsU0FBUyxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxFQUFFLElBQUksRUFBRSxTQUFTLElBQUksSUFBSTtZQUNqRSxPQUFPLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsSUFBSSxFQUFFLE9BQU87WUFDckQsTUFBTSxFQUFFLGtCQUFrQjtTQUMzQixDQUFDLENBQUE7UUFFRixNQUFNLGNBQWMsR0FBRyxHQUFHLFVBQVUsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLGNBQWMsRUFBRSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFBO1FBQ3pGLE1BQU0sWUFBWSxHQUFHLFVBQVUsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLGNBQWMsRUFBRSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQTtRQUVoRixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxjQUFjLEVBQUUsWUFBWSxDQUFDLENBQUE7UUFDL0MsSUFBSSxDQUFDLE9BQU8sR0FBRyxXQUFXLENBQUMsUUFBUSxDQUFBO1FBQ25DLElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFBO1FBQ25CLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQTtRQUM3QyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUMsSUFBSSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUE7SUFDOUIsQ0FBQztJQUVELE1BQU07UUFDSixNQUFNLEVBQUMsVUFBVSxFQUFFLEtBQUssRUFBQyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUE7UUFDbkMsTUFBTSxFQUFDLFVBQVUsRUFBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUE7UUFDM0IsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsSUFBSSxFQUFFLGlCQUFpQixDQUFBO1FBRTNFLE9BQU8sQ0FDTCxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsd0JBQXdCLENBQ25DO1FBQUEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FDakM7VUFBQSxDQUFDLEtBQUssSUFBSSxVQUFVLEVBQUUsR0FBRyxDQUFDLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FDdEMsQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxFQUFHLENBQ3hHLENBQ0Q7VUFBQSxDQUFDLFlBQVksSUFBSSxZQUFZLENBQUMsU0FBUyxDQUFDLENBQ3hDO1VBQUEsQ0FBQyxTQUFTLENBQ1IsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FDMUIsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsRUFBRTtnQkFDbEMsVUFBVSxFQUFFLEVBQUU7Z0JBQ2QsWUFBWSxFQUFFLEVBQUU7Z0JBQ2hCLGFBQWEsRUFBRSxFQUFFO2dCQUNqQixXQUFXLEVBQUUsRUFBRTtnQkFDZixZQUFZLEVBQUUsRUFBRTtnQkFDaEIsZUFBZSxFQUFFLFNBQVM7Z0JBQzFCLFNBQVMsRUFBRSxFQUFFO2FBQ2QsQ0FBQyxDQUFDLENBQ0gsTUFBTSxDQUFDLGVBQWUsQ0FFdEI7WUFBQSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLEVBQUMsS0FBSyxFQUFFLE1BQU0sRUFBQyxDQUFDLENBQUMsQ0FDMUQ7O1lBQ0YsRUFBRSxJQUFJLENBQ1I7VUFBQSxFQUFFLFNBQVMsQ0FDYjtRQUFBLEVBQUUsSUFBSSxDQUNSO01BQUEsRUFBRSxJQUFJLENBQUMsQ0FDUixDQUFBO0lBQ0gsQ0FBQztJQUVELFFBQVEsR0FBRyxLQUFLLElBQUksRUFBRTtRQUNwQixJQUFJLENBQUM7WUFDSCxNQUFNLEVBQUMsS0FBSyxFQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQTtZQUN2QixNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtZQUV6QyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUE7WUFDbEMsTUFBTSxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUE7WUFDbEIsTUFBTSxDQUFDLFlBQVksQ0FBQyxFQUFDLElBQUksRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxFQUFFLEVBQUUsRUFBQyxDQUFDLENBQUE7UUFDOUQsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixrQkFBa0IsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDekMsQ0FBQztJQUNILENBQUMsQ0FBQTtDQUNGLENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtQcmVzc2FibGUsIFZpZXd9IGZyb20gXCJyZWFjdC1uYXRpdmVcIlxuaW1wb3J0IEJhc2VDb21wb25lbnQgZnJvbSBcIi4uL2Jhc2UtY29tcG9uZW50LmpzXCJcbmltcG9ydCBDb25maWdSZWFkZXIgZnJvbSBcIi4vY29uZmlnLXJlYWRlci5qc1wiXG5pbXBvcnQge2RpZ2d9IGZyb20gXCJkaWdnZXJpemVcIlxuaW1wb3J0IEVkaXRBdHRyaWJ1dGUgZnJvbSBcIi4vZWRpdC1wYWdlL2VkaXQtYXR0cmlidXRlLmpzXCJcbmltcG9ydCB7Rmxhc2hOb3RpZmljYXRpb25zfSBmcm9tIFwiZmxhc2gtbm90aWZpY2F0aW9uc1wiXG5pbXBvcnQge0Zvcm19IGZyb20gXCIuLi9mb3JtLmpzXCJcbmltcG9ydCAqIGFzIGluZmxlY3Rpb24gZnJvbSBcImluZmxlY3Rpb25cIlxuLy8gQHRzLWV4cGVjdC1lcnJvclxuaW1wb3J0IExvY2FsZXMgZnJvbSBcInNoYXJlZC9sb2NhbGVzLmpzXCJcbmltcG9ydCBtZW1vIGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9tZW1vLmpzXCJcbmltcG9ydCBQYXJhbXMgZnJvbSBcIi4uL3BhcmFtcy5qc1wiXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gXCJwcm9wLXR5cGVzXCJcbmltcG9ydCBwcm9wVHlwZXNFeGFjdCBmcm9tIFwicHJvcC10eXBlcy1leGFjdFwiXG5pbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCJcbmltcG9ydCB7c2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IFRleHQgZnJvbSBcIi4uL3V0aWxzL3RleHQuanNcIlxuaW1wb3J0IHVzZUN1cnJlbnRVc2VyIGZyb20gXCIuLi91c2UtY3VycmVudC11c2VyLmpzXCJcbmltcG9ydCB1c2VNb2RlbCBmcm9tIFwiLi4vdXNlLW1vZGVsLmpzXCJcbmltcG9ydCB1c2VRdWVyeVBhcmFtcyBmcm9tIFwib24tbG9jYXRpb24tY2hhbmdlZC9idWlsZC91c2UtcXVlcnktcGFyYW1zLmpzXCJcblxuZXhwb3J0IGRlZmF1bHQgbWVtbyhzaGFwZUNvbXBvbmVudChjbGFzcyBBcGlNYWtlclN1cGVyQWRtaW5FZGl0UGFnZSBleHRlbmRzIEJhc2VDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0gcHJvcFR5cGVzRXhhY3Qoe1xuICAgIG1vZGVsQ2xhc3M6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWRcbiAgfSlcblxuICBzZXR1cCgpIHtcbiAgICBjb25zdCB7bW9kZWxDbGFzc30gPSB0aGlzLnBcbiAgICBjb25zdCBtb2RlbENsYXNzTmFtZSA9IG1vZGVsQ2xhc3MubW9kZWxDbGFzc0RhdGEoKS5uYW1lXG4gICAgY29uc3QgYXZhaWxhYmxlTG9jYWxlcyA9IExvY2FsZXMuYXZhaWxhYmxlTG9jYWxlcygpXG4gICAgdGhpcy5jb25maWdSZWFkZXIgPSBDb25maWdSZWFkZXIuZm9yTW9kZWwobW9kZWxDbGFzcylcbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHVzZUN1cnJlbnRVc2VyKClcbiAgICBjb25zdCBxdWVyeVBhcmFtcyA9IHVzZVF1ZXJ5UGFyYW1zKClcbiAgICBjb25zdCBzZWxlY3RlZE1vZGVsQXR0cmlidXRlcyA9IFtcImlkXCJdXG4gICAgY29uc3Qgc2VsZWN0ZWRBdHRyaWJ1dGVzID0ge31cbiAgICB0aGlzLmF0dHJpYnV0ZXMgPSB0aGlzLmNvbmZpZ1JlYWRlci5tb2RlbENvbmZpZz8uZWRpdD8uYXR0cmlidXRlc1xuXG4gICAgaWYgKCF0aGlzLmF0dHJpYnV0ZXMpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gJ2F0dHJpYnV0ZXMnIGdpdmVuIGZyb20gZWRpdCBjb25maWcgZm9yICR7bW9kZWxDbGFzcy5tb2RlbENsYXNzRGF0YSgpLm5hbWV9YClcbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IGF0dHJpYnV0ZSBvZiB0aGlzLmF0dHJpYnV0ZXMpIHtcbiAgICAgIGlmIChhdHRyaWJ1dGUudHJhbnNsYXRlZCkge1xuICAgICAgICBmb3IgKGNvbnN0IGxvY2FsZSBvZiBhdmFpbGFibGVMb2NhbGVzKSB7XG4gICAgICAgICAgc2VsZWN0ZWRNb2RlbEF0dHJpYnV0ZXMucHVzaChgJHthdHRyaWJ1dGUuYXR0cmlidXRlfSR7aW5mbGVjdGlvbi5jYW1lbGl6ZShsb2NhbGUpfWApXG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNlbGVjdGVkTW9kZWxBdHRyaWJ1dGVzLnB1c2goYXR0cmlidXRlLmF0dHJpYnV0ZSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICBzZWxlY3RlZEF0dHJpYnV0ZXNbbW9kZWxDbGFzc05hbWVdID0gc2VsZWN0ZWRNb2RlbEF0dHJpYnV0ZXNcblxuICAgIGNvbnN0IHVzZU1vZGVsUmVzdWx0ID0gdXNlTW9kZWwobW9kZWxDbGFzcywge1xuICAgICAgY2FjaGVBcmdzOiBbY3VycmVudFVzZXI/LmlkKCldLFxuICAgICAgbG9hZEJ5UXVlcnlQYXJhbTogKHByb3BzKSA9PiBwcm9wcy5xdWVyeVBhcmFtcy5tb2RlbF9pZCxcbiAgICAgIG5ld0lmTm9JZDogdGhpcy5jb25maWdSZWFkZXIubW9kZWxDb25maWc/LmVkaXQ/Lm5ld0lmTm9JZCB8fCB0cnVlLFxuICAgICAgcHJlbG9hZDogdGhpcy5jb25maWdSZWFkZXIubW9kZWxDb25maWc/LmVkaXQ/LnByZWxvYWQsXG4gICAgICBzZWxlY3Q6IHNlbGVjdGVkQXR0cmlidXRlc1xuICAgIH0pXG5cbiAgICBjb25zdCBtb2RlbElkVmFyTmFtZSA9IGAke2luZmxlY3Rpb24uY2FtZWxpemUobW9kZWxDbGFzcy5tb2RlbENsYXNzRGF0YSgpLm5hbWUsIHRydWUpfUlkYFxuICAgIGNvbnN0IG1vZGVsVmFyTmFtZSA9IGluZmxlY3Rpb24uY2FtZWxpemUobW9kZWxDbGFzcy5tb2RlbENsYXNzRGF0YSgpLm5hbWUsIHRydWUpXG5cbiAgICB0aGlzLm1vZGVsID0gZGlnZyh1c2VNb2RlbFJlc3VsdCwgbW9kZWxWYXJOYW1lKVxuICAgIHRoaXMubW9kZWxJZCA9IHF1ZXJ5UGFyYW1zLm1vZGVsX2lkXG4gICAgdGhpcy5tb2RlbEFyZ3MgPSB7fVxuICAgIHRoaXMubW9kZWxBcmdzW21vZGVsSWRWYXJOYW1lXSA9IHRoaXMubW9kZWxJZFxuICAgIHRoaXMudXNlU3RhdGVzKHtmb3JtOiBudWxsfSlcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7YXR0cmlidXRlcywgbW9kZWx9ID0gdGhpcy50dFxuICAgIGNvbnN0IHttb2RlbENsYXNzfSA9IHRoaXMucFxuICAgIGNvbnN0IGV4dHJhQ29udGVudCA9IHRoaXMuY29uZmlnUmVhZGVyLm1vZGVsQ29uZmlnPy5lZGl0Py5leHRyYUNvbnRlbnRjb25zdFxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxWaWV3IHRlc3RJRD1cInN1cGVyLWFkbWluLS1lZGl0LXBhZ2VcIj5cbiAgICAgICAgPEZvcm0gc2V0Rm9ybT17dGhpcy5zZXRTdGF0ZXMuZm9ybX0+XG4gICAgICAgICAge21vZGVsICYmIGF0dHJpYnV0ZXM/Lm1hcCgoYXR0cmlidXRlKSA9PlxuICAgICAgICAgICAgPEVkaXRBdHRyaWJ1dGUgYXR0cmlidXRlPXthdHRyaWJ1dGV9IGtleT17YXR0cmlidXRlLmF0dHJpYnV0ZX0gbW9kZWw9e21vZGVsfSBtb2RlbENsYXNzPXttb2RlbENsYXNzfSAvPlxuICAgICAgICAgICl9XG4gICAgICAgICAge2V4dHJhQ29udGVudCAmJiBleHRyYUNvbnRlbnQobW9kZWxBcmdzKX1cbiAgICAgICAgICA8UHJlc3NhYmxlXG4gICAgICAgICAgICBvblByZXNzPXt0aGlzLnR0Lm9uU3VibWl0fVxuICAgICAgICAgICAgc3R5bGU9e3RoaXMuY2FjaGUoXCJwcmVzc2FibGVTdHlsZVwiLCB7XG4gICAgICAgICAgICAgIHBhZGRpbmdUb3A6IDE4LFxuICAgICAgICAgICAgICBwYWRkaW5nUmlnaHQ6IDI0LFxuICAgICAgICAgICAgICBwYWRkaW5nQm90dG9tOiAxOCxcbiAgICAgICAgICAgICAgcGFkZGluZ0xlZnQ6IDI0LFxuICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6IDEwLFxuICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IFwiIzRjOTNmZlwiLFxuICAgICAgICAgICAgICBtYXJnaW5Ub3A6IDEwXG4gICAgICAgICAgICB9KX1cbiAgICAgICAgICAgIHRlc3RJRD1cInN1Ym1pdC1idXR0b25cIlxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxUZXh0IHN0eWxlPXt0aGlzLmNhY2hlKFwiYnV0dG9uVGV4dFN0eWxlXCIsIHtjb2xvcjogXCIjZmZmXCJ9KX0+XG4gICAgICAgICAgICAgIFN1Ym1pdFxuICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgIDwvUHJlc3NhYmxlPlxuICAgICAgICA8L0Zvcm0+XG4gICAgICA8L1ZpZXc+XG4gICAgKVxuICB9XG5cbiAgb25TdWJtaXQgPSBhc3luYyAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHttb2RlbH0gPSB0aGlzLnR0XG4gICAgICBjb25zdCBmb3JtT2JqZWN0ID0gdGhpcy5zLmZvcm0uYXNPYmplY3QoKVxuXG4gICAgICBtb2RlbC5hc3NpZ25BdHRyaWJ1dGVzKGZvcm1PYmplY3QpXG4gICAgICBhd2FpdCBtb2RlbC5zYXZlKClcbiAgICAgIFBhcmFtcy5jaGFuZ2VQYXJhbXMoe21vZGU6IHVuZGVmaW5lZCwgbW9kZWxfaWQ6IG1vZGVsLmlkKCl9KVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBGbGFzaE5vdGlmaWNhdGlvbnMuZXJyb3JSZXNwb25zZShlcnJvcilcbiAgICB9XG4gIH1cbn0pKVxuIl19