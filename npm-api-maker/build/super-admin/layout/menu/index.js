import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { StyleSheet, View } from "react-native";
import BaseComponent from "../../../base-component";
import Devise from "../../../devise.js";
import { FlashNotifications } from "flash-notifications";
import Icon from "../../../utils/icon";
import memo from "set-state-compare/build/memo.js";
import Link from "../../../link";
import MenuContent from "./menu-content";
import MenuItem from "./menu-item";
import Params from "../../../params.js";
import PropTypes from "prop-types";
import PropTypesExact from "prop-types-exact";
import React, { useMemo } from "react";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import Text from "../../../utils/text";
import useBreakpoint from "../../../use-breakpoint.js";
import useCurrentUser from "../../../use-current-user.js";
import useI18n from "i18n-on-steroids/src/use-i18n.mjs";
import { WithDefaultStyle } from "../../../utils/default-style";
// Hook for consistent menu logo link styling (replaces SCSS)
export const useMenuLogoLinkStyle = () => useMemo(() => ({ color: "#dededf", textDecorationLine: "none" }), []);
const styles = StyleSheet.create({
    root: {
        base: {
            position: "fixed",
            zIndex: 9,
            overflowY: "auto",
            overflowX: "hidden",
            top: 0,
            left: 0,
            height: "100%",
            flexDirection: "column",
            backgroundColor: "#1b1c1e"
        },
        mdDown: {
            width: "100%",
            maxWidth: 250,
            maxHeight: "100vh",
            overflowY: "auto"
        },
        mdUp: {
            width: 250
        },
        lgUp: {
            width: 290
        }
    },
    userName: {
        flexShrink: 1,
        marginLeft: 8
    },
    userNameContainer: {
        overflow: "hidden",
        maxWidth: 140
    }
});
export default memo(shapeComponent(class ComponentsAdminLayoutMenu extends BaseComponent {
    static propTypes = PropTypesExact({
        active: PropTypes.string,
        noAccess: PropTypes.bool.isRequired,
        onRequestMenuClose: PropTypes.func.isRequired,
        triggered: PropTypes.bool.isRequired
    });
    setup() {
        const { lgUp, mdDown, mdUp } = useBreakpoint();
        const { t } = useI18n({ namespace: "js.api_maker.super_admin.layout.menu" });
        const currentUser = useCurrentUser();
        this.setInstance({ currentUser, lgUp, mdDown, mdUp, t });
    }
    render() {
        const { currentUser, lgUp, mdDown, mdUp, t } = this.tt;
        const menuLogoLinkStyle = useMenuLogoLinkStyle();
        const { active, noAccess, triggered } = this.props;
        const style = [styles.root.base];
        if (mdDown)
            style.push(styles.root.mdDown);
        if (mdUp)
            style.push(styles.root.mdUp);
        if (lgUp)
            style.push(styles.root.lgUp);
        if (mdDown && !triggered) {
            return null;
        }
        return (_jsx(View, { dataSet: this.cache("rootViewDataSet", { component: "super-admin--layout--menu", triggered }, [triggered]), style: style, children: _jsxs(WithDefaultStyle, { style: this.cache("withDefaultStyleStyle", { Text: { color: "#fff" } }), children: [_jsx(View, { dataSet: this.cache("menuLogoViewDataSet", { class: "menu-logo" }), style: this.cache("menuLogoViewStyle", {
                            overflow: "hidden",
                            marginTop: 25,
                            marginRight: "auto",
                            marginLeft: "auto"
                        }), children: _jsx(Link, { dataSet: this.cache("menuLogoLinkDataSet", { class: "menu-logo-link" }), to: Params.withParams({}), children: _jsx(Text, { style: [
                                    menuLogoLinkStyle,
                                    this.cache("menuLogoLinkTextStyle", {
                                        fontSize: 42,
                                        textOverflow: "ellipsis",
                                        whiteSpace: "nowrap"
                                    })
                                ], children: "Admin" }) }) }), _jsx(View, { dataSet: { class: "menu-items-center" }, style: { marginTop: 25 }, children: !noAccess &&
                            _jsx(MenuContent, { active: active }) }), _jsxs(View, { dataSet: { class: "menu-items-bottom" }, style: { marginTop: "auto", marginBottom: 25 }, children: [currentUser &&
                                _jsxs(View, { dataSet: { class: "menu-user-section" }, style: {
                                        flexDirection: "row",
                                        alignItems: "center",
                                        marginRight: 25,
                                        marginBottom: 25,
                                        marginLeft: 25
                                    }, children: [_jsx(View, { dataSet: { class: "menu-user-icon" }, style: {
                                                width: 44,
                                                height: 44,
                                                alignItems: "center",
                                                justifyContent: "center",
                                                backgroundColor: "#abbcd0",
                                                borderRadius: "50%"
                                            }, children: _jsx(Icon, { name: "user", size: 12 }) }), _jsx(View, { className: "menu-user-name", style: styles.userName, children: _jsx(Text, { dataSet: { class: "menu-user-name-container" }, style: styles.userNameContainer, children: currentUser.name() }) })] }), currentUser &&
                                _jsx(MenuItem, { active: true, className: "sign-out-menu-item", icon: "sign-out-alt", label: t(".sign_out", { defaultValue: "Sign out" }), onClick: this.tt.onSignOutClicked })] })] }) }));
    }
    onSignOutClicked = async (e) => {
        e.preventDefault();
        try {
            await Devise.signOut();
            FlashNotifications.success(this.t(".you_have_been_signed_out", { defaultValue: "You have been signed out" }));
        }
        catch (error) {
            FlashNotifications.errorResponse(error);
        }
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbInN1cGVyLWFkbWluL2xheW91dC9tZW51L2luZGV4LmpzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFDLFVBQVUsRUFBRSxJQUFJLEVBQUMsTUFBTSxjQUFjLENBQUE7QUFDN0MsT0FBTyxhQUFhLE1BQU0seUJBQXlCLENBQUE7QUFDbkQsT0FBTyxNQUFNLE1BQU0sb0JBQW9CLENBQUE7QUFDdkMsT0FBTyxFQUFDLGtCQUFrQixFQUFDLE1BQU0scUJBQXFCLENBQUE7QUFDdEQsT0FBTyxJQUFJLE1BQU0scUJBQXFCLENBQUE7QUFDdEMsT0FBTyxJQUFJLE1BQU0saUNBQWlDLENBQUE7QUFDbEQsT0FBTyxJQUFJLE1BQU0sZUFBZSxDQUFBO0FBQ2hDLE9BQU8sV0FBVyxNQUFNLGdCQUFnQixDQUFBO0FBQ3hDLE9BQU8sUUFBUSxNQUFNLGFBQWEsQ0FBQTtBQUNsQyxPQUFPLE1BQU0sTUFBTSxvQkFBb0IsQ0FBQTtBQUN2QyxPQUFPLFNBQVMsTUFBTSxZQUFZLENBQUE7QUFDbEMsT0FBTyxjQUFjLE1BQU0sa0JBQWtCLENBQUE7QUFDN0MsT0FBTyxLQUFLLEVBQUUsRUFBQyxPQUFPLEVBQUMsTUFBTSxPQUFPLENBQUE7QUFDcEMsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLDRDQUE0QyxDQUFBO0FBQ3pFLE9BQU8sSUFBSSxNQUFNLHFCQUFxQixDQUFBO0FBQ3RDLE9BQU8sYUFBYSxNQUFNLDRCQUE0QixDQUFBO0FBQ3RELE9BQU8sY0FBYyxNQUFNLDhCQUE4QixDQUFBO0FBQ3pELE9BQU8sT0FBTyxNQUFNLG1DQUFtQyxDQUFBO0FBQ3ZELE9BQU8sRUFBQyxnQkFBZ0IsRUFBQyxNQUFNLDhCQUE4QixDQUFBO0FBRTdELDZEQUE2RDtBQUM3RCxNQUFNLENBQUMsTUFBTSxvQkFBb0IsR0FBRyxHQUFHLEVBQUUsQ0FDdkMsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFD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QUFNLFFBQ04sU0FBUyxFQUFDLG9CQUFvQixFQUM5QixJQUFJLEVBQUMsY0FBYyxFQUNuQixLQUFLLEVBQUUsQ0FBQyxDQUFDLFdBQVcsRUFBRSxFQUFDLFlBQVksRUFBRSxVQUFVLEVBQUMsQ0FBQyxFQUNqRCxPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxnQkFBZ0IsR0FDakMsSUFFQyxJQUNVLEdBQ2QsQ0FDUixDQUFBO0lBQ0gsQ0FBQztJQUVELGdCQUFnQixHQUFHLEtBQUssRUFBRSxDQUFDLEVBQUUsRUFBRTtRQUM3QixDQUFDLENBQUMsY0FBYyxFQUFFLENBQUE7UUFFbEIsSUFBSSxDQUFDO1lBQ0gsTUFBTSxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUE7WUFDdEIsa0JBQWtCLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsMkJBQTJCLEVBQUUsRUFBQyxZQUFZLEVBQUUsMEJBQTBCLEVBQUMsQ0FBQyxDQUFDLENBQUE7UUFDN0csQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixrQkFBa0IsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDekMsQ0FBQztJQUNILENBQUMsQ0FBQTtDQUNGLENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtTdHlsZVNoZWV0LCBWaWV3fSBmcm9tIFwicmVhY3QtbmF0aXZlXCJcbmltcG9ydCBCYXNlQ29tcG9uZW50IGZyb20gXCIuLi8uLi8uLi9iYXNlLWNvbXBvbmVudFwiXG5pbXBvcnQgRGV2aXNlIGZyb20gXCIuLi8uLi8uLi9kZXZpc2UuanNcIlxuaW1wb3J0IHtGbGFzaE5vdGlmaWNhdGlvbnN9IGZyb20gXCJmbGFzaC1ub3RpZmljYXRpb25zXCJcbmltcG9ydCBJY29uIGZyb20gXCIuLi8uLi8uLi91dGlscy9pY29uXCJcbmltcG9ydCBtZW1vIGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9tZW1vLmpzXCJcbmltcG9ydCBMaW5rIGZyb20gXCIuLi8uLi8uLi9saW5rXCJcbmltcG9ydCBNZW51Q29udGVudCBmcm9tIFwiLi9tZW51LWNvbnRlbnRcIlxuaW1wb3J0IE1lbnVJdGVtIGZyb20gXCIuL21lbnUtaXRlbVwiXG5pbXBvcnQgUGFyYW1zIGZyb20gXCIuLi8uLi8uLi9wYXJhbXMuanNcIlxuaW1wb3J0IFByb3BUeXBlcyBmcm9tIFwicHJvcC10eXBlc1wiXG5pbXBvcnQgUHJvcFR5cGVzRXhhY3QgZnJvbSBcInByb3AtdHlwZXMtZXhhY3RcIlxuaW1wb3J0IFJlYWN0LCB7dXNlTWVtb30gZnJvbSBcInJlYWN0XCJcbmltcG9ydCB7c2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IFRleHQgZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3RleHRcIlxuaW1wb3J0IHVzZUJyZWFrcG9pbnQgZnJvbSBcIi4uLy4uLy4uL3VzZS1icmVha3BvaW50LmpzXCJcbmltcG9ydCB1c2VDdXJyZW50VXNlciBmcm9tIFwiLi4vLi4vLi4vdXNlLWN1cnJlbnQtdXNlci5qc1wiXG5pbXBvcnQgdXNlSTE4biBmcm9tIFwiaTE4bi1vbi1zdGVyb2lkcy9zcmMvdXNlLWkxOG4ubWpzXCJcbmltcG9ydCB7V2l0aERlZmF1bHRTdHlsZX0gZnJvbSBcIi4uLy4uLy4uL3V0aWxzL2RlZmF1bHQtc3R5bGVcIlxuXG4vLyBIb29rIGZvciBjb25zaXN0ZW50IG1lbnUgbG9nbyBsaW5rIHN0eWxpbmcgKHJlcGxhY2VzIFNDU1MpXG5leHBvcnQgY29uc3QgdXNlTWVudUxvZ29MaW5rU3R5bGUgPSAoKSA9PlxuICB1c2VNZW1vKCgpID0+ICh7Y29sb3I6IFwiI2RlZGVkZlwiLCB0ZXh0RGVjb3JhdGlvbkxpbmU6IFwibm9uZVwifSksIFtdKVxuXG5jb25zdCBzdHlsZXMgPSBTdHlsZVNoZWV0LmNyZWF0ZSh7XG4gIHJvb3Q6IHtcbiAgICBiYXNlOiB7XG4gICAgICBwb3NpdGlvbjogXCJmaXhlZFwiLFxuICAgICAgekluZGV4OiA5LFxuICAgICAgb3ZlcmZsb3dZOiBcImF1dG9cIixcbiAgICAgIG92ZXJmbG93WDogXCJoaWRkZW5cIixcbiAgICAgIHRvcDogMCxcbiAgICAgIGxlZnQ6IDAsXG4gICAgICBoZWlnaHQ6IFwiMTAwJVwiLFxuICAgICAgZmxleERpcmVjdGlvbjogXCJjb2x1bW5cIixcbiAgICAgIGJhY2tncm91bmRDb2xvcjogXCIjMWIxYzFlXCJcbiAgICB9LFxuICAgIG1kRG93bjoge1xuICAgICAgd2lkdGg6IFwiMTAwJVwiLFxuICAgICAgbWF4V2lkdGg6IDI1MCxcbiAgICAgIG1heEhlaWdodDogXCIxMDB2aFwiLFxuICAgICAgb3ZlcmZsb3dZOiBcImF1dG9cIlxuICAgIH0sXG4gICAgbWRVcDoge1xuICAgICAgd2lkdGg6IDI1MFxuICAgIH0sXG4gICAgbGdVcDoge1xuICAgICAgd2lkdGg6IDI5MFxuICAgIH1cbiAgfSxcbiAgdXNlck5hbWU6IHtcbiAgICBmbGV4U2hyaW5rOiAxLFxuICAgIG1hcmdpbkxlZnQ6IDhcbiAgfSxcbiAgdXNlck5hbWVDb250YWluZXI6IHtcbiAgICBvdmVyZmxvdzogXCJoaWRkZW5cIixcbiAgICBtYXhXaWR0aDogMTQwXG4gIH1cbn0pXG5cbmV4cG9ydCBkZWZhdWx0IG1lbW8oc2hhcGVDb21wb25lbnQoY2xhc3MgQ29tcG9uZW50c0FkbWluTGF5b3V0TWVudSBleHRlbmRzIEJhc2VDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0gUHJvcFR5cGVzRXhhY3Qoe1xuICAgIGFjdGl2ZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBub0FjY2VzczogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCxcbiAgICBvblJlcXVlc3RNZW51Q2xvc2U6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgdHJpZ2dlcmVkOiBQcm9wVHlwZXMuYm9vbC5pc1JlcXVpcmVkXG4gIH0pXG5cbiAgc2V0dXAoKSB7XG4gICAgY29uc3Qge2xnVXAsIG1kRG93biwgbWRVcH0gPSB1c2VCcmVha3BvaW50KClcbiAgICBjb25zdCB7dH0gPSB1c2VJMThuKHtuYW1lc3BhY2U6IFwianMuYXBpX21ha2VyLnN1cGVyX2FkbWluLmxheW91dC5tZW51XCJ9KVxuICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gdXNlQ3VycmVudFVzZXIoKVxuXG4gICAgdGhpcy5zZXRJbnN0YW5jZSh7Y3VycmVudFVzZXIsIGxnVXAsIG1kRG93biwgbWRVcCwgdH0pXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge2N1cnJlbnRVc2VyLCBsZ1VwLCBtZERvd24sIG1kVXAsIHR9ID0gdGhpcy50dFxuICAgIGNvbnN0IG1lbnVMb2dvTGlua1N0eWxlID0gdXNlTWVudUxvZ29MaW5rU3R5bGUoKVxuICAgIGNvbnN0IHthY3RpdmUsIG5vQWNjZXNzLCB0cmlnZ2VyZWR9ID0gdGhpcy5wcm9wc1xuXG4gICAgY29uc3Qgc3R5bGUgPSBbc3R5bGVzLnJvb3QuYmFzZV1cblxuICAgIGlmIChtZERvd24pIHN0eWxlLnB1c2goc3R5bGVzLnJvb3QubWREb3duKVxuICAgIGlmIChtZFVwKSBzdHlsZS5wdXNoKHN0eWxlcy5yb290Lm1kVXApXG4gICAgaWYgKGxnVXApIHN0eWxlLnB1c2goc3R5bGVzLnJvb3QubGdVcClcblxuICAgIGlmIChtZERvd24gJiYgIXRyaWdnZXJlZCkge1xuICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFZpZXcgZGF0YVNldD17dGhpcy5jYWNoZShcInJvb3RWaWV3RGF0YVNldFwiLCB7Y29tcG9uZW50OiBcInN1cGVyLWFkbWluLS1sYXlvdXQtLW1lbnVcIiwgdHJpZ2dlcmVkfSwgW3RyaWdnZXJlZF0pfSBzdHlsZT17c3R5bGV9PlxuICAgICAgICA8V2l0aERlZmF1bHRTdHlsZSBzdHlsZT17dGhpcy5jYWNoZShcIndpdGhEZWZhdWx0U3R5bGVTdHlsZVwiLCB7VGV4dDoge2NvbG9yOiBcIiNmZmZcIn19KX0+XG4gICAgICAgICAgPFZpZXdcbiAgICAgICAgICAgIGRhdGFTZXQ9e3RoaXMuY2FjaGUoXCJtZW51TG9nb1ZpZXdEYXRhU2V0XCIsIHtjbGFzczogXCJtZW51LWxvZ29cIn0pfVxuICAgICAgICAgICAgc3R5bGU9e3RoaXMuY2FjaGUoXCJtZW51TG9nb1ZpZXdTdHlsZVwiLCB7XG4gICAgICAgICAgICAgIG92ZXJmbG93OiBcImhpZGRlblwiLFxuICAgICAgICAgICAgICBtYXJnaW5Ub3A6IDI1LFxuICAgICAgICAgICAgICBtYXJnaW5SaWdodDogXCJhdXRvXCIsXG4gICAgICAgICAgICAgIG1hcmdpbkxlZnQ6IFwiYXV0b1wiXG4gICAgICAgICAgICB9KX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8TGluayBkYXRhU2V0PXt0aGlzLmNhY2hlKFwibWVudUxvZ29MaW5rRGF0YVNldFwiLCB7Y2xhc3M6IFwibWVudS1sb2dvLWxpbmtcIn0pfSB0bz17UGFyYW1zLndpdGhQYXJhbXMoe30pfT5cbiAgICAgICAgICAgICAgPFRleHRcbiAgICAgICAgICAgICAgICBzdHlsZT17W1xuICAgICAgICAgICAgICAgICAgbWVudUxvZ29MaW5rU3R5bGUsXG4gICAgICAgICAgICAgICAgICB0aGlzLmNhY2hlKFwibWVudUxvZ29MaW5rVGV4dFN0eWxlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgZm9udFNpemU6IDQyLFxuICAgICAgICAgICAgICAgICAgICB0ZXh0T3ZlcmZsb3c6IFwiZWxsaXBzaXNcIixcbiAgICAgICAgICAgICAgICAgICAgd2hpdGVTcGFjZTogXCJub3dyYXBcIlxuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICBdfVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgQWRtaW5cbiAgICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgICAgPC9MaW5rPlxuICAgICAgICAgIDwvVmlldz5cbiAgICAgICAgICA8VmlldyBkYXRhU2V0PXt7Y2xhc3M6IFwibWVudS1pdGVtcy1jZW50ZXJcIn19IHN0eWxlPXt7bWFyZ2luVG9wOiAyNX19PlxuICAgICAgICAgICAgeyFub0FjY2VzcyAmJlxuICAgICAgICAgICAgICA8TWVudUNvbnRlbnQgYWN0aXZlPXthY3RpdmV9IC8+XG4gICAgICAgICAgICB9XG4gICAgICAgICAgPC9WaWV3PlxuICAgICAgICAgIDxWaWV3IGRhdGFTZXQ9e3tjbGFzczogXCJtZW51LWl0ZW1zLWJvdHRvbVwifX0gc3R5bGU9e3ttYXJnaW5Ub3A6IFwiYXV0b1wiLCBtYXJnaW5Cb3R0b206IDI1fX0+XG4gICAgICAgICAgICB7Y3VycmVudFVzZXIgJiZcbiAgICAgICAgICAgICAgPFZpZXdcbiAgICAgICAgICAgICAgICBkYXRhU2V0PXt7Y2xhc3M6IFwibWVudS11c2VyLXNlY3Rpb25cIn19XG4gICAgICAgICAgICAgICAgc3R5bGU9e3tcbiAgICAgICAgICAgICAgICAgIGZsZXhEaXJlY3Rpb246IFwicm93XCIsXG4gICAgICAgICAgICAgICAgICBhbGlnbkl0ZW1zOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgICAgICAgbWFyZ2luUmlnaHQ6IDI1LFxuICAgICAgICAgICAgICAgICAgbWFyZ2luQm90dG9tOiAyNSxcbiAgICAgICAgICAgICAgICAgIG1hcmdpbkxlZnQ6IDI1XG4gICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxWaWV3XG4gICAgICAgICAgICAgICAgICBkYXRhU2V0PXt7Y2xhc3M6IFwibWVudS11c2VyLWljb25cIn19XG4gICAgICAgICAgICAgICAgICBzdHlsZT17e1xuICAgICAgICAgICAgICAgICAgICB3aWR0aDogNDQsXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogNDQsXG4gICAgICAgICAgICAgICAgICAgIGFsaWduSXRlbXM6IFwiY2VudGVyXCIsXG4gICAgICAgICAgICAgICAgICAgIGp1c3RpZnlDb250ZW50OiBcImNlbnRlclwiLFxuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IFwiI2FiYmNkMFwiLFxuICAgICAgICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6IFwiNTAlXCJcbiAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgPEljb24gbmFtZT1cInVzZXJcIiBzaXplPXsxMn0gLz5cbiAgICAgICAgICAgICAgICA8L1ZpZXc+XG4gICAgICAgICAgICAgICAgPFZpZXcgY2xhc3NOYW1lPVwibWVudS11c2VyLW5hbWVcIiBzdHlsZT17c3R5bGVzLnVzZXJOYW1lfT5cbiAgICAgICAgICAgICAgICAgIDxUZXh0IGRhdGFTZXQ9e3tjbGFzczogXCJtZW51LXVzZXItbmFtZS1jb250YWluZXJcIn19IHN0eWxlPXtzdHlsZXMudXNlck5hbWVDb250YWluZXJ9PlxuICAgICAgICAgICAgICAgICAgICB7Y3VycmVudFVzZXIubmFtZSgpfVxuICAgICAgICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgICAgICAgIDwvVmlldz5cbiAgICAgICAgICAgICAgPC9WaWV3PlxuICAgICAgICAgICAgfVxuICAgICAgICAgICAge2N1cnJlbnRVc2VyICYmXG4gICAgICAgICAgICAgIDxNZW51SXRlbVxuICAgICAgICAgICAgICAgIGFjdGl2ZVxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cInNpZ24tb3V0LW1lbnUtaXRlbVwiXG4gICAgICAgICAgICAgICAgaWNvbj1cInNpZ24tb3V0LWFsdFwiXG4gICAgICAgICAgICAgICAgbGFiZWw9e3QoXCIuc2lnbl9vdXRcIiwge2RlZmF1bHRWYWx1ZTogXCJTaWduIG91dFwifSl9XG4gICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy50dC5vblNpZ25PdXRDbGlja2VkfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgfVxuICAgICAgICAgIDwvVmlldz5cbiAgICAgICAgPC9XaXRoRGVmYXVsdFN0eWxlPlxuICAgICAgPC9WaWV3PlxuICAgIClcbiAgfVxuXG4gIG9uU2lnbk91dENsaWNrZWQgPSBhc3luYyAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKVxuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IERldmlzZS5zaWduT3V0KClcbiAgICAgIEZsYXNoTm90aWZpY2F0aW9ucy5zdWNjZXNzKHRoaXMudChcIi55b3VfaGF2ZV9iZWVuX3NpZ25lZF9vdXRcIiwge2RlZmF1bHRWYWx1ZTogXCJZb3UgaGF2ZSBiZWVuIHNpZ25lZCBvdXRcIn0pKVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBGbGFzaE5vdGlmaWNhdGlvbnMuZXJyb3JSZXNwb25zZShlcnJvcilcbiAgICB9XG4gIH1cbn0pKVxuIl19