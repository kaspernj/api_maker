import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import React, { useCallback, useRef } from "react";
import BaseComponent from "../../../base-component";
import Icon from "../../../utils/icon";
import memo from "set-state-compare/build/memo.js";
import PropTypes from "prop-types";
import PropTypesExact from "prop-types-exact";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import Text from "../../../utils/text";
import { Pressable, View } from "react-native";
import useBreakpoint from "../../../use-breakpoint.js";
import useEventListener from "../../../use-event-listener.js";
// Hook for consistent action button styling across breakpoints
export const useHeaderActionButtonStyle = () => {
    const { mdUp } = useBreakpoint();
    return useCallback(({ stackedIndex = 0 } = {}) => {
        const base = mdUp
            ? {
                alignSelf: "flex-start",
                paddingVertical: 7,
                paddingHorizontal: 10,
                borderWidth: 1,
                borderColor: "#cbd5e1",
                marginRight: 4,
                marginBottom: 4,
                borderRadius: 5,
                fontSize: 13
            }
            : {
                alignSelf: "stretch",
                padding: 11
            };
        if (!mdUp && stackedIndex > 0) {
            base.borderTopWidth = 1;
            base.borderTopColor = "#c9c9c9";
        }
        return base;
    }, [mdUp]);
};
export default memo(shapeComponent(class ApiMakerSuperAdminLayoutHeader extends BaseComponent {
    static propTypes = PropTypesExact({
        actions: PropTypes.any,
        onTriggerMenu: PropTypes.func.isRequired,
        title: PropTypes.string
    });
    setup() {
        const { name: breakpoint, mdUp } = useBreakpoint();
        this.headerActionsRef = useRef();
        this.setInstance({ breakpoint, mdUp });
        this.useStates({
            headerActionsActive: false
        });
        useEventListener(window, "mouseup", this.tt.onWindowMouseUp);
    }
    render() {
        const { breakpoint, mdUp } = this.tt;
        const { actions, onTriggerMenu, title } = this.props;
        const headerStyle = {
            display: "flex",
            flexDirection: "row",
            alignItems: "center",
            zIndex: 9,
            height: 100,
            paddingRight: 30,
            paddingLeft: 30,
            backgroundColor: "#fff"
        };
        const headerActionsContainerStyle = {};
        const headerActionsStyle = {
            flexDirection: mdUp ? "row" : "column",
            alignItems: mdUp ? "flex-start" : "stretch",
            gap: mdUp ? 8 : 0
        };
        if (breakpoint == "xs" || breakpoint == "sm") {
            headerStyle.position = "absolute";
            headerStyle.width = "100%";
            Object.assign(headerActionsContainerStyle, {
                position: "fixed",
                top: 0,
                left: 0,
                display: "flex",
                width: "100vw",
                height: "100vh",
                alignItems: "center",
                justifyContent: "center",
                backgroundColor: "rgba(0, 0, 0, 0.8)"
            });
            if (!this.s.headerActionsActive) {
                headerActionsContainerStyle.display = "none";
            }
            Object.assign(headerActionsStyle, {
                minWidth: "80vw",
                maxWidth: "100vw",
                backgroundColor: "#fff"
            });
        }
        else if (breakpoint == "md") {
            headerStyle.position = "fixed";
            headerStyle.left = 250;
            headerStyle.width = "calc(100% - 250px)";
        }
        else if (breakpoint == "lg" || breakpoint == "xl" || breakpoint == "xxl") {
            headerStyle.position = "fixed";
            headerStyle.left = 290;
            headerStyle.width = "calc(100% - 290px)";
        }
        if (breakpoint == "md" || breakpoint == "lg" || breakpoint == "xl" || breakpoint == "xxl") {
            headerActionsContainerStyle.marginLeft = "auto";
        }
        return (_jsxs(View, { dataSet: this.cache("rootViewDataSet", { component: "super-admin--layout--header" }), style: headerStyle, children: [_jsx(View, { dataSet: this.cache("headerTitleViewDataSet", { class: "header-title-container" }), children: _jsx(Text, { style: this.cache("headerTitleTextStyle", { color: "#282a33", fontSize: 22 }), children: title }) }), actions &&
                    _jsx(View, { dataSet: { active: this.s.headerActionsActive, class: "header-actions-container" }, style: headerActionsContainerStyle, children: _jsx(View, { dataSet: this.cache("headerActionsViewDataSet", { class: "header-actions" }), ref: this.tt.headerActionsRef, style: headerActionsStyle, children: actions }) }), !mdUp &&
                    _jsxs(View, { dataSet: this.cache("burgerMenuContainerDataSet", { class: "burger-menu-container" }), style: this.cache("burgerMenuContainerStyle", {
                            flexDirection: "row",
                            marginLeft: "auto"
                        }), children: [actions &&
                                _jsx(Pressable, { dataSet: this.cache("actionsLinkDataSet", { class: "actions-link" }), onPress: this.tt.onGearsClicked, style: this.cache("actionsLinkStyle", { marginRight: 8, fontSize: 22 }), children: _jsx(Icon, { name: "gear", size: 20 }) }), _jsx(Pressable, { dataSet: this.cache("burgerMenuLinkDataSet", { class: "burger-menu-link" }), onPress: onTriggerMenu, children: _jsx(Icon, { name: "bars", size: 20 }) })] })] }));
    }
    onGearsClicked = () => this.setState({ headerActionsActive: !this.s.headerActionsActive });
    onWindowMouseUp = (e) => {
        // Close the header actions menu if clicked happened outside
        if (this.s.headerActionsActive && this.tt.headerActionsRef.current && !this.tt.headerActionsRef.current.contains(e.target)) {
            this.setState({ headerActionsActive: false });
        }
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbInN1cGVyLWFkbWluL2xheW91dC9oZWFkZXIvaW5kZXguanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEtBQUssRUFBRSxFQUFDLFdBQVcsRUFBRSxNQUFNLEVBQUMsTUFBTSxPQUFPLENBQUE7QUFDaEQsT0FBTyxhQUFhLE1BQU0seUJBQXlCLENBQUE7QUFDbkQsT0FBTyxJQUFJLE1BQU0scUJBQXFCLENBQUE7QUFDdEMsT0FBTyxJQUFJLE1BQU0saUNBQWlDLENBQUE7QUFDbEQsT0FBTyxTQUFTLE1BQU0sWUFBWSxDQUFBO0FBQ2xDLE9BQU8sY0FBYyxNQUFNLGtCQUFrQixDQUFBO0FBQzdDLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSw0Q0FBNEMsQ0FBQTtBQUN6RSxPQUFPLElBQUksTUFBTSxxQkFBcUIsQ0FBQTtBQUN0QyxPQUFPLEVBQUMsU0FBUyxFQUFFLElBQUksRUFBQyxNQUFNLGNBQWMsQ0FBQTtBQUM1QyxPQUFPLGFBQWEsTUFBTSw0QkFBNEIsQ0FBQTtBQUN0RCxPQUFPLGdCQUFnQixNQUFNLGdDQUFnQyxDQUFBO0FBRTdELCtEQUErRDtBQUMvRCxNQUFNLENBQUMsTUFBTSwwQkFBMEIsR0FBRyxHQUFHLEVBQUU7SUFDN0MsTUFBTSxFQUFDLElBQUksRUFBQyxHQUFHLGFBQWEsRUFBRSxDQUFBO0lBRTlCLE9BQU8sV0FBVyxDQUFDLENBQUMsRUFBQyxZQUFZLEdBQUcsQ0FBQyxFQUFDLEdBQUcsRUFBRSxFQUFFLEVBQUU7UUFDN0MsTUFBTSxJQUFJLEdBQUcsSUFBSTtZQUNmLENBQUMsQ0FBQztnQkFDRSxTQUFTLEVBQUUsWUFBWTtnQkFDdkIsZUFBZSxFQUFFLENBQUM7Z0JBQ2xCLGlCQUFpQixFQUFFLEVBQUU7Z0JBQ3JCLFdBQVcsRUFBRSxDQUFDO2dCQUNkLFdBQVcsRUFBRSxTQUFTO2dCQUN0QixXQUFXLEVBQUUsQ0FBQztnQkFDZCxZQUFZ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SSxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsRUFBRSxFQUFDLFdBQVcsRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBQyxDQUFDLFlBRXJFLEtBQUMsSUFBSSxJQUFDLElBQUksRUFBQyxNQUFNLEVBQUMsSUFBSSxFQUFFLEVBQUUsR0FBSSxHQUNwQixFQUVkLEtBQUMsU0FBUyxJQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLHVCQUF1QixFQUFFLEVBQUMsS0FBSyxFQUFFLGtCQUFrQixFQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsYUFBYSxZQUMxRyxLQUFDLElBQUksSUFBQyxJQUFJLEVBQUMsTUFBTSxFQUFDLElBQUksRUFBRSxFQUFFLEdBQUksR0FDcEIsSUFDUCxJQUVKLENBQ1IsQ0FBQTtJQUNILENBQUM7SUFFRCxjQUFjLEdBQUcsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFDLG1CQUFtQixFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxtQkFBbUIsRUFBQyxDQUFDLENBQUE7SUFFeEYsZUFBZSxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUU7UUFDdEIsNERBQTREO1FBQzVELElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxtQkFBbUIsSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztZQUMzSCxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUMsbUJBQW1CLEVBQUUsS0FBSyxFQUFDLENBQUMsQ0FBQTtRQUM3QyxDQUFDO0lBQ0gsQ0FBQyxDQUFBO0NBQ0YsQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHt1c2VDYWxsYmFjaywgdXNlUmVmfSBmcm9tIFwicmVhY3RcIlxuaW1wb3J0IEJhc2VDb21wb25lbnQgZnJvbSBcIi4uLy4uLy4uL2Jhc2UtY29tcG9uZW50XCJcbmltcG9ydCBJY29uIGZyb20gXCIuLi8uLi8uLi91dGlscy9pY29uXCJcbmltcG9ydCBtZW1vIGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9tZW1vLmpzXCJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIlxuaW1wb3J0IFByb3BUeXBlc0V4YWN0IGZyb20gXCJwcm9wLXR5cGVzLWV4YWN0XCJcbmltcG9ydCB7c2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IFRleHQgZnJvbSBcIi4uLy4uLy4uL3V0aWxzL3RleHRcIlxuaW1wb3J0IHtQcmVzc2FibGUsIFZpZXd9IGZyb20gXCJyZWFjdC1uYXRpdmVcIlxuaW1wb3J0IHVzZUJyZWFrcG9pbnQgZnJvbSBcIi4uLy4uLy4uL3VzZS1icmVha3BvaW50LmpzXCJcbmltcG9ydCB1c2VFdmVudExpc3RlbmVyIGZyb20gXCIuLi8uLi8uLi91c2UtZXZlbnQtbGlzdGVuZXIuanNcIlxuXG4vLyBIb29rIGZvciBjb25zaXN0ZW50IGFjdGlvbiBidXR0b24gc3R5bGluZyBhY3Jvc3MgYnJlYWtwb2ludHNcbmV4cG9ydCBjb25zdCB1c2VIZWFkZXJBY3Rpb25CdXR0b25TdHlsZSA9ICgpID0+IHtcbiAgY29uc3Qge21kVXB9ID0gdXNlQnJlYWtwb2ludCgpXG5cbiAgcmV0dXJuIHVzZUNhbGxiYWNrKCh7c3RhY2tlZEluZGV4ID0gMH0gPSB7fSkgPT4ge1xuICAgIGNvbnN0IGJhc2UgPSBtZFVwXG4gICAgICA/IHtcbiAgICAgICAgICBhbGlnblNlbGY6IFwiZmxleC1zdGFydFwiLFxuICAgICAgICAgIHBhZGRpbmdWZXJ0aWNhbDogNyxcbiAgICAgICAgICBwYWRkaW5nSG9yaXpvbnRhbDogMTAsXG4gICAgICAgICAgYm9yZGVyV2lkdGg6IDEsXG4gICAgICAgICAgYm9yZGVyQ29sb3I6IFwiI2NiZDVlMVwiLFxuICAgICAgICAgIG1hcmdpblJpZ2h0OiA0LFxuICAgICAgICAgIG1hcmdpbkJvdHRvbTogNCxcbiAgICAgICAgICBib3JkZXJSYWRpdXM6IDUsXG4gICAgICAgICAgZm9udFNpemU6IDEzXG4gICAgICAgIH1cbiAgICAgIDoge1xuICAgICAgICAgIGFsaWduU2VsZjogXCJzdHJldGNoXCIsXG4gICAgICAgICAgcGFkZGluZzogMTFcbiAgICAgICAgfVxuXG4gICAgaWYgKCFtZFVwICYmIHN0YWNrZWRJbmRleCA+IDApIHtcbiAgICAgIGJhc2UuYm9yZGVyVG9wV2lkdGggPSAxXG4gICAgICBiYXNlLmJvcmRlclRvcENvbG9yID0gXCIjYzljOWM5XCJcbiAgICB9XG5cbiAgICByZXR1cm4gYmFzZVxuICB9LCBbbWRVcF0pXG59XG5cbmV4cG9ydCBkZWZhdWx0IG1lbW8oc2hhcGVDb21wb25lbnQoY2xhc3MgQXBpTWFrZXJTdXBlckFkbWluTGF5b3V0SGVhZGVyIGV4dGVuZHMgQmFzZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSBQcm9wVHlwZXNFeGFjdCh7XG4gICAgYWN0aW9uczogUHJvcFR5cGVzLmFueSxcbiAgICBvblRyaWdnZXJNZW51OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHRpdGxlOiBQcm9wVHlwZXMuc3RyaW5nXG4gIH0pXG5cbiAgc2V0dXAoKSB7XG4gICAgY29uc3Qge25hbWU6IGJyZWFrcG9pbnQsIG1kVXB9ID0gdXNlQnJlYWtwb2ludCgpXG5cbiAgICB0aGlzLmhlYWRlckFjdGlvbnNSZWYgPSB1c2VSZWYoKVxuICAgIHRoaXMuc2V0SW5zdGFuY2Uoe2JyZWFrcG9pbnQsIG1kVXB9KVxuICAgIHRoaXMudXNlU3RhdGVzKHtcbiAgICAgIGhlYWRlckFjdGlvbnNBY3RpdmU6IGZhbHNlXG4gICAgfSlcblxuICAgIHVzZUV2ZW50TGlzdGVuZXIod2luZG93LCBcIm1vdXNldXBcIiwgdGhpcy50dC5vbldpbmRvd01vdXNlVXApXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge2JyZWFrcG9pbnQsIG1kVXB9ID0gdGhpcy50dFxuICAgIGNvbnN0IHthY3Rpb25zLCBvblRyaWdnZXJNZW51LCB0aXRsZX0gPSB0aGlzLnByb3BzXG5cbiAgICBjb25zdCBoZWFkZXJTdHlsZSA9IHtcbiAgICAgIGRpc3BsYXk6IFwiZmxleFwiLFxuICAgICAgZmxleERpcmVjdGlvbjogXCJyb3dcIixcbiAgICAgIGFsaWduSXRlbXM6IFwiY2VudGVyXCIsXG4gICAgICB6SW5kZXg6IDksXG4gICAgICBoZWlnaHQ6IDEwMCxcbiAgICAgIHBhZGRpbmdSaWdodDogMzAsXG4gICAgICBwYWRkaW5nTGVmdDogMzAsXG4gICAgICBiYWNrZ3JvdW5kQ29sb3I6IFwiI2ZmZlwiXG4gICAgfVxuXG4gICAgY29uc3QgaGVhZGVyQWN0aW9uc0NvbnRhaW5lclN0eWxlID0ge31cbiAgICBjb25zdCBoZWFkZXJBY3Rpb25zU3R5bGUgPSB7XG4gICAgICBmbGV4RGlyZWN0aW9uOiBtZFVwID8gXCJyb3dcIiA6IFwiY29sdW1uXCIsXG4gICAgICBhbGlnbkl0ZW1zOiBtZFVwID8gXCJmbGV4LXN0YXJ0XCIgOiBcInN0cmV0Y2hcIixcbiAgICAgIGdhcDogbWRVcCA/IDggOiAwXG4gICAgfVxuXG4gICAgaWYgKGJyZWFrcG9pbnQgPT0gXCJ4c1wiIHx8IGJyZWFrcG9pbnQgPT0gXCJzbVwiKSB7XG4gICAgICBoZWFkZXJTdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIlxuICAgICAgaGVhZGVyU3R5bGUud2lkdGggPSBcIjEwMCVcIlxuXG4gICAgICBPYmplY3QuYXNzaWduKGhlYWRlckFjdGlvbnNDb250YWluZXJTdHlsZSwge1xuICAgICAgICBwb3NpdGlvbjogXCJmaXhlZFwiLFxuICAgICAgICB0b3A6IDAsXG4gICAgICAgIGxlZnQ6IDAsXG5cbiAgICAgICAgZGlzcGxheTogXCJmbGV4XCIsXG4gICAgICAgIHdpZHRoOiBcIjEwMHZ3XCIsXG4gICAgICAgIGhlaWdodDogXCIxMDB2aFwiLFxuICAgICAgICBhbGlnbkl0ZW1zOiBcImNlbnRlclwiLFxuICAgICAgICBqdXN0aWZ5Q29udGVudDogXCJjZW50ZXJcIixcblxuICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IFwicmdiYSgwLCAwLCAwLCAwLjgpXCJcbiAgICAgIH0pXG5cbiAgICAgIGlmICghdGhpcy5zLmhlYWRlckFjdGlvbnNBY3RpdmUpIHtcbiAgICAgICAgaGVhZGVyQWN0aW9uc0NvbnRhaW5lclN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIlxuICAgICAgfVxuXG4gICAgICBPYmplY3QuYXNzaWduKGhlYWRlckFjdGlvbnNTdHlsZSwge1xuICAgICAgICBtaW5XaWR0aDogXCI4MHZ3XCIsXG4gICAgICAgIG1heFdpZHRoOiBcIjEwMHZ3XCIsXG4gICAgICAgIGJhY2tncm91bmRDb2xvcjogXCIjZmZmXCJcbiAgICAgIH0pXG4gICAgfSBlbHNlIGlmIChicmVha3BvaW50ID09IFwibWRcIikge1xuICAgICAgaGVhZGVyU3R5bGUucG9zaXRpb24gPSBcImZpeGVkXCJcbiAgICAgIGhlYWRlclN0eWxlLmxlZnQgPSAyNTBcbiAgICAgIGhlYWRlclN0eWxlLndpZHRoID0gXCJjYWxjKDEwMCUgLSAyNTBweClcIlxuICAgIH0gZWxzZSBpZiAoYnJlYWtwb2ludCA9PSBcImxnXCIgfHwgYnJlYWtwb2ludCA9PSBcInhsXCIgfHwgYnJlYWtwb2ludCA9PSBcInh4bFwiKSB7XG4gICAgICBoZWFkZXJTdHlsZS5wb3NpdGlvbiA9IFwiZml4ZWRcIlxuICAgICAgaGVhZGVyU3R5bGUubGVmdCA9IDI5MFxuICAgICAgaGVhZGVyU3R5bGUud2lkdGggPSBcImNhbGMoMTAwJSAtIDI5MHB4KVwiXG4gICAgfVxuXG4gICAgaWYgKGJyZWFrcG9pbnQgPT0gXCJtZFwiIHx8IGJyZWFrcG9pbnQgPT0gXCJsZ1wiIHx8IGJyZWFrcG9pbnQgPT0gXCJ4bFwiIHx8IGJyZWFrcG9pbnQgPT0gXCJ4eGxcIikge1xuICAgICAgaGVhZGVyQWN0aW9uc0NvbnRhaW5lclN0eWxlLm1hcmdpbkxlZnQgPSBcImF1dG9cIlxuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICA8VmlldyBkYXRhU2V0PXt0aGlzLmNhY2hlKFwicm9vdFZpZXdEYXRhU2V0XCIsIHtjb21wb25lbnQ6IFwic3VwZXItYWRtaW4tLWxheW91dC0taGVhZGVyXCJ9KX0gc3R5bGU9e2hlYWRlclN0eWxlfT5cbiAgICAgICAgPFZpZXcgZGF0YVNldD17dGhpcy5jYWNoZShcImhlYWRlclRpdGxlVmlld0RhdGFTZXRcIiwge2NsYXNzOiBcImhlYWRlci10aXRsZS1jb250YWluZXJcIn0pfT5cbiAgICAgICAgICA8VGV4dCBzdHlsZT17dGhpcy5jYWNoZShcImhlYWRlclRpdGxlVGV4dFN0eWxlXCIsIHtjb2xvcjogXCIjMjgyYTMzXCIsIGZvbnRTaXplOiAyMn0pfT5cbiAgICAgICAgICAgIHt0aXRsZX1cbiAgICAgICAgICA8L1RleHQ+XG4gICAgICAgIDwvVmlldz5cbiAgICAgICAge2FjdGlvbnMgJiZcbiAgICAgICAgICA8VmlldyBkYXRhU2V0PXt7YWN0aXZlOiB0aGlzLnMuaGVhZGVyQWN0aW9uc0FjdGl2ZSwgY2xhc3M6IFwiaGVhZGVyLWFjdGlvbnMtY29udGFpbmVyXCJ9fSBzdHlsZT17aGVhZGVyQWN0aW9uc0NvbnRhaW5lclN0eWxlfT5cbiAgICAgICAgICAgIDxWaWV3XG4gICAgICAgICAgICBkYXRhU2V0PXt0aGlzLmNhY2hlKFwiaGVhZGVyQWN0aW9uc1ZpZXdEYXRhU2V0XCIsIHtjbGFzczogXCJoZWFkZXItYWN0aW9uc1wifSl9XG4gICAgICAgICAgICByZWY9e3RoaXMudHQuaGVhZGVyQWN0aW9uc1JlZn1cbiAgICAgICAgICAgIHN0eWxlPXtoZWFkZXJBY3Rpb25zU3R5bGV9XG4gICAgICAgICAgPlxuICAgICAgICAgICAge2FjdGlvbnN9XG4gICAgICAgICAgPC9WaWV3PlxuICAgICAgICAgIDwvVmlldz5cbiAgICAgICAgfVxuICAgICAgICB7IW1kVXAgJiZcbiAgICAgICAgICA8Vmlld1xuICAgICAgICAgICAgZGF0YVNldD17dGhpcy5jYWNoZShcImJ1cmdlck1lbnVDb250YWluZXJEYXRhU2V0XCIsIHtjbGFzczogXCJidXJnZXItbWVudS1jb250YWluZXJcIn0pfVxuICAgICAgICAgICAgc3R5bGU9e3RoaXMuY2FjaGUoXCJidXJnZXJNZW51Q29udGFpbmVyU3R5bGVcIiwge1xuICAgICAgICAgICAgICBmbGV4RGlyZWN0aW9uOiBcInJvd1wiLFxuICAgICAgICAgICAgICBtYXJnaW5MZWZ0OiBcImF1dG9cIlxuICAgICAgICAgICAgfSl9XG4gICAgICAgICAgPlxuICAgICAgICAgICAge2FjdGlvbnMgJiZcbiAgICAgICAgICAgICAgPFByZXNzYWJsZVxuICAgICAgICAgICAgICAgIGRhdGFTZXQ9e3RoaXMuY2FjaGUoXCJhY3Rpb25zTGlua0RhdGFTZXRcIiwge2NsYXNzOiBcImFjdGlvbnMtbGlua1wifSl9XG4gICAgICAgICAgICAgICAgb25QcmVzcz17dGhpcy50dC5vbkdlYXJzQ2xpY2tlZH1cbiAgICAgICAgICAgICAgICBzdHlsZT17dGhpcy5jYWNoZShcImFjdGlvbnNMaW5rU3R5bGVcIiwge21hcmdpblJpZ2h0OiA4LCBmb250U2l6ZTogMjJ9KX1cbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxJY29uIG5hbWU9XCJnZWFyXCIgc2l6ZT17MjB9IC8+XG4gICAgICAgICAgICAgIDwvUHJlc3NhYmxlPlxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgPFByZXNzYWJsZSBkYXRhU2V0PXt0aGlzLmNhY2hlKFwiYnVyZ2VyTWVudUxpbmtEYXRhU2V0XCIsIHtjbGFzczogXCJidXJnZXItbWVudS1saW5rXCJ9KX0gb25QcmVzcz17b25UcmlnZ2VyTWVudX0+XG4gICAgICAgICAgICAgIDxJY29uIG5hbWU9XCJiYXJzXCIgc2l6ZT17MjB9IC8+XG4gICAgICAgICAgICA8L1ByZXNzYWJsZT5cbiAgICAgICAgICA8L1ZpZXc+XG4gICAgICAgIH1cbiAgICAgIDwvVmlldz5cbiAgICApXG4gIH1cblxuICBvbkdlYXJzQ2xpY2tlZCA9ICgpID0+IHRoaXMuc2V0U3RhdGUoe2hlYWRlckFjdGlvbnNBY3RpdmU6ICF0aGlzLnMuaGVhZGVyQWN0aW9uc0FjdGl2ZX0pXG5cbiAgb25XaW5kb3dNb3VzZVVwID0gKGUpID0+IHtcbiAgICAvLyBDbG9zZSB0aGUgaGVhZGVyIGFjdGlvbnMgbWVudSBpZiBjbGlja2VkIGhhcHBlbmVkIG91dHNpZGVcbiAgICBpZiAodGhpcy5zLmhlYWRlckFjdGlvbnNBY3RpdmUgJiYgdGhpcy50dC5oZWFkZXJBY3Rpb25zUmVmLmN1cnJlbnQgJiYgIXRoaXMudHQuaGVhZGVyQWN0aW9uc1JlZi5jdXJyZW50LmNvbnRhaW5zKGUudGFyZ2V0KSkge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7aGVhZGVyQWN0aW9uc0FjdGl2ZTogZmFsc2V9KVxuICAgIH1cbiAgfVxufSkpXG4iXX0=