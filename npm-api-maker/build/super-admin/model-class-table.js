import BaseComponent from "../base-component.js";
import ConfigReader from "./config-reader.js";
import { digg } from "diggerize";
import hasEditConfig from "./has-edit-config.js";
import * as inflection from "inflection";
import memo from "set-state-compare/build/memo.js";
import Params from "../params.js";
import PropTypes from "prop-types";
import React, { useMemo } from "react";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import Table from "../table/table.js";
import useCurrentUser from "../use-current-user.js";
export default memo(shapeComponent(class ApiMakerSuperAdminModelClassTable extends BaseComponent {
    static propTypes = {
        modelClass: PropTypes.func.isRequired
    };
    render() {
        const { modelClass, ...restProps } = this.props;
        const currentUser = useCurrentUser();
        const configReader = useMemo(() => ConfigReader.forModel(modelClass), [modelClass]);
        const { columns, select } = useMemo(() => configReader.tableColumns(), [modelClass]);
        const tableConfig = configReader.modelConfig?.table;
        const tableProps = {};
        if (!columns)
            throw new Error("No columns given");
        if (tableConfig?.query)
            tableProps.collection = tableConfig.query;
        return (<Table columns={columns} currentUser={currentUser} editModelPath={hasEditConfig(modelClass) ? this.tt.editModelPath : undefined} modelClass={modelClass} select={select} viewModelPath={this.tt.viewModelPath} workplace {...tableProps} {...restProps}/>);
    }
    editModelPath = (args) => {
        const argName = inflection.camelize(digg(this.p.modelClass.modelClassData(), "name"), true);
        const model = digg(args, argName);
        return Params.withParams({
            model: this.p.modelClass.modelClassData().name,
            model_id: model.primaryKey(),
            mode: "edit"
        });
    };
    viewModelPath = (args) => {
        const argName = inflection.camelize(digg(this.p.modelClass.modelClassData(), "name"), true);
        const model = digg(args, argName);
        return Params.withParams({
            model: this.p.modelClass.modelClassData().name,
            model_id: model.primaryKey()
        });
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kZWwtY2xhc3MtdGFibGUuanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbInN1cGVyLWFkbWluL21vZGVsLWNsYXNzLXRhYmxlLmpzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLGFBQWEsTUFBTSxzQkFBc0IsQ0FBQTtBQUNoRCxPQUFPLFlBQVksTUFBTSxvQkFBb0IsQ0FBQTtBQUM3QyxPQUFPLEVBQUMsSUFBSSxFQUFDLE1BQU0sV0FBVyxDQUFBO0FBQzlCLE9BQU8sYUFBYSxNQUFNLHNCQUFzQixDQUFBO0FBQ2hELE9BQU8sS0FBSyxVQUFVLE1BQU0sWUFBWSxDQUFBO0FBQ3hDLE9BQU8sSUFBSSxNQUFNLGlDQUFpQyxDQUFBO0FBQ2xELE9BQU8sTUFBTSxNQUFNLGNBQWMsQ0FBQTtBQUNqQyxPQUFPLFNBQVMsTUFBTSxZQUFZLENBQUE7QUFDbEMsT0FBTyxLQUFLLEVBQUUsRUFBQyxPQUFPLEVBQUMsTUFBTSxPQUFPLENBQUE7QUFDcEMsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLDRDQUE0QyxDQUFBO0FBQ3pFLE9BQU8sS0FBSyxNQUFNLG1CQUFtQixDQUFBO0FBQ3JDLE9BQU8sY0FBYyxNQUFNLHdCQUF3QixDQUFBO0FBRW5ELGVBQWUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLGlDQUFrQyxTQUFRLGFBQWE7SUFDOUYsTUFBTSxDQUFDLFNBQVMsR0FBRztRQUNqQixVQUFVLEVBQUUsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVO0tBQ3RDLENBQUE7SUFFRCxNQUFNO1FBQ0osTUFBTSxFQUFDLFVBQVUsRUFBRSxHQUFHLFNBQVMsRUFBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUE7UUFDN0MsTUFBTSxXQUFXLEdBQUcsY0FBYyxFQUFFLENBQUE7UUFDcEMsTUFBTSxZQUFZLEdBQUcsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFBO1FBQ25GLE1BQU0sRUFBQyxPQUFPLEVBQUUsTUFBTSxFQUFDLEdBQUcsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxZQUFZLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUE7UUFDbEYsTUFBTSxXQUFXLEdBQUcsWUFBWSxDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUE7UUFDbkQsTUFBTSxVQUFVLEdBQUcsRUFBRSxDQUFBO1FBRXJCLElBQUksQ0FBQyxPQUFPO1lBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQyxDQUFBO1FBRWpELElBQUksV0FBVyxFQUFFLEtBQUs7WUFBRSxVQUFVLENBQUMsVUFBVSxHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUE7UUFFakUsT0FBTyxDQUNMLENBQUMsS0FBSyxDQUNKLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUNqQixXQUFXLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FDekIsYUFBYSxDQUFDLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQzdFLFVBQVUsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUN2QixNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FDZixhQUFhLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxDQUNyQyxTQUFTLENBQ1QsSUFBSSxVQUFVLENBQUMsQ0FDZixJQUFJLFNBQVMsQ0FBQyxFQUNkLENBQ0gsQ0FBQTtJQUNILENBQUM7SUFFRCxhQUFhLEdBQUcsQ0FBQyxJQUFJLEVBQUUsRUFBRTtRQUN2QixNQUFNLE9BQU8sR0FBRyxVQUFVLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxjQUFjLEVBQUUsRUFBRSxNQUFNLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQTtRQUMzRixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFBO1FBRWpDLE9BQU8sTUFBTSxDQUFDLFVBQVUsQ0FBQztZQUN2QixLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsY0FBYyxFQUFFLENBQUMsSUFBSTtZQUM5QyxRQUFRLEVBQUUsS0FBSyxDQUFDLFVBQVUsRUFBRTtZQUM1QixJQUFJLEVBQUUsTUFBTTtTQUNiLENBQUMsQ0FBQTtJQUNKLENBQUMsQ0FBQTtJQUVELGFBQWEsR0FBRyxDQUFDLElBQUksRUFBRSxFQUFFO1FBQ3ZCLE1BQU0sT0FBTyxHQUFHLFVBQVUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLGNBQWMsRUFBRSxFQUFFLE1BQU0sQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFBO1FBQzNGLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUE7UUFFakMsT0FBTyxNQUFNLENBQUMsVUFBVSxDQUFDO1lBQ3ZCLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxJQUFJO1lBQzlDLFFBQVEsRUFBRSxLQUFLLENBQUMsVUFBVSxFQUFFO1NBQzdCLENBQUMsQ0FBQTtJQUNKLENBQUMsQ0FBQTtDQUNGLENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJhc2VDb21wb25lbnQgZnJvbSBcIi4uL2Jhc2UtY29tcG9uZW50LmpzXCJcbmltcG9ydCBDb25maWdSZWFkZXIgZnJvbSBcIi4vY29uZmlnLXJlYWRlci5qc1wiXG5pbXBvcnQge2RpZ2d9IGZyb20gXCJkaWdnZXJpemVcIlxuaW1wb3J0IGhhc0VkaXRDb25maWcgZnJvbSBcIi4vaGFzLWVkaXQtY29uZmlnLmpzXCJcbmltcG9ydCAqIGFzIGluZmxlY3Rpb24gZnJvbSBcImluZmxlY3Rpb25cIlxuaW1wb3J0IG1lbW8gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL21lbW8uanNcIlxuaW1wb3J0IFBhcmFtcyBmcm9tIFwiLi4vcGFyYW1zLmpzXCJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIlxuaW1wb3J0IFJlYWN0LCB7dXNlTWVtb30gZnJvbSBcInJlYWN0XCJcbmltcG9ydCB7c2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IFRhYmxlIGZyb20gXCIuLi90YWJsZS90YWJsZS5qc1wiXG5pbXBvcnQgdXNlQ3VycmVudFVzZXIgZnJvbSBcIi4uL3VzZS1jdXJyZW50LXVzZXIuanNcIlxuXG5leHBvcnQgZGVmYXVsdCBtZW1vKHNoYXBlQ29tcG9uZW50KGNsYXNzIEFwaU1ha2VyU3VwZXJBZG1pbk1vZGVsQ2xhc3NUYWJsZSBleHRlbmRzIEJhc2VDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIG1vZGVsQ2xhc3M6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWRcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7bW9kZWxDbGFzcywgLi4ucmVzdFByb3BzfSA9IHRoaXMucHJvcHNcbiAgICBjb25zdCBjdXJyZW50VXNlciA9IHVzZUN1cnJlbnRVc2VyKClcbiAgICBjb25zdCBjb25maWdSZWFkZXIgPSB1c2VNZW1vKCgpID0+IENvbmZpZ1JlYWRlci5mb3JNb2RlbChtb2RlbENsYXNzKSwgW21vZGVsQ2xhc3NdKVxuICAgIGNvbnN0IHtjb2x1bW5zLCBzZWxlY3R9ID0gdXNlTWVtbygoKSA9PiBjb25maWdSZWFkZXIudGFibGVDb2x1bW5zKCksIFttb2RlbENsYXNzXSlcbiAgICBjb25zdCB0YWJsZUNvbmZpZyA9IGNvbmZpZ1JlYWRlci5tb2RlbENvbmZpZz8udGFibGVcbiAgICBjb25zdCB0YWJsZVByb3BzID0ge31cblxuICAgIGlmICghY29sdW1ucykgdGhyb3cgbmV3IEVycm9yKFwiTm8gY29sdW1ucyBnaXZlblwiKVxuXG4gICAgaWYgKHRhYmxlQ29uZmlnPy5xdWVyeSkgdGFibGVQcm9wcy5jb2xsZWN0aW9uID0gdGFibGVDb25maWcucXVlcnlcblxuICAgIHJldHVybiAoXG4gICAgICA8VGFibGVcbiAgICAgICAgY29sdW1ucz17Y29sdW1uc31cbiAgICAgICAgY3VycmVudFVzZXI9e2N1cnJlbnRVc2VyfVxuICAgICAgICBlZGl0TW9kZWxQYXRoPXtoYXNFZGl0Q29uZmlnKG1vZGVsQ2xhc3MpID8gdGhpcy50dC5lZGl0TW9kZWxQYXRoIDogdW5kZWZpbmVkfVxuICAgICAgICBtb2RlbENsYXNzPXttb2RlbENsYXNzfVxuICAgICAgICBzZWxlY3Q9e3NlbGVjdH1cbiAgICAgICAgdmlld01vZGVsUGF0aD17dGhpcy50dC52aWV3TW9kZWxQYXRofVxuICAgICAgICB3b3JrcGxhY2VcbiAgICAgICAgey4uLnRhYmxlUHJvcHN9XG4gICAgICAgIHsuLi5yZXN0UHJvcHN9XG4gICAgICAvPlxuICAgIClcbiAgfVxuXG4gIGVkaXRNb2RlbFBhdGggPSAoYXJncykgPT4ge1xuICAgIGNvbnN0IGFyZ05hbWUgPSBpbmZsZWN0aW9uLmNhbWVsaXplKGRpZ2codGhpcy5wLm1vZGVsQ2xhc3MubW9kZWxDbGFzc0RhdGEoKSwgXCJuYW1lXCIpLCB0cnVlKVxuICAgIGNvbnN0IG1vZGVsID0gZGlnZyhhcmdzLCBhcmdOYW1lKVxuXG4gICAgcmV0dXJuIFBhcmFtcy53aXRoUGFyYW1zKHtcbiAgICAgIG1vZGVsOiB0aGlzLnAubW9kZWxDbGFzcy5tb2RlbENsYXNzRGF0YSgpLm5hbWUsXG4gICAgICBtb2RlbF9pZDogbW9kZWwucHJpbWFyeUtleSgpLFxuICAgICAgbW9kZTogXCJlZGl0XCJcbiAgICB9KVxuICB9XG5cbiAgdmlld01vZGVsUGF0aCA9IChhcmdzKSA9PiB7XG4gICAgY29uc3QgYXJnTmFtZSA9IGluZmxlY3Rpb24uY2FtZWxpemUoZGlnZyh0aGlzLnAubW9kZWxDbGFzcy5tb2RlbENsYXNzRGF0YSgpLCBcIm5hbWVcIiksIHRydWUpXG4gICAgY29uc3QgbW9kZWwgPSBkaWdnKGFyZ3MsIGFyZ05hbWUpXG5cbiAgICByZXR1cm4gUGFyYW1zLndpdGhQYXJhbXMoe1xuICAgICAgbW9kZWw6IHRoaXMucC5tb2RlbENsYXNzLm1vZGVsQ2xhc3NEYXRhKCkubmFtZSxcbiAgICAgIG1vZGVsX2lkOiBtb2RlbC5wcmltYXJ5S2V5KClcbiAgICB9KVxuICB9XG59KSlcbiJdfQ==