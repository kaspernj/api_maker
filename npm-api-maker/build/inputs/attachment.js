import BaseComponent from "../base-component.js";
import classNames from "classnames";
import { Input as ApiMakerInput } from "@kaspernj/api-maker/build/inputs/input";
import Checkbox from "./checkbox.js";
import memo from "set-state-compare/build/memo.js";
import PropTypes from "prop-types";
import React from "react";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import useI18n from "i18n-on-steroids/src/use-i18n.mjs";
import useInput from "../use-input.js";
export default memo(shapeComponent(class ApiMakerInputsAttachment extends BaseComponent {
    static propTypes = {
        className: PropTypes.string,
        model: PropTypes.object.isRequired,
        onPurgeChanged: PropTypes.func,
        purgeName: PropTypes.string
    };
    setup() {
        const { t } = useI18n({ namespace: "js.api_maker.inputs.attachment" });
        const { inputProps } = useInput({ props: this.props });
        this.setInstance({ inputProps, t });
        this.useStates({
            purgeChecked: false
        });
    }
    render() {
        const { inputProps, t } = this.tt;
        const { attribute, checkboxComponent, className, label, model, name, onPurgeChanged, purgeName, wrapperOpts, ...restProps } = this.props;
        const CheckboxComponent = checkboxComponent || Checkbox;
        const newInputProps = Object.assign({}, inputProps, { type: "file" });
        return (<div className={classNames("api-maker--inputs--attachment", "components--inputs--input", className)} {...restProps}>
        {this.isImage() &&
                <a href={this.getUrl()} target="_blank">
            <img src={this.getUrl()} style={{ maxWidth: "200px", maxHeight: "200px" }}/>
          </a>}
        {this.getUrl() &&
                <div className="input-checkbox" style={{ paddingTop: "15px", paddingBottom: "15px" }}>
            <CheckboxComponent id={this.getPurgeInputId()} name={this.getPurgeInputName()} onChange={this.props.onPurgeChanged}/>
            <label className="checkbox-label" htmlFor={this.getPurgeInputId()}>
              {t("js.shared.delete")}
            </label>
          </div>}
        {!this.s.purgeChecked &&
                <ApiMakerInput defaultValue={null} inputProps={newInputProps} model={model}/>}
      </div>);
    }
    getContentType() {
        const { attribute, model } = this.p;
        const attributeName = `${attribute}ContentType`;
        if (!(attributeName in model))
            throw new Error(`No such method on ${model.modelClassData().name}: ${attributeName}`);
        return model[attributeName]();
    }
    getPurgeInputId() {
        const { inputProps } = this.tt;
        return `${inputProps.id}_purge`;
    }
    getPurgeInputName() {
        if ("purgeName" in this.props)
            return this.props.purgeName;
        const { inputProps } = this.tt;
        if (!inputProps.name)
            return null;
        const match = inputProps.name.match(/^(.+)\[(.+?)\]$/);
        const purgeInputName = `${match[1]}[${match[2]}_purge]`;
        return purgeInputName;
    }
    getUrl() {
        const { attribute, model } = this.p;
        const attributeName = `${attribute}Url`;
        if (!(attributeName in model))
            throw new Error(`No such method on ${model.modelClassData().name}: ${attributeName}`);
        return model[attributeName]();
    }
    isImage() {
        return this.getContentType()?.startsWith("image/");
    }
    onPurgeChanged = (e) => {
        this.setState({ purgeChecked: digg(e, "target", "checked") });
        if (this.props.onPurgeChanged)
            this.props.onPurgeChanged(e);
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXR0YWNobWVudC5qcyIsInNvdXJjZVJvb3QiOiIvc3JjLyIsInNvdXJjZXMiOlsiaW5wdXRzL2F0dGFjaG1lbnQuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sYUFBYSxNQUFNLHNCQUFzQixDQUFBO0FBQ2hELE9BQU8sVUFBVSxNQUFNLFlBQVksQ0FBQTtBQUNuQyxPQUFPLEVBQUMsS0FBSyxJQUFJLGFBQWEsRUFBQyxNQUFNLHdDQUF3QyxDQUFBO0FBQzdFLE9BQU8sUUFBUSxNQUFNLGVBQWUsQ0FBQTtBQUNwQyxPQUFPLElBQUksTUFBTSxpQ0FBaUMsQ0FBQTtBQUNsRCxPQUFPLFNBQVMsTUFBTSxZQUFZLENBQUE7QUFDbEMsT0FBTyxLQUFLLE1BQU0sT0FBTyxDQUFBO0FBQ3pCLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSw0Q0FBNEMsQ0FBQTtBQUN6RSxPQUFPLE9BQU8sTUFBTSxtQ0FBbUMsQ0FBQTtBQUN2RCxPQUFPLFFBQVEsTUFBTSxpQkFBaUIsQ0FBQTtBQUV0QyxlQUFlLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSx3QkFBeUIsU0FBUSxhQUFhO0lBQ3JGLE1BQU0sQ0FBQyxTQUFTLEdBQUc7UUFDakIsU0FBUyxFQUFFLFNBQVMsQ0FBQyxNQUFNO1FBQzNCLEtBQUssRUFBRSxTQUFTLENBQUMsTUFBTSxDQUFDLFVBQVU7UUFDbEMsY0FBYyxFQUFFLFNBQVMsQ0FBQyxJQUFJO1FBQzlCLFNBQVMsRUFBRSxTQUFTLENBQUMsTUFBTTtLQUM1QixDQUFBO0lBRUQsS0FBSztRQUNILE1BQU0sRUFBQyxDQUFDLEVBQUMsR0FBRyxPQUFPLENBQUMsRUFBQyxTQUFTLEVBQUUsZ0NBQWdDLEVBQUMsQ0FBQyxDQUFBO1FBQ2xFLE1BQU0sRUFBQyxVQUFVLEVBQUMsR0FBRyxRQUFRLENBQUMsRUFBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBQyxDQUFDLENBQUE7UUFFbEQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxFQUFDLFVBQVUs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Q0FBQyxFQUFFLEVBQUU7UUFDckIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsQ0FBQyxFQUFFLFFBQVEsRUFBRSxTQUFTLENBQUMsRUFBQyxDQUFDLENBQUE7UUFFM0QsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWM7WUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUM3RCxDQUFDLENBQUE7Q0FDRixDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCYXNlQ29tcG9uZW50IGZyb20gXCIuLi9iYXNlLWNvbXBvbmVudC5qc1wiXG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tIFwiY2xhc3NuYW1lc1wiXG5pbXBvcnQge0lucHV0IGFzIEFwaU1ha2VySW5wdXR9IGZyb20gXCJAa2FzcGVybmovYXBpLW1ha2VyL2J1aWxkL2lucHV0cy9pbnB1dFwiXG5pbXBvcnQgQ2hlY2tib3ggZnJvbSBcIi4vY2hlY2tib3guanNcIlxuaW1wb3J0IG1lbW8gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL21lbW8uanNcIlxuaW1wb3J0IFByb3BUeXBlcyBmcm9tIFwicHJvcC10eXBlc1wiXG5pbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCJcbmltcG9ydCB7c2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IHVzZUkxOG4gZnJvbSBcImkxOG4tb24tc3Rlcm9pZHMvc3JjL3VzZS1pMThuLm1qc1wiXG5pbXBvcnQgdXNlSW5wdXQgZnJvbSBcIi4uL3VzZS1pbnB1dC5qc1wiXG5cbmV4cG9ydCBkZWZhdWx0IG1lbW8oc2hhcGVDb21wb25lbnQoY2xhc3MgQXBpTWFrZXJJbnB1dHNBdHRhY2htZW50IGV4dGVuZHMgQmFzZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIG1vZGVsOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgb25QdXJnZUNoYW5nZWQ6IFByb3BUeXBlcy5mdW5jLFxuICAgIHB1cmdlTmFtZTogUHJvcFR5cGVzLnN0cmluZ1xuICB9XG5cbiAgc2V0dXAoKSB7XG4gICAgY29uc3Qge3R9ID0gdXNlSTE4bih7bmFtZXNwYWNlOiBcImpzLmFwaV9tYWtlci5pbnB1dHMuYXR0YWNobWVudFwifSlcbiAgICBjb25zdCB7aW5wdXRQcm9wc30gPSB1c2VJbnB1dCh7cHJvcHM6IHRoaXMucHJvcHN9KVxuXG4gICAgdGhpcy5zZXRJbnN0YW5jZSh7aW5wdXRQcm9wcywgdH0pXG4gICAgdGhpcy51c2VTdGF0ZXMoe1xuICAgICAgcHVyZ2VDaGVja2VkOiBmYWxzZVxuICAgIH0pXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge2lucHV0UHJvcHMsIHR9ID0gdGhpcy50dFxuICAgIGNvbnN0IHthdHRyaWJ1dGUsIGNoZWNrYm94Q29tcG9uZW50LCBjbGFzc05hbWUsIGxhYmVsLCBtb2RlbCwgbmFtZSwgb25QdXJnZUNoYW5nZWQsIHB1cmdlTmFtZSwgd3JhcHBlck9wdHMsIC4uLnJlc3RQcm9wc30gPSB0aGlzLnByb3BzXG4gICAgY29uc3QgQ2hlY2tib3hDb21wb25lbnQgPSBjaGVja2JveENvbXBvbmVudCB8fCBDaGVja2JveFxuICAgIGNvbnN0IG5ld0lucHV0UHJvcHMgPSBPYmplY3QuYXNzaWduKHt9LCBpbnB1dFByb3BzLCB7dHlwZTogXCJmaWxlXCJ9KVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPXtjbGFzc05hbWVzKFwiYXBpLW1ha2VyLS1pbnB1dHMtLWF0dGFjaG1lbnRcIiwgXCJjb21wb25lbnRzLS1pbnB1dHMtLWlucHV0XCIsIGNsYXNzTmFtZSl9IHsuLi5yZXN0UHJvcHN9PlxuICAgICAgICB7dGhpcy5pc0ltYWdlKCkgJiZcbiAgICAgICAgICA8YSBocmVmPXt0aGlzLmdldFVybCgpfSB0YXJnZXQ9XCJfYmxhbmtcIj5cbiAgICAgICAgICAgIDxpbWcgc3JjPXt0aGlzLmdldFVybCgpfSBzdHlsZT17e21heFdpZHRoOiBcIjIwMHB4XCIsIG1heEhlaWdodDogXCIyMDBweFwifX0gLz5cbiAgICAgICAgICA8L2E+XG4gICAgICAgIH1cbiAgICAgICAge3RoaXMuZ2V0VXJsKCkgJiZcbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImlucHV0LWNoZWNrYm94XCIgc3R5bGU9e3twYWRkaW5nVG9wOiBcIjE1cHhcIiwgcGFkZGluZ0JvdHRvbTogXCIxNXB4XCJ9fT5cbiAgICAgICAgICAgIDxDaGVja2JveENvbXBvbmVudCBpZD17dGhpcy5nZXRQdXJnZUlucHV0SWQoKX0gbmFtZT17dGhpcy5nZXRQdXJnZUlucHV0TmFtZSgpfSBvbkNoYW5nZT17dGhpcy5wcm9wcy5vblB1cmdlQ2hhbmdlZH0gLz5cbiAgICAgICAgICAgIDxsYWJlbCBjbGFzc05hbWU9XCJjaGVja2JveC1sYWJlbFwiIGh0bWxGb3I9e3RoaXMuZ2V0UHVyZ2VJbnB1dElkKCl9PlxuICAgICAgICAgICAgICB7dChcImpzLnNoYXJlZC5kZWxldGVcIil9XG4gICAgICAgICAgICA8L2xhYmVsPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICB9XG4gICAgICAgIHshdGhpcy5zLnB1cmdlQ2hlY2tlZCAmJlxuICAgICAgICAgIDxBcGlNYWtlcklucHV0XG4gICAgICAgICAgICBkZWZhdWx0VmFsdWU9e251bGx9XG4gICAgICAgICAgICBpbnB1dFByb3BzPXtuZXdJbnB1dFByb3BzfVxuICAgICAgICAgICAgbW9kZWw9e21vZGVsfVxuICAgICAgICAgIC8+XG4gICAgICAgIH1cbiAgICAgIDwvZGl2PlxuICAgIClcbiAgfVxuXG4gIGdldENvbnRlbnRUeXBlKCkge1xuICAgIGNvbnN0IHthdHRyaWJ1dGUsIG1vZGVsfSA9IHRoaXMucFxuICAgIGNvbnN0IGF0dHJpYnV0ZU5hbWUgPSBgJHthdHRyaWJ1dGV9Q29udGVudFR5cGVgXG5cbiAgICBpZiAoIShhdHRyaWJ1dGVOYW1lIGluIG1vZGVsKSkgdGhyb3cgbmV3IEVycm9yKGBObyBzdWNoIG1ldGhvZCBvbiAke21vZGVsLm1vZGVsQ2xhc3NEYXRhKCkubmFtZX06ICR7YXR0cmlidXRlTmFtZX1gKVxuXG4gICAgcmV0dXJuIG1vZGVsW2F0dHJpYnV0ZU5hbWVdKClcbiAgfVxuXG4gIGdldFB1cmdlSW5wdXRJZCgpIHtcbiAgICBjb25zdCB7aW5wdXRQcm9wc30gPSB0aGlzLnR0XG5cbiAgICByZXR1cm4gYCR7aW5wdXRQcm9wcy5pZH1fcHVyZ2VgXG4gIH1cblxuICBnZXRQdXJnZUlucHV0TmFtZSgpIHtcbiAgICBpZiAoXCJwdXJnZU5hbWVcIiBpbiB0aGlzLnByb3BzKSByZXR1cm4gdGhpcy5wcm9wcy5wdXJnZU5hbWVcblxuICAgIGNvbnN0IHtpbnB1dFByb3BzfSA9IHRoaXMudHRcblxuICAgIGlmICghaW5wdXRQcm9wcy5uYW1lKSByZXR1cm4gbnVsbFxuXG4gICAgY29uc3QgbWF0Y2ggPSBpbnB1dFByb3BzLm5hbWUubWF0Y2goL14oLispXFxbKC4rPylcXF0kLylcbiAgICBjb25zdCBwdXJnZUlucHV0TmFtZSA9IGAke21hdGNoWzFdfVske21hdGNoWzJdfV9wdXJnZV1gXG5cbiAgICByZXR1cm4gcHVyZ2VJbnB1dE5hbWVcbiAgfVxuXG4gIGdldFVybCgpIHtcbiAgICBjb25zdCB7YXR0cmlidXRlLCBtb2RlbH0gPSB0aGlzLnBcbiAgICBjb25zdCBhdHRyaWJ1dGVOYW1lID0gYCR7YXR0cmlidXRlfVVybGBcblxuICAgIGlmICghKGF0dHJpYnV0ZU5hbWUgaW4gbW9kZWwpKSB0aHJvdyBuZXcgRXJyb3IoYE5vIHN1Y2ggbWV0aG9kIG9uICR7bW9kZWwubW9kZWxDbGFzc0RhdGEoKS5uYW1lfTogJHthdHRyaWJ1dGVOYW1lfWApXG5cbiAgICByZXR1cm4gbW9kZWxbYXR0cmlidXRlTmFtZV0oKVxuICB9XG5cbiAgaXNJbWFnZSgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRDb250ZW50VHlwZSgpPy5zdGFydHNXaXRoKFwiaW1hZ2UvXCIpXG4gIH1cblxuICBvblB1cmdlQ2hhbmdlZCA9IChlKSA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7cHVyZ2VDaGVja2VkOiBkaWdnKGUsIFwidGFyZ2V0XCIsIFwiY2hlY2tlZFwiKX0pXG5cbiAgICBpZiAodGhpcy5wcm9wcy5vblB1cmdlQ2hhbmdlZCkgdGhpcy5wcm9wcy5vblB1cmdlQ2hhbmdlZChlKVxuICB9XG59KSlcbiJdfQ==