import objectToFormData from "object-to-formdata";
export default class ApiMakerCommandSubmitData {
    /**
     * @param {object} data
     * @param {Record<string, any>} [data.global]
     * @param {import("./commands-pool.js").PoolDataType} data.pool
     */
    constructor(data) {
        this.data = data;
        this.filesCount = 0;
        this.jsonData = this.traverseObject(this.data, "json");
    }
    /** @returns {number} */
    getFilesCount = () => this.filesCount;
    /** @returns {Record<string, object>} */
    getJsonData = () => this.jsonData;
    getRawData() {
        if (!this.rawData) {
            this.rawData = this.traverseObject(this.data, "raw");
        }
        return this.rawData;
    }
    getFormData() {
        const objectForFormData = this.getRawData() || {};
        objectForFormData.json = JSON.stringify(this.getJsonData());
        const formData = objectToFormData.serialize(objectForFormData);
        return formData;
    }
    /**
     * @param {any} value
     * @param {string} type
     * @returns
     */
    convertDynamic(value, type) {
        if (Array.isArray(value)) {
            return this.traverseArray(value, type);
        }
        else if (typeof value == "object" && value !== null && value.constructor.name == "Object") {
            return this.traverseObject(value, type);
        }
        else {
            return value;
        }
    }
    /**
     * @param {any} object
     * @param {string} type
     * @returns {boolean}
     */
    shouldSkip(object, type) {
        if (type == "json" && object instanceof File) {
            this.filesCount += 1;
            return true;
        }
        if (type == "raw" && !Array.isArray(object) && !this.isObject(object) && !(object instanceof File)) {
            return true;
        }
        return false;
    }
    /**
     * @param {any} value
     * @returns {boolean}
     */
    isObject(value) {
        if (typeof value == "object" && value !== null && value.constructor.name == "Object") {
            return true;
        }
        return false;
    }
    /**
     * @param {Array<any>} array
     * @param {string} type
     * @returns {Array<any>}
     */
    traverseArray(array, type) {
        const newArray = [];
        for (const value of array) {
            if (this.shouldSkip(value, type)) {
                continue;
            }
            if (Array.isArray(value)) {
                newArray.push(this.convertDynamic(value, type));
            }
            else if (this.isObject(value)) {
                newArray.push(this.convertDynamic(value, type));
            }
            else {
                newArray.push(value);
            }
        }
        return newArray;
    }
    /**
     * @param {Record<any, any>} object
     * @param {string} type
     * @returns {Record<any, any>}
     */
    traverseObject(object, type) {
        const newObject = {};
        for (const key in object) {
            const value = object[key];
            if (this.shouldSkip(value, type)) {
                continue;
            }
            if (Array.isArray(value)) {
                newObject[key] = this.convertDynamic(value, type);
            }
            else if (this.isObject(value)) {
                newObject[key] = this.convertDynamic(value, type);
            }
            else {
                newObject[key] = value;
            }
        }
        return newObject;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbWFuZC1zdWJtaXQtZGF0YS5qcyIsInNvdXJjZVJvb3QiOiIvc3JjLyIsInNvdXJjZXMiOlsiY29tbWFuZC1zdWJtaXQtZGF0YS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLGdCQUFnQixNQUFNLG9CQUFvQixDQUFBO0FBRWpELE1BQU0sQ0FBQyxPQUFPLE9BQU8seUJBQXlCO0lBQzVDOzs7O09BSUc7SUFDSCxZQUFhLElBQUk7UUFDZixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQTtRQUNoQixJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQTtRQUNuQixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQTtJQUN4RCxDQUFDO0lBRUQsd0JBQXdCO0lBQ3hCLGFBQWEsR0FBRyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFBO0lBRXJDLHdDQUF3QztJQUN4QyxXQUFXLEdBQUcsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQTtJQUVqQyxVQUFVO1FBQ1IsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNsQixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQTtRQUN0RCxDQUFDO1FBRUQsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFBO0lBQ3JCLENBQUM7SUFFRCxXQUFXO1FBQ1QsTUFBTSxpQkFBaUIsR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksRUFBRSxDQUFBO1FBRWpELGlCQUFpQixDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFBO1FBRTNELE1BQU0sUUFBUSxHQUFHLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFB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QUFDO1lBRUQsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7Z0JBQ3pCLFNBQVMsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQTtZQUNuRCxDQUFDO2lCQUFNLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO2dCQUNoQyxTQUFTLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUE7WUFDbkQsQ0FBQztpQkFBTSxDQUFDO2dCQUNOLFNBQVMsQ0FBQyxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUE7WUFDeEIsQ0FBQztRQUNILENBQUM7UUFFRCxPQUFPLFNBQVMsQ0FBQTtJQUNsQixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgb2JqZWN0VG9Gb3JtRGF0YSBmcm9tIFwib2JqZWN0LXRvLWZvcm1kYXRhXCJcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpTWFrZXJDb21tYW5kU3VibWl0RGF0YSB7XG4gIC8qKlxuICAgKiBAcGFyYW0ge29iamVjdH0gZGF0YVxuICAgKiBAcGFyYW0ge1JlY29yZDxzdHJpbmcsIGFueT59IFtkYXRhLmdsb2JhbF1cbiAgICogQHBhcmFtIHtpbXBvcnQoXCIuL2NvbW1hbmRzLXBvb2wuanNcIikuUG9vbERhdGFUeXBlfSBkYXRhLnBvb2xcbiAgICovXG4gIGNvbnN0cnVjdG9yIChkYXRhKSB7XG4gICAgdGhpcy5kYXRhID0gZGF0YVxuICAgIHRoaXMuZmlsZXNDb3VudCA9IDBcbiAgICB0aGlzLmpzb25EYXRhID0gdGhpcy50cmF2ZXJzZU9iamVjdCh0aGlzLmRhdGEsIFwianNvblwiKVxuICB9XG5cbiAgLyoqIEByZXR1cm5zIHtudW1iZXJ9ICovXG4gIGdldEZpbGVzQ291bnQgPSAoKSA9PiB0aGlzLmZpbGVzQ291bnRcblxuICAvKiogQHJldHVybnMge1JlY29yZDxzdHJpbmcsIG9iamVjdD59ICovXG4gIGdldEpzb25EYXRhID0gKCkgPT4gdGhpcy5qc29uRGF0YVxuXG4gIGdldFJhd0RhdGEgKCkge1xuICAgIGlmICghdGhpcy5yYXdEYXRhKSB7XG4gICAgICB0aGlzLnJhd0RhdGEgPSB0aGlzLnRyYXZlcnNlT2JqZWN0KHRoaXMuZGF0YSwgXCJyYXdcIilcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5yYXdEYXRhXG4gIH1cblxuICBnZXRGb3JtRGF0YSAoKSB7XG4gICAgY29uc3Qgb2JqZWN0Rm9yRm9ybURhdGEgPSB0aGlzLmdldFJhd0RhdGEoKSB8fCB7fVxuXG4gICAgb2JqZWN0Rm9yRm9ybURhdGEuanNvbiA9IEpTT04uc3RyaW5naWZ5KHRoaXMuZ2V0SnNvbkRhdGEoKSlcblxuICAgIGNvbnN0IGZvcm1EYXRhID0gb2JqZWN0VG9Gb3JtRGF0YS5zZXJpYWxpemUob2JqZWN0Rm9yRm9ybURhdGEpXG5cbiAgICByZXR1cm4gZm9ybURhdGFcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0ge2FueX0gdmFsdWVcbiAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGVcbiAgICogQHJldHVybnNcbiAgICovXG4gIGNvbnZlcnREeW5hbWljKHZhbHVlLCB0eXBlKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICByZXR1cm4gdGhpcy50cmF2ZXJzZUFycmF5KHZhbHVlLCB0eXBlKVxuICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09IFwib2JqZWN0XCIgJiYgdmFsdWUgIT09IG51bGwgJiYgdmFsdWUuY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG4gICAgICByZXR1cm4gdGhpcy50cmF2ZXJzZU9iamVjdCh2YWx1ZSwgdHlwZSlcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHZhbHVlXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7YW55fSBvYmplY3RcbiAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGVcbiAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAqL1xuICBzaG91bGRTa2lwKG9iamVjdCwgdHlwZSkge1xuICAgIGlmICh0eXBlID09IFwianNvblwiICYmIG9iamVjdCBpbnN0YW5jZW9mIEZpbGUpIHtcbiAgICAgIHRoaXMuZmlsZXNDb3VudCArPSAxXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cblxuICAgIGlmICh0eXBlID09IFwicmF3XCIgJiYgIUFycmF5LmlzQXJyYXkob2JqZWN0KSAmJiAhdGhpcy5pc09iamVjdChvYmplY3QpICYmICEob2JqZWN0IGluc3RhbmNlb2YgRmlsZSkpIHtcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHthbnl9IHZhbHVlXG4gICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgKi9cbiAgaXNPYmplY3QodmFsdWUpIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09IFwib2JqZWN0XCIgJiYgdmFsdWUgIT09IG51bGwgJiYgdmFsdWUuY29uc3RydWN0b3IubmFtZSA9PSBcIk9iamVjdFwiKSB7XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cblxuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7QXJyYXk8YW55Pn0gYXJyYXlcbiAgICogQHBhcmFtIHtzdHJpbmd9IHR5cGVcbiAgICogQHJldHVybnMge0FycmF5PGFueT59XG4gICAqL1xuICB0cmF2ZXJzZUFycmF5KGFycmF5LCB0eXBlKSB7XG4gICAgY29uc3QgbmV3QXJyYXkgPSBbXVxuXG4gICAgZm9yIChjb25zdCB2YWx1ZSBvZiBhcnJheSkge1xuICAgICAgaWYgKHRoaXMuc2hvdWxkU2tpcCh2YWx1ZSwgdHlwZSkpIHtcbiAgICAgICAgY29udGludWVcbiAgICAgIH1cblxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgIG5ld0FycmF5LnB1c2godGhpcy5jb252ZXJ0RHluYW1pYyh2YWx1ZSwgdHlwZSkpXG4gICAgICB9IGVsc2UgaWYgKHRoaXMuaXNPYmplY3QodmFsdWUpKSB7XG4gICAgICAgIG5ld0FycmF5LnB1c2godGhpcy5jb252ZXJ0RHluYW1pYyh2YWx1ZSwgdHlwZSkpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXdBcnJheS5wdXNoKHZhbHVlKVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBuZXdBcnJheVxuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7UmVjb3JkPGFueSwgYW55Pn0gb2JqZWN0XG4gICAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlXG4gICAqIEByZXR1cm5zIHtSZWNvcmQ8YW55LCBhbnk+fVxuICAgKi9cbiAgdHJhdmVyc2VPYmplY3Qob2JqZWN0LCB0eXBlKSB7XG4gICAgY29uc3QgbmV3T2JqZWN0ID0ge31cblxuICAgIGZvciAoY29uc3Qga2V5IGluIG9iamVjdCkge1xuICAgICAgY29uc3QgdmFsdWUgPSBvYmplY3Rba2V5XVxuXG4gICAgICBpZiAodGhpcy5zaG91bGRTa2lwKHZhbHVlLCB0eXBlKSkge1xuICAgICAgICBjb250aW51ZVxuICAgICAgfVxuXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgbmV3T2JqZWN0W2tleV0gPSB0aGlzLmNvbnZlcnREeW5hbWljKHZhbHVlLCB0eXBlKVxuICAgICAgfSBlbHNlIGlmICh0aGlzLmlzT2JqZWN0KHZhbHVlKSkge1xuICAgICAgICBuZXdPYmplY3Rba2V5XSA9IHRoaXMuY29udmVydER5bmFtaWModmFsdWUsIHR5cGUpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXdPYmplY3Rba2V5XSA9IHZhbHVlXG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ld09iamVjdFxuICB9XG59XG4iXX0=