import { digg } from "diggerize";
export default class Serializer {
    static serialize(arg) {
        const serialize = new Serializer(arg);
        return serialize.serialize();
    }
    constructor(arg) {
        this.arg = arg;
    }
    serialize() {
        return this.serializeArgument(this.arg);
    }
    serializeArgument(arg) {
        if (typeof arg == "object" && arg && arg.constructor.apiMakerType == "BaseModel") {
            return {
                api_maker_type: "model",
                model_class_name: digg(arg.modelClassData(), "name"),
                model_id: arg.id()
            };
        }
        else if (typeof arg == "function" && arg.apiMakerType == "BaseModel") {
            return {
                api_maker_type: "resource",
                name: digg(arg.modelClassData(), "name")
            };
        }
        else if (arg instanceof Date) {
            let offsetNumber = parseInt((arg.getTimezoneOffset() / 60) * 100, 10);
            offsetNumber = -offsetNumber;
            let offset = `${offsetNumber}`;
            while (offset.length < 4) {
                offset = `0${offset}`;
            }
            return {
                api_maker_type: "datetime",
                value: `${arg.getFullYear()}-${arg.getMonth() + 1}-${arg.getDate()} ${arg.getHours()}:${arg.getMinutes()}:${arg.getSeconds()}+${offset}`
            };
        }
        else if (Array.isArray(arg)) {
            return this.serializeArray(arg);
        }
        else if (typeof arg == "object" && arg && arg.constructor && arg.constructor.apiMakerType == "Collection") {
            return {
                api_maker_type: "collection",
                value: this.serializeObject(arg)
            };
        }
        else if (typeof arg == "object" && arg !== null && arg.constructor.name == "Object") {
            return this.serializeObject(arg);
        }
        else {
            return arg;
        }
    }
    serializeArray(arg) {
        return arg.map((value) => this.serializeArgument(value));
    }
    serializeObject(arg) {
        const newObject = {};
        for (const key in arg) {
            const value = arg[key];
            const newValue = this.serializeArgument(value);
            const newKey = this.serializeArgument(key);
            newObject[newKey] = newValue;
        }
        return newObject;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VyaWFsaXplci5qcyIsInNvdXJjZVJvb3QiOiIvc3JjLyIsInNvdXJjZXMiOlsic2VyaWFsaXplci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsSUFBSSxFQUFDLE1BQU0sV0FBVyxDQUFBO0FBRTlCLE1BQU0sQ0FBQyxPQUFPLE9BQU8sVUFBVTtJQUM3QixNQUFNLENBQUMsU0FBUyxDQUFFLEdBQUc7UUFDbkIsTUFBTSxTQUFTLEdBQUcsSUFBSSxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUE7UUFFckMsT0FBTyxTQUFTLENBQUMsU0FBUyxFQUFFLENBQUE7SUFDOUIsQ0FBQztJQUVELFlBQWEsR0FBRztRQUNkLElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFBO0lBQ2hCLENBQUM7SUFFRCxTQUFTO1FBQ1AsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQ3pDLENBQUM7SUFFRCxpQkFBaUIsQ0FBRSxHQUFHO1FBQ3BCLElBQUksT0FBTyxHQUFHLElBQUksUUFBUSxJQUFJLEdBQUcsSUFBSSxHQUFHLENBQUMsV0FBVyxDQUFDLFlBQVksSUFBSSxXQUFXLEVBQUUsQ0FBQztZQUNqRixPQUFPO2dCQUNMLGNBQWMsRUFBRSxPQUFPO2dCQUN2QixnQkFBZ0IsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxFQUFFLE1BQU0sQ0FBQztnQkFDcEQsUUFBUSxFQUFFLEdBQUcsQ0FBQyxFQUFFLEVBQUU7YUFDbkIsQ0FBQTtRQUNILENBQUM7YUFBTSxJQUFJLE9BQU8sR0FBRyxJQUFJLFVBQVUsSUFBSSxHQUFHLENBQUMsWUFBWSxJQUFJLFdBQVcsRUFBRSxDQUFDO1lBQ3ZFLE9BQU87Z0JBQ0wsY0FBYyxFQUFFLFVBQVU7Z0JBQzFCLElBQUksRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxFQUFFLE1BQU0sQ0FBQzthQUN6QyxDQUFBO1FBQ0gsQ0FBQzthQUFNLElBQUksR0FBRyxZQUFZLElBQUksRUFBRSxDQUFDO1lBQy9CLElBQUksWUFBWSxHQUFHLFFBQVEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQTtZQUVyRSxZQUFZLEdBQUcsQ0FBQyxZQUFZLENBQUE7WUFFNUIsSUFBSSxNQUFNLEdBQUcsR0FBRyxZQUFZLEVBQUUsQ0FBQTtZQUU5QixPQUFPLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQ3pCLE1BQU0sR0FBRyxJQUFJLE1BQU0sRUFBRSxDQUFBO1lBQ3ZCLENBQUM7WUFFRCxPQUFPO2dCQUNMLGNBQWMsRUFBRSxVQUFVO2dCQUMxQixLQUFLLEVBQUUsR0FBRyxHQUFHLENBQUMsV0FBVyxFQUFFLElBQUksR0FBRyxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsT0FBTyxFQUFFLElBQUksR0FBRyxDQUFDLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxVQUFVLEVBQUUsSUFBSSxHQUFHLENBQUMsVUFBVSxFQUFFLElBQUksTUFBTSxFQUFFO2FBQ3pJLENBQUE7UUFDSCxDQUFDO2FBQU0sSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDOUIsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQ2pDLENBQUM7YUFBTSxJQUFJLE9BQU8sR0FBRyxJQUFJLFFBQVEsSUFBSSxHQUFHLElBQUksR0FBRyxDQUFDLFdBQVcsSUFBSSxHQUFHLENBQUMsV0FBVyxDQUFDLFlBQVksSUFBSSxZQUFZLEVBQUUsQ0FBQztZQUM1RyxPQUFPO2dCQUNMLGNBQWMsRUFBRSxZQUFZO2dCQUM1QixLQUFLLEVBQUUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUM7YUFDakMsQ0FBQTtRQUNILENBQUM7YUFBTSxJQUFJLE9BQU8sR0FBRyxJQUFJLFFBQVEsSUFBSSxHQUFHLEtBQUssSUFBSSxJQUFJLEdBQUcsQ0FBQyxXQUFXLENBQUMsSUFBSSxJQUFJLFFBQVEsRUFBRSxDQUFDO1lBQ3RGLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUNsQyxDQUFDO2FBQU0sQ0FBQztZQUNOLE9BQU8sR0FBRyxDQUFBO1FBQ1osQ0FBQztJQUNILENBQUM7SUFFRCxjQUFjLENBQUUsR0FBRztRQUNqQixPQUFPLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO0lBQzFELENBQUM7SUFFRCxlQUFlLENBQUUsR0FBRztRQUNsQixNQUFNLFNBQVMsR0FBRyxFQUFFLENBQUE7UUFFcEIsS0FBSyxNQUFNLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztZQUN0QixNQUFNLEtBQUssR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDdEIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxDQUFBO1lBQzlDLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsQ0FBQTtZQUUxQyxTQUFTLENBQUMsTUFBTSxDQUFDLEdBQUcsUUFBUSxDQUFBO1FBQzlCLENBQUM7UUFFRCxPQUFPLFNBQVMsQ0FBQTtJQUNsQixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2RpZ2d9IGZyb20gXCJkaWdnZXJpemVcIlxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTZXJpYWxpemVyIHtcbiAgc3RhdGljIHNlcmlhbGl6ZSAoYXJnKSB7XG4gICAgY29uc3Qgc2VyaWFsaXplID0gbmV3IFNlcmlhbGl6ZXIoYXJnKVxuXG4gICAgcmV0dXJuIHNlcmlhbGl6ZS5zZXJpYWxpemUoKVxuICB9XG5cbiAgY29uc3RydWN0b3IgKGFyZykge1xuICAgIHRoaXMuYXJnID0gYXJnXG4gIH1cblxuICBzZXJpYWxpemUgKCkge1xuICAgIHJldHVybiB0aGlzLnNlcmlhbGl6ZUFyZ3VtZW50KHRoaXMuYXJnKVxuICB9XG5cbiAgc2VyaWFsaXplQXJndW1lbnQgKGFyZykge1xuICAgIGlmICh0eXBlb2YgYXJnID09IFwib2JqZWN0XCIgJiYgYXJnICYmIGFyZy5jb25zdHJ1Y3Rvci5hcGlNYWtlclR5cGUgPT0gXCJCYXNlTW9kZWxcIikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYXBpX21ha2VyX3R5cGU6IFwibW9kZWxcIixcbiAgICAgICAgbW9kZWxfY2xhc3NfbmFtZTogZGlnZyhhcmcubW9kZWxDbGFzc0RhdGEoKSwgXCJuYW1lXCIpLFxuICAgICAgICBtb2RlbF9pZDogYXJnLmlkKClcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcmcgPT0gXCJmdW5jdGlvblwiICYmIGFyZy5hcGlNYWtlclR5cGUgPT0gXCJCYXNlTW9kZWxcIikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYXBpX21ha2VyX3R5cGU6IFwicmVzb3VyY2VcIixcbiAgICAgICAgbmFtZTogZGlnZyhhcmcubW9kZWxDbGFzc0RhdGEoKSwgXCJuYW1lXCIpXG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChhcmcgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICBsZXQgb2Zmc2V0TnVtYmVyID0gcGFyc2VJbnQoKGFyZy5nZXRUaW1lem9uZU9mZnNldCgpIC8gNjApICogMTAwLCAxMClcblxuICAgICAgb2Zmc2V0TnVtYmVyID0gLW9mZnNldE51bWJlclxuXG4gICAgICBsZXQgb2Zmc2V0ID0gYCR7b2Zmc2V0TnVtYmVyfWBcblxuICAgICAgd2hpbGUgKG9mZnNldC5sZW5ndGggPCA0KSB7XG4gICAgICAgIG9mZnNldCA9IGAwJHtvZmZzZXR9YFxuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBhcGlfbWFrZXJfdHlwZTogXCJkYXRldGltZVwiLFxuICAgICAgICB2YWx1ZTogYCR7YXJnLmdldEZ1bGxZZWFyKCl9LSR7YXJnLmdldE1vbnRoKCkgKyAxfS0ke2FyZy5nZXREYXRlKCl9ICR7YXJnLmdldEhvdXJzKCl9OiR7YXJnLmdldE1pbnV0ZXMoKX06JHthcmcuZ2V0U2Vjb25kcygpfSske29mZnNldH1gXG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGFyZykpIHtcbiAgICAgIHJldHVybiB0aGlzLnNlcmlhbGl6ZUFycmF5KGFyZylcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcmcgPT0gXCJvYmplY3RcIiAmJiBhcmcgJiYgYXJnLmNvbnN0cnVjdG9yICYmIGFyZy5jb25zdHJ1Y3Rvci5hcGlNYWtlclR5cGUgPT0gXCJDb2xsZWN0aW9uXCIpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFwaV9tYWtlcl90eXBlOiBcImNvbGxlY3Rpb25cIixcbiAgICAgICAgdmFsdWU6IHRoaXMuc2VyaWFsaXplT2JqZWN0KGFyZylcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcmcgPT0gXCJvYmplY3RcIiAmJiBhcmcgIT09IG51bGwgJiYgYXJnLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJPYmplY3RcIikge1xuICAgICAgcmV0dXJuIHRoaXMuc2VyaWFsaXplT2JqZWN0KGFyZylcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGFyZ1xuICAgIH1cbiAgfVxuXG4gIHNlcmlhbGl6ZUFycmF5IChhcmcpIHtcbiAgICByZXR1cm4gYXJnLm1hcCgodmFsdWUpID0+IHRoaXMuc2VyaWFsaXplQXJndW1lbnQodmFsdWUpKVxuICB9XG5cbiAgc2VyaWFsaXplT2JqZWN0IChhcmcpIHtcbiAgICBjb25zdCBuZXdPYmplY3QgPSB7fVxuXG4gICAgZm9yIChjb25zdCBrZXkgaW4gYXJnKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IGFyZ1trZXldXG4gICAgICBjb25zdCBuZXdWYWx1ZSA9IHRoaXMuc2VyaWFsaXplQXJndW1lbnQodmFsdWUpXG4gICAgICBjb25zdCBuZXdLZXkgPSB0aGlzLnNlcmlhbGl6ZUFyZ3VtZW50KGtleSlcblxuICAgICAgbmV3T2JqZWN0W25ld0tleV0gPSBuZXdWYWx1ZVxuICAgIH1cblxuICAgIHJldHVybiBuZXdPYmplY3RcbiAgfVxufVxuIl19