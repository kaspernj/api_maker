import Params from "./params.js";
const shared = {};
export default class KeyValueStore {
    static current() {
        if (!shared.currentKeyValueStore)
            shared.currentKeyValueStore = new KeyValueStore();
        return shared.currentKeyValueStore;
    }
    static get(key) {
        return KeyValueStore.current().get(key);
    }
    static set(key, value) {
        return KeyValueStore.current().set(key, value);
    }
    static async getCachedParams(paramName, args = {}) {
        const oldQuery = await KeyValueStore.get(paramName);
        const params = Params.parse();
        if (params && paramName in params) {
            return params[paramName];
        }
        else if (oldQuery) {
            return oldQuery;
        }
        else {
            return args.default || {};
        }
    }
    static setCachedParams(paramName, qParams) {
        return KeyValueStore.set(paramName, qParams);
    }
    constructor() {
        this.database = new Dexie("KeyValueStoreDatabase");
        this.database.version(1).stores({
            keyValues: "++id, key, value"
        });
    }
    async get(key) {
        const row = await this.database.keyValues
            .where("key")
            .equals(key)
            .first();
        if (row)
            return row.value;
    }
    async set(key, value) {
        const row = await this.database.keyValues
            .where("key")
            .equals(key)
            .first();
        if (row) {
            await this.database.keyValues.update(row.id, { value });
        }
        else {
            await this.database.keyValues.add({ key, value });
        }
        return true;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia2V5LXZhbHVlLXN0b3JlLmpzIiwic291cmNlUm9vdCI6Ii9zcmMvIiwic291cmNlcyI6WyJrZXktdmFsdWUtc3RvcmUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxNQUFNLE1BQU0sYUFBYSxDQUFBO0FBRWhDLE1BQU0sTUFBTSxHQUFHLEVBQUUsQ0FBQTtBQUVqQixNQUFNLENBQUMsT0FBTyxPQUFPLGFBQWE7SUFDaEMsTUFBTSxDQUFDLE9BQU87UUFDWixJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFvQjtZQUFFLE1BQU0sQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLGFBQWEsRUFBRSxDQUFBO1FBRW5GLE9BQU8sTUFBTSxDQUFDLG9CQUFvQixDQUFBO0lBQ3BDLENBQUM7SUFFRCxNQUFNLENBQUMsR0FBRyxDQUFFLEdBQUc7UUFDYixPQUFPLGFBQWEsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDekMsQ0FBQztJQUVELE1BQU0sQ0FBQyxHQUFHLENBQUUsR0FBRyxFQUFFLEtBQUs7UUFDcEIsT0FBTyxhQUFhLENBQUMsT0FBTyxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQTtJQUNoRCxDQUFDO0lBRUQsTUFBTSxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUUsU0FBUyxFQUFFLElBQUksR0FBRyxFQUFFO1FBQ2hELE1BQU0sUUFBUSxHQUFHLE1BQU0sYUFBYSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQTtRQUNuRCxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUE7UUFFN0IsSUFBSSxNQUFNLElBQUksU0FBUyxJQUFJLE1BQU0sRUFBRSxDQUFDO1lBQ2xDLE9BQU8sTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFBO1FBQzFCLENBQUM7YUFBTSxJQUFJLFFBQVEsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sUUFBUSxDQUFBO1FBQ2pCLENBQUM7YUFBTSxDQUFDO1lBQ04sT0FBTyxJQUFJLENBQUMsT0FBTyxJQUFJLEVBQUUsQ0FBQTtRQUMzQixDQUFDO0lBQ0gsQ0FBQztJQUVELE1BQU0sQ0FBQyxlQUFlLENBQUUsU0FBUyxFQUFFLE9BQU87UUFDeEMsT0FBTyxhQUFhLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxPQUFPLENBQUMsQ0FBQTtJQUM5QyxDQUFDO0lBRUQ7UUFDRSxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksS0FBSyxDQUFDLHVCQUF1QixDQUFDLENBQUE7UUFDbEQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO1lBQzlCLFNBQVMsRUFBRSxrQkFBa0I7U0FDOUIsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUVELEtBQUssQ0FBQyxHQUFHLENBQUUsR0FBRztRQUNaLE1BQU0sR0FBRyxHQUFHLE1BQU0sSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTO2FBQ3RDLEtBQUssQ0FBQyxLQUFLLENBQUM7YUFDWixNQUFNLENBQUMsR0FBRyxDQUFDO2FBQ1gsS0FBSyxFQUFFLENBQUE7UUFFVixJQUFJLEdBQUc7WUFDTCxPQUFPLEdBQUcsQ0FBQyxLQUFLLENBQUE7SUFDcEIsQ0FBQztJQUVELEtBQUssQ0FBQyxHQUFHLENBQUUsR0FBRyxFQUFFLEtBQUs7UUFDbkIsTUFBTSxHQUFHLEdBQUcsTUFBTSxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVM7YUFDdEMsS0FBSyxDQUFDLEtBQUssQ0FBQzthQUNaLE1BQU0sQ0FBQyxHQUFHLENBQUM7YUFDWCxLQUFLLEVBQUUsQ0FBQTtRQUVWLElBQUksR0FBRyxFQUFFLENBQUM7WUFDUixNQUFNLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUMsS0FBSyxFQUFDLENBQUMsQ0FBQTtRQUN2RCxDQUFDO2FBQU0sQ0FBQztZQUNOLE1BQU0sSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLEVBQUMsR0FBRyxFQUFFLEtBQUssRUFBQyxDQUFDLENBQUE7UUFDakQsQ0FBQztRQUVELE9BQU8sSUFBSSxDQUFBO0lBQ2IsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFBhcmFtcyBmcm9tIFwiLi9wYXJhbXMuanNcIlxuXG5jb25zdCBzaGFyZWQgPSB7fVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBLZXlWYWx1ZVN0b3JlIHtcbiAgc3RhdGljIGN1cnJlbnQgKCkge1xuICAgIGlmICghc2hhcmVkLmN1cnJlbnRLZXlWYWx1ZVN0b3JlKSBzaGFyZWQuY3VycmVudEtleVZhbHVlU3RvcmUgPSBuZXcgS2V5VmFsdWVTdG9yZSgpXG5cbiAgICByZXR1cm4gc2hhcmVkLmN1cnJlbnRLZXlWYWx1ZVN0b3JlXG4gIH1cblxuICBzdGF0aWMgZ2V0IChrZXkpIHtcbiAgICByZXR1cm4gS2V5VmFsdWVTdG9yZS5jdXJyZW50KCkuZ2V0KGtleSlcbiAgfVxuXG4gIHN0YXRpYyBzZXQgKGtleSwgdmFsdWUpIHtcbiAgICByZXR1cm4gS2V5VmFsdWVTdG9yZS5jdXJyZW50KCkuc2V0KGtleSwgdmFsdWUpXG4gIH1cblxuICBzdGF0aWMgYXN5bmMgZ2V0Q2FjaGVkUGFyYW1zIChwYXJhbU5hbWUsIGFyZ3MgPSB7fSkge1xuICAgIGNvbnN0IG9sZFF1ZXJ5ID0gYXdhaXQgS2V5VmFsdWVTdG9yZS5nZXQocGFyYW1OYW1lKVxuICAgIGNvbnN0IHBhcmFtcyA9IFBhcmFtcy5wYXJzZSgpXG5cbiAgICBpZiAocGFyYW1zICYmIHBhcmFtTmFtZSBpbiBwYXJhbXMpIHtcbiAgICAgIHJldHVybiBwYXJhbXNbcGFyYW1OYW1lXVxuICAgIH0gZWxzZSBpZiAob2xkUXVlcnkpIHtcbiAgICAgIHJldHVybiBvbGRRdWVyeVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYXJncy5kZWZhdWx0IHx8IHt9XG4gICAgfVxuICB9XG5cbiAgc3RhdGljIHNldENhY2hlZFBhcmFtcyAocGFyYW1OYW1lLCBxUGFyYW1zKSB7XG4gICAgcmV0dXJuIEtleVZhbHVlU3RvcmUuc2V0KHBhcmFtTmFtZSwgcVBhcmFtcylcbiAgfVxuXG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICB0aGlzLmRhdGFiYXNlID0gbmV3IERleGllKFwiS2V5VmFsdWVTdG9yZURhdGFiYXNlXCIpXG4gICAgdGhpcy5kYXRhYmFzZS52ZXJzaW9uKDEpLnN0b3Jlcyh7XG4gICAgICBrZXlWYWx1ZXM6IFwiKytpZCwga2V5LCB2YWx1ZVwiXG4gICAgfSlcbiAgfVxuXG4gIGFzeW5jIGdldCAoa2V5KSB7XG4gICAgY29uc3Qgcm93ID0gYXdhaXQgdGhpcy5kYXRhYmFzZS5rZXlWYWx1ZXNcbiAgICAgIC53aGVyZShcImtleVwiKVxuICAgICAgLmVxdWFscyhrZXkpXG4gICAgICAuZmlyc3QoKVxuXG4gICAgaWYgKHJvdylcbiAgICAgIHJldHVybiByb3cudmFsdWVcbiAgfVxuXG4gIGFzeW5jIHNldCAoa2V5LCB2YWx1ZSkge1xuICAgIGNvbnN0IHJvdyA9IGF3YWl0IHRoaXMuZGF0YWJhc2Uua2V5VmFsdWVzXG4gICAgICAud2hlcmUoXCJrZXlcIilcbiAgICAgIC5lcXVhbHMoa2V5KVxuICAgICAgLmZpcnN0KClcblxuICAgIGlmIChyb3cpIHtcbiAgICAgIGF3YWl0IHRoaXMuZGF0YWJhc2Uua2V5VmFsdWVzLnVwZGF0ZShyb3cuaWQsIHt2YWx1ZX0pXG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IHRoaXMuZGF0YWJhc2Uua2V5VmFsdWVzLmFkZCh7a2V5LCB2YWx1ZX0pXG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWVcbiAgfVxufVxuIl19