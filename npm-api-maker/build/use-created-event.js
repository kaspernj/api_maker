import debounceFunction from "debounce"; // eslint-disable-line sort-imports
import ModelEvents from "./model-events.js";
import PropTypes from "prop-types"; // eslint-disable-line sort-imports
import propTypesExact from "prop-types-exact";
import { useCallback, useLayoutEffect } from "react"; // eslint-disable-line sort-imports
import useShape from "set-state-compare/build/use-shape.js";
/**
 * @param {function} modelClass
 * @param {function} onCreated
 * @param {object} [args]
 * @param {boolean} [args.active]
 * @param {number} [args.debounce]
 * @param {function} [args.onConnected]
 * @returns {void}
 */
const ApiMakerUseCreatedEvent = (modelClass, onCreated, args = { active: true, debounce: 0, onConnected: undefined }) => {
    const { active = true, debounce } = args;
    const s = useShape({ active, debounce, modelClass, onCreated });
    const eventDebounce = useCallback(() => {
        if (!s.meta.debounceInstance) {
            if (typeof s.props.debounce == "number") {
                s.meta.debounceInstance = debounceFunction(s.p.onCreated, s.p.debounce);
            }
            else {
                s.meta.debounceInstance = debounceFunction(s.p.onCreated);
            }
        }
        return s.meta.debounceInstance;
    }, []);
    const onCreatedCallback = useCallback((...args) => {
        if (!s.p.active) {
            return;
        }
        if (s.p.debounce) {
            eventDebounce()(...args);
        }
        else {
            s.p.onCreated(...args);
        }
    }, []);
    useLayoutEffect(() => {
        const connectCreated = ModelEvents.connectCreated(s.p.modelClass, (...args) => onCreatedCallback(...args));
        return () => {
            connectCreated.unsubscribe();
        };
    }, []);
};
ApiMakerUseCreatedEvent.propTypes = propTypesExact({
    active: PropTypes.bool.isRequired,
    debounce: PropTypes.oneOfType([
        PropTypes.bool,
        PropTypes.number
    ]),
    modelClass: PropTypes.func.isRequired,
    onCreated: PropTypes.func.isRequired
});
export default ApiMakerUseCreatedEvent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlLWNyZWF0ZWQtZXZlbnQuanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbInVzZS1jcmVhdGVkLWV2ZW50LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sZ0JBQWdCLE1BQU0sVUFBVSxDQUFBLENBQUMsbUNBQW1DO0FBQzNFLE9BQU8sV0FBVyxNQUFNLG1CQUFtQixDQUFBO0FBQzNDLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQSxDQUFDLG1DQUFtQztBQUN0RSxPQUFPLGNBQWMsTUFBTSxrQkFBa0IsQ0FBQTtBQUM3QyxPQUFPLEVBQUMsV0FBVyxFQUFFLGVBQWUsRUFBQyxNQUFNLE9BQU8sQ0FBQSxDQUFDLG1DQUFtQztBQUN0RixPQUFPLFFBQVEsTUFBTSxzQ0FBc0MsQ0FBQTtBQUUzRDs7Ozs7Ozs7R0FRRztBQUNILE1BQU0sdUJBQXVCLEdBQUcsQ0FBQyxVQUFVLEVBQUUsU0FBUyxFQUFFLElBQUksR0FBRyxFQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFDLEVBQUUsRUFBRTtJQUNwSCxNQUFNLEVBQUMsTUFBTSxHQUFHLElBQUksRUFBRSxRQUFRLEVBQUMsR0FBRyxJQUFJLENBQUE7SUFDdEMsTUFBTSxDQUFDLEdBQUcsUUFBUSxDQUFDLEVBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFDLENBQUMsQ0FBQTtJQUU3RCxNQUFNLGFBQWEsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFO1FBQ3JDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDN0IsSUFBSSxPQUFPLENBQUMsQ0FBQyxLQUFLLENBQUMsUUFBUSxJQUFJLFFBQVEsRUFBRSxDQUFDO2dCQUN4QyxDQUFDLENBQUMsSUFBSSxDQUFDLGdCQUFnQixHQUFHLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUE7WUFDekUsQ0FBQztpQkFBTSxDQUFDO2dCQUNOLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQTtZQUMzRCxDQUFDO1FBQ0gsQ0FBQztRQUVELE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQTtJQUNoQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUE7SUFFTixNQUFNLGlCQUFpQixHQUFHLFdBQVcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxFQUFFLEVBQUU7UUFDaEQsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDaEIsT0FBTTtRQUNSLENBQUM7UUFFRCxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDakIsYUFBYSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQTtRQUMxQixDQUFDO2FBQU0sQ0FBQztZQUNOLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUE7UUFDeEIsQ0FBQztJQUNILENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQTtJQUVOLGVBQWUsQ0FBQyxHQUFHLEVBQUU7UUFDbkIsTUFBTSxjQUFjLEdBQUcsV0FBVyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDLEdBQUcsSUFBSSxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUE7UUFFMUcsT0FBTyxHQUFHLEVBQUU7WUFDVixjQUFjLENBQUMsV0FBVyxFQUFFLENBQUE7UUFDOUIsQ0FBQyxDQUFBO0lBQ0gsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFBO0FBQ1IsQ0FBQyxDQUFBO0FBRUQsdUJBQXVCLENBQUMsU0FBUyxHQUFHLGNBQWMsQ0FBQztJQUNqRCxNQUFNLEVBQUUsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVO0lBQ2pDLFFBQVEsRUFBRSxTQUFTLENBQUMsU0FBUyxDQUFDO1FBQzVCLFNBQVMsQ0FBQyxJQUFJO1FBQ2QsU0FBUyxDQUFDLE1BQU07S0FDakIsQ0FBQztJQUNGLFVBQVUsRUFBRSxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVU7SUFDckMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVTtDQUNyQyxDQUFDLENBQUE7QUFFRixlQUFlLHVCQUF1QixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGRlYm91bmNlRnVuY3Rpb24gZnJvbSBcImRlYm91bmNlXCIgLy8gZXNsaW50LWRpc2FibGUtbGluZSBzb3J0LWltcG9ydHNcbmltcG9ydCBNb2RlbEV2ZW50cyBmcm9tIFwiLi9tb2RlbC1ldmVudHMuanNcIlxuaW1wb3J0IFByb3BUeXBlcyBmcm9tIFwicHJvcC10eXBlc1wiIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgc29ydC1pbXBvcnRzXG5pbXBvcnQgcHJvcFR5cGVzRXhhY3QgZnJvbSBcInByb3AtdHlwZXMtZXhhY3RcIlxuaW1wb3J0IHt1c2VDYWxsYmFjaywgdXNlTGF5b3V0RWZmZWN0fSBmcm9tIFwicmVhY3RcIiAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHNvcnQtaW1wb3J0c1xuaW1wb3J0IHVzZVNoYXBlIGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC91c2Utc2hhcGUuanNcIlxuXG4vKipcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IG1vZGVsQ2xhc3NcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IG9uQ3JlYXRlZFxuICogQHBhcmFtIHtvYmplY3R9IFthcmdzXVxuICogQHBhcmFtIHtib29sZWFufSBbYXJncy5hY3RpdmVdXG4gKiBAcGFyYW0ge251bWJlcn0gW2FyZ3MuZGVib3VuY2VdXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBbYXJncy5vbkNvbm5lY3RlZF1cbiAqIEByZXR1cm5zIHt2b2lkfVxuICovXG5jb25zdCBBcGlNYWtlclVzZUNyZWF0ZWRFdmVudCA9IChtb2RlbENsYXNzLCBvbkNyZWF0ZWQsIGFyZ3MgPSB7YWN0aXZlOiB0cnVlLCBkZWJvdW5jZTogMCwgb25Db25uZWN0ZWQ6IHVuZGVmaW5lZH0pID0+IHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZWFjdC9mdW5jdGlvbi1jb21wb25lbnQtZGVmaW5pdGlvblxuICBjb25zdCB7YWN0aXZlID0gdHJ1ZSwgZGVib3VuY2V9ID0gYXJnc1xuICBjb25zdCBzID0gdXNlU2hhcGUoe2FjdGl2ZSwgZGVib3VuY2UsIG1vZGVsQ2xhc3MsIG9uQ3JlYXRlZH0pXG5cbiAgY29uc3QgZXZlbnREZWJvdW5jZSA9IHVzZUNhbGxiYWNrKCgpID0+IHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHNcbiAgICBpZiAoIXMubWV0YS5kZWJvdW5jZUluc3RhbmNlKSB7XG4gICAgICBpZiAodHlwZW9mIHMucHJvcHMuZGVib3VuY2UgPT0gXCJudW1iZXJcIikge1xuICAgICAgICBzLm1ldGEuZGVib3VuY2VJbnN0YW5jZSA9IGRlYm91bmNlRnVuY3Rpb24ocy5wLm9uQ3JlYXRlZCwgcy5wLmRlYm91bmNlKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcy5tZXRhLmRlYm91bmNlSW5zdGFuY2UgPSBkZWJvdW5jZUZ1bmN0aW9uKHMucC5vbkNyZWF0ZWQpXG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHMubWV0YS5kZWJvdW5jZUluc3RhbmNlXG4gIH0sIFtdKVxuXG4gIGNvbnN0IG9uQ3JlYXRlZENhbGxiYWNrID0gdXNlQ2FsbGJhY2soKC4uLmFyZ3MpID0+IHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHNcbiAgICBpZiAoIXMucC5hY3RpdmUpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGlmIChzLnAuZGVib3VuY2UpIHtcbiAgICAgIGV2ZW50RGVib3VuY2UoKSguLi5hcmdzKVxuICAgIH0gZWxzZSB7XG4gICAgICBzLnAub25DcmVhdGVkKC4uLmFyZ3MpXG4gICAgfVxuICB9LCBbXSlcblxuICB1c2VMYXlvdXRFZmZlY3QoKCkgPT4geyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlYWN0LWhvb2tzL2V4aGF1c3RpdmUtZGVwc1xuICAgIGNvbnN0IGNvbm5lY3RDcmVhdGVkID0gTW9kZWxFdmVudHMuY29ubmVjdENyZWF0ZWQocy5wLm1vZGVsQ2xhc3MsICguLi5hcmdzKSA9PiBvbkNyZWF0ZWRDYWxsYmFjayguLi5hcmdzKSlcblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBjb25uZWN0Q3JlYXRlZC51bnN1YnNjcmliZSgpXG4gICAgfVxuICB9LCBbXSlcbn1cblxuQXBpTWFrZXJVc2VDcmVhdGVkRXZlbnQucHJvcFR5cGVzID0gcHJvcFR5cGVzRXhhY3Qoe1xuICBhY3RpdmU6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsXG4gIGRlYm91bmNlOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtcbiAgICBQcm9wVHlwZXMuYm9vbCxcbiAgICBQcm9wVHlwZXMubnVtYmVyXG4gIF0pLFxuICBtb2RlbENsYXNzOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICBvbkNyZWF0ZWQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWRcbn0pXG5cbmV4cG9ydCBkZWZhdWx0IEFwaU1ha2VyVXNlQ3JlYXRlZEV2ZW50XG4iXX0=