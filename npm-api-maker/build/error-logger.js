import { digg } from "diggerize";
import SourceMapsLoader from "./source-maps-loader.js";
export default class ErrorLogger {
    constructor() {
        this.debugging = false;
        this.errorOccurred = false;
        this.errors = [];
        this.isHandlingError = false;
        this.sourceMapsLoader = new SourceMapsLoader();
        this.sourceMapsLoader.loadSourceMapsForScriptTags((script) => {
            const src = script.getAttribute("src");
            const type = script.getAttribute("type");
            if (src && (src.includes("/packs/") || src.includes("/packs-test/")) && (type == "text/javascript" || !type)) {
                return src;
            }
        });
    }
    debug(...output) {
        if (this.debugging)
            console.error(`ApiMaker ErrorLogger:`, ...output);
    }
    enable() {
        this.debug("Enable called");
        this.connectOnError();
        this.connectUnhandledRejection();
    }
    getErrors = () => this.errors;
    hasErrorOccurred = () => digg(this, "errorOccurred");
    isLoadingSourceMaps = () => digg(this, "sourceMapsLoader", "isLoadingSourceMaps");
    isWorkingOnError = () => digg(this, "isHandlingError") || this.isLoadingSourceMaps();
    connectOnError() {
        window.addEventListener("error", (event) => {
            if (this.debugging)
                this.debug(`Error:`, event.message);
            this.errorOccurred = true;
            if (!this.isHandlingError) {
                this.isHandlingError = true;
                this.onError(event).finally(() => {
                    this.isHandlingError = false;
                });
            }
        });
    }
    connectUnhandledRejection() {
        window.addEventListener("unhandledrejection", (event) => {
            if (this.debugging)
                this.debug(`Unhandled rejection:`, event.reason.message);
            this.errorOccurred = true;
            if (!this.isHandlingError) {
                this.isHandlingError = true;
                this.onUnhandledRejection(event).finally(() => {
                    this.isHandlingError = false;
                });
            }
        });
    }
    async onError(event) {
        this.errorOccurred = true;
        if (event.error)
            await this.sourceMapsLoader.loadSourceMaps(event.error);
        if (event.error && event.error.stack) {
            const backtrace = this.sourceMapsLoader.parseStackTrace(event.error.stack);
            this.errors.push({
                errorClass: event.error ? event.error.name : "No error class",
                message: event.message || "Unknown error",
                backtrace
            });
        }
        else {
            this.errors.push({
                errorClass: event.error ? event.error.name : "No error class",
                message: event.message || "Unknown error",
                backtrace: null
            });
        }
    }
    async onUnhandledRejection(event) {
        if (event.reason)
            await this.sourceMapsLoader.loadSourceMaps(event.reason);
        if (event.reason.stack) {
            const backtrace = this.sourceMapsLoader.parseStackTrace(event.reason.stack);
            this.errors.push({
                errorClass: "UnhandledRejection",
                message: event.reason.message || "Unhandled promise rejection",
                backtrace
            });
        }
        else {
            this.errors.push({
                errorClass: "UnhandledRejection",
                message: event.reason.message || "Unhandled promise rejection",
                backtrace: null
            });
        }
    }
    testPromiseError() {
        return new Promise((_resolve) => {
            throw new Error("testPromiseError");
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXJyb3ItbG9nZ2VyLmpzIiwic291cmNlUm9vdCI6Ii9zcmMvIiwic291cmNlcyI6WyJlcnJvci1sb2dnZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLElBQUksRUFBQyxNQUFNLFdBQVcsQ0FBQTtBQUM5QixPQUFPLGdCQUFnQixNQUFNLHlCQUF5QixDQUFBO0FBRXRELE1BQU0sQ0FBQyxPQUFPLE9BQU8sV0FBVztJQUM5QjtRQUNFLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFBO1FBQ3RCLElBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFBO1FBQzFCLElBQUksQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFBO1FBQ2hCLElBQUksQ0FBQyxlQUFlLEdBQUcsS0FBSyxDQUFBO1FBQzVCLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLGdCQUFnQixFQUFFLENBQUE7UUFDOUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLDJCQUEyQixDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUU7WUFDM0QsTUFBTSxHQUFHLEdBQUcsTUFBTSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQTtZQUN0QyxNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1lBRXhDLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsSUFBSSxHQUFHLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksaUJBQWlCLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO2dCQUM3RyxPQUFPLEdBQUcsQ0FBQTtZQUNaLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFFRCxLQUFLLENBQUMsR0FBRyxNQUFNO1FBQ2IsSUFBSSxJQUFJLENBQUMsU0FBUztZQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxNQUFN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TyxDQUFDLENBQUMsUUFBUSxFQUFFLEVBQUU7WUFDOUIsTUFBTSxJQUFJLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQyxDQUFBO1FBQ3JDLENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtkaWdnfSBmcm9tIFwiZGlnZ2VyaXplXCJcbmltcG9ydCBTb3VyY2VNYXBzTG9hZGVyIGZyb20gXCIuL3NvdXJjZS1tYXBzLWxvYWRlci5qc1wiXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEVycm9yTG9nZ2VyIHtcbiAgY29uc3RydWN0b3IgKCkge1xuICAgIHRoaXMuZGVidWdnaW5nID0gZmFsc2VcbiAgICB0aGlzLmVycm9yT2NjdXJyZWQgPSBmYWxzZVxuICAgIHRoaXMuZXJyb3JzID0gW11cbiAgICB0aGlzLmlzSGFuZGxpbmdFcnJvciA9IGZhbHNlXG4gICAgdGhpcy5zb3VyY2VNYXBzTG9hZGVyID0gbmV3IFNvdXJjZU1hcHNMb2FkZXIoKVxuICAgIHRoaXMuc291cmNlTWFwc0xvYWRlci5sb2FkU291cmNlTWFwc0ZvclNjcmlwdFRhZ3MoKHNjcmlwdCkgPT4ge1xuICAgICAgY29uc3Qgc3JjID0gc2NyaXB0LmdldEF0dHJpYnV0ZShcInNyY1wiKVxuICAgICAgY29uc3QgdHlwZSA9IHNjcmlwdC5nZXRBdHRyaWJ1dGUoXCJ0eXBlXCIpXG5cbiAgICAgIGlmIChzcmMgJiYgKHNyYy5pbmNsdWRlcyhcIi9wYWNrcy9cIikgfHwgc3JjLmluY2x1ZGVzKFwiL3BhY2tzLXRlc3QvXCIpKSAmJiAodHlwZSA9PSBcInRleHQvamF2YXNjcmlwdFwiIHx8ICF0eXBlKSkge1xuICAgICAgICByZXR1cm4gc3JjXG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIGRlYnVnKC4uLm91dHB1dCkge1xuICAgIGlmICh0aGlzLmRlYnVnZ2luZykgY29uc29sZS5lcnJvcihgQXBpTWFrZXIgRXJyb3JMb2dnZXI6YCwgLi4ub3V0cHV0KVxuICB9XG5cbiAgZW5hYmxlICgpIHtcbiAgICB0aGlzLmRlYnVnKFwiRW5hYmxlIGNhbGxlZFwiKVxuICAgIHRoaXMuY29ubmVjdE9uRXJyb3IoKVxuICAgIHRoaXMuY29ubmVjdFVuaGFuZGxlZFJlamVjdGlvbigpXG4gIH1cblxuICBnZXRFcnJvcnMgPSAoKSA9PiB0aGlzLmVycm9yc1xuICBoYXNFcnJvck9jY3VycmVkID0gKCkgPT5kaWdnKHRoaXMsIFwiZXJyb3JPY2N1cnJlZFwiKVxuICBpc0xvYWRpbmdTb3VyY2VNYXBzID0gKCkgPT4gZGlnZyh0aGlzLCBcInNvdXJjZU1hcHNMb2FkZXJcIiwgXCJpc0xvYWRpbmdTb3VyY2VNYXBzXCIpXG4gIGlzV29ya2luZ09uRXJyb3IgPSAoKSA9PiBkaWdnKHRoaXMsIFwiaXNIYW5kbGluZ0Vycm9yXCIpIHx8IHRoaXMuaXNMb2FkaW5nU291cmNlTWFwcygpXG5cbiAgY29ubmVjdE9uRXJyb3IoKSB7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJlcnJvclwiLCAoZXZlbnQpID0+IHtcbiAgICAgIGlmICh0aGlzLmRlYnVnZ2luZykgdGhpcy5kZWJ1ZyhgRXJyb3I6YCwgZXZlbnQubWVzc2FnZSlcbiAgICAgIHRoaXMuZXJyb3JPY2N1cnJlZCA9IHRydWVcblxuICAgICAgaWYgKCF0aGlzLmlzSGFuZGxpbmdFcnJvcikge1xuICAgICAgICB0aGlzLmlzSGFuZGxpbmdFcnJvciA9IHRydWVcbiAgICAgICAgdGhpcy5vbkVycm9yKGV2ZW50KS5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgICB0aGlzLmlzSGFuZGxpbmdFcnJvciA9IGZhbHNlXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIGNvbm5lY3RVbmhhbmRsZWRSZWplY3Rpb24oKSB7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJ1bmhhbmRsZWRyZWplY3Rpb25cIiwgKGV2ZW50KSA9PiB7XG4gICAgICBpZiAodGhpcy5kZWJ1Z2dpbmcpIHRoaXMuZGVidWcoYFVuaGFuZGxlZCByZWplY3Rpb246YCwgZXZlbnQucmVhc29uLm1lc3NhZ2UpXG4gICAgICB0aGlzLmVycm9yT2NjdXJyZWQgPSB0cnVlXG5cbiAgICAgIGlmICghdGhpcy5pc0hhbmRsaW5nRXJyb3IpIHtcbiAgICAgICAgdGhpcy5pc0hhbmRsaW5nRXJyb3IgPSB0cnVlXG4gICAgICAgIHRoaXMub25VbmhhbmRsZWRSZWplY3Rpb24oZXZlbnQpLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICAgIHRoaXMuaXNIYW5kbGluZ0Vycm9yID0gZmFsc2VcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgYXN5bmMgb25FcnJvcihldmVudCkge1xuICAgIHRoaXMuZXJyb3JPY2N1cnJlZCA9IHRydWVcblxuICAgIGlmIChldmVudC5lcnJvcikgYXdhaXQgdGhpcy5zb3VyY2VNYXBzTG9hZGVyLmxvYWRTb3VyY2VNYXBzKGV2ZW50LmVycm9yKVxuXG4gICAgaWYgKGV2ZW50LmVycm9yICYmIGV2ZW50LmVycm9yLnN0YWNrKSB7XG4gICAgICBjb25zdCBiYWNrdHJhY2UgPSB0aGlzLnNvdXJjZU1hcHNMb2FkZXIucGFyc2VTdGFja1RyYWNlKGV2ZW50LmVycm9yLnN0YWNrKVxuXG4gICAgICB0aGlzLmVycm9ycy5wdXNoKHtcbiAgICAgICAgZXJyb3JDbGFzczogZXZlbnQuZXJyb3IgPyBldmVudC5lcnJvci5uYW1lIDogXCJObyBlcnJvciBjbGFzc1wiLFxuICAgICAgICBtZXNzYWdlOiBldmVudC5tZXNzYWdlIHx8IFwiVW5rbm93biBlcnJvclwiLFxuICAgICAgICBiYWNrdHJhY2VcbiAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZXJyb3JzLnB1c2goe1xuICAgICAgICBlcnJvckNsYXNzOiBldmVudC5lcnJvciA/IGV2ZW50LmVycm9yLm5hbWUgOiBcIk5vIGVycm9yIGNsYXNzXCIsXG4gICAgICAgIG1lc3NhZ2U6IGV2ZW50Lm1lc3NhZ2UgfHwgXCJVbmtub3duIGVycm9yXCIsXG4gICAgICAgIGJhY2t0cmFjZTogbnVsbFxuICAgICAgfSlcbiAgICB9XG4gIH1cblxuICBhc3luYyBvblVuaGFuZGxlZFJlamVjdGlvbihldmVudCkge1xuICAgIGlmIChldmVudC5yZWFzb24pIGF3YWl0IHRoaXMuc291cmNlTWFwc0xvYWRlci5sb2FkU291cmNlTWFwcyhldmVudC5yZWFzb24pXG5cbiAgICBpZiAoZXZlbnQucmVhc29uLnN0YWNrKSB7XG4gICAgICBjb25zdCBiYWNrdHJhY2UgPSB0aGlzLnNvdXJjZU1hcHNMb2FkZXIucGFyc2VTdGFja1RyYWNlKGV2ZW50LnJlYXNvbi5zdGFjaylcblxuICAgICAgdGhpcy5lcnJvcnMucHVzaCh7XG4gICAgICAgIGVycm9yQ2xhc3M6IFwiVW5oYW5kbGVkUmVqZWN0aW9uXCIsXG4gICAgICAgIG1lc3NhZ2U6IGV2ZW50LnJlYXNvbi5tZXNzYWdlIHx8IFwiVW5oYW5kbGVkIHByb21pc2UgcmVqZWN0aW9uXCIsXG4gICAgICAgIGJhY2t0cmFjZVxuICAgICAgfSlcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5lcnJvcnMucHVzaCh7XG4gICAgICAgIGVycm9yQ2xhc3M6IFwiVW5oYW5kbGVkUmVqZWN0aW9uXCIsXG4gICAgICAgIG1lc3NhZ2U6IGV2ZW50LnJlYXNvbi5tZXNzYWdlIHx8IFwiVW5oYW5kbGVkIHByb21pc2UgcmVqZWN0aW9uXCIsXG4gICAgICAgIGJhY2t0cmFjZTogbnVsbFxuICAgICAgfSlcbiAgICB9XG4gIH1cblxuICB0ZXN0UHJvbWlzZUVycm9yKCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgoX3Jlc29sdmUpID0+IHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcInRlc3RQcm9taXNlRXJyb3JcIilcbiAgICB9KVxuICB9XG59XG4iXX0=