import I18nOnSteroids from "i18n-on-steroids";
import Money from "js-money";
import formatNumber from "format-number";
import replaceall from "replaceall";
export default class MoneyFormatter {
    static fromMoney(money, args = {}) {
        return new MoneyFormatter(money, args);
    }
    static format(money, args = {}) {
        return MoneyFormatter.fromMoney(money, args).toString();
    }
    static stringToFloat(moneyString) {
        let unformatted = replaceall(I18nOnSteroids.getCurrent().t("number.currency.format.delimiter"), "", moneyString);
        unformatted = replaceall(I18nOnSteroids.getCurrent().t("number.currency.format.separator"), ".", unformatted);
        const float = parseFloat(unformatted);
        return float;
    }
    static amountFromMoney(money) {
        if ("amount" in money) {
            return parseFloat(money.amount);
        }
        else if ("fractional" in money) {
            return parseFloat(money.fractional);
        }
        throw new Error(`Couldn't figure out amount from: ${JSON.stringify(money, null, 2)}`);
    }
    static currencyFromMoney(money) {
        let currencyString;
        if (typeof money.currency == "string") {
            currencyString = money.currency;
        }
        else if (typeof money.currency.id == "string") {
            currencyString = money.currency.id;
        }
        else if (typeof money.currency.iso_code == "string") {
            currencyString = money.currency.iso_code;
        }
        else if (typeof money.currency.code == "string") {
            currencyString = money.currency.code;
        }
        else {
            throw new Error(`Couldn't figure out currency from: ${JSON.stringify(money, null, 2)}`);
        }
        const moneyCurrency = Money[currencyString.toUpperCase()];
        if (!moneyCurrency) {
            throw new Error(`Could not find currency ${JSON.stringify(money, null, 2)}`);
        }
        return moneyCurrency;
    }
    static isMoney(value) {
        if (value instanceof Money)
            return true;
        if (typeof value == "object" && value && Object.keys(value).length == 2 && "amount" in value && "currency" in value)
            return true;
        return false;
    }
    constructor(money, args = {}) {
        this.args = args;
        this.money = money;
        this.amount = MoneyFormatter.amountFromMoney(money);
        this.currency = MoneyFormatter.currencyFromMoney(money);
    }
    toString() {
        const amount = (this.amount / 100).toFixed(this.decimalDigits());
        const formatOptions = {
            prefix: this.prefix(),
            decimal: I18nOnSteroids.getCurrent().t("number.currency.format.separator"),
            integerSeparator: I18nOnSteroids.getCurrent().t("number.currency.format.delimiter")
        };
        return formatNumber(formatOptions)(amount);
    }
    decimalDigits() {
        if (this.args.decimals !== null) {
            return this.args.decimals;
        }
        return this.currency.decimal_digits;
    }
    prefix() {
        if (this.args.excludeCurrency) {
            return "";
        }
        return `${this.currency.code} `;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9uZXktZm9ybWF0dGVyLmpzIiwic291cmNlUm9vdCI6Ii9zcmMvIiwic291cmNlcyI6WyJtb25leS1mb3JtYXR0ZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxjQUFjLE1BQU0sa0JBQWtCLENBQUE7QUFDN0MsT0FBTyxLQUFLLE1BQU0sVUFBVSxDQUFBO0FBQzVCLE9BQU8sWUFBWSxNQUFNLGVBQWUsQ0FBQTtBQUN4QyxPQUFPLFVBQVUsTUFBTSxZQUFZLENBQUE7QUFFbkMsTUFBTSxDQUFDLE9BQU8sT0FBTyxjQUFjO0lBQ2pDLE1BQU0sQ0FBQyxTQUFTLENBQUUsS0FBSyxFQUFFLElBQUksR0FBRyxFQUFFO1FBQ2hDLE9BQU8sSUFBSSxjQUFjLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFBO0lBQ3hDLENBQUM7SUFFRCxNQUFNLENBQUMsTUFBTSxDQUFFLEtBQUssRUFBRSxJQUFJLEdBQUcsRUFBRTtRQUM3QixPQUFPLGNBQWMsQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFBO0lBQ3pELENBQUM7SUFFRCxNQUFNLENBQUMsYUFBYSxDQUFFLFdBQVc7UUFDL0IsSUFBSSxXQUFXLEdBQUcsVUFBVSxDQUFDLGNBQWMsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLENBQUMsa0NBQWtDLENBQUMsRUFBRSxFQUFFLEVBQUUsV0FBVyxDQUFDLENBQUE7UUFFaEgsV0FBVyxHQUFHLFVBQVUsQ0FBQyxjQUFjLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQyxDQUFDLGtDQUFrQyxDQUFDLEVBQUUsR0FBRyxFQUFFLFdBQVcsQ0FBQyxDQUFBO1FBQzdHLE1BQU0sS0FBSyxHQUFHLFVBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQTtRQUVyQyxPQUFPLEtBQUssQ0FBQTtJQUNkLENBQUM7SUFFRCxNQUFNLENBQUMsZUFBZSxDQUFFLEtBQUs7UUFDM0IsSUFBSSxRQUFRLElBQUksS0FBSyxFQUFFLENB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QUFjLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQyxDQUFDLGtDQUFrQyxDQUFDO1lBQzFFLGdCQUFnQixFQUFFLGNBQWMsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLENBQUMsa0NBQWtDLENBQUM7U0FDcEYsQ0FBQTtRQUVELE9BQU8sWUFBWSxDQUFDLGFBQWEsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFBO0lBQzVDLENBQUM7SUFFRCxhQUFhO1FBQ1gsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsS0FBSyxJQUFJLEVBQUUsQ0FBQztZQUNoQyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFBO1FBQzNCLENBQUM7UUFFRCxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFBO0lBQ3JDLENBQUM7SUFFRCxNQUFNO1FBQ0osSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQzlCLE9BQU8sRUFBRSxDQUFBO1FBQ1gsQ0FBQztRQUVELE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksR0FBRyxDQUFBO0lBQ2pDLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBJMThuT25TdGVyb2lkcyBmcm9tIFwiaTE4bi1vbi1zdGVyb2lkc1wiXG5pbXBvcnQgTW9uZXkgZnJvbSBcImpzLW1vbmV5XCJcbmltcG9ydCBmb3JtYXROdW1iZXIgZnJvbSBcImZvcm1hdC1udW1iZXJcIlxuaW1wb3J0IHJlcGxhY2VhbGwgZnJvbSBcInJlcGxhY2VhbGxcIlxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNb25leUZvcm1hdHRlciB7XG4gIHN0YXRpYyBmcm9tTW9uZXkgKG1vbmV5LCBhcmdzID0ge30pIHtcbiAgICByZXR1cm4gbmV3IE1vbmV5Rm9ybWF0dGVyKG1vbmV5LCBhcmdzKVxuICB9XG5cbiAgc3RhdGljIGZvcm1hdCAobW9uZXksIGFyZ3MgPSB7fSkge1xuICAgIHJldHVybiBNb25leUZvcm1hdHRlci5mcm9tTW9uZXkobW9uZXksIGFyZ3MpLnRvU3RyaW5nKClcbiAgfVxuXG4gIHN0YXRpYyBzdHJpbmdUb0Zsb2F0IChtb25leVN0cmluZykge1xuICAgIGxldCB1bmZvcm1hdHRlZCA9IHJlcGxhY2VhbGwoSTE4bk9uU3Rlcm9pZHMuZ2V0Q3VycmVudCgpLnQoXCJudW1iZXIuY3VycmVuY3kuZm9ybWF0LmRlbGltaXRlclwiKSwgXCJcIiwgbW9uZXlTdHJpbmcpXG5cbiAgICB1bmZvcm1hdHRlZCA9IHJlcGxhY2VhbGwoSTE4bk9uU3Rlcm9pZHMuZ2V0Q3VycmVudCgpLnQoXCJudW1iZXIuY3VycmVuY3kuZm9ybWF0LnNlcGFyYXRvclwiKSwgXCIuXCIsIHVuZm9ybWF0dGVkKVxuICAgIGNvbnN0IGZsb2F0ID0gcGFyc2VGbG9hdCh1bmZvcm1hdHRlZClcblxuICAgIHJldHVybiBmbG9hdFxuICB9XG5cbiAgc3RhdGljIGFtb3VudEZyb21Nb25leSAobW9uZXkpIHtcbiAgICBpZiAoXCJhbW91bnRcIiBpbiBtb25leSkge1xuICAgICAgcmV0dXJuIHBhcnNlRmxvYXQobW9uZXkuYW1vdW50KVxuICAgIH0gZWxzZSBpZiAoXCJmcmFjdGlvbmFsXCIgaW4gbW9uZXkpIHtcbiAgICAgIHJldHVybiBwYXJzZUZsb2F0KG1vbmV5LmZyYWN0aW9uYWwpXG4gICAgfVxuXG4gICAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZG4ndCBmaWd1cmUgb3V0IGFtb3VudCBmcm9tOiAke0pTT04uc3RyaW5naWZ5KG1vbmV5LCBudWxsLCAyKX1gKVxuICB9XG5cbiAgc3RhdGljIGN1cnJlbmN5RnJvbU1vbmV5IChtb25leSkge1xuICAgIGxldCBjdXJyZW5jeVN0cmluZ1xuXG4gICAgaWYgKHR5cGVvZiBtb25leS5jdXJyZW5jeSA9PSBcInN0cmluZ1wiKSB7XG4gICAgICBjdXJyZW5jeVN0cmluZyA9IG1vbmV5LmN1cnJlbmN5XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgbW9uZXkuY3VycmVuY3kuaWQgPT0gXCJzdHJpbmdcIikge1xuICAgICAgY3VycmVuY3lTdHJpbmcgPSBtb25leS5jdXJyZW5jeS5pZFxuICAgIH0gZWxzZSBpZiAodHlwZW9mIG1vbmV5LmN1cnJlbmN5Lmlzb19jb2RlID09IFwic3RyaW5nXCIpIHtcbiAgICAgIGN1cnJlbmN5U3RyaW5nID0gbW9uZXkuY3VycmVuY3kuaXNvX2NvZGVcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBtb25leS5jdXJyZW5jeS5jb2RlID09IFwic3RyaW5nXCIpIHtcbiAgICAgIGN1cnJlbmN5U3RyaW5nID0gbW9uZXkuY3VycmVuY3kuY29kZVxuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkbid0IGZpZ3VyZSBvdXQgY3VycmVuY3kgZnJvbTogJHtKU09OLnN0cmluZ2lmeShtb25leSwgbnVsbCwgMil9YClcbiAgICB9XG5cbiAgICBjb25zdCBtb25leUN1cnJlbmN5ID0gTW9uZXlbY3VycmVuY3lTdHJpbmcudG9VcHBlckNhc2UoKV1cblxuICAgIGlmICghbW9uZXlDdXJyZW5jeSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3QgZmluZCBjdXJyZW5jeSAke0pTT04uc3RyaW5naWZ5KG1vbmV5LCBudWxsLCAyKX1gKVxuICAgIH1cblxuICAgIHJldHVybiBtb25leUN1cnJlbmN5XG4gIH1cblxuICBzdGF0aWMgaXNNb25leSh2YWx1ZSkge1xuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE1vbmV5KSByZXR1cm4gdHJ1ZVxuXG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSBcIm9iamVjdFwiICYmIHZhbHVlICYmIE9iamVjdC5rZXlzKHZhbHVlKS5sZW5ndGggPT0gMiAmJiBcImFtb3VudFwiIGluIHZhbHVlICYmIFwiY3VycmVuY3lcIiBpbiB2YWx1ZSlcbiAgICAgIHJldHVybiB0cnVlXG5cbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIGNvbnN0cnVjdG9yIChtb25leSwgYXJncyA9IHt9KSB7XG4gICAgdGhpcy5hcmdzID0gYXJnc1xuICAgIHRoaXMubW9uZXkgPSBtb25leVxuICAgIHRoaXMuYW1vdW50ID0gTW9uZXlGb3JtYXR0ZXIuYW1vdW50RnJvbU1vbmV5KG1vbmV5KVxuICAgIHRoaXMuY3VycmVuY3kgPSBNb25leUZvcm1hdHRlci5jdXJyZW5jeUZyb21Nb25leShtb25leSlcbiAgfVxuXG4gIHRvU3RyaW5nICgpIHtcbiAgICBjb25zdCBhbW91bnQgPSAodGhpcy5hbW91bnQgLyAxMDApLnRvRml4ZWQodGhpcy5kZWNpbWFsRGlnaXRzKCkpXG4gICAgY29uc3QgZm9ybWF0T3B0aW9ucyA9IHtcbiAgICAgIHByZWZpeDogdGhpcy5wcmVmaXgoKSxcbiAgICAgIGRlY2ltYWw6IEkxOG5PblN0ZXJvaWRzLmdldEN1cnJlbnQoKS50KFwibnVtYmVyLmN1cnJlbmN5LmZvcm1hdC5zZXBhcmF0b3JcIiksXG4gICAgICBpbnRlZ2VyU2VwYXJhdG9yOiBJMThuT25TdGVyb2lkcy5nZXRDdXJyZW50KCkudChcIm51bWJlci5jdXJyZW5jeS5mb3JtYXQuZGVsaW1pdGVyXCIpXG4gICAgfVxuXG4gICAgcmV0dXJuIGZvcm1hdE51bWJlcihmb3JtYXRPcHRpb25zKShhbW91bnQpXG4gIH1cblxuICBkZWNpbWFsRGlnaXRzICgpIHtcbiAgICBpZiAodGhpcy5hcmdzLmRlY2ltYWxzICE9PSBudWxsKSB7XG4gICAgICByZXR1cm4gdGhpcy5hcmdzLmRlY2ltYWxzXG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuY3VycmVuY3kuZGVjaW1hbF9kaWdpdHNcbiAgfVxuXG4gIHByZWZpeCAoKSB7XG4gICAgaWYgKHRoaXMuYXJncy5leGNsdWRlQ3VycmVuY3kpIHtcbiAgICAgIHJldHVybiBcIlwiXG4gICAgfVxuXG4gICAgcmV0dXJuIGAke3RoaXMuY3VycmVuY3kuY29kZX0gYFxuICB9XG59XG4iXX0=