import { digg } from "diggerize";
import * as inflection from "inflection";
import modelClassRequire from "./model-class-require.js";
import ModelsResponseReader from "./models-response-reader.js";
import Money from "js-money";
export default class ApiMakerDeserializer {
    static parse(object) {
        if (Array.isArray(object)) {
            return object.map((value) => ApiMakerDeserializer.parse(value));
        }
        else if (object && typeof object == "object") {
            if (object.api_maker_type == "date") {
                const date = new Date(digg(object, "value"));
                date.apiMakerType = "date";
                return date;
            }
            else if (object.api_maker_type == "time") {
                const date = new Date(digg(object, "value"));
                date.apiMakerType = "time";
                return date;
            }
            else if (object.api_maker_type == "collection") {
                // Need to remove type to avoid circular error
                const { api_maker_type, ...restObject } = object;
                return ModelsResponseReader.collection(ApiMakerDeserializer.parse(restObject));
            }
            else if (object.api_maker_type == "money") {
                const cents = digg(object, "amount");
                const currency = digg(object, "currency");
                return Money.fromInteger(cents, currency);
            }
            else if (object.api_maker_type == "model") {
                const modelClassName = inflection.classify(digg(object, "model_name"));
                const ModelClass = modelClassRequire(modelClassName);
                const data = ApiMakerDeserializer.parse(digg(object, "serialized"));
                const model = new ModelClass({ data, isNewRecord: false });
                return model;
            }
            else if (object.api_maker_type == "resource") {
                const modelClassName = inflection.classify(digg(object, "name"));
                const ModelClass = modelClassRequire(modelClassName);
                return ModelClass;
            }
            else {
                const newObject = {};
                for (const key in object) {
                    const value = object[key];
                    newObject[key] = ApiMakerDeserializer.parse(value);
                }
                return newObject;
            }
        }
        else {
            return object;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVzZXJpYWxpemVyLmpzIiwic291cmNlUm9vdCI6Ii9zcmMvIiwic291cmNlcyI6WyJkZXNlcmlhbGl6ZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLElBQUksRUFBQyxNQUFNLFdBQVcsQ0FBQTtBQUM5QixPQUFPLEtBQUssVUFBVSxNQUFNLFlBQVksQ0FBQTtBQUN4QyxPQUFPLGlCQUFpQixNQUFNLDBCQUEwQixDQUFBO0FBQ3hELE9BQU8sb0JBQW9CLE1BQU0sNkJBQTZCLENBQUE7QUFDOUQsT0FBTyxLQUFLLE1BQU0sVUFBVSxDQUFBO0FBRTVCLE1BQU0sQ0FBQyxPQUFPLE9BQU8sb0JBQW9CO0lBQ3ZDLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTTtRQUNqQixJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztZQUMxQixPQUFPLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLG9CQUFvQixDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBO1FBQ2pFLENBQUM7YUFBTSxJQUFJLE1BQU0sSUFBSSxPQUFPLE1BQU0sSUFBSSxRQUFRLEVBQUUsQ0FBQztZQUMvQyxJQUFJLE1BQU0sQ0FBQyxjQUFjLElBQUksTUFBTSxFQUFFLENBQUM7Z0JBQ3BDLE1BQU0sSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQTtnQkFFNUMsSUFBSSxDQUFDLFlBQVksR0FBRyxNQUFNLENBQUE7Z0JBRTFCLE9BQU8sSUFBSSxDQUFBO1lBQ2IsQ0FBQztpQkFBTSxJQUFJLE1BQU0sQ0FBQyxjQUFjLElBQUksTUFBTSxFQUFFLENBQUM7Z0JBQzNDLE1BQU0sSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQTtnQkFFNUMsSUFBSSxDQUFDLFlBQVksR0FBRyxNQUFNLENBQUE7Z0JBRTFCLE9BQU8sSUFBSSxDQUFBO1lBQ2IsQ0FBQztpQkFBTSxJQUFJLE1BQU0sQ0FBQyxjQUFjLElBQUksWUFBWSxFQUFFLENBQUM7Z0JBQ2pELDhDQUE4QztnQkFDOUMsTUFBTSxFQUFDLGNBQWMsRUFBRSxHQUFHLFVBQVUsRUFBQyxHQUFHLE1BQU0sQ0FBQTtnQkFFOUMsT0FBTyxvQkFBb0IsQ0FBQyxVQUFVLENBQUMsb0JBQW9CLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUE7WUFDaEYsQ0FBQztpQkFBTSxJQUFJLE1BQU0sQ0FBQyxjQUFjLElBQUksT0FBTyxFQUFFLENBQUM7Z0JBQzVDLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUE7Z0JBQ3BDLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsVUFBVSxDQUFDLENBQUE7Z0JBRXpDLE9BQU8sS0FBSyxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUE7WUFDM0MsQ0FBQztpQkFBTSxJQUFJLE1BQU0sQ0FBQyxjQUFjLElBQUksT0FBTyxFQUFFLENBQUM7Z0JBQzVDLE1BQU0sY0FBYyxHQUFHLFVBQVUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxZQUFZLENBQUMsQ0FBQyxDQUFBO2dCQUN0RSxNQUFNLFVBQVUsR0FBRyxpQkFBaUIsQ0FBQyxjQUFjLENBQUMsQ0FBQTtnQkFDcEQsTUFBTSxJQUFJLEdBQUcsb0JBQW9CLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsWUFBWSxDQUFDLENBQUMsQ0FBQTtnQkFDbkUsTUFBTSxLQUFLLEdBQUcsSUFBSSxVQUFVLENBQUMsRUFBQyxJQUFJLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBQyxDQUFDLENBQUE7Z0JBRXhELE9BQU8sS0FBSyxDQUFBO1lBQ2QsQ0FBQztpQkFBTSxJQUFJLE1BQU0sQ0FBQyxjQUFjLElBQUksVUFBVSxFQUFFLENBQUM7Z0JBQy9DLE1BQU0sY0FBYyxHQUFHLFVBQVUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFBO2dCQUNoRSxNQUFNLFVBQVUsR0FBRyxpQkFBaUIsQ0FBQyxjQUFjLENBQUMsQ0FBQTtnQkFFcEQsT0FBTyxVQUFVLENBQUE7WUFDbkIsQ0FBQztpQkFBTSxDQUFDO2dCQUNOLE1BQU0sU0FBUyxHQUFHLEVBQUUsQ0FBQTtnQkFFcEIsS0FBSyxNQUFNLEdBQUcsSUFBSSxNQUFNLEVBQUUsQ0FBQztvQkFDekIsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO29CQUN6QixTQUFTLENBQUMsR0FBRyxDQUFDLEdBQUcsb0JBQW9CLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFBO2dCQUNwRCxDQUFDO2dCQUVELE9BQU8sU0FBUyxDQUFBO1lBQ2xCLENBQUM7UUFDSCxDQUFDO2FBQU0sQ0FBQztZQUNOLE9BQU8sTUFBTSxDQUFBO1FBQ2YsQ0FBQztJQUNILENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7ZGlnZ30gZnJvbSBcImRpZ2dlcml6ZVwiXG5pbXBvcnQgKiBhcyBpbmZsZWN0aW9uIGZyb20gXCJpbmZsZWN0aW9uXCJcbmltcG9ydCBtb2RlbENsYXNzUmVxdWlyZSBmcm9tIFwiLi9tb2RlbC1jbGFzcy1yZXF1aXJlLmpzXCJcbmltcG9ydCBNb2RlbHNSZXNwb25zZVJlYWRlciBmcm9tIFwiLi9tb2RlbHMtcmVzcG9uc2UtcmVhZGVyLmpzXCJcbmltcG9ydCBNb25leSBmcm9tIFwianMtbW9uZXlcIlxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBcGlNYWtlckRlc2VyaWFsaXplciB7XG4gIHN0YXRpYyBwYXJzZShvYmplY3QpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShvYmplY3QpKSB7XG4gICAgICByZXR1cm4gb2JqZWN0Lm1hcCgodmFsdWUpID0+IEFwaU1ha2VyRGVzZXJpYWxpemVyLnBhcnNlKHZhbHVlKSlcbiAgICB9IGVsc2UgaWYgKG9iamVjdCAmJiB0eXBlb2Ygb2JqZWN0ID09IFwib2JqZWN0XCIpIHtcbiAgICAgIGlmIChvYmplY3QuYXBpX21ha2VyX3R5cGUgPT0gXCJkYXRlXCIpIHtcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKGRpZ2cob2JqZWN0LCBcInZhbHVlXCIpKVxuXG4gICAgICAgIGRhdGUuYXBpTWFrZXJUeXBlID0gXCJkYXRlXCJcblxuICAgICAgICByZXR1cm4gZGF0ZVxuICAgICAgfSBlbHNlIGlmIChvYmplY3QuYXBpX21ha2VyX3R5cGUgPT0gXCJ0aW1lXCIpIHtcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKGRpZ2cob2JqZWN0LCBcInZhbHVlXCIpKVxuXG4gICAgICAgIGRhdGUuYXBpTWFrZXJUeXBlID0gXCJ0aW1lXCJcblxuICAgICAgICByZXR1cm4gZGF0ZVxuICAgICAgfSBlbHNlIGlmIChvYmplY3QuYXBpX21ha2VyX3R5cGUgPT0gXCJjb2xsZWN0aW9uXCIpIHtcbiAgICAgICAgLy8gTmVlZCB0byByZW1vdmUgdHlwZSB0byBhdm9pZCBjaXJjdWxhciBlcnJvclxuICAgICAgICBjb25zdCB7YXBpX21ha2VyX3R5cGUsIC4uLnJlc3RPYmplY3R9ID0gb2JqZWN0XG5cbiAgICAgICAgcmV0dXJuIE1vZGVsc1Jlc3BvbnNlUmVhZGVyLmNvbGxlY3Rpb24oQXBpTWFrZXJEZXNlcmlhbGl6ZXIucGFyc2UocmVzdE9iamVjdCkpXG4gICAgICB9IGVsc2UgaWYgKG9iamVjdC5hcGlfbWFrZXJfdHlwZSA9PSBcIm1vbmV5XCIpIHtcbiAgICAgICAgY29uc3QgY2VudHMgPSBkaWdnKG9iamVjdCwgXCJhbW91bnRcIilcbiAgICAgICAgY29uc3QgY3VycmVuY3kgPSBkaWdnKG9iamVjdCwgXCJjdXJyZW5jeVwiKVxuXG4gICAgICAgIHJldHVybiBNb25leS5mcm9tSW50ZWdlcihjZW50cywgY3VycmVuY3kpXG4gICAgICB9IGVsc2UgaWYgKG9iamVjdC5hcGlfbWFrZXJfdHlwZSA9PSBcIm1vZGVsXCIpIHtcbiAgICAgICAgY29uc3QgbW9kZWxDbGFzc05hbWUgPSBpbmZsZWN0aW9uLmNsYXNzaWZ5KGRpZ2cob2JqZWN0LCBcIm1vZGVsX25hbWVcIikpXG4gICAgICAgIGNvbnN0IE1vZGVsQ2xhc3MgPSBtb2RlbENsYXNzUmVxdWlyZShtb2RlbENsYXNzTmFtZSlcbiAgICAgICAgY29uc3QgZGF0YSA9IEFwaU1ha2VyRGVzZXJpYWxpemVyLnBhcnNlKGRpZ2cob2JqZWN0LCBcInNlcmlhbGl6ZWRcIikpXG4gICAgICAgIGNvbnN0IG1vZGVsID0gbmV3IE1vZGVsQ2xhc3Moe2RhdGEsIGlzTmV3UmVjb3JkOiBmYWxzZX0pXG5cbiAgICAgICAgcmV0dXJuIG1vZGVsXG4gICAgICB9IGVsc2UgaWYgKG9iamVjdC5hcGlfbWFrZXJfdHlwZSA9PSBcInJlc291cmNlXCIpIHtcbiAgICAgICAgY29uc3QgbW9kZWxDbGFzc05hbWUgPSBpbmZsZWN0aW9uLmNsYXNzaWZ5KGRpZ2cob2JqZWN0LCBcIm5hbWVcIikpXG4gICAgICAgIGNvbnN0IE1vZGVsQ2xhc3MgPSBtb2RlbENsYXNzUmVxdWlyZShtb2RlbENsYXNzTmFtZSlcblxuICAgICAgICByZXR1cm4gTW9kZWxDbGFzc1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgbmV3T2JqZWN0ID0ge31cblxuICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBvYmplY3QpIHtcbiAgICAgICAgICBjb25zdCB2YWx1ZSA9IG9iamVjdFtrZXldXG4gICAgICAgICAgbmV3T2JqZWN0W2tleV0gPSBBcGlNYWtlckRlc2VyaWFsaXplci5wYXJzZSh2YWx1ZSlcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBuZXdPYmplY3RcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG9iamVjdFxuICAgIH1cbiAgfVxufVxuIl19