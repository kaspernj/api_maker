import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { Pressable } from "react-native";
import BaseComponent from "../base-component";
import Column from "./components/column";
import columnIdentifier from "./column-identifier.js";
import { EventEmitter } from "eventemitter3";
import { FlashNotifications } from "flash-notifications";
import Icon from "../utils/icon";
import * as inflection from "inflection";
import modelCallbackArgs from "./model-callback-args.js";
import Link from "../link";
import ModelColumn from "./model-column";
import PropTypes from "prop-types";
import propTypesExact from "prop-types-exact";
import React from "react";
import Row from "./components/row";
import memo from "set-state-compare/build/memo.js";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import useI18n from "i18n-on-steroids/src/use-i18n.mjs";
import WorkerPluginsCheckbox from "./worker-plugins-checkbox";
export default memo(shapeComponent(class ApiMakerBootStrapLiveTableModelRow extends BaseComponent {
    static propTypes = propTypesExact({
        cacheKey: PropTypes.string.isRequired,
        columns: PropTypes.array,
        columnWidths: PropTypes.object.isRequired,
        events: PropTypes.instanceOf(EventEmitter).isRequired,
        index: PropTypes.number.isRequired,
        model: PropTypes.object.isRequired,
        table: PropTypes.object.isRequired,
        tableSettingFullCacheKey: PropTypes.string.isRequired
    });
    setup() {
        const { t } = useI18n({ namespace: "js.api_maker.table.model_row" });
        this.t = t;
    }
    render() {
        const { index, table, model } = this.p;
        const { modelClass, workplace } = table.p;
        const { actionsContent, destroyEnabled, editModelPath, viewModelPath } = table.props;
        const { columns, currentWorkplace } = table.state;
        const { styleForColumn, styleForRow } = table.tt;
        const even = index % 2 == 0;
        this.modelCallbackArgs = modelCallbackArgs(table, model); // 'model' can change so this needs to be re-cached for every render
        let editPath, viewPath;
        if (editModelPath && model.can("edit")) {
            editPath = editModelPath(this.modelCallbackArgs);
        }
        if (viewModelPath && model.can("show")) {
            viewPath = viewModelPath(this.modelCallbackArgs);
        }
        return (_jsxs(Row, { dataSet: this.cache("rowDataSet", { class: `${inflection.dasherize(modelClass.modelClassData().paramKey)}-row`, modelId: model.id() }, [model.id(), modelClass.modelClassData().paramKey]), style: styleForRow({ even }), children: [workplace &&
                    _jsx(Column, { dataSet: this.cache("columnDataSet", { class: "workplace-column" }), style: styleForColumn({ even, style: { width: 41 } }), children: _jsx(WorkerPluginsCheckbox, { currentWorkplace: currentWorkplace, model: model, style: this.cache("workerPluginsCheckboxStyle", { marginHorizontal: "auto" }) }) }), columns && this.columnsContentFromColumns(model, even), _jsxs(Column, { dataSet: this.cache("actionsColumnDataSet", { class: "actions-column" }), style: styleForColumn({ even, style: {}, type: "actions" }), children: [actionsContent && actionsContent(this.tt.modelCallbackArgs), viewPath &&
                            _jsx(Link, { dataSet: this.cache("viewButtonDataSet", { class: "view-button" }), style: this.cache("searchLinkStyle", { marginLeft: 2, marginRight: 2 }), to: viewPath, children: _jsx(Icon, { name: "search", size: 18 }) }), editPath &&
                            _jsx(Link, { dataSet: this.cache("editButtonDataSet", { class: "edit-button" }), style: this.cache("editButtonStyle", { marginLeft: 2, marginRight: 2 }), to: editPath, children: _jsx(Icon, { name: "pencil", size: 20 }) }), destroyEnabled && model.can("destroy") &&
                            _jsx(Pressable, { dataSet: this.cache("destroyButtonDataSet", { class: "destroy-button" }), style: this.cache("destroyButtonStyle", { marginLeft: 2, marginRight: 2 }), onPress: this.tt.onDestroyClicked, children: _jsx(Icon, { name: "remove", size: 22 }) })] })] }));
    }
    columnsContentFromColumns(model, even) {
        const { columns, events, table } = this.p;
        return columns?.map(({ animatedPosition, animatedWidth, animatedZIndex, column, tableSettingColumn }, columnIndex) => _jsx(ModelColumn, { animatedPosition: animatedPosition, animatedWidth: animatedWidth, animatedZIndex: animatedZIndex, column: column, columnIndex: columnIndex, even: even, events: events, model: model, table: table, tableSettingColumn: tableSettingColumn }, columnIdentifier(column)));
    }
    onDestroyClicked = async () => {
        const { t } = this.tt;
        const { destroyMessage } = this.p.table.props;
        const { model } = this.p;
        if (!confirm(t("js.shared.are_you_sure"))) {
            return;
        }
        try {
            await model.destroy();
            if (destroyMessage) {
                FlashNotifications.success(destroyMessage);
            }
        }
        catch (error) {
            FlashNotifications.errorResponse(error);
        }
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kZWwtcm93LmpzIiwic291cmNlUm9vdCI6Ii9zcmMvIiwic291cmNlcyI6WyJ0YWJsZS9tb2RlbC1yb3cuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sY0FBYyxDQUFBO0FBQ3RDLE9BQU8sYUFBYSxNQUFNLG1CQUFtQixDQUFBO0FBQzdDLE9BQU8sTUFBTSxNQUFNLHFCQUFxQixDQUFBO0FBQ3hDLE9BQU8sZ0JBQWdCLE1BQU0sd0JBQXdCLENBQUE7QUFDckQsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLGVBQWUsQ0FBQTtBQUMxQyxPQUFPLEVBQUMsa0JBQWtCLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQTtBQUN0RCxPQUFPLElBQUksTUFBTSxlQUFlLENBQUE7QUFDaEMsT0FBTyxLQUFLLFVBQVUsTUFBTSxZQUFZLENBQUE7QUFDeEMsT0FBTyxpQkFBaUIsTUFBTSwwQkFBMEIsQ0FBQTtBQUN4RCxPQUFPLElBQUksTUFBTSxTQUFTLENBQUE7QUFDMUIsT0FBTyxXQUFXLE1BQU0sZ0JBQWdCLENBQUE7QUFDeEMsT0FBTyxTQUFTLE1BQU0sWUFBWSxDQUFBO0FBQ2xDLE9BQU8sY0FBYyxNQUFNLGtCQUFrQixDQUFBO0FBQzdDLE9BQU8sS0FBSyxNQUFNLE9BQU8sQ0FBQTtBQUN6QixPQUFPLEdBQUcsTUFBTSxrQkFBa0IsQ0FBQTtBQUNsQyxPQUFPLElBQUksTUFBTSxpQ0FBaUMsQ0FBQTtBQUNsRCxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sNENBQTRDLENBQUE7QUFDekUsT0FBTyxPQUFPLE1BQU0sbUNBQW1DLENBQUE7QUFDdkQsT0FBTyxxQkFBcUIsTUFBTSwyQkFBMkIsQ0FBQTtBQUU3RCxlQUFlLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxrQ0FBbUMsU0FBUSxhQUFhO0lBQy9GLE1BQU0sQ0FBQyxTQUFTLEdBQUcsY0FBYyxDQUFDO1FBQ2hDLFFBQVEsRUFBRSxTQUFTLENBQUMsTUFBTSxD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QUNILENBQUM7SUFFRCxnQkFBZ0IsR0FBRyxLQUFLLElBQUksRUFBRTtRQUM1QixNQUFNLEVBQUMsQ0FBQyxFQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQTtRQUNuQixNQUFNLEVBQUMsY0FBYyxFQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFBO1FBQzNDLE1BQU0sRUFBQyxLQUFLLEVBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFBO1FBRXRCLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLHdCQUF3QixDQUFDLENBQUMsRUFBRSxDQUFDO1lBQzFDLE9BQU07UUFDUixDQUFDO1FBRUQsSUFBSSxDQUFDO1lBQ0gsTUFBTSxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUE7WUFFckIsSUFBSSxjQUFjLEVBQUUsQ0FBQztnQkFDbkIsa0JBQWtCLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFBO1lBQzVDLENBQUM7UUFDSCxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLGtCQUFrQixDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUN6QyxDQUFDO0lBQ0gsQ0FBQyxDQUFBO0NBQ0YsQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1ByZXNzYWJsZX0gZnJvbSBcInJlYWN0LW5hdGl2ZVwiXG5pbXBvcnQgQmFzZUNvbXBvbmVudCBmcm9tIFwiLi4vYmFzZS1jb21wb25lbnRcIlxuaW1wb3J0IENvbHVtbiBmcm9tIFwiLi9jb21wb25lbnRzL2NvbHVtblwiXG5pbXBvcnQgY29sdW1uSWRlbnRpZmllciBmcm9tIFwiLi9jb2x1bW4taWRlbnRpZmllci5qc1wiXG5pbXBvcnQge0V2ZW50RW1pdHRlcn0gZnJvbSBcImV2ZW50ZW1pdHRlcjNcIlxuaW1wb3J0IHtGbGFzaE5vdGlmaWNhdGlvbnN9IGZyb20gXCJmbGFzaC1ub3RpZmljYXRpb25zXCJcbmltcG9ydCBJY29uIGZyb20gXCIuLi91dGlscy9pY29uXCJcbmltcG9ydCAqIGFzIGluZmxlY3Rpb24gZnJvbSBcImluZmxlY3Rpb25cIlxuaW1wb3J0IG1vZGVsQ2FsbGJhY2tBcmdzIGZyb20gXCIuL21vZGVsLWNhbGxiYWNrLWFyZ3MuanNcIlxuaW1wb3J0IExpbmsgZnJvbSBcIi4uL2xpbmtcIlxuaW1wb3J0IE1vZGVsQ29sdW1uIGZyb20gXCIuL21vZGVsLWNvbHVtblwiXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gXCJwcm9wLXR5cGVzXCJcbmltcG9ydCBwcm9wVHlwZXNFeGFjdCBmcm9tIFwicHJvcC10eXBlcy1leGFjdFwiXG5pbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCJcbmltcG9ydCBSb3cgZnJvbSBcIi4vY29tcG9uZW50cy9yb3dcIlxuaW1wb3J0IG1lbW8gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL21lbW8uanNcIlxuaW1wb3J0IHtzaGFwZUNvbXBvbmVudH0gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL3NoYXBlLWNvbXBvbmVudC5qc1wiXG5pbXBvcnQgdXNlSTE4biBmcm9tIFwiaTE4bi1vbi1zdGVyb2lkcy9zcmMvdXNlLWkxOG4ubWpzXCJcbmltcG9ydCBXb3JrZXJQbHVnaW5zQ2hlY2tib3ggZnJvbSBcIi4vd29ya2VyLXBsdWdpbnMtY2hlY2tib3hcIlxuXG5leHBvcnQgZGVmYXVsdCBtZW1vKHNoYXBlQ29tcG9uZW50KGNsYXNzIEFwaU1ha2VyQm9vdFN0cmFwTGl2ZVRhYmxlTW9kZWxSb3cgZXh0ZW5kcyBCYXNlQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHByb3BUeXBlc0V4YWN0KHtcbiAgICBjYWNoZUtleTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIGNvbHVtbnM6IFByb3BUeXBlcy5hcnJheSxcbiAgICBjb2x1bW5XaWR0aHM6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICBldmVudHM6IFByb3BUeXBlcy5pbnN0YW5jZU9mKEV2ZW50RW1pdHRlcikuaXNSZXF1aXJlZCxcbiAgICBpbmRleDogUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkLFxuICAgIG1vZGVsOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgdGFibGU6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICB0YWJsZVNldHRpbmdGdWxsQ2FjaGVLZXk6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZFxuICB9KVxuXG4gIHNldHVwKCkge1xuICAgIGNvbnN0IHt0fSA9IHVzZUkxOG4oe25hbWVzcGFjZTogXCJqcy5hcGlfbWFrZXIudGFibGUubW9kZWxfcm93XCJ9KVxuXG4gICAgdGhpcy50ID0gdFxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtpbmRleCwgdGFibGUsIG1vZGVsfSA9IHRoaXMucFxuICAgIGNvbnN0IHttb2RlbENsYXNzLCB3b3JrcGxhY2V9ID0gdGFibGUucFxuICAgIGNvbnN0IHthY3Rpb25zQ29udGVudCwgZGVzdHJveUVuYWJsZWQsIGVkaXRNb2RlbFBhdGgsIHZpZXdNb2RlbFBhdGh9ID0gdGFibGUucHJvcHNcbiAgICBjb25zdCB7Y29sdW1ucywgY3VycmVudFdvcmtwbGFjZX0gPSB0YWJsZS5zdGF0ZVxuICAgIGNvbnN0IHtzdHlsZUZvckNvbHVtbiwgc3R5bGVGb3JSb3d9ID0gdGFibGUudHRcbiAgICBjb25zdCBldmVuID0gaW5kZXggJSAyID09IDBcblxuICAgIHRoaXMubW9kZWxDYWxsYmFja0FyZ3MgPSBtb2RlbENhbGxiYWNrQXJncyh0YWJsZSwgbW9kZWwpIC8vICdtb2RlbCcgY2FuIGNoYW5nZSBzbyB0aGlzIG5lZWRzIHRvIGJlIHJlLWNhY2hlZCBmb3IgZXZlcnkgcmVuZGVyXG5cbiAgICBsZXQgZWRpdFBhdGgsIHZpZXdQYXRoXG5cbiAgICBpZiAoZWRpdE1vZGVsUGF0aCAmJiBtb2RlbC5jYW4oXCJlZGl0XCIpKSB7XG4gICAgICBlZGl0UGF0aCA9IGVkaXRNb2RlbFBhdGgodGhpcy5tb2RlbENhbGxiYWNrQXJncylcbiAgICB9XG5cbiAgICBpZiAodmlld01vZGVsUGF0aCAmJiBtb2RlbC5jYW4oXCJzaG93XCIpKSB7XG4gICAgICB2aWV3UGF0aCA9IHZpZXdNb2RlbFBhdGgodGhpcy5tb2RlbENhbGxiYWNrQXJncylcbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFJvd1xuICAgICAgICBkYXRhU2V0PXt0aGlzLmNhY2hlKFwicm93RGF0YVNldFwiLCB7Y2xhc3M6IGAke2luZmxlY3Rpb24uZGFzaGVyaXplKG1vZGVsQ2xhc3MubW9kZWxDbGFzc0RhdGEoKS5wYXJhbUtleSl9LXJvd2AsIG1vZGVsSWQ6IG1vZGVsLmlkKCl9LCBbbW9kZWwuaWQoKSwgbW9kZWxDbGFzcy5tb2RlbENsYXNzRGF0YSgpLnBhcmFtS2V5XSl9XG4gICAgICAgIHN0eWxlPXtzdHlsZUZvclJvdyh7ZXZlbn0pfVxuICAgICAgPlxuICAgICAgICB7d29ya3BsYWNlICYmXG4gICAgICAgICAgPENvbHVtbiBkYXRhU2V0PXt0aGlzLmNhY2hlKFwiY29sdW1uRGF0YVNldFwiLCB7Y2xhc3M6IFwid29ya3BsYWNlLWNvbHVtblwifSl9IHN0eWxlPXtzdHlsZUZvckNvbHVtbih7ZXZlbiwgc3R5bGU6IHt3aWR0aDogNDF9fSl9PlxuICAgICAgICAgICAgPFdvcmtlclBsdWdpbnNDaGVja2JveFxuICAgICAgICAgICAgICBjdXJyZW50V29ya3BsYWNlPXtjdXJyZW50V29ya3BsYWNlfVxuICAgICAgICAgICAgICBtb2RlbD17bW9kZWx9XG4gICAgICAgICAgICAgIHN0eWxlPXt0aGlzLmNhY2hlKFwid29ya2VyUGx1Z2luc0NoZWNrYm94U3R5bGVcIiwge21hcmdpbkhvcml6b250YWw6IFwiYXV0b1wifSl9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvQ29sdW1uPlxuICAgICAgICB9XG4gICAgICAgIHtjb2x1bW5zICYmIHRoaXMuY29sdW1uc0NvbnRlbnRGcm9tQ29sdW1ucyhtb2RlbCwgZXZlbil9XG4gICAgICAgIDxDb2x1bW4gZGF0YVNldD17dGhpcy5jYWNoZShcImFjdGlvbnNDb2x1bW5EYXRhU2V0XCIsIHtjbGFzczogXCJhY3Rpb25zLWNvbHVtblwifSl9IHN0eWxlPXtzdHlsZUZvckNvbHVtbih7ZXZlbiwgc3R5bGU6IHt9LCB0eXBlOiBcImFjdGlvbnNcIn0pfT5cbiAgICAgICAgICB7YWN0aW9uc0NvbnRlbnQgJiYgYWN0aW9uc0NvbnRlbnQodGhpcy50dC5tb2RlbENhbGxiYWNrQXJncyl9XG4gICAgICAgICAge3ZpZXdQYXRoICYmXG4gICAgICAgICAgICA8TGluayBkYXRhU2V0PXt0aGlzLmNhY2hlKFwidmlld0J1dHRvbkRhdGFTZXRcIiwge2NsYXNzOiBcInZpZXctYnV0dG9uXCJ9KX0gc3R5bGU9e3RoaXMuY2FjaGUoXCJzZWFyY2hMaW5rU3R5bGVcIiwge21hcmdpbkxlZnQ6IDIsIG1hcmdpblJpZ2h0OiAyfSl9IHRvPXt2aWV3UGF0aH0+XG4gICAgICAgICAgICAgIDxJY29uIG5hbWU9XCJzZWFyY2hcIiBzaXplPXsxOH0gLz5cbiAgICAgICAgICAgIDwvTGluaz5cbiAgICAgICAgICB9XG4gICAgICAgICAge2VkaXRQYXRoICYmXG4gICAgICAgICAgICA8TGluayBkYXRhU2V0PXt0aGlzLmNhY2hlKFwiZWRpdEJ1dHRvbkRhdGFTZXRcIiwge2NsYXNzOiBcImVkaXQtYnV0dG9uXCJ9KX0gc3R5bGU9e3RoaXMuY2FjaGUoXCJlZGl0QnV0dG9uU3R5bGVcIiwge21hcmdpbkxlZnQ6IDIsIG1hcmdpblJpZ2h0OiAyfSl9IHRvPXtlZGl0UGF0aH0+XG4gICAgICAgICAgICAgIDxJY29uIG5hbWU9XCJwZW5jaWxcIiBzaXplPXsyMH0gLz5cbiAgICAgICAgICAgIDwvTGluaz5cbiAgICAgICAgICB9XG4gICAgICAgICAge2Rlc3Ryb3lFbmFibGVkICYmIG1vZGVsLmNhbihcImRlc3Ryb3lcIikgJiZcbiAgICAgICAgICAgIDxQcmVzc2FibGVcbiAgICAgICAgICAgICAgZGF0YVNldD17dGhpcy5jYWNoZShcImRlc3Ryb3lCdXR0b25EYXRhU2V0XCIsIHtjbGFzczogXCJkZXN0cm95LWJ1dHRvblwifSl9XG4gICAgICAgICAgICAgIHN0eWxlPXt0aGlzLmNhY2hlKFwiZGVzdHJveUJ1dHRvblN0eWxlXCIsIHttYXJnaW5MZWZ0OiAyLCBtYXJnaW5SaWdodDogMn0pfVxuICAgICAgICAgICAgICBvblByZXNzPXt0aGlzLnR0Lm9uRGVzdHJveUNsaWNrZWR9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxJY29uIG5hbWU9XCJyZW1vdmVcIiBzaXplPXsyMn0gLz5cbiAgICAgICAgICAgIDwvUHJlc3NhYmxlPlxuICAgICAgICAgIH1cbiAgICAgICAgPC9Db2x1bW4+XG4gICAgICA8L1Jvdz5cbiAgICApXG4gIH1cblxuICBjb2x1bW5zQ29udGVudEZyb21Db2x1bW5zKG1vZGVsLCBldmVuKSB7XG4gICAgY29uc3Qge2NvbHVtbnMsIGV2ZW50cywgdGFibGV9ID0gdGhpcy5wXG5cbiAgICByZXR1cm4gY29sdW1ucz8ubWFwKCh7YW5pbWF0ZWRQb3NpdGlvbiwgYW5pbWF0ZWRXaWR0aCwgYW5pbWF0ZWRaSW5kZXgsIGNvbHVtbiwgdGFibGVTZXR0aW5nQ29sdW1ufSwgY29sdW1uSW5kZXgpID0+XG4gICAgICA8TW9kZWxDb2x1bW5cbiAgICAgICAgYW5pbWF0ZWRQb3NpdGlvbj17YW5pbWF0ZWRQb3NpdGlvbn1cbiAgICAgICAgYW5pbWF0ZWRXaWR0aD17YW5pbWF0ZWRXaWR0aH1cbiAgICAgICAgYW5pbWF0ZWRaSW5kZXg9e2FuaW1hdGVkWkluZGV4fVxuICAgICAgICBjb2x1bW49e2NvbHVtbn1cbiAgICAgICAgY29sdW1uSW5kZXg9e2NvbHVtbkluZGV4fVxuICAgICAgICBldmVuPXtldmVufVxuICAgICAgICBldmVudHM9e2V2ZW50c31cbiAgICAgICAga2V5PXtjb2x1bW5JZGVudGlmaWVyKGNvbHVtbil9XG4gICAgICAgIG1vZGVsPXttb2RlbH1cbiAgICAgICAgdGFibGU9e3RhYmxlfVxuICAgICAgICB0YWJsZVNldHRpbmdDb2x1bW49e3RhYmxlU2V0dGluZ0NvbHVtbn1cbiAgICAgIC8+XG4gICAgKVxuICB9XG5cbiAgb25EZXN0cm95Q2xpY2tlZCA9IGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB7dH0gPSB0aGlzLnR0XG4gICAgY29uc3Qge2Rlc3Ryb3lNZXNzYWdlfSA9IHRoaXMucC50YWJsZS5wcm9wc1xuICAgIGNvbnN0IHttb2RlbH0gPSB0aGlzLnBcblxuICAgIGlmICghY29uZmlybSh0KFwianMuc2hhcmVkLmFyZV95b3Vfc3VyZVwiKSkpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCBtb2RlbC5kZXN0cm95KClcblxuICAgICAgaWYgKGRlc3Ryb3lNZXNzYWdlKSB7XG4gICAgICAgIEZsYXNoTm90aWZpY2F0aW9ucy5zdWNjZXNzKGRlc3Ryb3lNZXNzYWdlKVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBGbGFzaE5vdGlmaWNhdGlvbnMuZXJyb3JSZXNwb25zZShlcnJvcilcbiAgICB9XG4gIH1cbn0pKVxuIl19