import React, { useMemo } from "react";
import BaseComponent from "../base-component.js";
import classNames from "classnames";
import Header from "./components/header.js";
import HeaderColumnContent from "./header-column-content.js";
import Icon from "../utils/icon.js";
import memo from "set-state-compare/build/memo.js";
import { Animated, PanResponder } from "react-native";
import PropTypes from "prop-types";
import propTypesExact from "prop-types-exact";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import useBreakpoint from "../use-breakpoint.js";
import Widths from "./widths.js";
export default memo(shapeComponent(class ApiMakerTableHeaderColumn extends BaseComponent {
    static propTypes = propTypesExact({
        active: PropTypes.bool.isRequired,
        animatedWidth: PropTypes.instanceOf(Animated.Value).isRequired,
        animatedZIndex: PropTypes.instanceOf(Animated.Value).isRequired,
        column: PropTypes.object.isRequired,
        resizing: PropTypes.bool.isRequired,
        table: PropTypes.object.isRequired,
        tableSettingColumn: PropTypes.object.isRequired,
        touchProps: PropTypes.object.isRequired,
        widths: PropTypes.instanceOf(Widths).isRequired
    });
    setup() {
        const { name: breakpoint, mdUp, smDown } = useBreakpoint();
        this.setInstance({ breakpoint, mdUp, smDown });
        this.useStates({
            resizing: false
        });
        this.resizePanResponder = useMemo(() => PanResponder.create({
            onStartShouldSetPanResponder: (_e) => {
                this.originalWidth = this.currentWidth;
                this.setState({ resizing: true });
                this.p.table.setState({ resizing: true });
                return true;
            },
            onPanResponderMove: (_e, gestate) => {
                const newWidth = this.tt.originalWidth + gestate.dx;
                this.p.widths.setWidthOfColumn({
                    identifier: this.p.tableSettingColumn.identifier(),
                    width: newWidth
                });
            },
            onPanResponderRelease: this.tt.onResizeEnd,
            onPanResponderTerminate: this.tt.onResizeEnd,
            onPanResponderTerminationRequest: () => false // Don't let another PanResponder steal focus and stop resizing until release
        }), []);
    }
    onResizeEnd = async () => {
        this.p.table.setState({ lastUpdate: new Date(), resizing: false });
        this.setState({ resizing: false });
        const width = this.p.widths.getWidthOfColumn(this.p.tableSettingColumn.identifier());
        await this.p.tableSettingColumn.update({ width });
    };
    render() {
        const { mdUp } = this.tt;
        const { active, animatedWidth, column, resizing, table, tableSettingColumn, touchProps } = this.p;
        const { styleForHeader } = table.tt;
        const headerProps = table.headerProps(column);
        const { style, ...restColumnProps } = headerProps;
        const actualStyle = useMemo(() => {
            const actualStyle = Object.assign({
                cursor: resizing ? "col-resize" : undefined,
                width: mdUp ? animatedWidth : "100%",
                height: mdUp ? "100%" : undefined
            }, style);
            return actualStyle;
        }, [active, animatedWidth, mdUp, resizing, style]);
        return (<Header dataSet={{
                className: classNames(...table.headerClassNameForColumn(column)),
                identifier: tableSettingColumn.identifier()
            }} onLayout={this.tt.onLayout} style={styleForHeader({ style: actualStyle })} {...restColumnProps}>
        {mdUp &&
                <Icon name="bars" style={this.cache("barsIconStyle", { marginRight: 3, fontSize: 12 })} {...touchProps}/>}
        <HeaderColumnContent column={column} table={table} tableSettingColumn={tableSettingColumn}/>
        {mdUp &&
                <Animated.View style={this.cache("resizeColumnViewStyle", {
                        position: "absolute",
                        top: 0,
                        right: 0,
                        width: 10,
                        height: "100%",
                        cursor: "col-resize",
                        zIndex: 9999
                    })} {...this.tt.resizePanResponder.panHandlers}/>}
      </Header>);
    }
    onLayout = (e) => {
        const { width } = e.nativeEvent.layout;
        this.currentWidth = width;
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVhZGVyLWNvbHVtbi5qcyIsInNvdXJjZVJvb3QiOiIvc3JjLyIsInNvdXJjZXMiOlsidGFibGUvaGVhZGVyLWNvbHVtbi5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLEVBQUUsRUFBQyxPQUFPLEVBQUMsTUFBTSxPQUFPLENBQUE7QUFDcEMsT0FBTyxhQUFhLE1BQU0sc0JBQXNCLENBQUE7QUFDaEQsT0FBTyxVQUFVLE1BQU0sWUFBWSxDQUFBO0FBQ25DLE9BQU8sTUFBTSxNQUFNLHdCQUF3QixDQUFBO0FBQzNDLE9BQU8sbUJBQW1CLE1BQU0sNEJBQTRCLENBQUE7QUFDNUQsT0FBTyxJQUFJLE1BQU0sa0JBQWtCLENBQUE7QUFDbkMsT0FBTyxJQUFJLE1BQU0saUNBQWlDLENBQUE7QUFDbEQsT0FBTyxFQUFDLFFBQVEsRUFBRSxZQUFZLEVBQUMsTUFBTSxjQUFjLENBQUE7QUFDbkQsT0FBTyxTQUFTLE1BQU0sWUFBWSxDQUFBO0FBQ2xDLE9BQU8sY0FBYyxNQUFNLGtCQUFrQixDQUFBO0FBQzdDLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSw0Q0FBNEMsQ0FBQTtBQUN6RSxPQUFPLGFBQWEsTUFBTSxzQkFBc0IsQ0FBQTtBQUNoRCxPQUFPLE1BQU0sTUFBTSxhQUFhLENBQUE7QUFFaEMsZUFBZSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0seUJBQTBCLFNBQVEsYUFBYTtJQUN0RixNQUFNLENBQUMsU0FBUyxHQUFHLGNBQWMsQ0FBQztRQUNoQyxNQUFNLEVBQUUsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVO1FBQ2pDLGFBQWEsRUFBRSxTQUFTLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxVQUFVO1FBQzlELGNBQWMsRUFBRSxTQUFTLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxVQUFVO1FBQy9ELE1BQU0sRUFBRSxTQUFTLENBQUMsTUFBTSxDQUFDLFVBQVU7UUFDbkMs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Z0JBQ0gsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLGVBQWUsRUFBRSxFQUFDLFdBQVcsRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLFVBQVUsQ0FBQyxFQUN2RyxDQUNBO1FBQUEsQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLGtCQUFrQixDQUFDLEVBQzFGO1FBQUEsQ0FBQyxJQUFJO2dCQUNILENBQUMsUUFBUSxDQUFDLElBQUksQ0FDWixLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLHVCQUF1QixFQUFFO3dCQUN6QyxRQUFRLEVBQUUsVUFBVTt3QkFDcEIsR0FBRyxFQUFFLENBQUM7d0JBQ04sS0FBSyxFQUFFLENBQUM7d0JBQ1IsS0FBSyxFQUFFLEVBQUU7d0JBQ1QsTUFBTSxFQUFFLE1BQU07d0JBQ2QsTUFBTSxFQUFFLFlBQVk7d0JBQ3BCLE1BQU0sRUFBRSxJQUFJO3FCQUNiLENBQUMsQ0FBQyxDQUNILElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLENBQUMsRUFFL0MsQ0FDRjtNQUFBLEVBQUUsTUFBTSxDQUFDLENBQ1YsQ0FBQTtJQUNILENBQUM7SUFFRCxRQUFRLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRTtRQUNmLE1BQU0sRUFBQyxLQUFLLEVBQUMsR0FBRyxDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQTtRQUVwQyxJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQTtJQUMzQixDQUFDLENBQUE7Q0FDRixDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwge3VzZU1lbW99IGZyb20gXCJyZWFjdFwiXG5pbXBvcnQgQmFzZUNvbXBvbmVudCBmcm9tIFwiLi4vYmFzZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSBcImNsYXNzbmFtZXNcIlxuaW1wb3J0IEhlYWRlciBmcm9tIFwiLi9jb21wb25lbnRzL2hlYWRlci5qc1wiXG5pbXBvcnQgSGVhZGVyQ29sdW1uQ29udGVudCBmcm9tIFwiLi9oZWFkZXItY29sdW1uLWNvbnRlbnQuanNcIlxuaW1wb3J0IEljb24gZnJvbSBcIi4uL3V0aWxzL2ljb24uanNcIlxuaW1wb3J0IG1lbW8gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL21lbW8uanNcIlxuaW1wb3J0IHtBbmltYXRlZCwgUGFuUmVzcG9uZGVyfSBmcm9tIFwicmVhY3QtbmF0aXZlXCJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIlxuaW1wb3J0IHByb3BUeXBlc0V4YWN0IGZyb20gXCJwcm9wLXR5cGVzLWV4YWN0XCJcbmltcG9ydCB7c2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IHVzZUJyZWFrcG9pbnQgZnJvbSBcIi4uL3VzZS1icmVha3BvaW50LmpzXCJcbmltcG9ydCBXaWR0aHMgZnJvbSBcIi4vd2lkdGhzLmpzXCJcblxuZXhwb3J0IGRlZmF1bHQgbWVtbyhzaGFwZUNvbXBvbmVudChjbGFzcyBBcGlNYWtlclRhYmxlSGVhZGVyQ29sdW1uIGV4dGVuZHMgQmFzZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSBwcm9wVHlwZXNFeGFjdCh7XG4gICAgYWN0aXZlOiBQcm9wVHlwZXMuYm9vbC5pc1JlcXVpcmVkLFxuICAgIGFuaW1hdGVkV2lkdGg6IFByb3BUeXBlcy5pbnN0YW5jZU9mKEFuaW1hdGVkLlZhbHVlKS5pc1JlcXVpcmVkLFxuICAgIGFuaW1hdGVkWkluZGV4OiBQcm9wVHlwZXMuaW5zdGFuY2VPZihBbmltYXRlZC5WYWx1ZSkuaXNSZXF1aXJlZCxcbiAgICBjb2x1bW46IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICByZXNpemluZzogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCxcbiAgICB0YWJsZTogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIHRhYmxlU2V0dGluZ0NvbHVtbjogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIHRvdWNoUHJvcHM6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICB3aWR0aHM6IFByb3BUeXBlcy5pbnN0YW5jZU9mKFdpZHRocykuaXNSZXF1aXJlZFxuICB9KVxuXG4gIHNldHVwKCkge1xuICAgIGNvbnN0IHtuYW1lOiBicmVha3BvaW50LCBtZFVwLCBzbURvd259ID0gdXNlQnJlYWtwb2ludCgpXG5cbiAgICB0aGlzLnNldEluc3RhbmNlKHticmVha3BvaW50LCBtZFVwLCBzbURvd259KVxuICAgIHRoaXMudXNlU3RhdGVzKHtcbiAgICAgIHJlc2l6aW5nOiBmYWxzZVxuICAgIH0pXG5cbiAgICB0aGlzLnJlc2l6ZVBhblJlc3BvbmRlciA9IHVzZU1lbW8oXG4gICAgICAoKSA9PiBQYW5SZXNwb25kZXIuY3JlYXRlKHtcbiAgICAgICAgb25TdGFydFNob3VsZFNldFBhblJlc3BvbmRlcjogKF9lKSA9PiB7XG4gICAgICAgICAgdGhpcy5vcmlnaW5hbFdpZHRoID0gdGhpcy5jdXJyZW50V2lkdGhcbiAgICAgICAgICB0aGlzLnNldFN0YXRlKHtyZXNpemluZzogdHJ1ZX0pXG4gICAgICAgICAgdGhpcy5wLnRhYmxlLnNldFN0YXRlKHtyZXNpemluZzogdHJ1ZX0pXG5cbiAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBvblBhblJlc3BvbmRlck1vdmU6IChfZSwgZ2VzdGF0ZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IG5ld1dpZHRoID0gdGhpcy50dC5vcmlnaW5hbFdpZHRoICsgZ2VzdGF0ZS5keFxuXG4gICAgICAgICAgdGhpcy5wLndpZHRocy5zZXRXaWR0aE9mQ29sdW1uKHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6IHRoaXMucC50YWJsZVNldHRpbmdDb2x1bW4uaWRlbnRpZmllcigpLFxuICAgICAgICAgICAgd2lkdGg6IG5ld1dpZHRoXG4gICAgICAgICAgfSlcbiAgICAgICAgfSxcbiAgICAgICAgb25QYW5SZXNwb25kZXJSZWxlYXNlOiB0aGlzLnR0Lm9uUmVzaXplRW5kLFxuICAgICAgICBvblBhblJlc3BvbmRlclRlcm1pbmF0ZTogdGhpcy50dC5vblJlc2l6ZUVuZCxcbiAgICAgICAgb25QYW5SZXNwb25kZXJUZXJtaW5hdGlvblJlcXVlc3Q6ICgpID0+IGZhbHNlIC8vIERvbid0IGxldCBhbm90aGVyIFBhblJlc3BvbmRlciBzdGVhbCBmb2N1cyBhbmQgc3RvcCByZXNpemluZyB1bnRpbCByZWxlYXNlXG4gICAgICB9KSxcbiAgICAgIFtdXG4gICAgKVxuICB9XG5cbiAgb25SZXNpemVFbmQgPSBhc3luYyAoKSA9PiB7XG4gICAgdGhpcy5wLnRhYmxlLnNldFN0YXRlKHtsYXN0VXBkYXRlOiBuZXcgRGF0ZSgpLCByZXNpemluZzogZmFsc2V9KVxuICAgIHRoaXMuc2V0U3RhdGUoe3Jlc2l6aW5nOiBmYWxzZX0pXG5cbiAgICBjb25zdCB3aWR0aCA9IHRoaXMucC53aWR0aHMuZ2V0V2lkdGhPZkNvbHVtbih0aGlzLnAudGFibGVTZXR0aW5nQ29sdW1uLmlkZW50aWZpZXIoKSlcblxuICAgIGF3YWl0IHRoaXMucC50YWJsZVNldHRpbmdDb2x1bW4udXBkYXRlKHt3aWR0aH0pXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge21kVXB9ID0gdGhpcy50dFxuICAgIGNvbnN0IHthY3RpdmUsIGFuaW1hdGVkV2lkdGgsIGNvbHVtbiwgcmVzaXppbmcsIHRhYmxlLCB0YWJsZVNldHRpbmdDb2x1bW4sIHRvdWNoUHJvcHN9ID0gdGhpcy5wXG4gICAgY29uc3Qge3N0eWxlRm9ySGVhZGVyfSA9IHRhYmxlLnR0XG4gICAgY29uc3QgaGVhZGVyUHJvcHMgPSB0YWJsZS5oZWFkZXJQcm9wcyhjb2x1bW4pXG4gICAgY29uc3Qge3N0eWxlLCAuLi5yZXN0Q29sdW1uUHJvcHN9ID0gaGVhZGVyUHJvcHNcbiAgICBjb25zdCBhY3R1YWxTdHlsZSA9IHVzZU1lbW8oXG4gICAgICAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGFjdHVhbFN0eWxlID0gT2JqZWN0LmFzc2lnbihcbiAgICAgICAgICB7XG4gICAgICAgICAgICBjdXJzb3I6IHJlc2l6aW5nID8gXCJjb2wtcmVzaXplXCIgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICB3aWR0aDogbWRVcCA/IGFuaW1hdGVkV2lkdGggOiBcIjEwMCVcIixcbiAgICAgICAgICAgIGhlaWdodDogbWRVcCA/IFwiMTAwJVwiIDogdW5kZWZpbmVkXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzdHlsZVxuICAgICAgICApXG5cbiAgICAgICAgcmV0dXJuIGFjdHVhbFN0eWxlXG4gICAgICB9LFxuICAgICAgW2FjdGl2ZSwgYW5pbWF0ZWRXaWR0aCwgbWRVcCwgcmVzaXppbmcsIHN0eWxlXVxuICAgIClcblxuICAgIHJldHVybiAoXG4gICAgICA8SGVhZGVyXG4gICAgICAgIGRhdGFTZXQ9e3tcbiAgICAgICAgICBjbGFzc05hbWU6IGNsYXNzTmFtZXMoLi4udGFibGUuaGVhZGVyQ2xhc3NOYW1lRm9yQ29sdW1uKGNvbHVtbikpLFxuICAgICAgICAgIGlkZW50aWZpZXI6IHRhYmxlU2V0dGluZ0NvbHVtbi5pZGVudGlmaWVyKClcbiAgICAgICAgfX1cbiAgICAgICAgb25MYXlvdXQ9e3RoaXMudHQub25MYXlvdXR9XG4gICAgICAgIHN0eWxlPXtzdHlsZUZvckhlYWRlcih7c3R5bGU6IGFjdHVhbFN0eWxlfSl9XG4gICAgICAgIHsuLi5yZXN0Q29sdW1uUHJvcHN9XG4gICAgICA+XG4gICAgICAgIHttZFVwICYmXG4gICAgICAgICAgPEljb24gbmFtZT1cImJhcnNcIiBzdHlsZT17dGhpcy5jYWNoZShcImJhcnNJY29uU3R5bGVcIiwge21hcmdpblJpZ2h0OiAzLCBmb250U2l6ZTogMTJ9KX0gey4uLnRvdWNoUHJvcHN9IC8+XG4gICAgICAgIH1cbiAgICAgICAgPEhlYWRlckNvbHVtbkNvbnRlbnQgY29sdW1uPXtjb2x1bW59IHRhYmxlPXt0YWJsZX0gdGFibGVTZXR0aW5nQ29sdW1uPXt0YWJsZVNldHRpbmdDb2x1bW59IC8+XG4gICAgICAgIHttZFVwICYmXG4gICAgICAgICAgPEFuaW1hdGVkLlZpZXdcbiAgICAgICAgICAgIHN0eWxlPXt0aGlzLmNhY2hlKFwicmVzaXplQ29sdW1uVmlld1N0eWxlXCIsIHtcbiAgICAgICAgICAgICAgcG9zaXRpb246IFwiYWJzb2x1dGVcIixcbiAgICAgICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgICAgICByaWdodDogMCxcbiAgICAgICAgICAgICAgd2lkdGg6IDEwLFxuICAgICAgICAgICAgICBoZWlnaHQ6IFwiMTAwJVwiLFxuICAgICAgICAgICAgICBjdXJzb3I6IFwiY29sLXJlc2l6ZVwiLFxuICAgICAgICAgICAgICB6SW5kZXg6IDk5OTlcbiAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgey4uLnRoaXMudHQucmVzaXplUGFuUmVzcG9uZGVyLnBhbkhhbmRsZXJzfVxuICAgICAgICAgIC8+XG4gICAgICAgIH1cbiAgICAgIDwvSGVhZGVyPlxuICAgIClcbiAgfVxuXG4gIG9uTGF5b3V0ID0gKGUpID0+IHtcbiAgICBjb25zdCB7d2lkdGh9ID0gZS5uYXRpdmVFdmVudC5sYXlvdXRcblxuICAgIHRoaXMuY3VycmVudFdpZHRoID0gd2lkdGhcbiAgfVxufSkpXG4iXX0=