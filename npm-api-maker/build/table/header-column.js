import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import React, { useMemo } from "react";
import BaseComponent from "../base-component";
import classNames from "classnames";
import Header from "./components/header";
import HeaderColumnContent from "./header-column-content";
import Icon from "../utils/icon";
import memo from "set-state-compare/build/memo.js";
import { Animated, PanResponder } from "react-native";
import PropTypes from "prop-types";
import propTypesExact from "prop-types-exact";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import useBreakpoint from "../use-breakpoint.js";
import Widths from "./widths";
export default memo(shapeComponent(class ApiMakerTableHeaderColumn extends BaseComponent {
    static propTypes = propTypesExact({
        active: PropTypes.bool.isRequired,
        animatedWidth: PropTypes.instanceOf(Animated.Value).isRequired,
        animatedZIndex: PropTypes.instanceOf(Animated.Value).isRequired,
        column: PropTypes.object.isRequired,
        resizing: PropTypes.bool.isRequired,
        table: PropTypes.object.isRequired,
        tableSettingColumn: PropTypes.object.isRequired,
        touchProps: PropTypes.object.isRequired,
        widths: PropTypes.instanceOf(Widths).isRequired
    });
    setup() {
        const { name: breakpoint, mdUp, smDown } = useBreakpoint();
        this.setInstance({ breakpoint, mdUp, smDown });
        this.useStates({
            resizing: false
        });
        this.resizePanResponder = useMemo(() => PanResponder.create({
            onStartShouldSetPanResponder: (_e) => {
                this.originalWidth = this.currentWidth;
                this.setState({ resizing: true });
                this.p.table.setState({ resizing: true });
                return true;
            },
            onPanResponderMove: (_e, gestate) => {
                const newWidth = this.tt.originalWidth + gestate.dx;
                this.p.widths.setWidthOfColumn({
                    identifier: this.p.tableSettingColumn.identifier(),
                    width: newWidth
                });
            },
            onPanResponderRelease: this.tt.onResizeEnd,
            onPanResponderTerminate: this.tt.onResizeEnd,
            onPanResponderTerminationRequest: () => false // Don't let another PanResponder steal focus and stop resizing until release
        }), []);
    }
    onResizeEnd = async () => {
        this.p.table.setState({ lastUpdate: new Date(), resizing: false });
        this.setState({ resizing: false });
        const width = this.p.widths.getWidthOfColumn(this.p.tableSettingColumn.identifier());
        await this.p.tableSettingColumn.update({ width });
    };
    render() {
        const { mdUp } = this.tt;
        const { active, animatedWidth, column, resizing, table, tableSettingColumn, touchProps } = this.p;
        const { styleForHeader } = table.tt;
        const headerProps = table.headerProps(column);
        const { style, ...restColumnProps } = headerProps;
        const actualStyle = useMemo(() => {
            const actualStyle = Object.assign({
                cursor: resizing ? "col-resize" : undefined,
                width: mdUp ? animatedWidth : "100%",
                height: mdUp ? "100%" : undefined
            }, style);
            return actualStyle;
        }, [active, animatedWidth, mdUp, resizing, style]);
        return (_jsxs(Header, { dataSet: {
                className: classNames(...table.headerClassNameForColumn(column)),
                identifier: tableSettingColumn.identifier()
            }, onLayout: this.tt.onLayout, style: styleForHeader({ style: actualStyle }), ...restColumnProps, children: [mdUp &&
                    _jsx(Icon, { name: "bars", style: this.cache("barsIconStyle", { marginRight: 3, fontSize: 12 }), ...touchProps }), _jsx(HeaderColumnContent, { column: column, table: table, tableSettingColumn: tableSettingColumn }), mdUp &&
                    _jsx(Animated.View, { style: this.cache("resizeColumnViewStyle", {
                            position: "absolute",
                            top: 0,
                            right: 0,
                            width: 10,
                            height: "100%",
                            cursor: "col-resize",
                            zIndex: 9999
                        }), ...this.tt.resizePanResponder.panHandlers })] }));
    }
    onLayout = (e) => {
        const { width } = e.nativeEvent.layout;
        this.currentWidth = width;
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVhZGVyLWNvbHVtbi5qcyIsInNvdXJjZVJvb3QiOiIvc3JjLyIsInNvdXJjZXMiOlsidGFibGUvaGVhZGVyLWNvbHVtbi5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sS0FBSyxFQUFFLEVBQUMsT0FBTyxFQUFDLE1BQU0sT0FBTyxDQUFBO0FBQ3BDLE9BQU8sYUFBYSxNQUFNLG1CQUFtQixDQUFBO0FBQzdDLE9BQU8sVUFBVSxNQUFNLFlBQVksQ0FBQTtBQUNuQyxPQUFPLE1BQU0sTUFBTSxxQkFBcUIsQ0FBQTtBQUN4QyxPQUFPLG1CQUFtQixNQUFNLHlCQUF5QixDQUFBO0FBQ3pELE9BQU8sSUFBSSxNQUFNLGVBQWUsQ0FBQTtBQUNoQyxPQUFPLElBQUksTUFBTSxpQ0FBaUMsQ0FBQTtBQUNsRCxPQUFPLEVBQUMsUUFBUSxFQUFFLFlBQVksRUFBQyxNQUFNLGNBQWMsQ0FBQTtBQUNuRCxPQUFPLFNBQVMsTUFBTSxZQUFZLENBQUE7QUFDbEMsT0FBTyxjQUFjLE1BQU0sa0JBQWtCLENBQUE7QUFDN0MsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLDRDQUE0QyxDQUFBO0FBQ3pFLE9BQU8sYUFBYSxNQUFNLHNCQUFzQixDQUFBO0FBQ2hELE9BQU8sTUFBTSxNQUFNLFVBQVUsQ0FBQTtBQUU3QixlQUFlLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSx5QkFBMEIsU0FBUSxhQUFhO0lBQ3RGLE1BQU0sQ0FBQyxTQUFTLEdBQUcsY0FBYyxDQUFDO1FBQ2hDLE1BQU0sRUFBRSxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVU7UUFDakMsYUFBYSxFQUFFLFNBQVMsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLFVBQVU7UUFDOUQsY0FBYyxFQUFFLFNBQVMsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLFVBQVU7UUFDL0QsTUFBTSxFQUFFLFNBQVMsQ0FBQyxNQUFNLENBQUMsVUFBVTtRQUNuQyxR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SUFBSSxDQUFDLEtBQUssQ0FBQyxlQUFlLEVBQUUsRUFBQyxXQUFXLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUMsQ0FBQyxLQUFNLFVBQVUsR0FBSSxFQUUxRyxLQUFDLG1CQUFtQixJQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxrQkFBa0IsRUFBRSxrQkFBa0IsR0FBSSxFQUM1RixJQUFJO29CQUNILEtBQUMsUUFBUSxDQUFDLElBQUksSUFDWixLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyx1QkFBdUIsRUFBRTs0QkFDekMsUUFBUSxFQUFFLFVBQVU7NEJBQ3BCLEdBQUcsRUFBRSxDQUFDOzRCQUNOLEtBQUssRUFBRSxDQUFDOzRCQUNSLEtBQUssRUFBRSxFQUFFOzRCQUNULE1BQU0sRUFBRSxNQUFNOzRCQUNkLE1BQU0sRUFBRSxZQUFZOzRCQUNwQixNQUFNLEVBQUUsSUFBSTt5QkFDYixDQUFDLEtBQ0UsSUFBSSxDQUFDLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLEdBQzFDLElBRUcsQ0FDVixDQUFBO0lBQ0gsQ0FBQztJQUVELFFBQVEsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFO1FBQ2YsTUFBTSxFQUFDLEtBQUssRUFBQyxHQUFHLENBQUMsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFBO1FBRXBDLElBQUksQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFBO0lBQzNCLENBQUMsQ0FBQTtDQUNGLENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7dXNlTWVtb30gZnJvbSBcInJlYWN0XCJcbmltcG9ydCBCYXNlQ29tcG9uZW50IGZyb20gXCIuLi9iYXNlLWNvbXBvbmVudFwiXG5pbXBvcnQgY2xhc3NOYW1lcyBmcm9tIFwiY2xhc3NuYW1lc1wiXG5pbXBvcnQgSGVhZGVyIGZyb20gXCIuL2NvbXBvbmVudHMvaGVhZGVyXCJcbmltcG9ydCBIZWFkZXJDb2x1bW5Db250ZW50IGZyb20gXCIuL2hlYWRlci1jb2x1bW4tY29udGVudFwiXG5pbXBvcnQgSWNvbiBmcm9tIFwiLi4vdXRpbHMvaWNvblwiXG5pbXBvcnQgbWVtbyBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvbWVtby5qc1wiXG5pbXBvcnQge0FuaW1hdGVkLCBQYW5SZXNwb25kZXJ9IGZyb20gXCJyZWFjdC1uYXRpdmVcIlxuaW1wb3J0IFByb3BUeXBlcyBmcm9tIFwicHJvcC10eXBlc1wiXG5pbXBvcnQgcHJvcFR5cGVzRXhhY3QgZnJvbSBcInByb3AtdHlwZXMtZXhhY3RcIlxuaW1wb3J0IHtzaGFwZUNvbXBvbmVudH0gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL3NoYXBlLWNvbXBvbmVudC5qc1wiXG5pbXBvcnQgdXNlQnJlYWtwb2ludCBmcm9tIFwiLi4vdXNlLWJyZWFrcG9pbnQuanNcIlxuaW1wb3J0IFdpZHRocyBmcm9tIFwiLi93aWR0aHNcIlxuXG5leHBvcnQgZGVmYXVsdCBtZW1vKHNoYXBlQ29tcG9uZW50KGNsYXNzIEFwaU1ha2VyVGFibGVIZWFkZXJDb2x1bW4gZXh0ZW5kcyBCYXNlQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHByb3BUeXBlc0V4YWN0KHtcbiAgICBhY3RpdmU6IFByb3BUeXBlcy5ib29sLmlzUmVxdWlyZWQsXG4gICAgYW5pbWF0ZWRXaWR0aDogUHJvcFR5cGVzLmluc3RhbmNlT2YoQW5pbWF0ZWQuVmFsdWUpLmlzUmVxdWlyZWQsXG4gICAgYW5pbWF0ZWRaSW5kZXg6IFByb3BUeXBlcy5pbnN0YW5jZU9mKEFuaW1hdGVkLlZhbHVlKS5pc1JlcXVpcmVkLFxuICAgIGNvbHVtbjogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIHJlc2l6aW5nOiBQcm9wVHlwZXMuYm9vbC5pc1JlcXVpcmVkLFxuICAgIHRhYmxlOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgdGFibGVTZXR0aW5nQ29sdW1uOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gICAgdG91Y2hQcm9wczogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIHdpZHRoczogUHJvcFR5cGVzLmluc3RhbmNlT2YoV2lkdGhzKS5pc1JlcXVpcmVkXG4gIH0pXG5cbiAgc2V0dXAoKSB7XG4gICAgY29uc3Qge25hbWU6IGJyZWFrcG9pbnQsIG1kVXAsIHNtRG93bn0gPSB1c2VCcmVha3BvaW50KClcblxuICAgIHRoaXMuc2V0SW5zdGFuY2Uoe2JyZWFrcG9pbnQsIG1kVXAsIHNtRG93bn0pXG4gICAgdGhpcy51c2VTdGF0ZXMoe1xuICAgICAgcmVzaXppbmc6IGZhbHNlXG4gICAgfSlcblxuICAgIHRoaXMucmVzaXplUGFuUmVzcG9uZGVyID0gdXNlTWVtbyhcbiAgICAgICgpID0+IFBhblJlc3BvbmRlci5jcmVhdGUoe1xuICAgICAgICBvblN0YXJ0U2hvdWxkU2V0UGFuUmVzcG9uZGVyOiAoX2UpID0+IHtcbiAgICAgICAgICB0aGlzLm9yaWdpbmFsV2lkdGggPSB0aGlzLmN1cnJlbnRXaWR0aFxuICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe3Jlc2l6aW5nOiB0cnVlfSlcbiAgICAgICAgICB0aGlzLnAudGFibGUuc2V0U3RhdGUoe3Jlc2l6aW5nOiB0cnVlfSlcblxuICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIG9uUGFuUmVzcG9uZGVyTW92ZTogKF9lLCBnZXN0YXRlKSA9PiB7XG4gICAgICAgICAgY29uc3QgbmV3V2lkdGggPSB0aGlzLnR0Lm9yaWdpbmFsV2lkdGggKyBnZXN0YXRlLmR4XG5cbiAgICAgICAgICB0aGlzLnAud2lkdGhzLnNldFdpZHRoT2ZDb2x1bW4oe1xuICAgICAgICAgICAgaWRlbnRpZmllcjogdGhpcy5wLnRhYmxlU2V0dGluZ0NvbHVtbi5pZGVudGlmaWVyKCksXG4gICAgICAgICAgICB3aWR0aDogbmV3V2lkdGhcbiAgICAgICAgICB9KVxuICAgICAgICB9LFxuICAgICAgICBvblBhblJlc3BvbmRlclJlbGVhc2U6IHRoaXMudHQub25SZXNpemVFbmQsXG4gICAgICAgIG9uUGFuUmVzcG9uZGVyVGVybWluYXRlOiB0aGlzLnR0Lm9uUmVzaXplRW5kLFxuICAgICAgICBvblBhblJlc3BvbmRlclRlcm1pbmF0aW9uUmVxdWVzdDogKCkgPT4gZmFsc2UgLy8gRG9uJ3QgbGV0IGFub3RoZXIgUGFuUmVzcG9uZGVyIHN0ZWFsIGZvY3VzIGFuZCBzdG9wIHJlc2l6aW5nIHVudGlsIHJlbGVhc2VcbiAgICAgIH0pLFxuICAgICAgW11cbiAgICApXG4gIH1cblxuICBvblJlc2l6ZUVuZCA9IGFzeW5jICgpID0+IHtcbiAgICB0aGlzLnAudGFibGUuc2V0U3RhdGUoe2xhc3RVcGRhdGU6IG5ldyBEYXRlKCksIHJlc2l6aW5nOiBmYWxzZX0pXG4gICAgdGhpcy5zZXRTdGF0ZSh7cmVzaXppbmc6IGZhbHNlfSlcblxuICAgIGNvbnN0IHdpZHRoID0gdGhpcy5wLndpZHRocy5nZXRXaWR0aE9mQ29sdW1uKHRoaXMucC50YWJsZVNldHRpbmdDb2x1bW4uaWRlbnRpZmllcigpKVxuXG4gICAgYXdhaXQgdGhpcy5wLnRhYmxlU2V0dGluZ0NvbHVtbi51cGRhdGUoe3dpZHRofSlcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7bWRVcH0gPSB0aGlzLnR0XG4gICAgY29uc3Qge2FjdGl2ZSwgYW5pbWF0ZWRXaWR0aCwgY29sdW1uLCByZXNpemluZywgdGFibGUsIHRhYmxlU2V0dGluZ0NvbHVtbiwgdG91Y2hQcm9wc30gPSB0aGlzLnBcbiAgICBjb25zdCB7c3R5bGVGb3JIZWFkZXJ9ID0gdGFibGUudHRcbiAgICBjb25zdCBoZWFkZXJQcm9wcyA9IHRhYmxlLmhlYWRlclByb3BzKGNvbHVtbilcbiAgICBjb25zdCB7c3R5bGUsIC4uLnJlc3RDb2x1bW5Qcm9wc30gPSBoZWFkZXJQcm9wc1xuICAgIGNvbnN0IGFjdHVhbFN0eWxlID0gdXNlTWVtbyhcbiAgICAgICgpID0+IHtcbiAgICAgICAgY29uc3QgYWN0dWFsU3R5bGUgPSBPYmplY3QuYXNzaWduKFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGN1cnNvcjogcmVzaXppbmcgPyBcImNvbC1yZXNpemVcIiA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHdpZHRoOiBtZFVwID8gYW5pbWF0ZWRXaWR0aCA6IFwiMTAwJVwiLFxuICAgICAgICAgICAgaGVpZ2h0OiBtZFVwID8gXCIxMDAlXCIgOiB1bmRlZmluZWRcbiAgICAgICAgICB9LFxuICAgICAgICAgIHN0eWxlXG4gICAgICAgIClcblxuICAgICAgICByZXR1cm4gYWN0dWFsU3R5bGVcbiAgICAgIH0sXG4gICAgICBbYWN0aXZlLCBhbmltYXRlZFdpZHRoLCBtZFVwLCByZXNpemluZywgc3R5bGVdXG4gICAgKVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxIZWFkZXJcbiAgICAgICAgZGF0YVNldD17e1xuICAgICAgICAgIGNsYXNzTmFtZTogY2xhc3NOYW1lcyguLi50YWJsZS5oZWFkZXJDbGFzc05hbWVGb3JDb2x1bW4oY29sdW1uKSksXG4gICAgICAgICAgaWRlbnRpZmllcjogdGFibGVTZXR0aW5nQ29sdW1uLmlkZW50aWZpZXIoKVxuICAgICAgICB9fVxuICAgICAgICBvbkxheW91dD17dGhpcy50dC5vbkxheW91dH1cbiAgICAgICAgc3R5bGU9e3N0eWxlRm9ySGVhZGVyKHtzdHlsZTogYWN0dWFsU3R5bGV9KX1cbiAgICAgICAgey4uLnJlc3RDb2x1bW5Qcm9wc31cbiAgICAgID5cbiAgICAgICAge21kVXAgJiZcbiAgICAgICAgICA8SWNvbiBuYW1lPVwiYmFyc1wiIHN0eWxlPXt0aGlzLmNhY2hlKFwiYmFyc0ljb25TdHlsZVwiLCB7bWFyZ2luUmlnaHQ6IDMsIGZvbnRTaXplOiAxMn0pfSB7Li4udG91Y2hQcm9wc30gLz5cbiAgICAgICAgfVxuICAgICAgICA8SGVhZGVyQ29sdW1uQ29udGVudCBjb2x1bW49e2NvbHVtbn0gdGFibGU9e3RhYmxlfSB0YWJsZVNldHRpbmdDb2x1bW49e3RhYmxlU2V0dGluZ0NvbHVtbn0gLz5cbiAgICAgICAge21kVXAgJiZcbiAgICAgICAgICA8QW5pbWF0ZWQuVmlld1xuICAgICAgICAgICAgc3R5bGU9e3RoaXMuY2FjaGUoXCJyZXNpemVDb2x1bW5WaWV3U3R5bGVcIiwge1xuICAgICAgICAgICAgICBwb3NpdGlvbjogXCJhYnNvbHV0ZVwiLFxuICAgICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICAgIHJpZ2h0OiAwLFxuICAgICAgICAgICAgICB3aWR0aDogMTAsXG4gICAgICAgICAgICAgIGhlaWdodDogXCIxMDAlXCIsXG4gICAgICAgICAgICAgIGN1cnNvcjogXCJjb2wtcmVzaXplXCIsXG4gICAgICAgICAgICAgIHpJbmRleDogOTk5OVxuICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICB7Li4udGhpcy50dC5yZXNpemVQYW5SZXNwb25kZXIucGFuSGFuZGxlcnN9XG4gICAgICAgICAgLz5cbiAgICAgICAgfVxuICAgICAgPC9IZWFkZXI+XG4gICAgKVxuICB9XG5cbiAgb25MYXlvdXQgPSAoZSkgPT4ge1xuICAgIGNvbnN0IHt3aWR0aH0gPSBlLm5hdGl2ZUV2ZW50LmxheW91dFxuXG4gICAgdGhpcy5jdXJyZW50V2lkdGggPSB3aWR0aFxuICB9XG59KSlcbiJdfQ==