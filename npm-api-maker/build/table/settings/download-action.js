import BaseComponent from "../../base-component.js";
import ColumnContent from "../column-content.js";
import columnIdentifier from "../column-identifier.js";
import columnVisible from "../column-visible.js";
import { saveAs } from "file-saver";
import Icon from "../../utils/icon.js";
import memo from "set-state-compare/build/memo.js";
import PropTypes from "prop-types";
import propTypesExact from "prop-types-exact";
import React from "react";
import { renderToString } from "react-dom/server";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import { Pressable } from "react-native";
import Text from "../../utils/text.js";
export default memo(shapeComponent(class ApiMakerTableSettingsDownloadAction extends BaseComponent {
    static propTypes = propTypesExact({
        l: PropTypes.func.isRequired,
        table: PropTypes.object.isRequired
    });
    render() {
        return (<Pressable dataSet={this.cache("pressableDataSet", { component: "api-maker/table/settings/download-action" })} onPress={this.tt.onDownloadPress} style={this.cache("pressableStyle", { flexDirection: "row", alignItems: "center" })}>
        <Icon name="download" size={20}/>
        <Text style={this.cache("textStyle", { marginLeft: 5 })}>
          Download
        </Text>
      </Pressable>);
    }
    onDownloadPress = () => {
        const { l, table } = this.p;
        const { modelClass } = table.p;
        const { collection } = table.tt;
        const { models } = collection;
        const { preparedColumns } = table.s;
        const tableElement = (<table>
        <thead>
          <tr>
            {preparedColumns?.map(({ column, tableSettingColumn }) => columnVisible(column, tableSettingColumn) &&
                <th key={columnIdentifier(column)}>
                {table.headerLabelForColumn(column)}
              </th>)}
          </tr>
        </thead>
        <tbody>
          {models.map((model) => <tr key={model.id()}>
              {preparedColumns?.map(({ column, tableSettingColumn }) => columnVisible(column, tableSettingColumn) &&
                    <td key={columnIdentifier(column)}>
                  {new ColumnContent({ column, l, mode: "html", model, table }).content()}
                </td>)}
            </tr>)}
        </tbody>
      </table>);
        const tableHTML = renderToString(tableElement);
        const blob = new Blob([tableHTML], { type: "text/html;charset=utf-8" });
        const fileName = `${modelClass.modelName().human({ count: 2 })}.html`;
        saveAs(blob, fileName);
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG93bmxvYWQtYWN0aW9uLmpzIiwic291cmNlUm9vdCI6Ii9zcmMvIiwic291cmNlcyI6WyJ0YWJsZS9zZXR0aW5ncy9kb3dubG9hZC1hY3Rpb24uanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sYUFBYSxNQUFNLHlCQUF5QixDQUFBO0FBQ25ELE9BQU8sYUFBYSxNQUFNLHNCQUFzQixDQUFBO0FBQ2hELE9BQU8sZ0JBQWdCLE1BQU0seUJBQXlCLENBQUE7QUFDdEQsT0FBTyxhQUFhLE1BQU0sc0JBQXNCLENBQUE7QUFDaEQsT0FBTyxFQUFDLE1BQU0sRUFBQyxNQUFNLFlBQVksQ0FBQTtBQUNqQyxPQUFPLElBQUksTUFBTSxxQkFBcUIsQ0FBQTtBQUN0QyxPQUFPLElBQUksTUFBTSxpQ0FBaUMsQ0FBQTtBQUNsRCxPQUFPLFNBQVMsTUFBTSxZQUFZLENBQUE7QUFDbEMsT0FBTyxjQUFjLE1BQU0sa0JBQWtCLENBQUE7QUFDN0MsT0FBTyxLQUFLLE1BQU0sT0FBTyxDQUFBO0FBQ3pCLE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSxrQkFBa0IsQ0FBQTtBQUMvQyxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sNENBQTRDLENBQUE7QUFDekUsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLGNBQWMsQ0FBQTtBQUN0QyxPQUFPLElBQUksTUFBTSxxQkFBcUIsQ0FBQTtBQUV0QyxlQUFlLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxtQ0FBb0MsU0FBUSxhQUFhO0lBQ2hHLE1BQU0sQ0FBQyxTQUFTLEdBQUcsY0FBYyxDQUFDO1FBQ2hDLENBQUMsRUFBRSxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVU7UUFDNUIsS0FBSyxFQUFFLFNBQVMsQ0FBQyxNQUFNLENBQUMsVUFBVTtLQUNuQyxDQUFDLENBQUE7SUFFRixNQUFNO1FBQ0osT0FBTyxDQUNMLENBQUMsU0FBUyxDQUNSLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsa0JBQWtCLEVB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LEdBQUcsR0FBRyxVQUFVLENBQUMsU0FBUyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUMsS0FBSyxFQUFFLENBQUMsRUFBQyxDQUFDLE9BQU8sQ0FBQTtRQUVuRSxNQUFNLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFBO0lBQ3hCLENBQUMsQ0FBQTtDQUNGLENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJhc2VDb21wb25lbnQgZnJvbSBcIi4uLy4uL2Jhc2UtY29tcG9uZW50LmpzXCJcbmltcG9ydCBDb2x1bW5Db250ZW50IGZyb20gXCIuLi9jb2x1bW4tY29udGVudC5qc1wiXG5pbXBvcnQgY29sdW1uSWRlbnRpZmllciBmcm9tIFwiLi4vY29sdW1uLWlkZW50aWZpZXIuanNcIlxuaW1wb3J0IGNvbHVtblZpc2libGUgZnJvbSBcIi4uL2NvbHVtbi12aXNpYmxlLmpzXCJcbmltcG9ydCB7c2F2ZUFzfSBmcm9tIFwiZmlsZS1zYXZlclwiXG5pbXBvcnQgSWNvbiBmcm9tIFwiLi4vLi4vdXRpbHMvaWNvbi5qc1wiXG5pbXBvcnQgbWVtbyBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvbWVtby5qc1wiXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gXCJwcm9wLXR5cGVzXCJcbmltcG9ydCBwcm9wVHlwZXNFeGFjdCBmcm9tIFwicHJvcC10eXBlcy1leGFjdFwiXG5pbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCJcbmltcG9ydCB7cmVuZGVyVG9TdHJpbmd9IGZyb20gXCJyZWFjdC1kb20vc2VydmVyXCJcbmltcG9ydCB7c2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IHtQcmVzc2FibGV9IGZyb20gXCJyZWFjdC1uYXRpdmVcIlxuaW1wb3J0IFRleHQgZnJvbSBcIi4uLy4uL3V0aWxzL3RleHQuanNcIlxuXG5leHBvcnQgZGVmYXVsdCBtZW1vKHNoYXBlQ29tcG9uZW50KGNsYXNzIEFwaU1ha2VyVGFibGVTZXR0aW5nc0Rvd25sb2FkQWN0aW9uIGV4dGVuZHMgQmFzZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSBwcm9wVHlwZXNFeGFjdCh7XG4gICAgbDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICB0YWJsZTogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkXG4gIH0pXG5cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8UHJlc3NhYmxlXG4gICAgICAgIGRhdGFTZXQ9e3RoaXMuY2FjaGUoXCJwcmVzc2FibGVEYXRhU2V0XCIsIHtjb21wb25lbnQ6IFwiYXBpLW1ha2VyL3RhYmxlL3NldHRpbmdzL2Rvd25sb2FkLWFjdGlvblwifSl9XG4gICAgICAgIG9uUHJlc3M9e3RoaXMudHQub25Eb3dubG9hZFByZXNzfVxuICAgICAgICBzdHlsZT17dGhpcy5jYWNoZShcInByZXNzYWJsZVN0eWxlXCIsIHtmbGV4RGlyZWN0aW9uOiBcInJvd1wiLCBhbGlnbkl0ZW1zOiBcImNlbnRlclwifSl9XG4gICAgICA+XG4gICAgICAgIDxJY29uIG5hbWU9XCJkb3dubG9hZFwiIHNpemU9ezIwfSAvPlxuICAgICAgICA8VGV4dCBzdHlsZT17dGhpcy5jYWNoZShcInRleHRTdHlsZVwiLCB7bWFyZ2luTGVmdDogNX0pfT5cbiAgICAgICAgICBEb3dubG9hZFxuICAgICAgICA8L1RleHQ+XG4gICAgICA8L1ByZXNzYWJsZT5cbiAgICApXG4gIH1cblxuICBvbkRvd25sb2FkUHJlc3MgPSAoKSA9PiB7XG4gICAgY29uc3Qge2wsIHRhYmxlfSA9IHRoaXMucFxuICAgIGNvbnN0IHttb2RlbENsYXNzfSA9IHRhYmxlLnBcbiAgICBjb25zdCB7Y29sbGVjdGlvbn0gPSB0YWJsZS50dFxuICAgIGNvbnN0IHttb2RlbHN9ID0gY29sbGVjdGlvblxuICAgIGNvbnN0IHtwcmVwYXJlZENvbHVtbnN9ID0gdGFibGUuc1xuICAgIGNvbnN0IHRhYmxlRWxlbWVudCA9IChcbiAgICAgIDx0YWJsZT5cbiAgICAgICAgPHRoZWFkPlxuICAgICAgICAgIDx0cj5cbiAgICAgICAgICAgIHtwcmVwYXJlZENvbHVtbnM/Lm1hcCgoe2NvbHVtbiwgdGFibGVTZXR0aW5nQ29sdW1ufSkgPT4gY29sdW1uVmlzaWJsZShjb2x1bW4sIHRhYmxlU2V0dGluZ0NvbHVtbikgJiZcbiAgICAgICAgICAgICAgPHRoIGtleT17Y29sdW1uSWRlbnRpZmllcihjb2x1bW4pfT5cbiAgICAgICAgICAgICAgICB7dGFibGUuaGVhZGVyTGFiZWxGb3JDb2x1bW4oY29sdW1uKX1cbiAgICAgICAgICAgICAgPC90aD5cbiAgICAgICAgICAgICl9XG4gICAgICAgICAgPC90cj5cbiAgICAgICAgPC90aGVhZD5cbiAgICAgICAgPHRib2R5PlxuICAgICAgICAgIHttb2RlbHMubWFwKChtb2RlbCkgPT5cbiAgICAgICAgICAgIDx0ciBrZXk9e21vZGVsLmlkKCl9PlxuICAgICAgICAgICAgICB7cHJlcGFyZWRDb2x1bW5zPy5tYXAoKHtjb2x1bW4sIHRhYmxlU2V0dGluZ0NvbHVtbn0pID0+IGNvbHVtblZpc2libGUoY29sdW1uLCB0YWJsZVNldHRpbmdDb2x1bW4pICYmXG4gICAgICAgICAgICAgICAgPHRkIGtleT17Y29sdW1uSWRlbnRpZmllcihjb2x1bW4pfT5cbiAgICAgICAgICAgICAgICAgIHtuZXcgQ29sdW1uQ29udGVudCh7Y29sdW1uLCBsLCBtb2RlOiBcImh0bWxcIiwgbW9kZWwsIHRhYmxlfSkuY29udGVudCgpfVxuICAgICAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgICAgICAgICl9XG4gICAgICAgICAgICA8L3RyPlxuICAgICAgICAgICl9XG4gICAgICAgIDwvdGJvZHk+XG4gICAgICA8L3RhYmxlPlxuICAgIClcbiAgICBjb25zdCB0YWJsZUhUTUwgPSByZW5kZXJUb1N0cmluZyh0YWJsZUVsZW1lbnQpXG4gICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFt0YWJsZUhUTUxdLCB7dHlwZTogXCJ0ZXh0L2h0bWw7Y2hhcnNldD11dGYtOFwifSlcbiAgICBjb25zdCBmaWxlTmFtZSA9IGAke21vZGVsQ2xhc3MubW9kZWxOYW1lKCkuaHVtYW4oe2NvdW50OiAyfSl9Lmh0bWxgXG5cbiAgICBzYXZlQXMoYmxvYiwgZmlsZU5hbWUpXG4gIH1cbn0pKVxuIl19