import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import BaseComponent from "../../base-component";
import ColumnContent from "../column-content";
import columnIdentifier from "../column-identifier.js";
import columnVisible from "../column-visible.js";
import { saveAs } from "file-saver";
import Icon from "../../utils/icon";
import memo from "set-state-compare/build/memo.js";
import PropTypes from "prop-types";
import propTypesExact from "prop-types-exact";
import React from "react";
import { renderToString } from "react-dom/server";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import { Pressable } from "react-native";
import Text from "../../utils/text";
export default memo(shapeComponent(class ApiMakerTableSettingsDownloadAction extends BaseComponent {
    static propTypes = propTypesExact({
        l: PropTypes.func.isRequired,
        table: PropTypes.object.isRequired
    });
    render() {
        return (_jsxs(Pressable, { dataSet: this.cache("pressableDataSet", { component: "api-maker/table/settings/download-action" }), onPress: this.tt.onDownloadPress, style: this.cache("pressableStyle", { flexDirection: "row", alignItems: "center" }), children: [_jsx(Icon, { name: "download", size: 20 }), _jsx(Text, { style: this.cache("textStyle", { marginLeft: 5 }), children: "Download" })] }));
    }
    onDownloadPress = () => {
        const { l, table } = this.p;
        const { modelClass } = table.p;
        const { collection } = table.tt;
        const { models } = collection;
        const { preparedColumns } = table.s;
        const tableElement = (_jsxs("table", { children: [_jsx("thead", { children: _jsx("tr", { children: preparedColumns?.map(({ column, tableSettingColumn }) => columnVisible(column, tableSettingColumn) &&
                            _jsx("th", { children: table.headerLabelForColumn(column) }, columnIdentifier(column))) }) }), _jsx("tbody", { children: models.map((model) => _jsx("tr", { children: preparedColumns?.map(({ column, tableSettingColumn }) => columnVisible(column, tableSettingColumn) &&
                            _jsx("td", { children: new ColumnContent({ column, l, mode: "html", model, table }).content() }, columnIdentifier(column))) }, model.id())) })] }));
        const tableHTML = renderToString(tableElement);
        const blob = new Blob([tableHTML], { type: "text/html;charset=utf-8" });
        const fileName = `${modelClass.modelName().human({ count: 2 })}.html`;
        saveAs(blob, fileName);
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG93bmxvYWQtYWN0aW9uLmpzIiwic291cmNlUm9vdCI6Ii9zcmMvIiwic291cmNlcyI6WyJ0YWJsZS9zZXR0aW5ncy9kb3dubG9hZC1hY3Rpb24uanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLGFBQWEsTUFBTSxzQkFBc0IsQ0FBQTtBQUNoRCxPQUFPLGFBQWEsTUFBTSxtQkFBbUIsQ0FBQTtBQUM3QyxPQUFPLGdCQUFnQixNQUFNLHlCQUF5QixDQUFBO0FBQ3RELE9BQU8sYUFBYSxNQUFNLHNCQUFzQixDQUFBO0FBQ2hELE9BQU8sRUFBQyxNQUFNLEVBQUMsTUFBTSxZQUFZLENBQUE7QUFDakMsT0FBTyxJQUFJLE1BQU0sa0JBQWtCLENBQUE7QUFDbkMsT0FBTyxJQUFJLE1BQU0saUNBQWlDLENBQUE7QUFDbEQsT0FBTyxTQUFTLE1BQU0sWUFBWSxDQUFBO0FBQ2xDLE9BQU8sY0FBYyxNQUFNLGtCQUFrQixDQUFBO0FBQzdDLE9BQU8sS0FBSyxNQUFNLE9BQU8sQ0FBQTtBQUN6QixPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sa0JBQWtCLENBQUE7QUFDL0MsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLDRDQUE0QyxDQUFBO0FBQ3pFLE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSxjQUFjLENBQUE7QUFDdEMsT0FBTyxJQUFJLE1BQU0sa0JBQWtCLENBQUE7QUFFbkMsZUFBZSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sbUNBQW9DLFNBQVEsYUFBYTtJQUNoRyxNQUFNLENBQUMsU0FBUyxHQUFHLGNBQWMsQ0FBQztRQUNoQyxDQUFDLEVBQUUsU0FBUyxDQUFDLElBQUksQ0FBQyxVQUFVO1FBQzVCLEtBQUssRUFBRSxTQUFTLENBQUMsTUFBTSxDQUFDLFVBQVU7S0FDbkMsQ0FBQyxDQUFBO0lBRUYsTUFBTTtRQUNKLE9BQU8sQ0FDTCxNQUFDLFNBQVMsSUFDUixPQUFPLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsRUFBRSxFQUFDLFNBQVMsRUFBRSwwQ0FBMEMsRUFBQyxDQUFDLEVBQ2hHLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLGVBQWUsRUFDaEMsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLEVBQUUsRUFBQyxhQUFhLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUMsQ0FBQyxhQUVqRixLQUFDLElBQUksSUFBQyxJQUFJLEVBQUMsVUFBVSxFQUFDLElBQUksRUFBRSxFQUFFLEdBQUksRUFDbEMsS0FBQyxJQUFJLElBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUFFLEVBQUMsVUFBVSxFQUFFLENBQUMsRUFBQyxDQUFDLHlCQUU5QyxJQUNHLENBQ2IsQ0FBQTtJQUNILENBQUM7SUFFRCxlQUFlLEdBQUcsR0FBRyxFQUFFO1FBQ3JCLE1BQU0sRUFBQyxDQUFDLEVBQUUsS0FBSyxFQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQTtRQUN6QixNQUFNLEVBQUMsVUFBVSxFQUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQTtRQUM1QixNQUFNLEVBQUMsVUFBVSxFQUFDLEdBQUcsS0FBSyxDQUFDLEVBQUUsQ0FBQTtRQUM3QixNQUFNLEVBQUMsTUFBTSxFQUFDLEdBQUcsVUFBVSxDQUFBO1FBQzNCLE1BQU0sRUFBQyxlQUFlLEVBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFBO1FBQ2pDLE1BQU0sWUFBWSxHQUFHLENBQ25CLDRCQUNFLDBCQUNFLHVCQUNHLGVBQWUsRUFBRSxHQUFHLENBQUMsQ0FBQyxFQUFDLE1BQU0sRUFBRSxrQkFBa0IsRUFBQyxFQUFFLEVBQUUsQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFLGtCQUFrQixDQUFDOzRCQUMvRix1QkFDRyxLQUFLLENBQUMsb0JBQW9CLENBQUMsTUFBTSxDQUFDLElBRDVCLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUU1QixDQUNOLEdBQ0UsR0FDQyxFQUNSLDBCQUNHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUNwQix1QkFDRyxlQUFlLEVBQUUsR0FBRyxDQUFDLENBQUMsRUFBQyxNQUFNLEVBQUUsa0JBQWtCLEVBQUMsRUFBRSxFQUFFLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxrQkFBa0IsQ0FBQzs0QkFDL0YsdUJBQ0csSUFBSSxhQUFhLENBQUMsRUFBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBQyxDQUFDLENBQUMsT0FBTyxFQUFFLElBRDlELGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUU1QixDQUNOLElBTE0sS0FBSyxDQUFDLEVBQUUsRUFBRSxDQU1kLENBQ04sR0FDSyxJQUNGLENBQ1QsQ0FBQTtRQUNELE1BQU0sU0FBUyxHQUFHLGNBQWMsQ0FBQyxZQUFZLENBQUMsQ0FBQTtRQUM5QyxNQUFNLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxDQUFDLFNBQVMsQ0FBQyxFQUFFLEVBQUMsSUFBSSxFQUFFLHlCQUF5QixFQUFDLENBQUMsQ0FBQTtRQUNyRSxNQUFNLFFBQVEsR0FBRyxHQUFHLFVBQVUsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBQyxLQUFLLEVBQUUsQ0FBQyxFQUFDLENBQUMsT0FBTyxDQUFBO1FBRW5FLE1BQU0sQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUE7SUFDeEIsQ0FBQyxDQUFBO0NBQ0YsQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQmFzZUNvbXBvbmVudCBmcm9tIFwiLi4vLi4vYmFzZS1jb21wb25lbnRcIlxuaW1wb3J0IENvbHVtbkNvbnRlbnQgZnJvbSBcIi4uL2NvbHVtbi1jb250ZW50XCJcbmltcG9ydCBjb2x1bW5JZGVudGlmaWVyIGZyb20gXCIuLi9jb2x1bW4taWRlbnRpZmllci5qc1wiXG5pbXBvcnQgY29sdW1uVmlzaWJsZSBmcm9tIFwiLi4vY29sdW1uLXZpc2libGUuanNcIlxuaW1wb3J0IHtzYXZlQXN9IGZyb20gXCJmaWxlLXNhdmVyXCJcbmltcG9ydCBJY29uIGZyb20gXCIuLi8uLi91dGlscy9pY29uXCJcbmltcG9ydCBtZW1vIGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9tZW1vLmpzXCJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIlxuaW1wb3J0IHByb3BUeXBlc0V4YWN0IGZyb20gXCJwcm9wLXR5cGVzLWV4YWN0XCJcbmltcG9ydCBSZWFjdCBmcm9tIFwicmVhY3RcIlxuaW1wb3J0IHtyZW5kZXJUb1N0cmluZ30gZnJvbSBcInJlYWN0LWRvbS9zZXJ2ZXJcIlxuaW1wb3J0IHtzaGFwZUNvbXBvbmVudH0gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL3NoYXBlLWNvbXBvbmVudC5qc1wiXG5pbXBvcnQge1ByZXNzYWJsZX0gZnJvbSBcInJlYWN0LW5hdGl2ZVwiXG5pbXBvcnQgVGV4dCBmcm9tIFwiLi4vLi4vdXRpbHMvdGV4dFwiXG5cbmV4cG9ydCBkZWZhdWx0IG1lbW8oc2hhcGVDb21wb25lbnQoY2xhc3MgQXBpTWFrZXJUYWJsZVNldHRpbmdzRG93bmxvYWRBY3Rpb24gZXh0ZW5kcyBCYXNlQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHByb3BUeXBlc0V4YWN0KHtcbiAgICBsOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHRhYmxlOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWRcbiAgfSlcblxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxQcmVzc2FibGVcbiAgICAgICAgZGF0YVNldD17dGhpcy5jYWNoZShcInByZXNzYWJsZURhdGFTZXRcIiwge2NvbXBvbmVudDogXCJhcGktbWFrZXIvdGFibGUvc2V0dGluZ3MvZG93bmxvYWQtYWN0aW9uXCJ9KX1cbiAgICAgICAgb25QcmVzcz17dGhpcy50dC5vbkRvd25sb2FkUHJlc3N9XG4gICAgICAgIHN0eWxlPXt0aGlzLmNhY2hlKFwicHJlc3NhYmxlU3R5bGVcIiwge2ZsZXhEaXJlY3Rpb246IFwicm93XCIsIGFsaWduSXRlbXM6IFwiY2VudGVyXCJ9KX1cbiAgICAgID5cbiAgICAgICAgPEljb24gbmFtZT1cImRvd25sb2FkXCIgc2l6ZT17MjB9IC8+XG4gICAgICAgIDxUZXh0IHN0eWxlPXt0aGlzLmNhY2hlKFwidGV4dFN0eWxlXCIsIHttYXJnaW5MZWZ0OiA1fSl9PlxuICAgICAgICAgIERvd25sb2FkXG4gICAgICAgIDwvVGV4dD5cbiAgICAgIDwvUHJlc3NhYmxlPlxuICAgIClcbiAgfVxuXG4gIG9uRG93bmxvYWRQcmVzcyA9ICgpID0+IHtcbiAgICBjb25zdCB7bCwgdGFibGV9ID0gdGhpcy5wXG4gICAgY29uc3Qge21vZGVsQ2xhc3N9ID0gdGFibGUucFxuICAgIGNvbnN0IHtjb2xsZWN0aW9ufSA9IHRhYmxlLnR0XG4gICAgY29uc3Qge21vZGVsc30gPSBjb2xsZWN0aW9uXG4gICAgY29uc3Qge3ByZXBhcmVkQ29sdW1uc30gPSB0YWJsZS5zXG4gICAgY29uc3QgdGFibGVFbGVtZW50ID0gKFxuICAgICAgPHRhYmxlPlxuICAgICAgICA8dGhlYWQ+XG4gICAgICAgICAgPHRyPlxuICAgICAgICAgICAge3ByZXBhcmVkQ29sdW1ucz8ubWFwKCh7Y29sdW1uLCB0YWJsZVNldHRpbmdDb2x1bW59KSA9PiBjb2x1bW5WaXNpYmxlKGNvbHVtbiwgdGFibGVTZXR0aW5nQ29sdW1uKSAmJlxuICAgICAgICAgICAgICA8dGgga2V5PXtjb2x1bW5JZGVudGlmaWVyKGNvbHVtbil9PlxuICAgICAgICAgICAgICAgIHt0YWJsZS5oZWFkZXJMYWJlbEZvckNvbHVtbihjb2x1bW4pfVxuICAgICAgICAgICAgICA8L3RoPlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L3RyPlxuICAgICAgICA8L3RoZWFkPlxuICAgICAgICA8dGJvZHk+XG4gICAgICAgICAge21vZGVscy5tYXAoKG1vZGVsKSA9PlxuICAgICAgICAgICAgPHRyIGtleT17bW9kZWwuaWQoKX0+XG4gICAgICAgICAgICAgIHtwcmVwYXJlZENvbHVtbnM/Lm1hcCgoe2NvbHVtbiwgdGFibGVTZXR0aW5nQ29sdW1ufSkgPT4gY29sdW1uVmlzaWJsZShjb2x1bW4sIHRhYmxlU2V0dGluZ0NvbHVtbikgJiZcbiAgICAgICAgICAgICAgICA8dGQga2V5PXtjb2x1bW5JZGVudGlmaWVyKGNvbHVtbil9PlxuICAgICAgICAgICAgICAgICAge25ldyBDb2x1bW5Db250ZW50KHtjb2x1bW4sIGwsIG1vZGU6IFwiaHRtbFwiLCBtb2RlbCwgdGFibGV9KS5jb250ZW50KCl9XG4gICAgICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgIDwvdHI+XG4gICAgICAgICAgKX1cbiAgICAgICAgPC90Ym9keT5cbiAgICAgIDwvdGFibGU+XG4gICAgKVxuICAgIGNvbnN0IHRhYmxlSFRNTCA9IHJlbmRlclRvU3RyaW5nKHRhYmxlRWxlbWVudClcbiAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW3RhYmxlSFRNTF0sIHt0eXBlOiBcInRleHQvaHRtbDtjaGFyc2V0PXV0Zi04XCJ9KVxuICAgIGNvbnN0IGZpbGVOYW1lID0gYCR7bW9kZWxDbGFzcy5tb2RlbE5hbWUoKS5odW1hbih7Y291bnQ6IDJ9KX0uaHRtbGBcblxuICAgIHNhdmVBcyhibG9iLCBmaWxlTmFtZSlcbiAgfVxufSkpXG4iXX0=