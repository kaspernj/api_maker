import React, { useEffect, useMemo, useRef } from "react";
import BaseComponent from "../base-component.js";
import classNames from "classnames";
import Collection from "../collection.js";
import memo from "set-state-compare/build/memo.js";
import PropTypes from "prop-types";
import propTypesExact from "prop-types-exact";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import { simpleObjectDifferent } from "set-state-compare/build/diff-utils.js";
import useModelEvent from "../use-model-event.js";
const Checkbox = memo(shapeComponent(class Checkbox extends BaseComponent {
    render() {
        const { indeterminate, ...restProps } = this.props;
        const checkboxRef = useRef();
        useEffect(() => {
            checkboxRef.current.indeterminate = indeterminate;
        });
        return (<input ref={checkboxRef} type="checkbox" {...restProps}/>);
    }
}));
export default memo(shapeComponent(class ApiMakerTableWorkerPluginsCheckAllCheckbox extends BaseComponent {
    static propTypes = propTypesExact({
        currentWorkplace: PropTypes.object,
        query: PropTypes.instanceOf(Collection),
        style: PropTypes.object
    });
    setup() {
        this.useStates({
            checked: false,
            indeterminate: false
        });
        useMemo(() => {
            this.updateAllChecked();
        }, []);
        useModelEvent(this.props.currentWorkplace, "workplace_links_created", this.tt.onLinksCreated);
        useModelEvent(this.props.currentWorkplace, "workplace_links_destroyed", this.tt.onLinksDestroyed);
    }
    componentDidUpdate(prevProps) {
        const previousParams = prevProps.query.params();
        const currentParams = this.props.query.params();
        if (simpleObjectDifferent(previousParams, currentParams)) {
            this.updateAllChecked();
        }
    }
    async updateAllChecked() {
        const { query, currentWorkplace } = this.props;
        const queryLinksStatusResult = await currentWorkplace.queryLinksStatus({ query });
        const allChecked = queryLinksStatusResult.all_checked;
        const someChecked = queryLinksStatusResult.some_checked;
        this.setState({
            checked: allChecked,
            indeterminate: someChecked
        });
    }
    render() {
        const { className, style } = this.props;
        const { checked, indeterminate } = this.state;
        return (<Checkbox checked={checked} className={classNames("api-maker--table--worker-plugins-check-all-checkbox", className)} indeterminate={indeterminate} onChange={this.onCheckedChanged} style={style}/>);
    }
    modelClassName = () => this.props.query.modelClass().modelClassData().name;
    onCheckedChanged = async (e) => {
        e.preventDefault();
        const { currentWorkplace, query } = this.props;
        const checkbox = e.target;
        if (checkbox.checked) {
            await currentWorkplace.addQuery({ query });
            this.setState({ checked: true, indeterminate: false });
        }
        else {
            await currentWorkplace.removeQuery({ query });
            this.setState({ checked: false, indeterminate: false });
        }
    };
    onLinksCreated = ({ args }) => {
        if (args.created[this.modelClassName()]) {
            this.updateAllChecked();
        }
    };
    onLinksDestroyed = ({ args }) => {
        if (args.destroyed[this.modelClassName()]) {
            this.updateAllChecked();
        }
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29ya2VyLXBsdWdpbnMtY2hlY2stYWxsLWNoZWNrYm94LmpzIiwic291cmNlUm9vdCI6Ii9zcmMvIiwic291cmNlcyI6WyJ0YWJsZS93b3JrZXItcGx1Z2lucy1jaGVjay1hbGwtY2hlY2tib3guanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxFQUFFLEVBQUMsU0FBUyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUMsTUFBTSxPQUFPLENBQUE7QUFDdkQsT0FBTyxhQUFhLE1BQU0sc0JBQXNCLENBQUE7QUFDaEQsT0FBTyxVQUFVLE1BQU0sWUFBWSxDQUFBO0FBQ25DLE9BQU8sVUFBVSxNQUFNLGtCQUFrQixDQUFBO0FBQ3pDLE9BQU8sSUFBSSxNQUFNLGlDQUFpQyxDQUFBO0FBQ2xELE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQTtBQUNsQyxPQUFPLGNBQWMsTUFBTSxrQkFBa0IsQ0FBQTtBQUM3QyxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sNENBQTRDLENBQUE7QUFDekUsT0FBTyxFQUFDLHFCQUFxQixFQUFDLE1BQU0sdUNBQXVDLENBQUE7QUFDM0UsT0FBTyxhQUFhLE1BQU0sdUJBQXVCLENBQUE7QUFFakQsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLFFBQVMsU0FBUSxhQUFhO0lBQ3ZFLE1BQU07UUFDSixNQUFNLEVBQUMsYUFBYSxFQUFFLEdBQUcsU0FBUyxFQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQTtRQUNoRCxNQUFNLFdBQVcsR0FBRyxNQUFNLEVBQUUsQ0FBQTtRQUU1QixTQUFTLENBQUMsR0FBRyxFQUFFO1lBQ2IsV0FBVyxDQUFDLE9BQU8sQ0FBQyxhQUFhLEdBQUcsYUFBYSxDQUFBO1FBQ25ELENBQUMsQ0FBQyxDQUFBO1FBRUYsT0FBTyxDQUNMLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxTQUFT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QUFDLGdCQUFnQixFQUFFLEtBQUssRUFBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUE7UUFDNUMsTUFBTSxRQUFRLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQTtRQUV6QixJQUFJLFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNyQixNQUFNLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxFQUFDLEtBQUssRUFBQyxDQUFDLENBQUE7WUFDeEMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsYUFBYSxFQUFFLEtBQUssRUFBQyxDQUFDLENBQUE7UUFDdEQsQ0FBQzthQUFNLENBQUM7WUFDTixNQUFNLGdCQUFnQixDQUFDLFdBQVcsQ0FBQyxFQUFDLEtBQUssRUFBQyxDQUFDLENBQUE7WUFDM0MsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsYUFBYSxFQUFFLEtBQUssRUFBQyxDQUFDLENBQUE7UUFDdkQsQ0FBQztJQUNILENBQUMsQ0FBQTtJQUVELGNBQWMsR0FBRyxDQUFDLEVBQUMsSUFBSSxFQUFDLEVBQUUsRUFBRTtRQUMxQixJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDLEVBQUUsQ0FBQztZQUN4QyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQTtRQUN6QixDQUFDO0lBQ0gsQ0FBQyxDQUFBO0lBRUQsZ0JBQWdCLEdBQUcsQ0FBQyxFQUFDLElBQUksRUFBQyxFQUFFLEVBQUU7UUFDNUIsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQyxFQUFFLENBQUM7WUFDMUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUE7UUFDekIsQ0FBQztJQUNILENBQUMsQ0FBQTtDQUNGLENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7dXNlRWZmZWN0LCB1c2VNZW1vLCB1c2VSZWZ9IGZyb20gXCJyZWFjdFwiXG5pbXBvcnQgQmFzZUNvbXBvbmVudCBmcm9tIFwiLi4vYmFzZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSBcImNsYXNzbmFtZXNcIlxuaW1wb3J0IENvbGxlY3Rpb24gZnJvbSBcIi4uL2NvbGxlY3Rpb24uanNcIlxuaW1wb3J0IG1lbW8gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL21lbW8uanNcIlxuaW1wb3J0IFByb3BUeXBlcyBmcm9tIFwicHJvcC10eXBlc1wiXG5pbXBvcnQgcHJvcFR5cGVzRXhhY3QgZnJvbSBcInByb3AtdHlwZXMtZXhhY3RcIlxuaW1wb3J0IHtzaGFwZUNvbXBvbmVudH0gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL3NoYXBlLWNvbXBvbmVudC5qc1wiXG5pbXBvcnQge3NpbXBsZU9iamVjdERpZmZlcmVudH0gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL2RpZmYtdXRpbHMuanNcIlxuaW1wb3J0IHVzZU1vZGVsRXZlbnQgZnJvbSBcIi4uL3VzZS1tb2RlbC1ldmVudC5qc1wiXG5cbmNvbnN0IENoZWNrYm94ID0gbWVtbyhzaGFwZUNvbXBvbmVudChjbGFzcyBDaGVja2JveCBleHRlbmRzIEJhc2VDb21wb25lbnQge1xuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge2luZGV0ZXJtaW5hdGUsIC4uLnJlc3RQcm9wc30gPSB0aGlzLnByb3BzXG4gICAgY29uc3QgY2hlY2tib3hSZWYgPSB1c2VSZWYoKVxuXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgIGNoZWNrYm94UmVmLmN1cnJlbnQuaW5kZXRlcm1pbmF0ZSA9IGluZGV0ZXJtaW5hdGVcbiAgICB9KVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxpbnB1dCByZWY9e2NoZWNrYm94UmVmfSB0eXBlPVwiY2hlY2tib3hcIiB7Li4ucmVzdFByb3BzfSAvPlxuICAgIClcbiAgfVxufSkpXG5cbmV4cG9ydCBkZWZhdWx0IG1lbW8oc2hhcGVDb21wb25lbnQoY2xhc3MgQXBpTWFrZXJUYWJsZVdvcmtlclBsdWdpbnNDaGVja0FsbENoZWNrYm94IGV4dGVuZHMgQmFzZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSBwcm9wVHlwZXNFeGFjdCh7XG4gICAgY3VycmVudFdvcmtwbGFjZTogUHJvcFR5cGVzLm9iamVjdCxcbiAgICBxdWVyeTogUHJvcFR5cGVzLmluc3RhbmNlT2YoQ29sbGVjdGlvbiksXG4gICAgc3R5bGU6IFByb3BUeXBlcy5vYmplY3RcbiAgfSlcblxuICBzZXR1cCgpIHtcbiAgICB0aGlzLnVzZVN0YXRlcyh7XG4gICAgICBjaGVja2VkOiBmYWxzZSxcbiAgICAgIGluZGV0ZXJtaW5hdGU6IGZhbHNlXG4gICAgfSlcblxuICAgIHVzZU1lbW8oKCkgPT4ge1xuICAgICAgdGhpcy51cGRhdGVBbGxDaGVja2VkKClcbiAgICB9LCBbXSlcblxuICAgIHVzZU1vZGVsRXZlbnQodGhpcy5wcm9wcy5jdXJyZW50V29ya3BsYWNlLCBcIndvcmtwbGFjZV9saW5rc19jcmVhdGVkXCIsIHRoaXMudHQub25MaW5rc0NyZWF0ZWQpXG4gICAgdXNlTW9kZWxFdmVudCh0aGlzLnByb3BzLmN1cnJlbnRXb3JrcGxhY2UsIFwid29ya3BsYWNlX2xpbmtzX2Rlc3Ryb3llZFwiLCB0aGlzLnR0Lm9uTGlua3NEZXN0cm95ZWQpXG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7XG4gICAgY29uc3QgcHJldmlvdXNQYXJhbXMgPSBwcmV2UHJvcHMucXVlcnkucGFyYW1zKClcbiAgICBjb25zdCBjdXJyZW50UGFyYW1zID0gdGhpcy5wcm9wcy5xdWVyeS5wYXJhbXMoKVxuXG4gICAgaWYgKHNpbXBsZU9iamVjdERpZmZlcmVudChwcmV2aW91c1BhcmFtcywgY3VycmVudFBhcmFtcykpIHtcbiAgICAgIHRoaXMudXBkYXRlQWxsQ2hlY2tlZCgpXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgdXBkYXRlQWxsQ2hlY2tlZCgpIHtcbiAgICBjb25zdCB7cXVlcnksIGN1cnJlbnRXb3JrcGxhY2V9ID0gdGhpcy5wcm9wc1xuICAgIGNvbnN0IHF1ZXJ5TGlua3NTdGF0dXNSZXN1bHQgPSBhd2FpdCBjdXJyZW50V29ya3BsYWNlLnF1ZXJ5TGlua3NTdGF0dXMoe3F1ZXJ5fSlcbiAgICBjb25zdCBhbGxDaGVja2VkID0gcXVlcnlMaW5rc1N0YXR1c1Jlc3VsdC5hbGxfY2hlY2tlZFxuICAgIGNvbnN0IHNvbWVDaGVja2VkID0gcXVlcnlMaW5rc1N0YXR1c1Jlc3VsdC5zb21lX2NoZWNrZWRcblxuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgY2hlY2tlZDogYWxsQ2hlY2tlZCxcbiAgICAgIGluZGV0ZXJtaW5hdGU6IHNvbWVDaGVja2VkXG4gICAgfSlcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7Y2xhc3NOYW1lLCBzdHlsZX0gPSB0aGlzLnByb3BzXG4gICAgY29uc3Qge2NoZWNrZWQsIGluZGV0ZXJtaW5hdGV9ID0gdGhpcy5zdGF0ZVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxDaGVja2JveFxuICAgICAgICBjaGVja2VkPXtjaGVja2VkfVxuICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoXCJhcGktbWFrZXItLXRhYmxlLS13b3JrZXItcGx1Z2lucy1jaGVjay1hbGwtY2hlY2tib3hcIiwgY2xhc3NOYW1lKX1cbiAgICAgICAgaW5kZXRlcm1pbmF0ZT17aW5kZXRlcm1pbmF0ZX1cbiAgICAgICAgb25DaGFuZ2U9e3RoaXMub25DaGVja2VkQ2hhbmdlZH1cbiAgICAgICAgc3R5bGU9e3N0eWxlfVxuICAgICAgLz5cbiAgICApXG4gIH1cblxuICBtb2RlbENsYXNzTmFtZSA9ICgpID0+IHRoaXMucHJvcHMucXVlcnkubW9kZWxDbGFzcygpLm1vZGVsQ2xhc3NEYXRhKCkubmFtZVxuXG4gIG9uQ2hlY2tlZENoYW5nZWQgPSBhc3luYyAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKVxuXG4gICAgY29uc3Qge2N1cnJlbnRXb3JrcGxhY2UsIHF1ZXJ5fSA9IHRoaXMucHJvcHNcbiAgICBjb25zdCBjaGVja2JveCA9IGUudGFyZ2V0XG5cbiAgICBpZiAoY2hlY2tib3guY2hlY2tlZCkge1xuICAgICAgYXdhaXQgY3VycmVudFdvcmtwbGFjZS5hZGRRdWVyeSh7cXVlcnl9KVxuICAgICAgdGhpcy5zZXRTdGF0ZSh7Y2hlY2tlZDogdHJ1ZSwgaW5kZXRlcm1pbmF0ZTogZmFsc2V9KVxuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCBjdXJyZW50V29ya3BsYWNlLnJlbW92ZVF1ZXJ5KHtxdWVyeX0pXG4gICAgICB0aGlzLnNldFN0YXRlKHtjaGVja2VkOiBmYWxzZSwgaW5kZXRlcm1pbmF0ZTogZmFsc2V9KVxuICAgIH1cbiAgfVxuXG4gIG9uTGlua3NDcmVhdGVkID0gKHthcmdzfSkgPT4ge1xuICAgIGlmIChhcmdzLmNyZWF0ZWRbdGhpcy5tb2RlbENsYXNzTmFtZSgpXSkge1xuICAgICAgdGhpcy51cGRhdGVBbGxDaGVja2VkKClcbiAgICB9XG4gIH1cblxuICBvbkxpbmtzRGVzdHJveWVkID0gKHthcmdzfSkgPT4ge1xuICAgIGlmIChhcmdzLmRlc3Ryb3llZFt0aGlzLm1vZGVsQ2xhc3NOYW1lKCldKSB7XG4gICAgICB0aGlzLnVwZGF0ZUFsbENoZWNrZWQoKVxuICAgIH1cbiAgfVxufSkpXG4iXX0=