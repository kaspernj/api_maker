import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import apiMakerConfig from "@kaspernj/api-maker/build/config.js";
import BaseComponent from "../../base-component";
import Checkbox from "../../bootstrap/checkbox";
import { digg } from "diggerize";
import { FlashNotifications } from "flash-notifications";
import { Form } from "../../form";
import Input from "../../bootstrap/input";
import modelClassRequire from "../../model-class-require.js";
import React from "react";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import memo from "set-state-compare/build/memo.js";
import useI18n from "i18n-on-steroids/src/use-i18n.mjs";
const TableSearch = modelClassRequire("TableSearch");
export default memo(shapeComponent(class ApiMakerTableFiltersSaveSearchModal extends BaseComponent {
    setup() {
        const { t } = useI18n({ namespace: "js.api_maker.table.filters.save_search_modal" });
        this.t = t;
        this.useStates({ form: null });
    }
    render() {
        const { currentFilters, currentUser, onRequestClose, search, ...restProps } = this.props;
        const Modal = apiMakerConfig.getModal();
        return (_jsx(Modal, { onRequestClose: onRequestClose, ...restProps, children: _jsxs(Form, { onSubmit: this.tt.onSaveSearchSubmit, setForm: this.setStates.form, children: [_jsx(Input, { defaultValue: search.name(), id: "table_search_name", label: this.t(".search_name", { defaultValue: "Search name" }), name: "table_search[name]" }), _jsx(Checkbox, { defaultChecked: search.public(), id: "table_search_public", label: this.t(".public", { defaultValue: "Public" }), name: "table_search[public]" }), _jsx("button", { className: "save-search-submit-button", children: this.t(".save_search", { defaultValue: "Save search" }) })] }) }));
    }
    onSaveSearchSubmit = async () => {
        const formData = this.s.form.asObject();
        const { currentFilters, currentUser, onRequestClose, search } = this.p;
        const hasUserTypeColumn = Boolean(TableSearch.attributes().find((attribute) => attribute.name() == "user_type"));
        if (search.isNewRecord()) {
            formData.table_search.query_params = JSON.stringify(currentFilters());
        }
        if (hasUserTypeColumn) {
            formData.table_search.user_type = digg(currentUser.modelClassData(), "className");
        }
        formData.table_search.user_id = currentUser.id();
        try {
            await search.saveRaw(formData);
            FlashNotifications.success(this.t(".", { defaultValue: "The search was saved." }));
            onRequestClose();
        }
        catch (error) {
            FlashNotifications.errorResponse(error);
        }
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2F2ZS1zZWFyY2gtbW9kYWwuanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbInRhYmxlL2ZpbHRlcnMvc2F2ZS1zZWFyY2gtbW9kYWwuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLGNBQWMsTUFBTSxxQ0FBcUMsQ0FBQTtBQUNoRSxPQUFPLGFBQWEsTUFBTSxzQkFBc0IsQ0FBQTtBQUNoRCxPQUFPLFFBQVEsTUFBTSwwQkFBMEIsQ0FBQTtBQUMvQyxPQUFPLEVBQUMsSUFBSSxFQUFDLE1BQU0sV0FBVyxDQUFBO0FBQzlCLE9BQU8sRUFBQyxrQkFBa0IsRUFBQyxNQUFNLHFCQUFxQixDQUFBO0FBQ3RELE9BQU8sRUFBQyxJQUFJLEVBQUMsTUFBTSxZQUFZLENBQUE7QUFDL0IsT0FBTyxLQUFLLE1BQU0sdUJBQXVCLENBQUE7QUFDekMsT0FBTyxpQkFBaUIsTUFBTSw4QkFBOEIsQ0FBQTtBQUM1RCxPQUFPLEtBQUssTUFBTSxPQUFPLENBQUE7QUFDekIsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLDRDQUE0QyxDQUFBO0FBQ3pFLE9BQU8sSUFBSSxNQUFNLGlDQUFpQyxDQUFBO0FBQ2xELE9BQU8sT0FBTyxNQUFNLG1DQUFtQyxDQUFBO0FBRXZELE1BQU0sV0FBVyxHQUFHLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxDQUFBO0FBRXBELGVBQWUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLG1DQUFvQyxTQUFRLGFBQWE7SUFDaEcsS0FBSztRQUNILE1BQU0sRUFBQyxDQUFDLEVBQUMsR0FBRyxPQUFPLENBQUMsRUFBQyxTQUFTLEVBQUUsOENBQThDLEVBQUMsQ0FBQyxDQUFBO1FBRWhGLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQ1YsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFDLElBQUksRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFBO0lBQzlCLENBQUM7SUFFRCxNQUFNO1FBQ0osTUFBTSxFQUFDLGNBQWMsRUFBRSxXQUFXLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBRSxHQUFHLFNBQVMsRUFBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUE7UUFDdEYsTUFBTSxLQUFLLEdBQUcsY0FBYyxDQUFDLFFBQVEsRUFBRSxDQUFBO1FBRXZDLE9BQU8sQ0FDTCxLQUFDLEtBQUssSUFBQyxjQUFjLEVBQUUsY0FBYyxLQUFNLFNBQVMsWUFDbEQsTUFBQyxJQUFJLElBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsa0JBQWtCLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxhQUN0RSxLQUFDLEtBQUssSUFDSixZQUFZLEVBQUUsTUFBTSxDQUFDLElBQUksRUFBRSxFQUMzQixFQUFFLEVBQUMsbUJBQW1CLEVBQ3RCLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLGNBQWMsRUFBRSxFQUFDLFlBQVksRUFBRSxhQUFhLEVBQUMsQ0FBQyxFQUM1RCxJQUFJLEVBQUMsb0JBQW9CLEdBQ3pCLEVBQ0YsS0FBQyxRQUFRLElBQ1AsY0FBYyxFQUFFLE1BQU0sQ0FBQyxNQUFNLEVBQUUsRUFDL0IsRUFBRSxFQUFDLHFCQUFxQixFQUN4QixLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxTQUFTLEVBQUUsRUFBQyxZQUFZLEVBQUUsUUFBUSxFQUFDLENBQUMsRUFDbEQsSUFBSSxFQUFDLHNCQUFzQixHQUMzQixFQUNGLGlCQUFRLFNBQVMsRUFBQywyQkFBMkIsWUFDMUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxjQUFjLEVBQUUsRUFBQyxZQUFZLEVBQUUsYUFBYSxFQUFDLENBQUMsR0FDL0MsSUFDSixHQUNELENBQ1QsQ0FBQTtJQUNILENBQUM7SUFFRCxrQkFBa0IsR0FBRyxLQUFLLElBQUksRUFBRTtRQUM5QixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtRQUN2QyxNQUFNLEVBQUMsY0FBYyxFQUFFLFdBQVcsRUFBRSxjQUFjLEVBQUUsTUFBTSxFQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQTtRQUNwRSxNQUFNLGlCQUFpQixHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsVUFBVSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLElBQUksV0FBVyxDQUFDLENBQUMsQ0FBQTtRQUVoSCxJQUFJLE1BQU0sQ0FBQyxXQUFXLEVBQUUsRUFBRSxDQUFDO1lBQ3pCLFFBQVEsQ0FBQyxZQUFZLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxFQUFFLENBQUMsQ0FBQTtRQUN2RSxDQUFDO1FBRUQsSUFBSSxpQkFBaUIsRUFBRSxDQUFDO1lBQ3RCLFFBQVEsQ0FBQyxZQUFZLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsY0FBYyxFQUFFLEVBQUUsV0FBVyxDQUFDLENBQUE7UUFDbkYsQ0FBQztRQUVELFFBQVEsQ0FBQyxZQUFZLENBQUMsT0FBTyxHQUFHLFdBQVcsQ0FBQyxFQUFFLEVBQUUsQ0FBQTtRQUVoRCxJQUFJLENBQUM7WUFDSCxNQUFNLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUE7WUFDOUIsa0JBQWtCLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUMsWUFBWSxFQUFFLHVCQUF1QixFQUFDLENBQUMsQ0FBQyxDQUFBO1lBQ2hGLGNBQWMsRUFBRSxDQUFBO1FBQ2xCLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2Ysa0JBQWtCLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBQ3pDLENBQUM7SUFDSCxDQUFDLENBQUE7Q0FDRixDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBhcGlNYWtlckNvbmZpZyBmcm9tIFwiQGthc3Blcm5qL2FwaS1tYWtlci9idWlsZC9jb25maWcuanNcIlxuaW1wb3J0IEJhc2VDb21wb25lbnQgZnJvbSBcIi4uLy4uL2Jhc2UtY29tcG9uZW50XCJcbmltcG9ydCBDaGVja2JveCBmcm9tIFwiLi4vLi4vYm9vdHN0cmFwL2NoZWNrYm94XCJcbmltcG9ydCB7ZGlnZ30gZnJvbSBcImRpZ2dlcml6ZVwiXG5pbXBvcnQge0ZsYXNoTm90aWZpY2F0aW9uc30gZnJvbSBcImZsYXNoLW5vdGlmaWNhdGlvbnNcIlxuaW1wb3J0IHtGb3JtfSBmcm9tIFwiLi4vLi4vZm9ybVwiXG5pbXBvcnQgSW5wdXQgZnJvbSBcIi4uLy4uL2Jvb3RzdHJhcC9pbnB1dFwiXG5pbXBvcnQgbW9kZWxDbGFzc1JlcXVpcmUgZnJvbSBcIi4uLy4uL21vZGVsLWNsYXNzLXJlcXVpcmUuanNcIlxuaW1wb3J0IFJlYWN0IGZyb20gXCJyZWFjdFwiXG5pbXBvcnQge3NoYXBlQ29tcG9uZW50fSBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvc2hhcGUtY29tcG9uZW50LmpzXCJcbmltcG9ydCBtZW1vIGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9tZW1vLmpzXCJcbmltcG9ydCB1c2VJMThuIGZyb20gXCJpMThuLW9uLXN0ZXJvaWRzL3NyYy91c2UtaTE4bi5tanNcIlxuXG5jb25zdCBUYWJsZVNlYXJjaCA9IG1vZGVsQ2xhc3NSZXF1aXJlKFwiVGFibGVTZWFyY2hcIilcblxuZXhwb3J0IGRlZmF1bHQgbWVtbyhzaGFwZUNvbXBvbmVudChjbGFzcyBBcGlNYWtlclRhYmxlRmlsdGVyc1NhdmVTZWFyY2hNb2RhbCBleHRlbmRzIEJhc2VDb21wb25lbnQge1xuICBzZXR1cCgpIHtcbiAgICBjb25zdCB7dH0gPSB1c2VJMThuKHtuYW1lc3BhY2U6IFwianMuYXBpX21ha2VyLnRhYmxlLmZpbHRlcnMuc2F2ZV9zZWFyY2hfbW9kYWxcIn0pXG5cbiAgICB0aGlzLnQgPSB0XG4gICAgdGhpcy51c2VTdGF0ZXMoe2Zvcm06IG51bGx9KVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtjdXJyZW50RmlsdGVycywgY3VycmVudFVzZXIsIG9uUmVxdWVzdENsb3NlLCBzZWFyY2gsIC4uLnJlc3RQcm9wc30gPSB0aGlzLnByb3BzXG4gICAgY29uc3QgTW9kYWwgPSBhcGlNYWtlckNvbmZpZy5nZXRNb2RhbCgpXG5cbiAgICByZXR1cm4gKFxuICAgICAgPE1vZGFsIG9uUmVxdWVzdENsb3NlPXtvblJlcXVlc3RDbG9zZX0gey4uLnJlc3RQcm9wc30+XG4gICAgICAgIDxGb3JtIG9uU3VibWl0PXt0aGlzLnR0Lm9uU2F2ZVNlYXJjaFN1Ym1pdH0gc2V0Rm9ybT17dGhpcy5zZXRTdGF0ZXMuZm9ybX0+XG4gICAgICAgICAgPElucHV0XG4gICAgICAgICAgICBkZWZhdWx0VmFsdWU9e3NlYXJjaC5uYW1lKCl9XG4gICAgICAgICAgICBpZD1cInRhYmxlX3NlYXJjaF9uYW1lXCJcbiAgICAgICAgICAgIGxhYmVsPXt0aGlzLnQoXCIuc2VhcmNoX25hbWVcIiwge2RlZmF1bHRWYWx1ZTogXCJTZWFyY2ggbmFtZVwifSl9XG4gICAgICAgICAgICBuYW1lPVwidGFibGVfc2VhcmNoW25hbWVdXCJcbiAgICAgICAgICAvPlxuICAgICAgICAgIDxDaGVja2JveFxuICAgICAgICAgICAgZGVmYXVsdENoZWNrZWQ9e3NlYXJjaC5wdWJsaWMoKX1cbiAgICAgICAgICAgIGlkPVwidGFibGVfc2VhcmNoX3B1YmxpY1wiXG4gICAgICAgICAgICBsYWJlbD17dGhpcy50KFwiLnB1YmxpY1wiLCB7ZGVmYXVsdFZhbHVlOiBcIlB1YmxpY1wifSl9XG4gICAgICAgICAgICBuYW1lPVwidGFibGVfc2VhcmNoW3B1YmxpY11cIlxuICAgICAgICAgIC8+XG4gICAgICAgICAgPGJ1dHRvbiBjbGFzc05hbWU9XCJzYXZlLXNlYXJjaC1zdWJtaXQtYnV0dG9uXCI+XG4gICAgICAgICAgICB7dGhpcy50KFwiLnNhdmVfc2VhcmNoXCIsIHtkZWZhdWx0VmFsdWU6IFwiU2F2ZSBzZWFyY2hcIn0pfVxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8L0Zvcm0+XG4gICAgICA8L01vZGFsPlxuICAgIClcbiAgfVxuXG4gIG9uU2F2ZVNlYXJjaFN1Ym1pdCA9IGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBmb3JtRGF0YSA9IHRoaXMucy5mb3JtLmFzT2JqZWN0KClcbiAgICBjb25zdCB7Y3VycmVudEZpbHRlcnMsIGN1cnJlbnRVc2VyLCBvblJlcXVlc3RDbG9zZSwgc2VhcmNofSA9IHRoaXMucFxuICAgIGNvbnN0IGhhc1VzZXJUeXBlQ29sdW1uID0gQm9vbGVhbihUYWJsZVNlYXJjaC5hdHRyaWJ1dGVzKCkuZmluZCgoYXR0cmlidXRlKSA9PiBhdHRyaWJ1dGUubmFtZSgpID09IFwidXNlcl90eXBlXCIpKVxuXG4gICAgaWYgKHNlYXJjaC5pc05ld1JlY29yZCgpKSB7XG4gICAgICBmb3JtRGF0YS50YWJsZV9zZWFyY2gucXVlcnlfcGFyYW1zID0gSlNPTi5zdHJpbmdpZnkoY3VycmVudEZpbHRlcnMoKSlcbiAgICB9XG5cbiAgICBpZiAoaGFzVXNlclR5cGVDb2x1bW4pIHtcbiAgICAgIGZvcm1EYXRhLnRhYmxlX3NlYXJjaC51c2VyX3R5cGUgPSBkaWdnKGN1cnJlbnRVc2VyLm1vZGVsQ2xhc3NEYXRhKCksIFwiY2xhc3NOYW1lXCIpXG4gICAgfVxuXG4gICAgZm9ybURhdGEudGFibGVfc2VhcmNoLnVzZXJfaWQgPSBjdXJyZW50VXNlci5pZCgpXG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgc2VhcmNoLnNhdmVSYXcoZm9ybURhdGEpXG4gICAgICBGbGFzaE5vdGlmaWNhdGlvbnMuc3VjY2Vzcyh0aGlzLnQoXCIuXCIsIHtkZWZhdWx0VmFsdWU6IFwiVGhlIHNlYXJjaCB3YXMgc2F2ZWQuXCJ9KSlcbiAgICAgIG9uUmVxdWVzdENsb3NlKClcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgRmxhc2hOb3RpZmljYXRpb25zLmVycm9yUmVzcG9uc2UoZXJyb3IpXG4gICAgfVxuICB9XG59KSlcbiJdfQ==