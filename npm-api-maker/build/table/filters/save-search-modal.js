import apiMakerConfig from "@kaspernj/api-maker/build/config.js";
import BaseComponent from "../../base-component.js";
import Checkbox from "../../bootstrap/checkbox.js";
import { digg } from "diggerize";
import { FlashNotifications } from "flash-notifications";
import { Form } from "../../form.js";
import Input from "../../bootstrap/input.js";
import modelClassRequire from "../../model-class-require.js";
import React from "react";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import memo from "set-state-compare/build/memo.js";
import useI18n from "i18n-on-steroids/src/use-i18n.mjs";
const TableSearch = modelClassRequire("TableSearch");
export default memo(shapeComponent(class ApiMakerTableFiltersSaveSearchModal extends BaseComponent {
    setup() {
        const { t } = useI18n({ namespace: "js.api_maker.table.filters.save_search_modal" });
        this.t = t;
        this.useStates({ form: null });
    }
    render() {
        const { currentFilters, currentUser, onRequestClose, search, ...restProps } = this.props;
        const Modal = apiMakerConfig.getModal();
        return (<Modal onRequestClose={onRequestClose} {...restProps}>
        <Form onSubmit={this.tt.onSaveSearchSubmit} setForm={this.setStates.form}>
          <Input defaultValue={search.name()} id="table_search_name" label={this.t(".search_name", { defaultValue: "Search name" })} name="table_search[name]"/>
          <Checkbox defaultChecked={search.public()} id="table_search_public" label={this.t(".public", { defaultValue: "Public" })} name="table_search[public]"/>
          <button className="save-search-submit-button">
            {this.t(".save_search", { defaultValue: "Save search" })}
          </button>
        </Form>
      </Modal>);
    }
    onSaveSearchSubmit = async () => {
        const formData = this.s.form.asObject();
        const { currentFilters, currentUser, onRequestClose, search } = this.p;
        const hasUserTypeColumn = Boolean(TableSearch.attributes().find((attribute) => attribute.name() == "user_type"));
        if (search.isNewRecord()) {
            formData.table_search.query_params = JSON.stringify(currentFilters());
        }
        if (hasUserTypeColumn) {
            formData.table_search.user_type = digg(currentUser.modelClassData(), "className");
        }
        formData.table_search.user_id = currentUser.id();
        try {
            await search.saveRaw(formData);
            FlashNotifications.success(this.t(".", { defaultValue: "The search was saved." }));
            onRequestClose();
        }
        catch (error) {
            FlashNotifications.errorResponse(error);
        }
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2F2ZS1zZWFyY2gtbW9kYWwuanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbInRhYmxlL2ZpbHRlcnMvc2F2ZS1zZWFyY2gtbW9kYWwuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sY0FBYyxNQUFNLHFDQUFxQyxDQUFBO0FBQ2hFLE9BQU8sYUFBYSxNQUFNLHlCQUF5QixDQUFBO0FBQ25ELE9BQU8sUUFBUSxNQUFNLDZCQUE2QixDQUFBO0FBQ2xELE9BQU8sRUFBQyxJQUFJLEVBQUMsTUFBTSxXQUFXLENBQUE7QUFDOUIsT0FBTyxFQUFDLGtCQUFrQixFQUFDLE1BQU0scUJBQXFCLENBQUE7QUFDdEQsT0FBTyxFQUFDLElBQUksRUFBQyxNQUFNLGVBQWUsQ0FBQTtBQUNsQyxPQUFPLEtBQUssTUFBTSwwQkFBMEIsQ0FBQTtBQUM1QyxPQUFPLGlCQUFpQixNQUFNLDhCQUE4QixDQUFBO0FBQzVELE9BQU8sS0FBSyxNQUFNLE9BQU8sQ0FBQTtBQUN6QixPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sNENBQTRDLENBQUE7QUFDekUsT0FBTyxJQUFJLE1BQU0saUNBQWlDLENBQUE7QUFDbEQsT0FBTyxPQUFPLE1BQU0sbUNBQW1DLENBQUE7QUFFdkQsTUFBTSxXQUFXLEdBQUcsaUJBQWlCLENBQUMsYUFBYSxDQUFDLENBQUE7QUFFcEQsZUFBZSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sbUNBQW9DLFNBQVEsYUFBYTtJQUNoRyxLQUFLO1FBQ0gsTUFBTSxFQUFDLENBQUMsRUFBQyxHQUFHLE9BQU8sQ0FBQyxFQUFDLFNBQVMsRUFBRSw4Q0FBOEMsRUFBQyxDQUFDLENBQUE7UUFFaEYsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDVixJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUMsSUFBSSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUE7SUFDOUIsQ0FBQztJQUVELE1BQU07UUFDSixNQUFNLEVBQUMsY0FBYyxFQUFF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LENBQUE7UUFDekMsQ0FBQztJQUNILENBQUMsQ0FBQTtDQUNGLENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGFwaU1ha2VyQ29uZmlnIGZyb20gXCJAa2FzcGVybmovYXBpLW1ha2VyL2J1aWxkL2NvbmZpZy5qc1wiXG5pbXBvcnQgQmFzZUNvbXBvbmVudCBmcm9tIFwiLi4vLi4vYmFzZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IENoZWNrYm94IGZyb20gXCIuLi8uLi9ib290c3RyYXAvY2hlY2tib3guanNcIlxuaW1wb3J0IHtkaWdnfSBmcm9tIFwiZGlnZ2VyaXplXCJcbmltcG9ydCB7Rmxhc2hOb3RpZmljYXRpb25zfSBmcm9tIFwiZmxhc2gtbm90aWZpY2F0aW9uc1wiXG5pbXBvcnQge0Zvcm19IGZyb20gXCIuLi8uLi9mb3JtLmpzXCJcbmltcG9ydCBJbnB1dCBmcm9tIFwiLi4vLi4vYm9vdHN0cmFwL2lucHV0LmpzXCJcbmltcG9ydCBtb2RlbENsYXNzUmVxdWlyZSBmcm9tIFwiLi4vLi4vbW9kZWwtY2xhc3MtcmVxdWlyZS5qc1wiXG5pbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCJcbmltcG9ydCB7c2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IG1lbW8gZnJvbSBcInNldC1zdGF0ZS1jb21wYXJlL2J1aWxkL21lbW8uanNcIlxuaW1wb3J0IHVzZUkxOG4gZnJvbSBcImkxOG4tb24tc3Rlcm9pZHMvc3JjL3VzZS1pMThuLm1qc1wiXG5cbmNvbnN0IFRhYmxlU2VhcmNoID0gbW9kZWxDbGFzc1JlcXVpcmUoXCJUYWJsZVNlYXJjaFwiKVxuXG5leHBvcnQgZGVmYXVsdCBtZW1vKHNoYXBlQ29tcG9uZW50KGNsYXNzIEFwaU1ha2VyVGFibGVGaWx0ZXJzU2F2ZVNlYXJjaE1vZGFsIGV4dGVuZHMgQmFzZUNvbXBvbmVudCB7XG4gIHNldHVwKCkge1xuICAgIGNvbnN0IHt0fSA9IHVzZUkxOG4oe25hbWVzcGFjZTogXCJqcy5hcGlfbWFrZXIudGFibGUuZmlsdGVycy5zYXZlX3NlYXJjaF9tb2RhbFwifSlcblxuICAgIHRoaXMudCA9IHRcbiAgICB0aGlzLnVzZVN0YXRlcyh7Zm9ybTogbnVsbH0pXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge2N1cnJlbnRGaWx0ZXJzLCBjdXJyZW50VXNlciwgb25SZXF1ZXN0Q2xvc2UsIHNlYXJjaCwgLi4ucmVzdFByb3BzfSA9IHRoaXMucHJvcHNcbiAgICBjb25zdCBNb2RhbCA9IGFwaU1ha2VyQ29uZmlnLmdldE1vZGFsKClcblxuICAgIHJldHVybiAoXG4gICAgICA8TW9kYWwgb25SZXF1ZXN0Q2xvc2U9e29uUmVxdWVzdENsb3NlfSB7Li4ucmVzdFByb3BzfT5cbiAgICAgICAgPEZvcm0gb25TdWJtaXQ9e3RoaXMudHQub25TYXZlU2VhcmNoU3VibWl0fSBzZXRGb3JtPXt0aGlzLnNldFN0YXRlcy5mb3JtfT5cbiAgICAgICAgICA8SW5wdXRcbiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZT17c2VhcmNoLm5hbWUoKX1cbiAgICAgICAgICAgIGlkPVwidGFibGVfc2VhcmNoX25hbWVcIlxuICAgICAgICAgICAgbGFiZWw9e3RoaXMudChcIi5zZWFyY2hfbmFtZVwiLCB7ZGVmYXVsdFZhbHVlOiBcIlNlYXJjaCBuYW1lXCJ9KX1cbiAgICAgICAgICAgIG5hbWU9XCJ0YWJsZV9zZWFyY2hbbmFtZV1cIlxuICAgICAgICAgIC8+XG4gICAgICAgICAgPENoZWNrYm94XG4gICAgICAgICAgICBkZWZhdWx0Q2hlY2tlZD17c2VhcmNoLnB1YmxpYygpfVxuICAgICAgICAgICAgaWQ9XCJ0YWJsZV9zZWFyY2hfcHVibGljXCJcbiAgICAgICAgICAgIGxhYmVsPXt0aGlzLnQoXCIucHVibGljXCIsIHtkZWZhdWx0VmFsdWU6IFwiUHVibGljXCJ9KX1cbiAgICAgICAgICAgIG5hbWU9XCJ0YWJsZV9zZWFyY2hbcHVibGljXVwiXG4gICAgICAgICAgLz5cbiAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT1cInNhdmUtc2VhcmNoLXN1Ym1pdC1idXR0b25cIj5cbiAgICAgICAgICAgIHt0aGlzLnQoXCIuc2F2ZV9zZWFyY2hcIiwge2RlZmF1bHRWYWx1ZTogXCJTYXZlIHNlYXJjaFwifSl9XG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIDwvRm9ybT5cbiAgICAgIDwvTW9kYWw+XG4gICAgKVxuICB9XG5cbiAgb25TYXZlU2VhcmNoU3VibWl0ID0gYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGZvcm1EYXRhID0gdGhpcy5zLmZvcm0uYXNPYmplY3QoKVxuICAgIGNvbnN0IHtjdXJyZW50RmlsdGVycywgY3VycmVudFVzZXIsIG9uUmVxdWVzdENsb3NlLCBzZWFyY2h9ID0gdGhpcy5wXG4gICAgY29uc3QgaGFzVXNlclR5cGVDb2x1bW4gPSBCb29sZWFuKFRhYmxlU2VhcmNoLmF0dHJpYnV0ZXMoKS5maW5kKChhdHRyaWJ1dGUpID0+IGF0dHJpYnV0ZS5uYW1lKCkgPT0gXCJ1c2VyX3R5cGVcIikpXG5cbiAgICBpZiAoc2VhcmNoLmlzTmV3UmVjb3JkKCkpIHtcbiAgICAgIGZvcm1EYXRhLnRhYmxlX3NlYXJjaC5xdWVyeV9wYXJhbXMgPSBKU09OLnN0cmluZ2lmeShjdXJyZW50RmlsdGVycygpKVxuICAgIH1cblxuICAgIGlmIChoYXNVc2VyVHlwZUNvbHVtbikge1xuICAgICAgZm9ybURhdGEudGFibGVfc2VhcmNoLnVzZXJfdHlwZSA9IGRpZ2coY3VycmVudFVzZXIubW9kZWxDbGFzc0RhdGEoKSwgXCJjbGFzc05hbWVcIilcbiAgICB9XG5cbiAgICBmb3JtRGF0YS50YWJsZV9zZWFyY2gudXNlcl9pZCA9IGN1cnJlbnRVc2VyLmlkKClcblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCBzZWFyY2guc2F2ZVJhdyhmb3JtRGF0YSlcbiAgICAgIEZsYXNoTm90aWZpY2F0aW9ucy5zdWNjZXNzKHRoaXMudChcIi5cIiwge2RlZmF1bHRWYWx1ZTogXCJUaGUgc2VhcmNoIHdhcyBzYXZlZC5cIn0pKVxuICAgICAgb25SZXF1ZXN0Q2xvc2UoKVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBGbGFzaE5vdGlmaWNhdGlvbnMuZXJyb3JSZXNwb25zZShlcnJvcilcbiAgICB9XG4gIH1cbn0pKVxuIl19