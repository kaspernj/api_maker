import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from "react/jsx-runtime";
import BaseComponent from "../../base-component";
import { digg, digs } from "diggerize";
import Filter from "./filter";
import FilterForm from "./filter-form";
import { FlashNotifications } from "flash-notifications";
import LoadSearchModal from "./load-search-modal";
import SaveSearchModal from "./save-search-modal";
import Params from "../../params.js";
import PropTypes from "prop-types";
import { TableSearch } from "models.js";
import memo from "set-state-compare/build/memo.js";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import React from "react";
import useI18n from "i18n-on-steroids/src/use-i18n.mjs";
import useQueryParams from "on-location-changed/build/use-query-params.js";
import { View } from "react-native";
export default memo(shapeComponent(class ApiMakerTableFilters extends BaseComponent {
    static propTypes = {
        currentUser: PropTypes.object,
        modelClass: PropTypes.func.isRequired,
        queryName: PropTypes.string.isRequired,
        querySName: PropTypes.string.isRequired
    };
    setup() {
        const { t } = useI18n({ namespace: "js.api_maker.table.filters" });
        this.queryParams = useQueryParams();
        this.t = t;
        this.useStates({
            filter: undefined,
            showLoadSearchModal: undefined,
            showSaveSearchModal: false
        });
    }
    render() {
        const { modelClass, querySName } = digs(this.props, "modelClass", "querySName");
        const { currentUser } = this.props;
        const { filter, showLoadSearchModal, showSaveSearchModal } = digs(this.state, "filter", "showLoadSearchModal", "showSaveSearchModal");
        const currentFilters = this.currentFilters();
        return (_jsxs(View, { dataSet: this.cache("rootViewDataSet", { class: "api-maker--table--filters" }), style: this.cache("rootViewStyle", { alignItems: "flex-start" }), children: [filter &&
                    _jsx(FilterForm, { filter: filter, modelClass: modelClass, onApplyClicked: this.tt.onApplyClicked, onRequestClose: this.tt.onFilterFormRequestClose, querySearchName: querySName }, `filter-${filter.filterIndex}`), showLoadSearchModal &&
                    _jsx(LoadSearchModal, { currentUser: currentUser, modelClass: modelClass, onEditSearchPressed: digg(this, "onEditSearchPressed"), onRequestClose: digg(this, "onRequestCloseLoadSearchModal"), querySearchName: querySName }), showSaveSearchModal &&
                    _jsx(SaveSearchModal, { currentFilters: digg(this, "currentFilters"), currentUser: currentUser, onRequestClose: digg(this, "onRequestCloseSaveSearchModal"), search: showSaveSearchModal }), currentFilters?.map((filterData, filterIndex) => _jsx(Filter, { filterIndex: filterIndex, onClick: this.tt.onFilterClicked, onRemoveClicked: this.tt.onRemoveClicked, ...filterData }, filterIndex)), _jsxs(View, { dataSet: this.cache("filterActionsDataSet", { class: "filter-actions" }), style: this.cache("filterActionsStyle", { flexDirection: "row", marginTop: 10 }), children: [_jsx("button", { className: "add-new-filter-button", onClick: this.tt.onAddFilterClicked, children: this.t(".add_new_filter", { defaultValue: "Add new filter" }) }), currentUser &&
                            _jsxs(_Fragment, { children: [_jsx("button", { className: "save-search-button", onClick: this.tt.onSaveSearchClicked, style: { marginLeft: 10 }, children: this.t(".save_search", { defaultValue: "Save search" }) }), _jsx("button", { className: "load-search-button", onClick: this.tt.onLoadSearchClicked, style: { marginLeft: 10 }, children: this.t(".load_search", { defaultValue: "Load search" }) })] })] })] }));
    }
    currentFilters = () => {
        const { querySName } = digs(this.props, "querySName");
        const currentFilters = this.queryParams[querySName] || [];
        return currentFilters.map((currentFilter) => JSON.parse(currentFilter));
    };
    onAddFilterClicked = (e) => {
        e.preventDefault();
        const newFilterIndex = this.currentFilters().length;
        this.setState({
            filter: {
                filterIndex: newFilterIndex
            }
        });
    };
    onApplyClicked = () => this.setState({ filter: undefined });
    onEditSearchPressed = ({ search }) => {
        this.onRequestCloseLoadSearchModal();
        this.setState({
            showSaveSearchModal: search
        });
    };
    onFilterClicked = (filter) => this.setState({ filter });
    onFilterFormRequestClose = () => this.setState({ filter: undefined });
    onLoadSearchClicked = (e) => {
        e.preventDefault();
        this.setState({
            showLoadSearchModal: true
        });
    };
    onRemoveClicked = ({ filterIndex }) => {
        const { querySName } = digs(this.props, "querySName");
        const searchParams = Params.parse()[querySName] || {};
        delete searchParams[filterIndex];
        const newParams = {};
        newParams[querySName] = searchParams;
        Params.changeParams(newParams);
        this.setState({
            filter: undefined
        });
    };
    onRequestCloseLoadSearchModal = () => this.setState({ showLoadSearchModal: false });
    onRequestCloseSaveSearchModal = () => this.setState({ showSaveSearchModal: undefined });
    onSaveSearchClicked = (e) => {
        e.preventDefault();
        if (this.hasAnyFilters()) {
            this.setState({ showSaveSearchModal: new TableSearch() });
        }
        else {
            FlashNotifications.alert(this.t(".no_filters_has_been_set", { defaultValue: "No filters has been set" }));
        }
    };
    hasAnyFilters = () => Object.keys(this.currentFilters()).length > 0;
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbInRhYmxlL2ZpbHRlcnMvaW5kZXguanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLGFBQWEsTUFBTSxzQkFBc0IsQ0FBQTtBQUNoRCxPQUFPLEVBQUMsSUFBSSxFQUFFLElBQUksRUFBQyxNQUFNLFdBQVcsQ0FBQTtBQUNwQyxPQUFPLE1BQU0sTUFBTSxVQUFVLENBQUE7QUFDN0IsT0FBTyxVQUFVLE1BQU0sZUFBZSxDQUFBO0FBQ3RDLE9BQU8sRUFBQyxrQkFBa0IsRUFBQyxNQUFNLHFCQUFxQixDQUFBO0FBQ3RELE9BQU8sZUFBZSxNQUFNLHFCQUFxQixDQUFBO0FBQ2pELE9BQU8sZUFBZSxNQUFNLHFCQUFxQixDQUFBO0FBQ2pELE9BQU8sTUFBTSxNQUFNLGlCQUFpQixDQUFBO0FBQ3BDLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQTtBQUNsQyxPQUFPLEVBQUMsV0FBVyxFQUFDLE1BQU0sV0FBVyxDQUFBO0FBQ3JDLE9BQU8sSUFBSSxNQUFNLGlDQUFpQyxDQUFBO0FBQ2xELE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSw0Q0FBNEMsQ0FBQTtBQUN6RSxPQUFPLEtBQUssTUFBTSxPQUFPLENBQUE7QUFDekIsT0FBTyxPQUFPLE1BQU0sbUNBQW1DLENBQUE7QUFDdkQsT0FBTyxjQUFjLE1BQU0sK0NBQStDLENBQUE7QUFDMUUsT0FBTyxFQUFDLElBQUksRUFBQyxNQUFNLGNBQWMsQ0FBQTtBQUVqQyxlQUFlLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxvQkFBcUIsU0FBUSxhQUFhO0lBQ2pGLE1BQU0sQ0FBQyxTQUFTLEdBQUc7UUFDakIsV0FBVyxFQUFFLFNBQVMsQ0FBQyxNQUFNO1FBQzdCLFVBQVUsRUFBRSxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVU7UUFDckMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxNQUFNLENBQUMsVUFBVTtRQUN0QyxVQUFVLEVBQUUsU0FB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QmFzZUNvbXBvbmVudCBmcm9tIFwiLi4vLi4vYmFzZS1jb21wb25lbnRcIlxuaW1wb3J0IHtkaWdnLCBkaWdzfSBmcm9tIFwiZGlnZ2VyaXplXCJcbmltcG9ydCBGaWx0ZXIgZnJvbSBcIi4vZmlsdGVyXCJcbmltcG9ydCBGaWx0ZXJGb3JtIGZyb20gXCIuL2ZpbHRlci1mb3JtXCJcbmltcG9ydCB7Rmxhc2hOb3RpZmljYXRpb25zfSBmcm9tIFwiZmxhc2gtbm90aWZpY2F0aW9uc1wiXG5pbXBvcnQgTG9hZFNlYXJjaE1vZGFsIGZyb20gXCIuL2xvYWQtc2VhcmNoLW1vZGFsXCJcbmltcG9ydCBTYXZlU2VhcmNoTW9kYWwgZnJvbSBcIi4vc2F2ZS1zZWFyY2gtbW9kYWxcIlxuaW1wb3J0IFBhcmFtcyBmcm9tIFwiLi4vLi4vcGFyYW1zLmpzXCJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIlxuaW1wb3J0IHtUYWJsZVNlYXJjaH0gZnJvbSBcIm1vZGVscy5qc1wiXG5pbXBvcnQgbWVtbyBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvbWVtby5qc1wiXG5pbXBvcnQge3NoYXBlQ29tcG9uZW50fSBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvc2hhcGUtY29tcG9uZW50LmpzXCJcbmltcG9ydCBSZWFjdCBmcm9tIFwicmVhY3RcIlxuaW1wb3J0IHVzZUkxOG4gZnJvbSBcImkxOG4tb24tc3Rlcm9pZHMvc3JjL3VzZS1pMThuLm1qc1wiXG5pbXBvcnQgdXNlUXVlcnlQYXJhbXMgZnJvbSBcIm9uLWxvY2F0aW9uLWNoYW5nZWQvYnVpbGQvdXNlLXF1ZXJ5LXBhcmFtcy5qc1wiXG5pbXBvcnQge1ZpZXd9IGZyb20gXCJyZWFjdC1uYXRpdmVcIlxuXG5leHBvcnQgZGVmYXVsdCBtZW1vKHNoYXBlQ29tcG9uZW50KGNsYXNzIEFwaU1ha2VyVGFibGVGaWx0ZXJzIGV4dGVuZHMgQmFzZUNvbXBvbmVudCB7XG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgY3VycmVudFVzZXI6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgbW9kZWxDbGFzczogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBxdWVyeU5hbWU6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICBxdWVyeVNOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWRcbiAgfVxuXG4gIHNldHVwKCkge1xuICAgIGNvbnN0IHt0fSA9IHVzZUkxOG4oe25hbWVzcGFjZTogXCJqcy5hcGlfbWFrZXIudGFibGUuZmlsdGVyc1wifSlcblxuICAgIHRoaXMucXVlcnlQYXJhbXMgPSB1c2VRdWVyeVBhcmFtcygpXG4gICAgdGhpcy50ID0gdFxuICAgIHRoaXMudXNlU3RhdGVzKHtcbiAgICAgIGZpbHRlcjogdW5kZWZpbmVkLFxuICAgICAgc2hvd0xvYWRTZWFyY2hNb2RhbDogdW5kZWZpbmVkLFxuICAgICAgc2hvd1NhdmVTZWFyY2hNb2RhbDogZmFsc2VcbiAgICB9KVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHttb2RlbENsYXNzLCBxdWVyeVNOYW1lfSA9IGRpZ3ModGhpcy5wcm9wcywgXCJtb2RlbENsYXNzXCIsIFwicXVlcnlTTmFtZVwiKVxuICAgIGNvbnN0IHtjdXJyZW50VXNlcn0gPSB0aGlzLnByb3BzXG4gICAgY29uc3Qge2ZpbHRlciwgc2hvd0xvYWRTZWFyY2hNb2RhbCwgc2hvd1NhdmVTZWFyY2hNb2RhbH0gPSBkaWdzKHRoaXMuc3RhdGUsIFwiZmlsdGVyXCIsIFwic2hvd0xvYWRTZWFyY2hNb2RhbFwiLCBcInNob3dTYXZlU2VhcmNoTW9kYWxcIilcbiAgICBjb25zdCBjdXJyZW50RmlsdGVycyA9IHRoaXMuY3VycmVudEZpbHRlcnMoKVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxWaWV3IGRhdGFTZXQ9e3RoaXMuY2FjaGUoXCJyb290Vmlld0RhdGFTZXRcIiwge2NsYXNzOiBcImFwaS1tYWtlci0tdGFibGUtLWZpbHRlcnNcIn0pfSBzdHlsZT17dGhpcy5jYWNoZShcInJvb3RWaWV3U3R5bGVcIiwge2FsaWduSXRlbXM6IFwiZmxleC1zdGFydFwifSl9PlxuICAgICAgICB7ZmlsdGVyICYmXG4gICAgICAgICAgPEZpbHRlckZvcm1cbiAgICAgICAgICAgIGZpbHRlcj17ZmlsdGVyfVxuICAgICAgICAgICAga2V5PXtgZmlsdGVyLSR7ZmlsdGVyLmZpbHRlckluZGV4fWB9XG4gICAgICAgICAgICBtb2RlbENsYXNzPXttb2RlbENsYXNzfVxuICAgICAgICAgICAgb25BcHBseUNsaWNrZWQ9e3RoaXMudHQub25BcHBseUNsaWNrZWR9XG4gICAgICAgICAgICBvblJlcXVlc3RDbG9zZT17dGhpcy50dC5vbkZpbHRlckZvcm1SZXF1ZXN0Q2xvc2V9XG4gICAgICAgICAgICBxdWVyeVNlYXJjaE5hbWU9e3F1ZXJ5U05hbWV9XG4gICAgICAgICAgLz5cbiAgICAgICAgfVxuICAgICAgICB7c2hvd0xvYWRTZWFyY2hNb2RhbCAmJlxuICAgICAgICAgIDxMb2FkU2VhcmNoTW9kYWxcbiAgICAgICAgICAgIGN1cnJlbnRVc2VyPXtjdXJyZW50VXNlcn1cbiAgICAgICAgICAgIG1vZGVsQ2xhc3M9e21vZGVsQ2xhc3N9XG4gICAgICAgICAgICBvbkVkaXRTZWFyY2hQcmVzc2VkPXtkaWdnKHRoaXMsIFwib25FZGl0U2VhcmNoUHJlc3NlZFwiKX1cbiAgICAgICAgICAgIG9uUmVxdWVzdENsb3NlPXtkaWdnKHRoaXMsIFwib25SZXF1ZXN0Q2xvc2VMb2FkU2VhcmNoTW9kYWxcIil9XG4gICAgICAgICAgICBxdWVyeVNlYXJjaE5hbWU9e3F1ZXJ5U05hbWV9XG4gICAgICAgICAgLz5cbiAgICAgICAgfVxuICAgICAgICB7c2hvd1NhdmVTZWFyY2hNb2RhbCAmJlxuICAgICAgICAgIDxTYXZlU2VhcmNoTW9kYWxcbiAgICAgICAgICAgIGN1cnJlbnRGaWx0ZXJzPXtkaWdnKHRoaXMsIFwiY3VycmVudEZpbHRlcnNcIil9XG4gICAgICAgICAgICBjdXJyZW50VXNlcj17Y3VycmVudFVzZXJ9XG4gICAgICAgICAgICBvblJlcXVlc3RDbG9zZT17ZGlnZyh0aGlzLCBcIm9uUmVxdWVzdENsb3NlU2F2ZVNlYXJjaE1vZGFsXCIpfVxuICAgICAgICAgICAgc2VhcmNoPXtzaG93U2F2ZVNlYXJjaE1vZGFsfVxuICAgICAgICAgIC8+XG4gICAgICAgIH1cbiAgICAgICAge2N1cnJlbnRGaWx0ZXJzPy5tYXAoKGZpbHRlckRhdGEsIGZpbHRlckluZGV4KSA9PlxuICAgICAgICAgIDxGaWx0ZXJcbiAgICAgICAgICAgIGtleT17ZmlsdGVySW5kZXh9XG4gICAgICAgICAgICBmaWx0ZXJJbmRleD17ZmlsdGVySW5kZXh9XG4gICAgICAgICAgICBvbkNsaWNrPXt0aGlzLnR0Lm9uRmlsdGVyQ2xpY2tlZH1cbiAgICAgICAgICAgIG9uUmVtb3ZlQ2xpY2tlZD17dGhpcy50dC5vblJlbW92ZUNsaWNrZWR9XG4gICAgICAgICAgICB7Li4uZmlsdGVyRGF0YX1cbiAgICAgICAgICAvPlxuICAgICAgICApfVxuICAgICAgICA8VmlldyBkYXRhU2V0PXt0aGlzLmNhY2hlKFwiZmlsdGVyQWN0aW9uc0RhdGFTZXRcIiwge2NsYXNzOiBcImZpbHRlci1hY3Rpb25zXCJ9KX0gc3R5bGU9e3RoaXMuY2FjaGUoXCJmaWx0ZXJBY3Rpb25zU3R5bGVcIiwge2ZsZXhEaXJlY3Rpb246IFwicm93XCIsIG1hcmdpblRvcDogMTB9KX0+XG4gICAgICAgICAgPGJ1dHRvbiBjbGFzc05hbWU9XCJhZGQtbmV3LWZpbHRlci1idXR0b25cIiBvbkNsaWNrPXt0aGlzLnR0Lm9uQWRkRmlsdGVyQ2xpY2tlZH0+XG4gICAgICAgICAgICB7dGhpcy50KFwiLmFkZF9uZXdfZmlsdGVyXCIsIHtkZWZhdWx0VmFsdWU6IFwiQWRkIG5ldyBmaWx0ZXJcIn0pfVxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgIHtjdXJyZW50VXNlciAmJlxuICAgICAgICAgICAgPD5cbiAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzc05hbWU9XCJzYXZlLXNlYXJjaC1idXR0b25cIiBvbkNsaWNrPXt0aGlzLnR0Lm9uU2F2ZVNlYXJjaENsaWNrZWR9IHN0eWxlPXt7bWFyZ2luTGVmdDogMTB9fT5cbiAgICAgICAgICAgICAgICB7dGhpcy50KFwiLnNhdmVfc2VhcmNoXCIsIHtkZWZhdWx0VmFsdWU6IFwiU2F2ZSBzZWFyY2hcIn0pfVxuICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzc05hbWU9XCJsb2FkLXNlYXJjaC1idXR0b25cIiBvbkNsaWNrPXt0aGlzLnR0Lm9uTG9hZFNlYXJjaENsaWNrZWR9IHN0eWxlPXt7bWFyZ2luTGVmdDogMTB9fT5cbiAgICAgICAgICAgICAgICB7dGhpcy50KFwiLmxvYWRfc2VhcmNoXCIsIHtkZWZhdWx0VmFsdWU6IFwiTG9hZCBzZWFyY2hcIn0pfVxuICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgIDwvPlxuICAgICAgICAgIH1cbiAgICAgICAgPC9WaWV3PlxuICAgICAgPC9WaWV3PlxuICAgIClcbiAgfVxuXG4gIGN1cnJlbnRGaWx0ZXJzID0gKCkgPT4ge1xuICAgIGNvbnN0IHtxdWVyeVNOYW1lfSA9IGRpZ3ModGhpcy5wcm9wcywgXCJxdWVyeVNOYW1lXCIpXG4gICAgY29uc3QgY3VycmVudEZpbHRlcnMgPSB0aGlzLnF1ZXJ5UGFyYW1zW3F1ZXJ5U05hbWVdIHx8IFtdXG5cbiAgICByZXR1cm4gY3VycmVudEZpbHRlcnMubWFwKChjdXJyZW50RmlsdGVyKSA9PiBKU09OLnBhcnNlKGN1cnJlbnRGaWx0ZXIpKVxuICB9XG5cbiAgb25BZGRGaWx0ZXJDbGlja2VkID0gKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KClcblxuICAgIGNvbnN0IG5ld0ZpbHRlckluZGV4ID0gdGhpcy5jdXJyZW50RmlsdGVycygpLmxlbmd0aFxuXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBmaWx0ZXI6IHtcbiAgICAgICAgZmlsdGVySW5kZXg6IG5ld0ZpbHRlckluZGV4XG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIG9uQXBwbHlDbGlja2VkID0gKCkgPT4gdGhpcy5zZXRTdGF0ZSh7ZmlsdGVyOiB1bmRlZmluZWR9KVxuXG4gIG9uRWRpdFNlYXJjaFByZXNzZWQgPSAoe3NlYXJjaH0pID0+IHtcbiAgICB0aGlzLm9uUmVxdWVzdENsb3NlTG9hZFNlYXJjaE1vZGFsKClcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIHNob3dTYXZlU2VhcmNoTW9kYWw6IHNlYXJjaFxuICAgIH0pXG4gIH1cblxuICBvbkZpbHRlckNsaWNrZWQgPSAoZmlsdGVyKSA9PiB0aGlzLnNldFN0YXRlKHtmaWx0ZXJ9KVxuICBvbkZpbHRlckZvcm1SZXF1ZXN0Q2xvc2UgPSAoKSA9PiB0aGlzLnNldFN0YXRlKHtmaWx0ZXI6IHVuZGVmaW5lZH0pXG5cbiAgb25Mb2FkU2VhcmNoQ2xpY2tlZCA9IChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpXG5cbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIHNob3dMb2FkU2VhcmNoTW9kYWw6IHRydWVcbiAgICB9KVxuICB9XG5cbiAgb25SZW1vdmVDbGlja2VkID0gKHtmaWx0ZXJJbmRleH0pID0+IHtcbiAgICBjb25zdCB7cXVlcnlTTmFtZX0gPSBkaWdzKHRoaXMucHJvcHMsIFwicXVlcnlTTmFtZVwiKVxuICAgIGNvbnN0IHNlYXJjaFBhcmFtcyA9IFBhcmFtcy5wYXJzZSgpW3F1ZXJ5U05hbWVdIHx8IHt9XG5cbiAgICBkZWxldGUgc2VhcmNoUGFyYW1zW2ZpbHRlckluZGV4XVxuXG4gICAgY29uc3QgbmV3UGFyYW1zID0ge31cblxuICAgIG5ld1BhcmFtc1txdWVyeVNOYW1lXSA9IHNlYXJjaFBhcmFtc1xuXG4gICAgUGFyYW1zLmNoYW5nZVBhcmFtcyhuZXdQYXJhbXMpXG5cbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGZpbHRlcjogdW5kZWZpbmVkXG4gICAgfSlcbiAgfVxuXG4gIG9uUmVxdWVzdENsb3NlTG9hZFNlYXJjaE1vZGFsID0gKCkgPT4gdGhpcy5zZXRTdGF0ZSh7c2hvd0xvYWRTZWFyY2hNb2RhbDogZmFsc2V9KVxuICBvblJlcXVlc3RDbG9zZVNhdmVTZWFyY2hNb2RhbCA9ICgpID0+IHRoaXMuc2V0U3RhdGUoe3Nob3dTYXZlU2VhcmNoTW9kYWw6IHVuZGVmaW5lZH0pXG5cbiAgb25TYXZlU2VhcmNoQ2xpY2tlZCA9IChlKSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpXG5cbiAgICBpZiAodGhpcy5oYXNBbnlGaWx0ZXJzKCkpIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe3Nob3dTYXZlU2VhcmNoTW9kYWw6IG5ldyBUYWJsZVNlYXJjaCgpfSlcbiAgICB9IGVsc2Uge1xuICAgICAgRmxhc2hOb3RpZmljYXRpb25zLmFsZXJ0KHRoaXMudChcIi5ub19maWx0ZXJzX2hhc19iZWVuX3NldFwiLCB7ZGVmYXVsdFZhbHVlOiBcIk5vIGZpbHRlcnMgaGFzIGJlZW4gc2V0XCJ9KSlcbiAgICB9XG4gIH1cblxuICBoYXNBbnlGaWx0ZXJzID0gKCkgPT4gT2JqZWN0LmtleXModGhpcy5jdXJyZW50RmlsdGVycygpKS5sZW5ndGggPiAwXG59KSlcbiJdfQ==