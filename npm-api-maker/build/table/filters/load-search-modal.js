import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import React, { useMemo } from "react";
import { Pressable, View } from "react-native";
import apiMakerConfig from "@kaspernj/api-maker/build/config.js";
import BaseComponent from "../../base-component";
import classNames from "classnames";
import { digg } from "diggerize";
import memo from "set-state-compare/build/memo.js";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import Params from "../../params.js";
import { TableSearch } from "models.js";
import Text from "../../utils/text";
import useI18n from "i18n-on-steroids/src/use-i18n.mjs";
const SearchLink = memo(shapeComponent(class SearchLink extends BaseComponent {
    render() {
        const { search } = this.props;
        return (_jsxs(View, { dataSet: this.cache("rootViewStyle", { class: "search-row", searchId: search.id() }, [search.id()]), style: this.cache("rootViewStyleStyle", { flexDirection: "row", width: "100%" }), children: [_jsx(Pressable, { dataSet: this.cache("loadSearchLinkPressableDataSet", { class: "load-search-link" }), onPress: this.tt.onSearchClicked, style: this.cache("loadSearchLinkPressableStyle", { justifyContent: "center" }), children: _jsx(Text, { children: search.name() }) }), _jsxs(View, { style: this.cache("actionsViewStyle", { flexDirection: "row", marginLeft: "auto" }), children: [_jsx(Pressable, { dataSet: this.cache("editSearchButtonDataSet", { class: "edit-search-button" }), onPress: this.tt.onEditPressed, style: this.cache("editSearchButtonStyle", {
                                alignItems: "center",
                                justifyContent: "center",
                                width: 25,
                                height: 25,
                                backgroundColor: "#fff",
                                border: "1px solid #007bff",
                                borderRadius: 5,
                                color: "#007bff"
                            }), children: _jsx(Text, { children: "\u270E" }) }), _jsx(Pressable, { dataSet: this.cache("deleteSearchButtonDataSet", { class: "delete-search-button" }), onPress: this.tt.onDeletePressed, style: this.cache("deleteSearchButtonStyle", {
                                alignItems: "center",
                                justifyContent: "center",
                                marginLeft: 5,
                                width: 25,
                                height: 25,
                                backgroundColor: "#fff",
                                border: "1px solid #dc3545",
                                borderRadius: 5,
                                color: "#dc3545"
                            }), children: _jsx(Text, { children: "\u2715" }) })] })] }));
    }
    onDeletePressed = async () => {
        if (!confirm("Are you sure?")) {
            return;
        }
        const { search } = this.props;
        await search.destroy();
        this.props.onDeleted({ search });
    };
    onEditPressed = () => this.props.onEditPressed({ search: this.props.search });
    onSearchClicked = () => this.props.onClick({ search: this.props.search });
}));
export default memo(shapeComponent(class ApiMakerTableFiltersLoadSearchModal extends BaseComponent {
    setup() {
        const { t } = useI18n({ namespace: "js.api_maker.table.filters.load_search_modal" });
        this.useStates({
            editSearch: undefined,
            searches: undefined
        });
        this.setInstance({ t });
        useMemo(() => {
            this.loadSearches();
        }, []);
    }
    loadSearches = async () => {
        const { currentUser } = this.props;
        const userType = digg(currentUser.modelClassData(), "name");
        const searches = await TableSearch
            .ransack({ user_id_eq: currentUser.id(), user_type_eq: userType })
            .toArray();
        this.setState({ searches });
    };
    render() {
        const { t } = this.tt;
        const { className, currentUser, modelClass, onEditSearchPressed, onRequestClose, querySearchName, ...restProps } = this.props;
        const Modal = apiMakerConfig.getModal();
        return (_jsxs(Modal, { className: classNames("api-maker--table--filters--load-search-modal", className), onRequestClose: onRequestClose, ...restProps, children: [_jsx(View, { children: _jsx(Text, { children: t(".choose_a_search", { defaultValue: "Choose a search" }) }) }), this.state.searches?.map((search) => _jsx(SearchLink, { onClick: this.tt.onSearchClicked, onDeleted: this.tt.onSearchDeleted, onEditPressed: onEditSearchPressed, search: search }, search.id()))] }));
    }
    onSearchClicked = ({ search }) => {
        const { onRequestClose, querySearchName } = this.props;
        const queryParams = search.queryParams();
        const newParams = {};
        newParams[querySearchName] = queryParams.map((queryParam) => JSON.stringify(queryParam));
        Params.changeParams(newParams);
        onRequestClose();
    };
    onSearchDeleted = ({ search }) => {
        this.setState({
            searches: this.state.searches.filter((existingSearch) => existingSearch.id() != search.id())
        });
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9hZC1zZWFyY2gtbW9kYWwuanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbInRhYmxlL2ZpbHRlcnMvbG9hZC1zZWFyY2gtbW9kYWwuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEtBQUssRUFBRSxFQUFDLE9BQU8sRUFBQyxNQUFNLE9BQU8sQ0FBQTtBQUNwQyxPQUFPLEVBQUMsU0FBUyxFQUFFLElBQUksRUFBQyxNQUFNLGNBQWMsQ0FBQTtBQUM1QyxPQUFPLGNBQWMsTUFBTSxxQ0FBcUMsQ0FBQTtBQUNoRSxPQUFPLGFBQWEsTUFBTSxzQkFBc0IsQ0FBQTtBQUNoRCxPQUFPLFVBQVUsTUFBTSxZQUFZLENBQUE7QUFDbkMsT0FBTyxFQUFDLElBQUksRUFBQyxNQUFNLFdBQVcsQ0FBQTtBQUM5QixPQUFPLElBQUksTUFBTSxpQ0FBaUMsQ0FBQTtBQUNsRCxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sNENBQTRDLENBQUE7QUFDekUsT0FBTyxNQUFNLE1BQU0saUJBQWlCLENBQUE7QUFDcEMsT0FBTyxFQUFDLFdBQVcsRUFBQyxNQUFNLFdBQVcsQ0FBQTtBQUNyQyxPQUFPLElBQUksTUFBTSxrQkFBa0IsQ0FBQTtBQUNuQyxPQUFPLE9BQU8sTUFBTSxtQ0FBbUMsQ0FBQTtBQUV2RCxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sVUFBVyxTQUFRLGFBQWE7SUFDM0UsTUFBTTtRQUNKLE1BQU0sRUFBQyxNQUFNLEVBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFBO1FBRTNCLE9BQU8sQ0FDTCxNQUFDLElBQUksSUFDSCxPQUFPLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxlQUFlLEVBQUUsRUFBQyxLQUFLLEVBQUUsWUFBWSxFQUFFLFFBQVEsRUFBRSxNQUFNLENBQUMsRUFBRSxFQUFFLEVBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQ2pHLEtBQUssRUFB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Q0FBQyxDQUFBO0lBRUQsZUFBZSxHQUFHLENBQUMsRUFBQyxNQUFNLEVBQUMsRUFBRSxFQUFFO1FBQzdCLElBQUksQ0FBQyxRQUFRLENBQUM7WUFDWixRQUFRLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsY0FBYyxFQUFFLEVBQUUsQ0FBQyxjQUFjLENBQUMsRUFBRSxFQUFFLElBQUksTUFBTSxDQUFDLEVBQUUsRUFBRSxDQUFDO1NBQzdGLENBQUMsQ0FBQTtJQUNKLENBQUMsQ0FBQTtDQUNGLENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7dXNlTWVtb30gZnJvbSBcInJlYWN0XCJcbmltcG9ydCB7UHJlc3NhYmxlLCBWaWV3fSBmcm9tIFwicmVhY3QtbmF0aXZlXCJcbmltcG9ydCBhcGlNYWtlckNvbmZpZyBmcm9tIFwiQGthc3Blcm5qL2FwaS1tYWtlci9idWlsZC9jb25maWcuanNcIlxuaW1wb3J0IEJhc2VDb21wb25lbnQgZnJvbSBcIi4uLy4uL2Jhc2UtY29tcG9uZW50XCJcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gXCJjbGFzc25hbWVzXCJcbmltcG9ydCB7ZGlnZ30gZnJvbSBcImRpZ2dlcml6ZVwiXG5pbXBvcnQgbWVtbyBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvbWVtby5qc1wiXG5pbXBvcnQge3NoYXBlQ29tcG9uZW50fSBmcm9tIFwic2V0LXN0YXRlLWNvbXBhcmUvYnVpbGQvc2hhcGUtY29tcG9uZW50LmpzXCJcbmltcG9ydCBQYXJhbXMgZnJvbSBcIi4uLy4uL3BhcmFtcy5qc1wiXG5pbXBvcnQge1RhYmxlU2VhcmNofSBmcm9tIFwibW9kZWxzLmpzXCJcbmltcG9ydCBUZXh0IGZyb20gXCIuLi8uLi91dGlscy90ZXh0XCJcbmltcG9ydCB1c2VJMThuIGZyb20gXCJpMThuLW9uLXN0ZXJvaWRzL3NyYy91c2UtaTE4bi5tanNcIlxuXG5jb25zdCBTZWFyY2hMaW5rID0gbWVtbyhzaGFwZUNvbXBvbmVudChjbGFzcyBTZWFyY2hMaW5rIGV4dGVuZHMgQmFzZUNvbXBvbmVudCB7XG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7c2VhcmNofSA9IHRoaXMucHJvcHNcblxuICAgIHJldHVybiAoXG4gICAgICA8Vmlld1xuICAgICAgICBkYXRhU2V0PXt0aGlzLmNhY2hlKFwicm9vdFZpZXdTdHlsZVwiLCB7Y2xhc3M6IFwic2VhcmNoLXJvd1wiLCBzZWFyY2hJZDogc2VhcmNoLmlkKCl9LCBbc2VhcmNoLmlkKCldKX1cbiAgICAgICAgc3R5bGU9e3RoaXMuY2FjaGUoXCJyb290Vmlld1N0eWxlU3R5bGVcIiwge2ZsZXhEaXJlY3Rpb246IFwicm93XCIsIHdpZHRoOiBcIjEwMCVcIn0pfVxuICAgICAgPlxuICAgICAgICA8UHJlc3NhYmxlXG4gICAgICAgICAgZGF0YVNldD17dGhpcy5jYWNoZShcImxvYWRTZWFyY2hMaW5rUHJlc3NhYmxlRGF0YVNldFwiLCB7Y2xhc3M6IFwibG9hZC1zZWFyY2gtbGlua1wifSl9XG4gICAgICAgICAgb25QcmVzcz17dGhpcy50dC5vblNlYXJjaENsaWNrZWR9XG4gICAgICAgICAgc3R5bGU9e3RoaXMuY2FjaGUoXCJsb2FkU2VhcmNoTGlua1ByZXNzYWJsZVN0eWxlXCIsIHtqdXN0aWZ5Q29udGVudDogXCJjZW50ZXJcIn0pfVxuICAgICAgICA+XG4gICAgICAgICAgPFRleHQ+XG4gICAgICAgICAgICB7c2VhcmNoLm5hbWUoKX1cbiAgICAgICAgICA8L1RleHQ+XG4gICAgICAgIDwvUHJlc3NhYmxlPlxuICAgICAgICA8VmlldyBzdHlsZT17dGhpcy5jYWNoZShcImFjdGlvbnNWaWV3U3R5bGVcIiwge2ZsZXhEaXJlY3Rpb246IFwicm93XCIsIG1hcmdpbkxlZnQ6IFwiYXV0b1wifSl9PlxuICAgICAgICAgIDxQcmVzc2FibGVcbiAgICAgICAgICAgIGRhdGFTZXQ9e3RoaXMuY2FjaGUoXCJlZGl0U2VhcmNoQnV0dG9uRGF0YVNldFwiLCB7Y2xhc3M6IFwiZWRpdC1zZWFyY2gtYnV0dG9uXCJ9KX1cbiAgICAgICAgICAgIG9uUHJlc3M9e3RoaXMudHQub25FZGl0UHJlc3NlZH1cbiAgICAgICAgICAgIHN0eWxlPXt0aGlzLmNhY2hlKFwiZWRpdFNlYXJjaEJ1dHRvblN0eWxlXCIsIHtcbiAgICAgICAgICAgICAgYWxpZ25JdGVtczogXCJjZW50ZXJcIixcbiAgICAgICAgICAgICAganVzdGlmeUNvbnRlbnQ6IFwiY2VudGVyXCIsXG4gICAgICAgICAgICAgIHdpZHRoOiAyNSxcbiAgICAgICAgICAgICAgaGVpZ2h0OiAyNSxcbiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBcIiNmZmZcIixcbiAgICAgICAgICAgICAgYm9yZGVyOiBcIjFweCBzb2xpZCAjMDA3YmZmXCIsXG4gICAgICAgICAgICAgIGJvcmRlclJhZGl1czogNSxcbiAgICAgICAgICAgICAgY29sb3I6IFwiIzAwN2JmZlwiXG4gICAgICAgICAgICB9KX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8VGV4dD5cbiAgICAgICAgICAgICAgJiN4MjcwRTtcbiAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICA8L1ByZXNzYWJsZT5cbiAgICAgICAgICA8UHJlc3NhYmxlXG4gICAgICAgICAgICBkYXRhU2V0PXt0aGlzLmNhY2hlKFwiZGVsZXRlU2VhcmNoQnV0dG9uRGF0YVNldFwiLCB7Y2xhc3M6IFwiZGVsZXRlLXNlYXJjaC1idXR0b25cIn0pfVxuICAgICAgICAgICAgb25QcmVzcz17dGhpcy50dC5vbkRlbGV0ZVByZXNzZWR9XG4gICAgICAgICAgICBzdHlsZT17dGhpcy5jYWNoZShcImRlbGV0ZVNlYXJjaEJ1dHRvblN0eWxlXCIsIHtcbiAgICAgICAgICAgICAgYWxpZ25JdGVtczogXCJjZW50ZXJcIixcbiAgICAgICAgICAgICAganVzdGlmeUNvbnRlbnQ6IFwiY2VudGVyXCIsXG4gICAgICAgICAgICAgIG1hcmdpbkxlZnQ6IDUsXG4gICAgICAgICAgICAgIHdpZHRoOiAyNSxcbiAgICAgICAgICAgICAgaGVpZ2h0OiAyNSxcbiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBcIiNmZmZcIixcbiAgICAgICAgICAgICAgYm9yZGVyOiBcIjFweCBzb2xpZCAjZGMzNTQ1XCIsXG4gICAgICAgICAgICAgIGJvcmRlclJhZGl1czogNSxcbiAgICAgICAgICAgICAgY29sb3I6IFwiI2RjMzU0NVwiXG4gICAgICAgICAgICB9KX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8VGV4dD5cbiAgICAgICAgICAgICAgJiN4MjcxNTtcbiAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICA8L1ByZXNzYWJsZT5cbiAgICAgICAgPC9WaWV3PlxuICAgICAgPC9WaWV3PlxuICAgIClcbiAgfVxuXG4gIG9uRGVsZXRlUHJlc3NlZCA9IGFzeW5jICgpID0+IHtcbiAgICBpZiAoIWNvbmZpcm0oXCJBcmUgeW91IHN1cmU/XCIpKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBjb25zdCB7c2VhcmNofSA9IHRoaXMucHJvcHNcblxuICAgIGF3YWl0IHNlYXJjaC5kZXN0cm95KClcbiAgICB0aGlzLnByb3BzLm9uRGVsZXRlZCh7c2VhcmNofSlcbiAgfVxuXG4gIG9uRWRpdFByZXNzZWQgPSAoKSA9PiB0aGlzLnByb3BzLm9uRWRpdFByZXNzZWQoe3NlYXJjaDogdGhpcy5wcm9wcy5zZWFyY2h9KVxuICBvblNlYXJjaENsaWNrZWQgPSAoKSA9PiB0aGlzLnByb3BzLm9uQ2xpY2soe3NlYXJjaDogdGhpcy5wcm9wcy5zZWFyY2h9KVxufSkpXG5cbmV4cG9ydCBkZWZhdWx0IG1lbW8oc2hhcGVDb21wb25lbnQoY2xhc3MgQXBpTWFrZXJUYWJsZUZpbHRlcnNMb2FkU2VhcmNoTW9kYWwgZXh0ZW5kcyBCYXNlQ29tcG9uZW50IHtcbiAgc2V0dXAoKSB7XG4gICAgY29uc3Qge3R9ID0gdXNlSTE4bih7bmFtZXNwYWNlOiBcImpzLmFwaV9tYWtlci50YWJsZS5maWx0ZXJzLmxvYWRfc2VhcmNoX21vZGFsXCJ9KVxuXG4gICAgdGhpcy51c2VTdGF0ZXMoe1xuICAgICAgZWRpdFNlYXJjaDogdW5kZWZpbmVkLFxuICAgICAgc2VhcmNoZXM6IHVuZGVmaW5lZFxuICAgIH0pXG4gICAgdGhpcy5zZXRJbnN0YW5jZSh7dH0pXG5cbiAgICB1c2VNZW1vKCgpID0+IHtcbiAgICAgIHRoaXMubG9hZFNlYXJjaGVzKClcbiAgICB9LCBbXSlcbiAgfVxuXG4gIGxvYWRTZWFyY2hlcyA9IGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB7Y3VycmVudFVzZXJ9ID0gdGhpcy5wcm9wc1xuICAgIGNvbnN0IHVzZXJUeXBlID0gZGlnZyhjdXJyZW50VXNlci5tb2RlbENsYXNzRGF0YSgpLCBcIm5hbWVcIilcbiAgICBjb25zdCBzZWFyY2hlcyA9IGF3YWl0IFRhYmxlU2VhcmNoXG4gICAgICAucmFuc2Fjayh7dXNlcl9pZF9lcTogY3VycmVudFVzZXIuaWQoKSwgdXNlcl90eXBlX2VxOiB1c2VyVHlwZX0pXG4gICAgICAudG9BcnJheSgpXG5cbiAgICB0aGlzLnNldFN0YXRlKHtzZWFyY2hlc30pXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge3R9ID0gdGhpcy50dFxuICAgIGNvbnN0IHtjbGFzc05hbWUsIGN1cnJlbnRVc2VyLCBtb2RlbENsYXNzLCBvbkVkaXRTZWFyY2hQcmVzc2VkLCBvblJlcXVlc3RDbG9zZSwgcXVlcnlTZWFyY2hOYW1lLCAuLi5yZXN0UHJvcHN9ID0gdGhpcy5wcm9wc1xuICAgIGNvbnN0IE1vZGFsID0gYXBpTWFrZXJDb25maWcuZ2V0TW9kYWwoKVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxNb2RhbCBjbGFzc05hbWU9e2NsYXNzTmFtZXMoXCJhcGktbWFrZXItLXRhYmxlLS1maWx0ZXJzLS1sb2FkLXNlYXJjaC1tb2RhbFwiLCBjbGFzc05hbWUpfSBvblJlcXVlc3RDbG9zZT17b25SZXF1ZXN0Q2xvc2V9IHsuLi5yZXN0UHJvcHN9PlxuICAgICAgICA8Vmlldz5cbiAgICAgICAgICA8VGV4dD5cbiAgICAgICAgICAgIHt0KFwiLmNob29zZV9hX3NlYXJjaFwiLCB7ZGVmYXVsdFZhbHVlOiBcIkNob29zZSBhIHNlYXJjaFwifSl9XG4gICAgICAgICAgPC9UZXh0PlxuICAgICAgICA8L1ZpZXc+XG4gICAgICAgIHt0aGlzLnN0YXRlLnNlYXJjaGVzPy5tYXAoKHNlYXJjaCkgPT5cbiAgICAgICAgICA8U2VhcmNoTGlua1xuICAgICAgICAgICAga2V5PXtzZWFyY2guaWQoKX1cbiAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMudHQub25TZWFyY2hDbGlja2VkfVxuICAgICAgICAgICAgb25EZWxldGVkPXt0aGlzLnR0Lm9uU2VhcmNoRGVsZXRlZH1cbiAgICAgICAgICAgIG9uRWRpdFByZXNzZWQ9e29uRWRpdFNlYXJjaFByZXNzZWR9XG4gICAgICAgICAgICBzZWFyY2g9e3NlYXJjaH1cbiAgICAgICAgICAvPlxuICAgICAgICApfVxuICAgICAgPC9Nb2RhbD5cbiAgICApXG4gIH1cblxuICBvblNlYXJjaENsaWNrZWQgPSAoe3NlYXJjaH0pID0+IHtcbiAgICBjb25zdCB7b25SZXF1ZXN0Q2xvc2UsIHF1ZXJ5U2VhcmNoTmFtZX0gPSB0aGlzLnByb3BzXG4gICAgY29uc3QgcXVlcnlQYXJhbXMgPSBzZWFyY2gucXVlcnlQYXJhbXMoKVxuICAgIGNvbnN0IG5ld1BhcmFtcyA9IHt9XG5cbiAgICBuZXdQYXJhbXNbcXVlcnlTZWFyY2hOYW1lXSA9IHF1ZXJ5UGFyYW1zLm1hcCgocXVlcnlQYXJhbSkgPT4gSlNPTi5zdHJpbmdpZnkocXVlcnlQYXJhbSkpXG5cbiAgICBQYXJhbXMuY2hhbmdlUGFyYW1zKG5ld1BhcmFtcylcblxuICAgIG9uUmVxdWVzdENsb3NlKClcbiAgfVxuXG4gIG9uU2VhcmNoRGVsZXRlZCA9ICh7c2VhcmNofSkgPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgc2VhcmNoZXM6IHRoaXMuc3RhdGUuc2VhcmNoZXMuZmlsdGVyKChleGlzdGluZ1NlYXJjaCkgPT4gZXhpc3RpbmdTZWFyY2guaWQoKSAhPSBzZWFyY2guaWQoKSlcbiAgICB9KVxuICB9XG59KSlcbiJdfQ==