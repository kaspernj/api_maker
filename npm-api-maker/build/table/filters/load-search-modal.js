import React, { useMemo } from "react";
import { Pressable, View } from "react-native";
import apiMakerConfig from "@kaspernj/api-maker/build/config.js";
import BaseComponent from "../../base-component.js";
import classNames from "classnames";
import { digg } from "diggerize";
import memo from "set-state-compare/build/memo.js";
import { shapeComponent } from "set-state-compare/build/shape-component.js";
import Params from "../../params.js";
import { TableSearch } from "models.js";
import Text from "../../utils/text.js";
import useI18n from "i18n-on-steroids/src/use-i18n.mjs";
const SearchLink = memo(shapeComponent(class SearchLink extends BaseComponent {
    render() {
        const { search } = this.props;
        return (<View dataSet={this.cache("rootViewStyle", { class: "search-row", searchId: search.id() }, [search.id()])} style={this.cache("rootViewStyleStyle", { flexDirection: "row", width: "100%" })}>
        <Pressable dataSet={this.cache("loadSearchLinkPressableDataSet", { class: "load-search-link" })} onPress={this.tt.onSearchClicked} style={this.cache("loadSearchLinkPressableStyle", { justifyContent: "center" })}>
          <Text>
            {search.name()}
          </Text>
        </Pressable>
        <View style={this.cache("actionsViewStyle", { flexDirection: "row", marginLeft: "auto" })}>
          <Pressable dataSet={this.cache("editSearchButtonDataSet", { class: "edit-search-button" })} onPress={this.tt.onEditPressed} style={this.cache("editSearchButtonStyle", {
                alignItems: "center",
                justifyContent: "center",
                width: 25,
                height: 25,
                backgroundColor: "#fff",
                border: "1px solid #007bff",
                borderRadius: 5,
                color: "#007bff"
            })}>
            <Text>
              &#x270E;
            </Text>
          </Pressable>
          <Pressable dataSet={this.cache("deleteSearchButtonDataSet", { class: "delete-search-button" })} onPress={this.tt.onDeletePressed} style={this.cache("deleteSearchButtonStyle", {
                alignItems: "center",
                justifyContent: "center",
                marginLeft: 5,
                width: 25,
                height: 25,
                backgroundColor: "#fff",
                border: "1px solid #dc3545",
                borderRadius: 5,
                color: "#dc3545"
            })}>
            <Text>
              &#x2715;
            </Text>
          </Pressable>
        </View>
      </View>);
    }
    onDeletePressed = async () => {
        if (!confirm("Are you sure?")) {
            return;
        }
        const { search } = this.props;
        await search.destroy();
        this.props.onDeleted({ search });
    };
    onEditPressed = () => this.props.onEditPressed({ search: this.props.search });
    onSearchClicked = () => this.props.onClick({ search: this.props.search });
}));
export default memo(shapeComponent(class ApiMakerTableFiltersLoadSearchModal extends BaseComponent {
    setup() {
        const { t } = useI18n({ namespace: "js.api_maker.table.filters.load_search_modal" });
        this.useStates({
            editSearch: undefined,
            searches: undefined
        });
        this.setInstance({ t });
        useMemo(() => {
            this.loadSearches();
        }, []);
    }
    loadSearches = async () => {
        const { currentUser } = this.props;
        const userType = digg(currentUser.modelClassData(), "name");
        const searches = await TableSearch
            .ransack({ user_id_eq: currentUser.id(), user_type_eq: userType })
            .toArray();
        this.setState({ searches });
    };
    render() {
        const { t } = this.tt;
        const { className, currentUser, modelClass, onEditSearchPressed, onRequestClose, querySearchName, ...restProps } = this.props;
        const Modal = apiMakerConfig.getModal();
        return (<Modal className={classNames("api-maker--table--filters--load-search-modal", className)} onRequestClose={onRequestClose} {...restProps}>
        <View>
          <Text>
            {t(".choose_a_search", { defaultValue: "Choose a search" })}
          </Text>
        </View>
        {this.state.searches?.map((search) => <SearchLink key={search.id()} onClick={this.tt.onSearchClicked} onDeleted={this.tt.onSearchDeleted} onEditPressed={onEditSearchPressed} search={search}/>)}
      </Modal>);
    }
    onSearchClicked = ({ search }) => {
        const { onRequestClose, querySearchName } = this.props;
        const queryParams = search.queryParams();
        const newParams = {};
        newParams[querySearchName] = queryParams.map((queryParam) => JSON.stringify(queryParam));
        Params.changeParams(newParams);
        onRequestClose();
    };
    onSearchDeleted = ({ search }) => {
        this.setState({
            searches: this.state.searches.filter((existingSearch) => existingSearch.id() != search.id())
        });
    };
}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9hZC1zZWFyY2gtbW9kYWwuanMiLCJzb3VyY2VSb290IjoiL3NyYy8iLCJzb3VyY2VzIjpbInRhYmxlL2ZpbHRlcnMvbG9hZC1zZWFyY2gtbW9kYWwuanN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxFQUFFLEVBQUMsT0FBTyxFQUFDLE1BQU0sT0FBTyxDQUFBO0FBQ3BDLE9BQU8sRUFBQyxTQUFTLEVBQUUsSUFBSSxFQUFDLE1BQU0sY0FBYyxDQUFBO0FBQzVDLE9BQU8sY0FBYyxNQUFNLHFDQUFxQyxDQUFBO0FBQ2hFLE9BQU8sYUFBYSxNQUFNLHlCQUF5QixDQUFBO0FBQ25ELE9BQU8sVUFBVSxNQUFNLFlBQVksQ0FBQTtBQUNuQyxPQUFPLEVBQUMsSUFBSSxFQUFDLE1BQU0sV0FBVyxDQUFBO0FBQzlCLE9BQU8sSUFBSSxNQUFNLGlDQUFpQyxDQUFBO0FBQ2xELE9BQU8sRUFBQyxjQUFjLEVBQUMsTUFBTSw0Q0FBNEMsQ0FBQTtBQUN6RSxPQUFPLE1BQU0sTUFBTSxpQkFBaUIsQ0FBQTtBQUNwQyxPQUFPLEVBQUMsV0FBVyxFQUFDLE1BQU0sV0FBVyxDQUFBO0FBQ3JDLE9BQU8sSUFBSSxNQUFNLHFCQUFxQixDQUFBO0FBQ3RDLE9BQU8sT0FBTyxNQUFNLG1DQUFtQyxDQUFBO0FBRXZELE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxVQUFXLFNBQVEsYUFBYTtJQUMzRSxNQUFNO1FBQ0osTUFBTSxFQUFDLE1BQU0sRUFBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUE7UUFFM0IsT0FBTyxDQUNMLENBQUMsSUFBSSxDQUNILE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsZUFBZSxFQUFFLEVBQUMsS0FBSyxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQUUsTUFBTSxDQUFDLEVBQUUsRUFBRSxFQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQ2xH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Q0FBQyxDQUNuQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFDZixDQUNILENBQ0g7TUFBQSxFQUFFLEtBQUssQ0FBQyxDQUNULENBQUE7SUFDSCxDQUFDO0lBRUQsZUFBZSxHQUFHLENBQUMsRUFBQyxNQUFNLEVBQUMsRUFBRSxFQUFFO1FBQzdCLE1BQU0sRUFBQyxjQUFjLEVBQUUsZUFBZSxFQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQTtRQUNwRCxNQUFNLFdBQVcsR0FBRyxNQUFNLENBQUMsV0FBVyxFQUFFLENBQUE7UUFDeEMsTUFBTSxTQUFTLEdBQUcsRUFBRSxDQUFBO1FBRXBCLFNBQVMsQ0FBQyxlQUFlLENBQUMsR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUE7UUFFeEYsTUFBTSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQTtRQUU5QixjQUFjLEVBQUUsQ0FBQTtJQUNsQixDQUFDLENBQUE7SUFFRCxlQUFlLEdBQUcsQ0FBQyxFQUFDLE1BQU0sRUFBQyxFQUFFLEVBQUU7UUFDN0IsSUFBSSxDQUFDLFFBQVEsQ0FBQztZQUNaLFFBQVEsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxjQUFjLEVBQUUsRUFBRSxDQUFDLGNBQWMsQ0FBQyxFQUFFLEVBQUUsSUFBSSxNQUFNLENBQUMsRUFBRSxFQUFFLENBQUM7U0FDN0YsQ0FBQyxDQUFBO0lBQ0osQ0FBQyxDQUFBO0NBQ0YsQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHt1c2VNZW1vfSBmcm9tIFwicmVhY3RcIlxuaW1wb3J0IHtQcmVzc2FibGUsIFZpZXd9IGZyb20gXCJyZWFjdC1uYXRpdmVcIlxuaW1wb3J0IGFwaU1ha2VyQ29uZmlnIGZyb20gXCJAa2FzcGVybmovYXBpLW1ha2VyL2J1aWxkL2NvbmZpZy5qc1wiXG5pbXBvcnQgQmFzZUNvbXBvbmVudCBmcm9tIFwiLi4vLi4vYmFzZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSBcImNsYXNzbmFtZXNcIlxuaW1wb3J0IHtkaWdnfSBmcm9tIFwiZGlnZ2VyaXplXCJcbmltcG9ydCBtZW1vIGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9tZW1vLmpzXCJcbmltcG9ydCB7c2hhcGVDb21wb25lbnR9IGZyb20gXCJzZXQtc3RhdGUtY29tcGFyZS9idWlsZC9zaGFwZS1jb21wb25lbnQuanNcIlxuaW1wb3J0IFBhcmFtcyBmcm9tIFwiLi4vLi4vcGFyYW1zLmpzXCJcbmltcG9ydCB7VGFibGVTZWFyY2h9IGZyb20gXCJtb2RlbHMuanNcIlxuaW1wb3J0IFRleHQgZnJvbSBcIi4uLy4uL3V0aWxzL3RleHQuanNcIlxuaW1wb3J0IHVzZUkxOG4gZnJvbSBcImkxOG4tb24tc3Rlcm9pZHMvc3JjL3VzZS1pMThuLm1qc1wiXG5cbmNvbnN0IFNlYXJjaExpbmsgPSBtZW1vKHNoYXBlQ29tcG9uZW50KGNsYXNzIFNlYXJjaExpbmsgZXh0ZW5kcyBCYXNlQ29tcG9uZW50IHtcbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtzZWFyY2h9ID0gdGhpcy5wcm9wc1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxWaWV3XG4gICAgICAgIGRhdGFTZXQ9e3RoaXMuY2FjaGUoXCJyb290Vmlld1N0eWxlXCIsIHtjbGFzczogXCJzZWFyY2gtcm93XCIsIHNlYXJjaElkOiBzZWFyY2guaWQoKX0sIFtzZWFyY2guaWQoKV0pfVxuICAgICAgICBzdHlsZT17dGhpcy5jYWNoZShcInJvb3RWaWV3U3R5bGVTdHlsZVwiLCB7ZmxleERpcmVjdGlvbjogXCJyb3dcIiwgd2lkdGg6IFwiMTAwJVwifSl9XG4gICAgICA+XG4gICAgICAgIDxQcmVzc2FibGVcbiAgICAgICAgICBkYXRhU2V0PXt0aGlzLmNhY2hlKFwibG9hZFNlYXJjaExpbmtQcmVzc2FibGVEYXRhU2V0XCIsIHtjbGFzczogXCJsb2FkLXNlYXJjaC1saW5rXCJ9KX1cbiAgICAgICAgICBvblByZXNzPXt0aGlzLnR0Lm9uU2VhcmNoQ2xpY2tlZH1cbiAgICAgICAgICBzdHlsZT17dGhpcy5jYWNoZShcImxvYWRTZWFyY2hMaW5rUHJlc3NhYmxlU3R5bGVcIiwge2p1c3RpZnlDb250ZW50OiBcImNlbnRlclwifSl9XG4gICAgICAgID5cbiAgICAgICAgICA8VGV4dD5cbiAgICAgICAgICAgIHtzZWFyY2gubmFtZSgpfVxuICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgPC9QcmVzc2FibGU+XG4gICAgICAgIDxWaWV3IHN0eWxlPXt0aGlzLmNhY2hlKFwiYWN0aW9uc1ZpZXdTdHlsZVwiLCB7ZmxleERpcmVjdGlvbjogXCJyb3dcIiwgbWFyZ2luTGVmdDogXCJhdXRvXCJ9KX0+XG4gICAgICAgICAgPFByZXNzYWJsZVxuICAgICAgICAgICAgZGF0YVNldD17dGhpcy5jYWNoZShcImVkaXRTZWFyY2hCdXR0b25EYXRhU2V0XCIsIHtjbGFzczogXCJlZGl0LXNlYXJjaC1idXR0b25cIn0pfVxuICAgICAgICAgICAgb25QcmVzcz17dGhpcy50dC5vbkVkaXRQcmVzc2VkfVxuICAgICAgICAgICAgc3R5bGU9e3RoaXMuY2FjaGUoXCJlZGl0U2VhcmNoQnV0dG9uU3R5bGVcIiwge1xuICAgICAgICAgICAgICBhbGlnbkl0ZW1zOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgICBqdXN0aWZ5Q29udGVudDogXCJjZW50ZXJcIixcbiAgICAgICAgICAgICAgd2lkdGg6IDI1LFxuICAgICAgICAgICAgICBoZWlnaHQ6IDI1LFxuICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IFwiI2ZmZlwiLFxuICAgICAgICAgICAgICBib3JkZXI6IFwiMXB4IHNvbGlkICMwMDdiZmZcIixcbiAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiA1LFxuICAgICAgICAgICAgICBjb2xvcjogXCIjMDA3YmZmXCJcbiAgICAgICAgICAgIH0pfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxUZXh0PlxuICAgICAgICAgICAgICAmI3gyNzBFO1xuICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgIDwvUHJlc3NhYmxlPlxuICAgICAgICAgIDxQcmVzc2FibGVcbiAgICAgICAgICAgIGRhdGFTZXQ9e3RoaXMuY2FjaGUoXCJkZWxldGVTZWFyY2hCdXR0b25EYXRhU2V0XCIsIHtjbGFzczogXCJkZWxldGUtc2VhcmNoLWJ1dHRvblwifSl9XG4gICAgICAgICAgICBvblByZXNzPXt0aGlzLnR0Lm9uRGVsZXRlUHJlc3NlZH1cbiAgICAgICAgICAgIHN0eWxlPXt0aGlzLmNhY2hlKFwiZGVsZXRlU2VhcmNoQnV0dG9uU3R5bGVcIiwge1xuICAgICAgICAgICAgICBhbGlnbkl0ZW1zOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgICBqdXN0aWZ5Q29udGVudDogXCJjZW50ZXJcIixcbiAgICAgICAgICAgICAgbWFyZ2luTGVmdDogNSxcbiAgICAgICAgICAgICAgd2lkdGg6IDI1LFxuICAgICAgICAgICAgICBoZWlnaHQ6IDI1LFxuICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IFwiI2ZmZlwiLFxuICAgICAgICAgICAgICBib3JkZXI6IFwiMXB4IHNvbGlkICNkYzM1NDVcIixcbiAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiA1LFxuICAgICAgICAgICAgICBjb2xvcjogXCIjZGMzNTQ1XCJcbiAgICAgICAgICAgIH0pfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxUZXh0PlxuICAgICAgICAgICAgICAmI3gyNzE1O1xuICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgIDwvUHJlc3NhYmxlPlxuICAgICAgICA8L1ZpZXc+XG4gICAgICA8L1ZpZXc+XG4gICAgKVxuICB9XG5cbiAgb25EZWxldGVQcmVzc2VkID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmICghY29uZmlybShcIkFyZSB5b3Ugc3VyZT9cIikpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGNvbnN0IHtzZWFyY2h9ID0gdGhpcy5wcm9wc1xuXG4gICAgYXdhaXQgc2VhcmNoLmRlc3Ryb3koKVxuICAgIHRoaXMucHJvcHMub25EZWxldGVkKHtzZWFyY2h9KVxuICB9XG5cbiAgb25FZGl0UHJlc3NlZCA9ICgpID0+IHRoaXMucHJvcHMub25FZGl0UHJlc3NlZCh7c2VhcmNoOiB0aGlzLnByb3BzLnNlYXJjaH0pXG4gIG9uU2VhcmNoQ2xpY2tlZCA9ICgpID0+IHRoaXMucHJvcHMub25DbGljayh7c2VhcmNoOiB0aGlzLnByb3BzLnNlYXJjaH0pXG59KSlcblxuZXhwb3J0IGRlZmF1bHQgbWVtbyhzaGFwZUNvbXBvbmVudChjbGFzcyBBcGlNYWtlclRhYmxlRmlsdGVyc0xvYWRTZWFyY2hNb2RhbCBleHRlbmRzIEJhc2VDb21wb25lbnQge1xuICBzZXR1cCgpIHtcbiAgICBjb25zdCB7dH0gPSB1c2VJMThuKHtuYW1lc3BhY2U6IFwianMuYXBpX21ha2VyLnRhYmxlLmZpbHRlcnMubG9hZF9zZWFyY2hfbW9kYWxcIn0pXG5cbiAgICB0aGlzLnVzZVN0YXRlcyh7XG4gICAgICBlZGl0U2VhcmNoOiB1bmRlZmluZWQsXG4gICAgICBzZWFyY2hlczogdW5kZWZpbmVkXG4gICAgfSlcbiAgICB0aGlzLnNldEluc3RhbmNlKHt0fSlcblxuICAgIHVzZU1lbW8oKCkgPT4ge1xuICAgICAgdGhpcy5sb2FkU2VhcmNoZXMoKVxuICAgIH0sIFtdKVxuICB9XG5cbiAgbG9hZFNlYXJjaGVzID0gYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHtjdXJyZW50VXNlcn0gPSB0aGlzLnByb3BzXG4gICAgY29uc3QgdXNlclR5cGUgPSBkaWdnKGN1cnJlbnRVc2VyLm1vZGVsQ2xhc3NEYXRhKCksIFwibmFtZVwiKVxuICAgIGNvbnN0IHNlYXJjaGVzID0gYXdhaXQgVGFibGVTZWFyY2hcbiAgICAgIC5yYW5zYWNrKHt1c2VyX2lkX2VxOiBjdXJyZW50VXNlci5pZCgpLCB1c2VyX3R5cGVfZXE6IHVzZXJUeXBlfSlcbiAgICAgIC50b0FycmF5KClcblxuICAgIHRoaXMuc2V0U3RhdGUoe3NlYXJjaGVzfSlcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7dH0gPSB0aGlzLnR0XG4gICAgY29uc3Qge2NsYXNzTmFtZSwgY3VycmVudFVzZXIsIG1vZGVsQ2xhc3MsIG9uRWRpdFNlYXJjaFByZXNzZWQsIG9uUmVxdWVzdENsb3NlLCBxdWVyeVNlYXJjaE5hbWUsIC4uLnJlc3RQcm9wc30gPSB0aGlzLnByb3BzXG4gICAgY29uc3QgTW9kYWwgPSBhcGlNYWtlckNvbmZpZy5nZXRNb2RhbCgpXG5cbiAgICByZXR1cm4gKFxuICAgICAgPE1vZGFsIGNsYXNzTmFtZT17Y2xhc3NOYW1lcyhcImFwaS1tYWtlci0tdGFibGUtLWZpbHRlcnMtLWxvYWQtc2VhcmNoLW1vZGFsXCIsIGNsYXNzTmFtZSl9IG9uUmVxdWVzdENsb3NlPXtvblJlcXVlc3RDbG9zZX0gey4uLnJlc3RQcm9wc30+XG4gICAgICAgIDxWaWV3PlxuICAgICAgICAgIDxUZXh0PlxuICAgICAgICAgICAge3QoXCIuY2hvb3NlX2Ffc2VhcmNoXCIsIHtkZWZhdWx0VmFsdWU6IFwiQ2hvb3NlIGEgc2VhcmNoXCJ9KX1cbiAgICAgICAgICA8L1RleHQ+XG4gICAgICAgIDwvVmlldz5cbiAgICAgICAge3RoaXMuc3RhdGUuc2VhcmNoZXM/Lm1hcCgoc2VhcmNoKSA9PlxuICAgICAgICAgIDxTZWFyY2hMaW5rXG4gICAgICAgICAgICBrZXk9e3NlYXJjaC5pZCgpfVxuICAgICAgICAgICAgb25DbGljaz17dGhpcy50dC5vblNlYXJjaENsaWNrZWR9XG4gICAgICAgICAgICBvbkRlbGV0ZWQ9e3RoaXMudHQub25TZWFyY2hEZWxldGVkfVxuICAgICAgICAgICAgb25FZGl0UHJlc3NlZD17b25FZGl0U2VhcmNoUHJlc3NlZH1cbiAgICAgICAgICAgIHNlYXJjaD17c2VhcmNofVxuICAgICAgICAgIC8+XG4gICAgICAgICl9XG4gICAgICA8L01vZGFsPlxuICAgIClcbiAgfVxuXG4gIG9uU2VhcmNoQ2xpY2tlZCA9ICh7c2VhcmNofSkgPT4ge1xuICAgIGNvbnN0IHtvblJlcXVlc3RDbG9zZSwgcXVlcnlTZWFyY2hOYW1lfSA9IHRoaXMucHJvcHNcbiAgICBjb25zdCBxdWVyeVBhcmFtcyA9IHNlYXJjaC5xdWVyeVBhcmFtcygpXG4gICAgY29uc3QgbmV3UGFyYW1zID0ge31cblxuICAgIG5ld1BhcmFtc1txdWVyeVNlYXJjaE5hbWVdID0gcXVlcnlQYXJhbXMubWFwKChxdWVyeVBhcmFtKSA9PiBKU09OLnN0cmluZ2lmeShxdWVyeVBhcmFtKSlcblxuICAgIFBhcmFtcy5jaGFuZ2VQYXJhbXMobmV3UGFyYW1zKVxuXG4gICAgb25SZXF1ZXN0Q2xvc2UoKVxuICB9XG5cbiAgb25TZWFyY2hEZWxldGVkID0gKHtzZWFyY2h9KSA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBzZWFyY2hlczogdGhpcy5zdGF0ZS5zZWFyY2hlcy5maWx0ZXIoKGV4aXN0aW5nU2VhcmNoKSA9PiBleGlzdGluZ1NlYXJjaC5pZCgpICE9IHNlYXJjaC5pZCgpKVxuICAgIH0pXG4gIH1cbn0pKVxuIl19